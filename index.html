<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/blog/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/blog/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="爱好电影，更爱女神阿佳妮；爱网球，更爱罗杰费德勒。网易云音乐深度用户">
<meta property="og:type" content="website">
<meta property="og:title" content="jhgrrewq 前端小站">
<meta property="og:url" content="http://jhgrrewq.github.io/index.html">
<meta property="og:site_name" content="jhgrrewq 前端小站">
<meta property="og:description" content="爱好电影，更爱女神阿佳妮；爱网球，更爱罗杰费德勒。网易云音乐深度用户">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jhgrrewq 前端小站">
<meta name="twitter:description" content="爱好电影，更爱女神阿佳妮；爱网球，更爱罗杰费德勒。网易云音乐深度用户">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'O0AP0FGXSX',
      apiKey: 'ab7c2224e88a925feeea82c8902add9d',
      indexName: 'jhgrrewq',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jhgrrewq.github.io/">





  <title>jhgrrewq 前端小站</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jhgrrewq 前端小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">置我于死地者 必将赐我以后生</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2021/12/29/cci-map 统一服务规范/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2021/12/29/cci-map 统一服务规范/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-12-29T17:02:19+08:00">
                2021-12-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><h3 id="1-地理应用分层"><a href="#1-地理应用分层" class="headerlink" title="1.   地理应用分层"></a>1.   地理应用分层</h3><p><img src="https://z3.ax1x.com/2021/10/11/5VoPpt.png" alt></p>
<h3 id="2-cci-map-介绍"><a href="#2-cci-map-介绍" class="headerlink" title="2. cci-map 介绍"></a>2. cci-map 介绍</h3><p>cci-map 是基于 @antv/l7 二次开发的地图渲染引擎，使用 WebGL 渲染技术可支持海量数据点加载，功能包括：地图底图切换、地图控制组件、可视化图层等。(L7 是蚂蚁金服基于 WebGL 的开源大规模地理空间数据可视分析开发框: 2D，3D 一体化的海量数据高性能渲染; 支持 CSV，JSON，geojson 等数据格式接入，可按需求自定义数据格式; 多地图底图支持，支持离线内网部署，见文档<a href="https://l7.antv.vision/zh/docs/api/map" target="_blank" rel="noopener">https://l7.antv.vision/zh/docs/api/map</a>)</p>
<p><img src="https://z3.ax1x.com/2021/10/11/5VokX8.png" alt></p>
<h3 id="3-安装"><a href="#3-安装" class="headerlink" title="3. 安装"></a>3. 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 使用cci 私有仓库</span></span><br><span class="line"></span><br><span class="line">npm config <span class="built_in">set</span> registry http://ccinpm.citycloud.com.cn</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 推荐使用 nrm 管理 registry</span></span><br><span class="line"></span><br><span class="line">  npm install nrm -g</span><br><span class="line"></span><br><span class="line">  nrm add cci http://ccinpm.citycloud.com.cn</span><br><span class="line"></span><br><span class="line">  nrm ls <span class="comment">#查看registry列表</span></span><br><span class="line"></span><br><span class="line">  nrm use cci <span class="comment">#使用 cci 仓库</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 安装依赖</span></span><br><span class="line">npm install cci-map</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 推荐使用 yarn 安装依赖, 必要是可以删除 yarn.lock 文件重新安装</span></span><br><span class="line">  <span class="comment"># 安装 yarn</span></span><br><span class="line">  npm install yarn -g</span><br><span class="line"></span><br><span class="line">  yarn add cci-map</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 使用绘制工具需要安装依赖</span></span><br><span class="line"> 	npm install cci-lib-l7-draw</span><br><span class="line"> 	yarn add cci-lib-l7-draw</span><br></pre></td></tr></table></figure>
<h3 id="4-快速上手"><a href="#4-快速上手" class="headerlink" title="4. 快速上手"></a>4. 快速上手</h3><p>cci-map 兼容 @antv/l7用法，暴露 CMap 类作为场景构造类（@antv/l7对应 Scene 类），并对 @antv/l7 升级和扩展了部分功能。</p>
<h4 id="4-1-cci-map-使用-ES-module-引入"><a href="#4-1-cci-map-使用-ES-module-引入" class="headerlink" title="4.1 cci-map 使用 ES module 引入"></a>4.1 cci-map 使用 ES module 引入</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cmap = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    zoom: <span class="number">4</span>, <span class="comment">// 初始化地图层级</span></span><br><span class="line">    pitch: <span class="number">50</span>,</span><br><span class="line">    rotation: <span class="number">0</span>,</span><br><span class="line">    maxZoom: <span class="number">30</span>,</span><br><span class="line">    minZoom: <span class="number">0</span>,</span><br><span class="line">    center: [<span class="number">105.404</span>, <span class="number">28.915</span>], <span class="comment">// 初始化地图中心点</span></span><br><span class="line">    token: <span class="string">'48463d4ad0a6bd804a336d9ed317717e'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">cmap.on(<span class="string">'loaded'</span>, () =&gt; &#123;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="4-2-cci-map-使用-script-脚本引入"><a href="#4-2-cci-map-使用-script-脚本引入" class="headerlink" title="4.2 cci-map 使用 script 脚本引入"></a>4.2 cci-map 使用 script 脚本引入</h4><p>如需引用第三方地图API，请确保在先引入第三方API后再引入 cci-map ( 目前 umd 版本在 cci-map 库 dist 目录下 index.umd.js 文件，后续会开放 cdn )</p>
<p><strong>所有构造类和方法在命名空间 CciMap 下</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span> = <span class="string">'cci-map/dist/index.umd.js'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="4-2-1-使用高德地图"><a href="#4-2-1-使用高德地图" class="headerlink" title="4.2.1 使用高德地图"></a>4.2.1 使用高德地图</h5><ul>
<li>注册账号并申请Key</li>
</ul>
<ol>
<li>首先，<a href="https://lbs.amap.com/dev/id/choose" target="_blank" rel="noopener">注册开发者账号</a>，成为高德开放平台开发者</li>
<li>登陆之后，在进入「应用管理」 页面「创建新应用」</li>
<li>为应用<a href="https://lbs.amap.com/dev/key/app" target="_blank" rel="noopener">添加 Key</a>，「服务平台」一项请选择「 Web 端 ( JSAPI ) 」</li>
</ol>
<ul>
<li>引入 cci-map 脚本</li>
</ul>
<p>2.0版本在cci-map内部动态引入了高德地图JS API，因此不再需要单独引入高德JS API，只需设置 type 为 <code>amap</code> 并且传入token</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'cci-map/dist/index.umd.js'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>完整代码</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>创建地图场景<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">       <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">margin</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="css">    	<span class="selector-id">#map</span> &#123; <span class="attribute">position</span>:absolute; <span class="attribute">top</span>:<span class="number">0</span>; <span class="attribute">bottom</span>:<span class="number">0</span>; <span class="attribute">width</span>:<span class="number">100%</span>; &#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"map"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1. 需要先引入第三方地图 api --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2. 引入 cci-map 脚本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"cci-map/dist/index.umd.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 3. 初始化 cci-map 场景构造类</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> scene = <span class="keyword">new</span> CciMap.CMap(&#123;</span></span><br><span class="line"><span class="javascript">    id: <span class="string">'map'</span>,</span></span><br><span class="line"><span class="javascript">    map: <span class="keyword">new</span> CciMap.GaodeMap(&#123;</span></span><br><span class="line"><span class="javascript">      style: <span class="string">'dark'</span>, <span class="comment">// 样式URL</span></span></span><br><span class="line">      center: [120.19382669582967, 30.258134],</span><br><span class="line">      pitch: 0,</span><br><span class="line">      zoom: 12,</span><br><span class="line"><span class="javascript">      token: <span class="string">'高德地图token'</span>,</span></span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">	</span><br><span class="line"><span class="javascript">  <span class="comment">// 4. 添加可视化图层(获取数据后初始化图层)</span></span></span><br><span class="line"><span class="javascript">	fetch(<span class="string">'https://gw.alipayobjects.com/os/rmsportal/oVTMqfzuuRFKiDwhPSFL.json'</span>)</span></span><br><span class="line"><span class="javascript">  .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span></span><br><span class="line"><span class="javascript">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> pointLayer = <span class="keyword">new</span> CciMap.PointLayer(&#123;&#125;)</span></span><br><span class="line">      .source(data.list, &#123;</span><br><span class="line">        parser: &#123;</span><br><span class="line"><span class="javascript">          type: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="javascript">          x: <span class="string">'j'</span>,</span></span><br><span class="line"><span class="javascript">          y: <span class="string">'w'</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">      .shape(<span class="string">'cylinder'</span>)</span></span><br><span class="line"><span class="javascript">      .size(<span class="string">'t'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">level</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> [ <span class="number">1</span>, <span class="number">2</span>, level * <span class="number">2</span> + <span class="number">20</span> ];</span></span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">      .color(<span class="string">'t'</span>, [</span></span><br><span class="line"><span class="javascript">        <span class="string">'#094D4A'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#146968'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#1D7F7E'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#289899'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#34B6B7'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#4AC5AF'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#5FD3A6'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#7BE39E'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#A1EDB8'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#CEF8D6'</span></span></span><br><span class="line">      ])</span><br><span class="line">      .style(&#123;</span><br><span class="line">        opacity: 1.0</span><br><span class="line">      &#125;);</span><br><span class="line">    scene.addLayer(pointLayer);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="4-2-2-使用-mapbox"><a href="#4-2-2-使用-mapbox" class="headerlink" title="4.2.2 使用 mapbox"></a>4.2.2 使用 mapbox</h5><ul>
<li>注册MapBox token</li>
</ul>
<p>注册地址 <a href="https://docs.mapbox.com/help/how-mapbox-works/access-tokens/#creating-and-managing-access-tokens" target="_blank" rel="noopener">Mapbox Access Tokens</a></p>
<ul>
<li>引入mapbox.gl JS 和 css</li>
</ul>
<p>使用mapbox 需要单独引入 mapbox</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">'https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css'</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>引入 cci-map 脚本</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'cci-map/dist/index.umd.js'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>完整代码</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>创建地图场景<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-pseudo">::-webkit-scrollbar</span>&#123;<span class="attribute">display</span>:none;&#125;<span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">margin</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="css">    	<span class="selector-id">#map</span> &#123; <span class="attribute">position</span>:absolute; <span class="attribute">top</span>:<span class="number">0</span>; <span class="attribute">bottom</span>:<span class="number">0</span>; <span class="attribute">width</span>:<span class="number">100%</span>; &#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"map"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 1. 需要先引入第三方地图 api --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">'https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css'</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 2. 引入 cci-map 脚本 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"cci-map/dist/index.umd.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 3. 初始化 cci-map 场景构造类</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> scene = <span class="keyword">new</span> CciMap.CMap(&#123;</span></span><br><span class="line"><span class="javascript">    id: <span class="string">'map'</span>,</span></span><br><span class="line"><span class="javascript">    map: <span class="keyword">new</span> CciMap.Mapbox(&#123;</span></span><br><span class="line"><span class="javascript">      style: <span class="string">'dark'</span>, <span class="comment">// 样式URL</span></span></span><br><span class="line">      center: [120.19382669582967, 30.258134],</span><br><span class="line">      pitch: 0,</span><br><span class="line">      zoom: 12,</span><br><span class="line"><span class="javascript">      token: <span class="string">'mapbox token'</span>,</span></span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript"><span class="comment">// 4. 添加可视化图层(获取数据后初始化图层)</span></span></span><br><span class="line"><span class="javascript">fetch(<span class="string">'https://gw.alipayobjects.com/os/rmsportal/oVTMqfzuuRFKiDwhPSFL.json'</span>)</span></span><br><span class="line"><span class="javascript">  .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span></span><br><span class="line"><span class="javascript">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> pointLayer = <span class="keyword">new</span> CciMap.PointLayer(&#123;&#125;)</span></span><br><span class="line">      .source(data.list, &#123;</span><br><span class="line">        parser: &#123;</span><br><span class="line"><span class="javascript">          type: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="javascript">          x: <span class="string">'j'</span>,</span></span><br><span class="line"><span class="javascript">          y: <span class="string">'w'</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">      .shape(<span class="string">'cylinder'</span>)</span></span><br><span class="line"><span class="javascript">      .size(<span class="string">'t'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">level</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> [ <span class="number">1</span>, <span class="number">2</span>, level * <span class="number">2</span> + <span class="number">20</span> ];</span></span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">      .color(<span class="string">'t'</span>, [</span></span><br><span class="line"><span class="javascript">        <span class="string">'#094D4A'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#146968'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#1D7F7E'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#289899'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#34B6B7'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#4AC5AF'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#5FD3A6'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#7BE39E'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#A1EDB8'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#CEF8D6'</span></span></span><br><span class="line">      ])</span><br><span class="line">      .style(&#123;</span><br><span class="line">        opacity: 1.0</span><br><span class="line">      &#125;);</span><br><span class="line">    scene.addLayer(pointLayer);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="4-2-3-使用-maptalks"><a href="#4-2-3-使用-maptalks" class="headerlink" title="4.2.3 使用 maptalks"></a>4.2.3 使用 maptalks</h5><ul>
<li>引入maptalks JS 和 css</li>
</ul>
<p>使用mapbox 需要单独引入 mapbox</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"https://cdn.bootcdn.net/ajax/libs/maptalks/0.49.0/maptalks.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcdn.net/ajax/libs/maptalks/0.49.0/maptalks.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>引入 cci-map 脚本</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'cci-map/dist/index.umd.js'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>完整代码</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>创建地图场景<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-pseudo">::-webkit-scrollbar</span>&#123;<span class="attribute">display</span>:none;&#125;<span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">margin</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="css">    	<span class="selector-id">#map</span> &#123; <span class="attribute">position</span>:absolute; <span class="attribute">top</span>:<span class="number">0</span>; <span class="attribute">bottom</span>:<span class="number">0</span>; <span class="attribute">width</span>:<span class="number">100%</span>; &#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"map"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 1. 需要先引入第三方地图 api --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"https://cdn.bootcdn.net/ajax/libs/maptalks/0.49.0/maptalks.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcdn.net/ajax/libs/maptalks/0.49.0/maptalks.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 2. 引入 cci-map 脚本 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"cci-map/dist/index.umd.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 3. 初始化 cci-map 场景构造类</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> scene = <span class="keyword">new</span> CciMap.CMap(&#123;</span></span><br><span class="line"><span class="javascript">    id: <span class="string">'map'</span>,</span></span><br><span class="line"><span class="javascript">    map: <span class="keyword">new</span> CciMap.MapTalks(&#123;</span></span><br><span class="line"><span class="javascript">      style: <span class="string">'dark'</span>, <span class="comment">// 样式URL</span></span></span><br><span class="line">      center: [120.19382669582967, 30.258134],</span><br><span class="line">      pitch: 0,</span><br><span class="line">      zoom: 12</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript"><span class="comment">// 4. 添加可视化图层(获取数据后初始化图层)</span></span></span><br><span class="line"><span class="javascript">fetch(<span class="string">'https://gw.alipayobjects.com/os/rmsportal/oVTMqfzuuRFKiDwhPSFL.json'</span>)</span></span><br><span class="line"><span class="javascript">  .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span></span><br><span class="line"><span class="javascript">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> pointLayer = <span class="keyword">new</span> CciMap.PointLayer(&#123;&#125;)</span></span><br><span class="line">      .source(data.list, &#123;</span><br><span class="line">        parser: &#123;</span><br><span class="line"><span class="javascript">          type: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="javascript">          x: <span class="string">'j'</span>,</span></span><br><span class="line"><span class="javascript">          y: <span class="string">'w'</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">      .shape(<span class="string">'cylinder'</span>)</span></span><br><span class="line"><span class="javascript">      .size(<span class="string">'t'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">level</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> [ <span class="number">1</span>, <span class="number">2</span>, level * <span class="number">2</span> + <span class="number">20</span> ];</span></span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">      .color(<span class="string">'t'</span>, [</span></span><br><span class="line"><span class="javascript">        <span class="string">'#094D4A'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#146968'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#1D7F7E'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#289899'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#34B6B7'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#4AC5AF'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#5FD3A6'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#7BE39E'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#A1EDB8'</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">'#CEF8D6'</span></span></span><br><span class="line">      ])</span><br><span class="line">      .style(&#123;</span><br><span class="line">        opacity: 1.0</span><br><span class="line">      &#125;);</span><br><span class="line">    scene.addLayer(pointLayer);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3-cci-lib-draw-快速上手"><a href="#4-3-cci-lib-draw-快速上手" class="headerlink" title="4.3 cci-lib-draw 快速上手"></a>4.3 cci-lib-draw 快速上手</h4><h5 id="4-3-1-使用"><a href="#4-3-1-使用" class="headerlink" title="4.3.1 使用"></a>4.3.1 使用</h5><ul>
<li>es6 module</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; DrawControl &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>使用 script 脚本引入</p>
<p>如需引用第三方地图API，请确保在先引入第三方API后再引入 cci-map,  再引入 cci-lib-l7-draw ( 目前 umd 版本在 cci-lib-l7-draw 库 dist 目录下 index.umd.js 文件，后续会开放 cdn )</p>
<p><strong>所有构造类和方法在命名空间 CciMapDraw 下</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'cci-lib-l7-draw/dist/index.umd.js'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="4-3-2-实例化"><a href="#4-3-2-实例化" class="headerlink" title="4.3.2 实例化"></a>4.3.2 实例化</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> control = <span class="keyword">new</span> DrawControl(scene, option)</span><br><span class="line">scene.addControl(control)</span><br></pre></td></tr></table></figure>
<h2 id="二、-自定义投影坐标系"><a href="#二、-自定义投影坐标系" class="headerlink" title="二、 自定义投影坐标系"></a>二、 自定义投影坐标系</h2><p>l7 只接入高德和 mapbox 地图引擎，而 cci-map 还接入了 maptalks。对于自定义天地图投影需求，可以指定底图为 maptalks，结合 proj4 实现。</p>
<ul>
<li><a href="http://proj4js.org/" target="_blank" rel="noopener">Proj4js</a> 是地理坐标参考系的转换javascript库, 它同时支持不同大地基准面的转换</li>
<li>对于不同坐标系，默认 resolution 和 fullExtent 参考 maptalks 源码 DefaultSpatialReference 部分（定义了 EPSG3857，EPSG4490，EPSG4326，百度等）</li>
</ul>
<h4 id="2-1-maptalks-自定义投影-EPSG4490-天地图"><a href="#2-1-maptalks-自定义投影-EPSG4490-天地图" class="headerlink" title="2.1 maptalks 自定义投影 EPSG4490 天地图"></a>2.1 maptalks 自定义投影 EPSG4490 天地图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  import &#123; CMap, MapTalks, WMSLayer &#125; from &apos;cci-map&apos;</span><br><span class="line">  // import &#123; CMap, MapTalks &#125; from &apos;cci-map&apos;</span><br><span class="line">  // import &#123; WMSLayer &#125; from &apos;cci-layers&apos;</span><br><span class="line">  import * as maptalks from &apos;maptalks&apos;</span><br><span class="line">  import proj4 from &apos;proj4&apos;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    beforeDestroy() &#123;</span><br><span class="line">      this.scene.destroy()</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">      // 对比 leaflet proj4 设置</span><br><span class="line">      /* const CRS_4490 = new L.Proj.CRS(</span><br><span class="line">        &quot;EPSG:4490&quot;,</span><br><span class="line">        &quot;+proj=longlat +ellps=GRS80 +no_defs&quot;,</span><br><span class="line">        &#123;</span><br><span class="line">          resolutions: [</span><br><span class="line">            0.00549933137239034, // Level 0</span><br><span class="line">            0.00274966568619517, // Level 1</span><br><span class="line">            0.00137483284309758, // Level 2</span><br><span class="line">            0.000687416421548792, // Level 3</span><br><span class="line">            0.000343708210774396, // Level 4</span><br><span class="line">            0.000171854105387198,</span><br><span class="line">            8.5927052693599e-5,</span><br><span class="line">            4.29635263467995e-5,</span><br><span class="line">            2.14817631733998e-5,</span><br><span class="line">            1.07408815866999e-5,</span><br><span class="line">            5.37044079334994e-6,</span><br><span class="line">            2.68522039667497e-6,</span><br><span class="line">            1.34261019833748e-6</span><br><span class="line">          ],</span><br><span class="line">          origin: [118.122911693886, 31.2869311022836]</span><br><span class="line">        &#125;</span><br><span class="line">      ) */</span><br><span class="line">      </span><br><span class="line">      // 自定义投影坐标系天地图</span><br><span class="line">      /* proj4.defs(&apos;EPSG4490&apos;, &quot;+proj=longlat +ellps=GRS80 +no_defs&quot;)</span><br><span class="line">      const projection = proj4(&apos;EPSG4490&apos;) */</span><br><span class="line">      const proj4490 = &quot;+proj=longlat +ellps=GRS80 +no_defs&quot;</span><br><span class="line">      const projection = proj4(&apos;WGS84&apos;, proj4490)</span><br><span class="line">      const spatialReference = &#123;</span><br><span class="line">        projection: &#123;</span><br><span class="line">          code: &apos;EPSG4490&apos;,</span><br><span class="line">          project: function(c) &#123;</span><br><span class="line">            const pc = projection.forward(c.toArray())</span><br><span class="line">            return new maptalks.Coordinate(pc)</span><br><span class="line">          &#125;,</span><br><span class="line">          unproject: function(pc) &#123;</span><br><span class="line">            const c = projection.inverse(pc.toArray())</span><br><span class="line">            return new maptalks.Coordinate(c)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        resolutions: [</span><br><span class="line">          0.00549933137239034, // Level 0</span><br><span class="line">          0.00274966568619517, // Level 1</span><br><span class="line">          0.00137483284309758, // Level 2</span><br><span class="line">          0.000687416421548792, // Level 3</span><br><span class="line">          0.000343708210774396, // Level 4</span><br><span class="line">          0.000171854105387198,</span><br><span class="line">          8.5927052693599e-5,</span><br><span class="line">          4.29635263467995e-5,</span><br><span class="line">          2.14817631733998e-5,</span><br><span class="line">          1.07408815866999e-5,</span><br><span class="line">          5.37044079334994e-6,</span><br><span class="line">          2.68522039667497e-6,</span><br><span class="line">          1.34261019833748e-6</span><br><span class="line">        ],</span><br><span class="line">        &apos;fullExtent&apos;: &#123;</span><br><span class="line">          &apos;top&apos;: 90,</span><br><span class="line">          &apos;left&apos;: -180,</span><br><span class="line">          &apos;bottom&apos;: -90,</span><br><span class="line">          &apos;right&apos;: 180</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      const mapInstance = new maptalks.Map(&apos;map&apos;, &#123;</span><br><span class="line">        center: [119.822911693886, 30.0869311022836],</span><br><span class="line">        zoom: 0,</span><br><span class="line">        spatialReference, // 地图需要设置 spatialReference</span><br><span class="line">        baseLayer: new maptalks.TileLayer(&apos;base&apos;, &#123;</span><br><span class="line">          urlTemplate: &apos;http://183.134.200.102:8080/DD1223/E36CCEA93443D1495DB9B9F2B2FFE348CB1A367D75176F815040AB19E54CDCA5DAAA25813AF965E2ABD0CC2463DD1223/PBS/rest/services/hzsyvector/Mapserver/tile/&#123;z&#125;/&#123;y&#125;/&#123;x&#125;&apos;,</span><br><span class="line">          spatialReference,</span><br><span class="line">          tileSystem: [1, -1, 118.122911693886, 31.2869311022836]  // 要设置图层 spatialReference 和 tileSystem</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      const scene = new CMap(&#123;</span><br><span class="line">        id: &apos;map&apos;,</span><br><span class="line">        map: new MapTalks(&#123;</span><br><span class="line">          mapInstance</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      this.scene = scene</span><br><span class="line"></span><br><span class="line">      scene.on(&apos;loaded&apos;, () =&gt; &#123;</span><br><span class="line">        const layer = new WMSLayer(&#123;</span><br><span class="line">          tileSize: 256</span><br><span class="line">        &#125;)</span><br><span class="line">        layer.source(</span><br><span class="line">          &#123;</span><br><span class="line">            url: &apos;/geoserver/wms&apos;,</span><br><span class="line">            params: &#123;</span><br><span class="line">              layers: &apos;multi_polygon&apos;,</span><br><span class="line">              version: &apos;1.1.1&apos;,</span><br><span class="line">              format: &apos;image/png&apos;,</span><br><span class="line">              transparent: true</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            parser: &#123;</span><br><span class="line">              type: &apos;wms&apos;,</span><br><span class="line">              crs: &apos;EPSG:4326&apos;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">        scene.addLayer(layer)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    id=&quot;map&quot;</span><br><span class="line">    style=&quot;</span><br><span class="line">      position: absolute;</span><br><span class="line">      top: 0;</span><br><span class="line">      left: 0;</span><br><span class="line">      right: 0;</span><br><span class="line">      bottom: 0;</span><br><span class="line">    &quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-proj4js来实现默认的EPSG-3857空间"><a href="#2-2-proj4js来实现默认的EPSG-3857空间" class="headerlink" title="2.2 proj4js来实现默认的EPSG:3857空间"></a>2.2 proj4js来实现默认的EPSG:3857空间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div style=&quot;width:100%;height:100%&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;map&quot;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; CMap, MapTalks &#125; from &apos;cci-map&apos;</span><br><span class="line">import * as maptalks from &apos;maptalks&apos;</span><br><span class="line">import proj4 from &apos;proj4&apos;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">     // EPSG:3857&apos;s proj definition</span><br><span class="line">      var proj3857 = &apos;+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs&apos;;</span><br><span class="line">      const proj = proj4(&apos;WGS84&apos;, proj3857);</span><br><span class="line"></span><br><span class="line">      // define a custom projection object</span><br><span class="line">      var projection = &#123;</span><br><span class="line">        code : &apos;proj4-merc&apos;,  // code of the projection</span><br><span class="line"></span><br><span class="line">        project : function (c) &#123; // from wgs84 to EPSG3857</span><br><span class="line">          var pc = proj.forward(c.toArray());</span><br><span class="line">          return new maptalks.Coordinate(pc);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        unproject : function (pc) &#123; // from EPSG3857 to wgs84</span><br><span class="line">          var c = proj.inverse(pc.toArray());</span><br><span class="line">          return new maptalks.Coordinate(c);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      var mapInstance = new maptalks.Map(&apos;map&apos;, &#123;</span><br><span class="line">        center:     [-0.113049, 51.498568],</span><br><span class="line">        zoom:  13,</span><br><span class="line">        // spatial reference definition</span><br><span class="line">        spatialReference : &#123;</span><br><span class="line">          projection : projection,        // geo projection, defined by proj4js</span><br><span class="line">          resolutions : [           // map&apos;s zoom levels and resolutions</span><br><span class="line">            156543.03392804097,</span><br><span class="line">            78271.51696402048,</span><br><span class="line">            9135.75848201024,</span><br><span class="line">            19567.87924100512,</span><br><span class="line">            9783.93962050256,</span><br><span class="line">            4891.96981025128,</span><br><span class="line">            2445.98490512564,</span><br><span class="line">            1222.99245256282,</span><br><span class="line">            611.49622628141,</span><br><span class="line">            305.748113140705,</span><br><span class="line">            152.8740565703525,</span><br><span class="line">            76.43702828517625,</span><br><span class="line">            38.21851414258813,</span><br><span class="line">            19.109257071294063,</span><br><span class="line">            9.554628535647032,</span><br><span class="line">            4.777314267823516,</span><br><span class="line">            2.388657133911758,</span><br><span class="line">            1.194328566955879,</span><br><span class="line">            0.5971642834779395,</span><br><span class="line">            0.29858214173896974</span><br><span class="line">          ],</span><br><span class="line">          fullExtent : &#123;         // map&apos;s full extent</span><br><span class="line">            &apos;top&apos;: 6378137 * Math.PI,</span><br><span class="line">            &apos;left&apos;: -6378137 * Math.PI,</span><br><span class="line">            &apos;bottom&apos;: -6378137 * Math.PI,</span><br><span class="line">            &apos;right&apos;: 6378137 * Math.PI</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        baseLayer : new maptalks.TileLayer(&apos;base&apos;,&#123;</span><br><span class="line">          urlTemplate: &apos;https://&#123;s&#125;.basemaps.cartocdn.com/light_all/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png&apos;,</span><br><span class="line">          subdomains: [&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;],</span><br><span class="line">          attribution: &apos;&amp;copy; &lt;a href=&quot;http://osm.org&quot;&gt;OpenStreetMap&lt;/a&gt; contributors, &amp;copy; &lt;a href=&quot;https://carto.com/&quot;&gt;CARTO&lt;/a&gt;&apos;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      const scene = new CMap(&#123;</span><br><span class="line">        id: &apos;map&apos;,</span><br><span class="line">        map: new MapTalks(&#123;</span><br><span class="line">          mapInstance</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      scene.on(&apos;loaded&apos;, () =&gt; &#123;</span><br><span class="line">        console.log(&apos;test::::::;&apos;);</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">  display: none;</span><br><span class="line">&#125;</span><br><span class="line">#map &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br><span class="line">#map .l7-scene &#123;</span><br><span class="line">  position: absolute !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="三、-cci-map-gis工具"><a href="#三、-cci-map-gis工具" class="headerlink" title="三、 cci-map gis工具"></a><strong>三、</strong> cci-map gis工具</h2><h3 id="1-BD09，GCJ02-和-WGS84-坐标系间的转换工具"><a href="#1-BD09，GCJ02-和-WGS84-坐标系间的转换工具" class="headerlink" title="1.   BD09，GCJ02 和 WGS84 坐标系间的转换工具"></a>1.   BD09，GCJ02 和 WGS84 坐标系间的转换工具</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CoordsTransform  &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CoordsTransform &#125; from 'cci-utils'</span></span><br><span class="line"><span class="keyword">const</span> lng = <span class="number">120</span></span><br><span class="line"><span class="keyword">const</span> lat = <span class="number">30</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 百度坐标系 (BD-09) 与 火星坐标系 (GCJ-02)的转换</span></span><br><span class="line"><span class="comment"> * 即 百度 转 谷歌、高德</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">lng</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">lat</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*[]&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">CoordsTransform.bd09togcj02(lng, lat)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 火星坐标系 (GCJ-02) 与百度坐标系 (BD-09) 的转换</span></span><br><span class="line"><span class="comment"> * 即谷歌、高德 转 百度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">lng</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">lat</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*[]&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">CoordsTransform.gcj02tobd09(lng, lat)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WGS84转GCj02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">lng</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">lat</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*[]&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">CoordsTransform.wgs84togcj02(lng, lat)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GCJ02 转换为 WGS84</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">lng</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">lat</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*[]&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">CoordsTransform.gcj02towgs84(lng, lat)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 百度坐标系 (BD-09) 与 WGS84的转换</span></span><br><span class="line"><span class="comment">   * 即 百度 转 谷歌</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">lng</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">lat</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;*[]&#125;</span></span></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">CoordsTransform.bd09towgs84(lng, lat)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * WGS84 与 百度坐标系 (BD-09)的转换</span></span><br><span class="line"><span class="comment">   * 即 谷歌 转 百度</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">lng</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="variable">lat</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;*[]&#125;</span></span></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">CoordsTransform.wgs84tobd09(lng, lat)</span><br></pre></td></tr></table></figure>
<h3 id="2-数据抽稀-针对大数据量边界数据"><a href="#2-数据抽稀-针对大数据量边界数据" class="headerlink" title="2. 数据抽稀(针对大数据量边界数据)"></a>2. 数据抽稀(针对大数据量边界数据)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; simplifyGeoJSON &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; simplifyGeoJSON &#125; from 'cci-utils'</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>geojson 数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>tolerance 误差（可不传）</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;&#125;</span></span></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">const</span> geojson = &#123;</span><br><span class="line">      type: <span class="string">'FeatureCollection'</span>,</span><br><span class="line">      features: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'Feature'</span>,</span><br><span class="line">          properties: &#123;&#125;,</span><br><span class="line">          geometry: &#123;</span><br><span class="line">            type: <span class="string">'Polygon'</span>,</span><br><span class="line">            coordinates: [</span><br><span class="line">              [</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.30470275878906</span>,</span><br><span class="line">                  <span class="number">39.88352811449648</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.32083892822264</span>,</span><br><span class="line">                  <span class="number">39.89380183825623</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.31637573242188</span>,</span><br><span class="line">                  <span class="number">39.89617247892832</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.30556106567381</span>,</span><br><span class="line">                  <span class="number">39.89577737784395</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.30281448364258</span>,</span><br><span class="line">                  <span class="number">39.89709437260048</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.28822326660156</span>,</span><br><span class="line">                  <span class="number">39.90657598772839</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.27809524536131</span>,</span><br><span class="line">                  <span class="number">39.901571965464</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.27843856811523</span>,</span><br><span class="line">                  <span class="number">39.880103197763546</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.28822326660156</span>,</span><br><span class="line">                  <span class="number">39.87457027859936</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.29131317138673</span>,</span><br><span class="line">                  <span class="number">39.85928656392012</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.29371643066405</span>,</span><br><span class="line">                  <span class="number">39.852302354195864</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.3129425048828</span>,</span><br><span class="line">                  <span class="number">39.853620184014325</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.3393783569336</span>,</span><br><span class="line">                  <span class="number">39.85414730885731</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.3448715209961</span>,</span><br><span class="line">                  <span class="number">39.85796884289976</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.3448715209961</span>,</span><br><span class="line">                  <span class="number">39.87233063679467</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.3422966003418</span>,</span><br><span class="line">                  <span class="number">39.885240508711654</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.32564544677734</span>,</span><br><span class="line">                  <span class="number">39.889060310919994</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.31465911865234</span>,</span><br><span class="line">                  <span class="number">39.88813830918363</span></span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                  <span class="number">116.30470275878906</span>,</span><br><span class="line">                  <span class="number">39.88352811449648</span></span><br><span class="line">                ]</span><br><span class="line">              ]</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">var</span> simplified = simplifyGeoJSON(geojson, tolerance)</span><br></pre></td></tr></table></figure>
<h3 id="3-浏览器辅助-cci-map-的-Browser-类"><a href="#3-浏览器辅助-cci-map-的-Browser-类" class="headerlink" title="3. 浏览器辅助 ( cci-map 的 Browser 类 )"></a>3. 浏览器辅助 ( cci-map 的 Browser 类 )</h3><table>
<thead>
<tr>
<th style="text-align:left">属性名</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>ua</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">当前浏览器userAgent</td>
</tr>
<tr>
<td style="text-align:left"><code>mobile</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否移动设备</td>
</tr>
<tr>
<td style="text-align:left"><code>plat</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:left">平台类型，如：’windows’、’mac’、’ios’、’android’、’other’</td>
</tr>
<tr>
<td style="text-align:left"><code>windows</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否windows设备</td>
</tr>
<tr>
<td style="text-align:left"><code>ios</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否iOS设备</td>
</tr>
<tr>
<td style="text-align:left"><code>iPad</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否iPad</td>
</tr>
<tr>
<td style="text-align:left"><code>iPhone</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否iPhone</td>
</tr>
<tr>
<td style="text-align:left"><code>android</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否安卓设备</td>
</tr>
<tr>
<td style="text-align:left"><code>android23</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否安卓4以下系统</td>
</tr>
<tr>
<td style="text-align:left"><code>chrome</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否Chrome浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>firefox</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否火狐浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>safari</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否Safari浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>wechat</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否微信</td>
</tr>
<tr>
<td style="text-align:left"><code>uc</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否UC浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>qq</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否QQ或者QQ浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>ie</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否IE</td>
</tr>
<tr>
<td style="text-align:left"><code>ie6</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否IE6</td>
</tr>
<tr>
<td style="text-align:left"><code>ie7</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否IE7</td>
</tr>
<tr>
<td style="text-align:left"><code>ie8</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否IE8</td>
</tr>
<tr>
<td style="text-align:left"><code>ie9</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否IE9</td>
</tr>
<tr>
<td style="text-align:left"><code>ie10</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否IE10</td>
</tr>
<tr>
<td style="text-align:left"><code>ie11</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否IE11</td>
</tr>
<tr>
<td style="text-align:left"><code>ielt9</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否IE9以下</td>
</tr>
<tr>
<td style="text-align:left"><code>edge</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否Edge浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>isLocalStorage</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持LocaStorage</td>
</tr>
<tr>
<td style="text-align:left"><code>isGeolocation</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持Geolocation</td>
</tr>
<tr>
<td style="text-align:left"><code>mobileWebkit</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否Webkit移动浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>mobileWebkit3d</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持Css3D的Webkit移动端浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>retina</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否高清屏幕，devicePixelRatio&gt;1</td>
</tr>
<tr>
<td style="text-align:left"><code>touch</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否触屏</td>
</tr>
<tr>
<td style="text-align:left"><code>msPointer</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否msPointer设备</td>
</tr>
<tr>
<td style="text-align:left"><code>pointer</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否pointer设备</td>
</tr>
<tr>
<td style="text-align:left"><code>webkit</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否webkit浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>webkit3d</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持Css3D的Webkit浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>gecko3d</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持Css3D的gecko浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>ie3d</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持Css3D的ie浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>any3d</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持Css3D的浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>opera3d</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持Css3D的opera浏览器</td>
</tr>
<tr>
<td style="text-align:left"><code>isCanvas</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持canvas</td>
</tr>
<tr>
<td style="text-align:left"><code>isSvg</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持svg</td>
</tr>
<tr>
<td style="text-align:left"><code>isVML</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持vml</td>
</tr>
<tr>
<td style="text-align:left"><code>isWorker</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持WebWorker</td>
</tr>
<tr>
<td style="text-align:left"><code>isWebsocket</code></td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">是否支持WebSocket</td>
</tr>
<tr>
<td style="text-align:left"><code>isWebGL</code></td>
<td style="text-align:left"><code>function</code></td>
<td style="text-align:left">判断是否支持webgl</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Browser &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; Browser &#125; from 'cci-utils'</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'browser.chrome'</span>, Browser.chrome)</span><br></pre></td></tr></table></figure>
<h2 id="四、cci-map-绘制工具"><a href="#四、cci-map-绘制工具" class="headerlink" title="四、cci-map 绘制工具"></a>四、cci-map 绘制工具</h2><p>cci-lib-l7-draw 二次开发的地图绘制组件，支持点、marker、线、面， 圆、矩形、的绘制编辑，支持矩形、多边形和圆形框选缩放，支持距离和面积测量</p>
<h3 id="1-DrawControl"><a href="#1-DrawControl" class="headerlink" title="1. DrawControl"></a>1. DrawControl</h3><h4 id="1-1-使用"><a href="#1-1-使用" class="headerlink" title="1.1 使用"></a>1.1 使用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; DrawControl &#125; from &apos;cci-lib-l7-draw&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="1-2-参数"><a href="#1-2-参数" class="headerlink" title="1.2 参数"></a>1.2 参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> control = <span class="keyword">new</span> DrawControl(scene, option);</span><br></pre></td></tr></table></figure>
<p>1.2.1 scene</p>
<p>scene 对象, 绘制控件需要传入 scene 实例</p>
<p>1.2.2 options</p>
<p>control 配置项</p>
<table>
<thead>
<tr>
<th style="text-align:left">name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Default</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">position</td>
<td style="text-align:left">bottomright、topright、 bottomleft’ topleft</td>
<td style="text-align:left">topright</td>
<td style="text-align:left">组件位置</td>
</tr>
<tr>
<td style="text-align:left">layout</td>
<td style="text-align:left">horizontal、 vertical</td>
<td style="text-align:left">vertical</td>
<td style="text-align:left">组件布局</td>
</tr>
<tr>
<td style="text-align:left">controls</td>
<td style="text-align:left">controlOptions</td>
<td style="text-align:left">设置 UI 组件添加哪些绘制工具</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">style</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">地图绘制样式</td>
</tr>
</tbody>
</table>
<p>1.2.3 UI 组件配置项</p>
<ul>
<li>point <code>boolean | drawOption</code> 绘制点工具配置</li>
<li>marker <code>boolean | drawOption</code> 绘制 marker 工具配置</li>
<li>line <code>boolean | drawOption</code> 绘制线工具配置</li>
<li>polygon <code>boolean | drawOption</code> 绘制面工具配置</li>
<li>circle <code>boolean | drawOption</code> 绘制圆工具配置</li>
<li>rect <code>boolean | drawOption</code> 绘制矩形工具配置</li>
<li>delete <code>boolean | drawOption</code> 添加删除工具</li>
<li>calculateLine <code>boolean</code> 添加测量距离工具</li>
<li>calculateArea <code>boolean</code> 添加测量面积工具</li>
</ul>
<p>1.2.4 默认配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    point: <span class="literal">true</span>,</span><br><span class="line">    marker: <span class="literal">true</span>,</span><br><span class="line">    line: <span class="literal">true</span>,</span><br><span class="line">    polygon: <span class="literal">true</span>,</span><br><span class="line">    rect: <span class="literal">true</span>,</span><br><span class="line">    circle: <span class="literal">true</span>,</span><br><span class="line">    <span class="keyword">delete</span>: <span class="literal">true</span>,</span><br><span class="line">    calculateLine: <span class="literal">true</span>,</span><br><span class="line">    calculateArea: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>1.2.5 示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    point: <span class="literal">false</span>,</span><br><span class="line">    marker: <span class="literal">false</span>,</span><br><span class="line">    line: &#123;</span><br><span class="line">      editEnable: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    polygon: <span class="literal">true</span>,</span><br><span class="line">    rect: <span class="literal">true</span>,</span><br><span class="line">    circle: <span class="literal">true</span>,</span><br><span class="line">    <span class="keyword">delete</span>: <span class="literal">false</span>,</span><br><span class="line">    calculateLine: <span class="literal">true</span>,</span><br><span class="line">    calculateArea: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-添加到地图"><a href="#1-3-添加到地图" class="headerlink" title="1.3 添加到地图"></a>1.3 添加到地图</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.addControl(control);</span><br></pre></td></tr></table></figure>
<h4 id="1-4-从地图中移除"><a href="#1-4-从地图中移除" class="headerlink" title="1.4 从地图中移除"></a>1.4 从地图中移除</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.removeControl(control);</span><br></pre></td></tr></table></figure>
<h4 id="1-5-方法"><a href="#1-5-方法" class="headerlink" title="1.5 方法"></a>1.5 方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDraw()</span><br></pre></td></tr></table></figure>
<p>参数： type 绘制实例 <code>point|marker|line|polygon|rect|circle</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pointDraw = drawcontrol.get(<span class="string">'point'</span>);</span><br></pre></td></tr></table></figure>
<p><code>getAllData()</code> 获取每个 Draw 实例绘制的结果数据</p>
<p>返回数据格式如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  point: []</span><br><span class="line">  line: [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-6-事件"><a href="#1-6-事件" class="headerlink" title="1.6 事件"></a>1.6 事件</h4><p>drawControl 的事件类型和每个 Draw 的事件一致，如果在 drawControl 监听事件会为每个 draw 增加事件监听</p>
<ul>
<li>drawType: Draw 类型</li>
<li>feature: 对应的数据</li>
</ul>
<p><code>draw.create</code> 绘制完成时触发该事件</p>
<p><code>draw.delete</code> 图形删除时触发该事件</p>
<p><code>draw.update</code> 图形更新时触发该事件，图形的平移，顶点的编辑</p>
<p><code>draw.selectionchange</code> 图形选中时触发该事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drawControl.on(<span class="string">'draw.delete'</span>, e =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="1-7-style"><a href="#1-7-style" class="headerlink" title="1.7 style"></a>1.7 style</h4><p>drawControl 的 style 和每个 Draw 的 style 一致</p>
<h3 id="2-Draw-Type"><a href="#2-Draw-Type" class="headerlink" title="2. Draw Type"></a>2. Draw Type</h3><p>可以不依赖 Draw UI 组件，独立的使用每一个 Draw</p>
<h4 id="2-1-DrawMarker-新增功能"><a href="#2-1-DrawMarker-新增功能" class="headerlink" title="2.1 DrawMarker (新增功能)"></a>2.1 DrawMarker (新增功能)</h4><p>绘制 marker</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; DrawMarker &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span>;</span><br><span class="line"><span class="keyword">const</span> drawMarker = <span class="keyword">new</span> DrawCircle(scene);</span><br><span class="line">drawMarker.enable();</span><br></pre></td></tr></table></figure>
<p>参数使用 data 选项时候， geojson 的 propertise 需要添加对应类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> DrawMarker(scene, &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    type: <span class="string">'FeatureCollection'</span>,</span><br><span class="line">    features: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'Feature'</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          markerOption: &#123;&#125; <span class="comment">// 传入 Marker 构造函数配置项进行自定义设置；传空对象则渲染默认 marker</span></span><br><span class="line">        &#125;,</span><br><span class="line">        geometry: &#123;</span><br><span class="line">          type: <span class="string">'Point'</span>,</span><br><span class="line">          coordinates: markerCoordinates</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2-2-DrawCircle"><a href="#2-2-DrawCircle" class="headerlink" title="2.2 DrawCircle"></a>2.2 DrawCircle</h4><p>绘制圆形</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; DrawCircle &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span>;</span><br><span class="line"><span class="keyword">const</span> drawCircle = <span class="keyword">new</span> DrawCircle(scene);</span><br><span class="line">drawCircle.enable();</span><br></pre></td></tr></table></figure>
<p>参数使用 data 选项初始化渲染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> draw = <span class="keyword">new</span> DrawCircle(scene, &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    type: <span class="string">'circle'</span>,</span><br><span class="line">    features: [</span><br><span class="line">      [<span class="number">127.61718749999999</span>, <span class="number">54.97761367069628</span>], <span class="comment">// 中心点</span></span><br><span class="line">      [<span class="number">117.42187500000001</span>, <span class="number">23.241346102386135</span>], <span class="comment">// 圆上点</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>或者调用 resetData 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> draw = <span class="keyword">new</span> DrawCircle(scene)</span><br><span class="line">draw.resetData(&#123;</span><br><span class="line">  type: <span class="string">'circle'</span>,</span><br><span class="line">  features: [</span><br><span class="line">    [<span class="number">127.61718749999999</span>, <span class="number">54.97761367069628</span>], <span class="comment">// 中心点</span></span><br><span class="line">    [<span class="number">117.42187500000001</span>, <span class="number">23.241346102386135</span>], <span class="comment">// 圆上点</span></span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-3-DrawRect"><a href="#2-3-DrawRect" class="headerlink" title="2.3 DrawRect"></a>2.3 DrawRect</h4><p>绘制四边形</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; DrawRect &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span>;</span><br><span class="line"><span class="keyword">const</span> drawRect = <span class="keyword">new</span> DrawRect(scene);</span><br><span class="line">drawRect.enable();</span><br></pre></td></tr></table></figure>
<p>参数使用 data 选项渲染初始化数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> draw = <span class="keyword">new</span> DrawRect(scene, &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    type: <span class="string">'rect'</span>,</span><br><span class="line">    features: [</span><br><span class="line">      [<span class="number">127.61718749999999</span>, <span class="number">54.97761367069628</span>], <span class="comment">// 对角线两点</span></span><br><span class="line">      [<span class="number">117.42187500000001</span>, <span class="number">23.241346102386135</span>], </span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>或者调用 resetData 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> draw = <span class="keyword">new</span> DrawRect(scene)</span><br><span class="line">draw.resetData(&#123;</span><br><span class="line">  type: <span class="string">'rect'</span>,</span><br><span class="line">  features: [</span><br><span class="line">    [<span class="number">127.61718749999999</span>, <span class="number">54.97761367069628</span>], <span class="comment">// 对角线两点</span></span><br><span class="line">    [<span class="number">117.42187500000001</span>, <span class="number">23.241346102386135</span>], </span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-4-DrawLine"><a href="#2-4-DrawLine" class="headerlink" title="2.4 DrawLine"></a>2.4 DrawLine</h4><p>绘制路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; DrawLine &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span>;</span><br><span class="line"><span class="keyword">const</span> drawLine = <span class="keyword">new</span> DrawLine(scene);</span><br><span class="line">drawLine.enable();</span><br><span class="line"><span class="keyword">new</span> DrawLine(scene, &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    type: <span class="string">'FeatureCollection'</span>,</span><br><span class="line">    features: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'Feature'</span>,</span><br><span class="line">        properties: &#123;&#125;,</span><br><span class="line">        geometry: &#123;</span><br><span class="line">          type: <span class="string">'LineString'</span>,</span><br><span class="line">          coordinates: lineCoordinates</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2-5-DrawPoint"><a href="#2-5-DrawPoint" class="headerlink" title="2.5 DrawPoint"></a>2.5 DrawPoint</h4><p>绘制点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; DrawPoint &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span>;</span><br><span class="line"><span class="keyword">const</span> drawPoint = <span class="keyword">new</span> DrawPoint(scene);</span><br><span class="line">drawPoint.enable();</span><br><span class="line"><span class="keyword">new</span> DrawPoint(scene, &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    type: <span class="string">'FeatureCollection'</span>,</span><br><span class="line">    features: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'Feature'</span>,</span><br><span class="line">        properties: &#123;&#125;,</span><br><span class="line">        geometry: &#123;</span><br><span class="line">          type: <span class="string">'Point'</span>,</span><br><span class="line">          coordinates: pointCoordinates</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2-6-DrawPolygon"><a href="#2-6-DrawPolygon" class="headerlink" title="2.6 DrawPolygon"></a>2.6 DrawPolygon</h4><p>绘制多边形</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; DrawPolygon &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span>;</span><br><span class="line"><span class="keyword">const</span> drawPoint = <span class="keyword">new</span> DrawPolygon(scene);</span><br><span class="line">drawPoint.enable();</span><br><span class="line"><span class="keyword">new</span> DrawPolygon(scene, &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    type: <span class="string">'FeatureCollection'</span>,</span><br><span class="line">    features: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'Feature'</span>,</span><br><span class="line">        properties: &#123;&#125;,</span><br><span class="line">        geometry: &#123;</span><br><span class="line">          type: <span class="string">'Polygon'</span>,</span><br><span class="line">          coordinates: polygonCoordinates</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2-7-DrawOption-配置项"><a href="#2-7-DrawOption-配置项" class="headerlink" title="2.7 DrawOption 配置项"></a>2.7 DrawOption 配置项</h4><ul>
<li>editEnable boolean 是否允许编辑</li>
<li>selectEnable boolean 是否允许选中</li>
</ul>
<h4 id="2-8-方法"><a href="#2-8-方法" class="headerlink" title="2.8 方法"></a>2.8 方法</h4><p><code>enable</code> 开始编辑，绘制完成之后会自动结束。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">draw.enable();</span><br></pre></td></tr></table></figure>
<p><code>disable</code> 结束编辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">draw.disable();</span><br></pre></td></tr></table></figure>
<h4 id="2-9-Style"><a href="#2-9-Style" class="headerlink" title="2.9 Style"></a>2.9 Style</h4><ul>
<li>active 绘制过程中高亮颜色</li>
<li>normal 正常显示状态</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> style = &#123;</span><br><span class="line">  active: &#123;</span><br><span class="line">    point: &#123;</span><br><span class="line">      type: <span class="string">'PointLayer'</span>,</span><br><span class="line">      shape: <span class="string">'circle'</span>,</span><br><span class="line">      color: <span class="string">'#fbb03b'</span>,</span><br><span class="line">      size: <span class="number">5</span>,</span><br><span class="line">      style: &#123;</span><br><span class="line">        stroke: <span class="string">'#fff'</span>,</span><br><span class="line">        strokeWidth: <span class="number">2</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    line: &#123;</span><br><span class="line">      type: <span class="string">'LineLayer'</span>,</span><br><span class="line">      shape: <span class="string">'line'</span>,</span><br><span class="line">      color: <span class="string">'#fbb03b'</span>,</span><br><span class="line">      size: <span class="number">1</span>,</span><br><span class="line">      style: &#123;</span><br><span class="line">        opacity: <span class="number">1</span>,</span><br><span class="line">        lineType: <span class="string">'dash'</span>,</span><br><span class="line">        dashArray: [<span class="number">2</span>, <span class="number">2</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    polygon: &#123;</span><br><span class="line">      shape: <span class="string">'fill'</span>,</span><br><span class="line">      color: <span class="string">'#fbb03b'</span>,</span><br><span class="line">      style: &#123;</span><br><span class="line">        opacity: <span class="number">0.1</span>,</span><br><span class="line">        stroke: <span class="string">'#fbb03b'</span>,</span><br><span class="line">        strokeWidth: <span class="number">1</span>,</span><br><span class="line">        strokeOpacity: <span class="number">1</span>,</span><br><span class="line">        lineType: <span class="string">'dash'</span>,</span><br><span class="line">        dashArray: [<span class="number">2</span>, <span class="number">2</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  normal: &#123;</span><br><span class="line">    polygon: &#123;</span><br><span class="line">      type: <span class="string">'PolygonLayer'</span>,</span><br><span class="line">      shape: <span class="string">'fill'</span>,</span><br><span class="line">      color: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">      style: &#123;</span><br><span class="line">        opacity: <span class="number">0.1</span>,</span><br><span class="line">        stroke: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">        strokeWidth: <span class="number">1</span>,</span><br><span class="line">        strokeOpacity: <span class="number">1</span>,</span><br><span class="line">        lineType: <span class="string">'solid'</span>,</span><br><span class="line">        dashArray: [<span class="number">2</span>, <span class="number">2</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    line: &#123;</span><br><span class="line">      type: <span class="string">'LineLayer'</span>,</span><br><span class="line">      shape: <span class="string">'line'</span>,</span><br><span class="line">      size: <span class="number">1</span>,</span><br><span class="line">      color: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">      style: &#123;</span><br><span class="line">        opacity: <span class="number">1</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    point: &#123;</span><br><span class="line">      type: <span class="string">'PointLayer'</span>,</span><br><span class="line">      shape: <span class="string">'circle'</span>,</span><br><span class="line">      color: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">      size: <span class="number">3</span>,</span><br><span class="line">      style: &#123;</span><br><span class="line">        stroke: <span class="string">'#fff'</span>,</span><br><span class="line">        strokeWidth: <span class="number">2</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  normal_point: &#123;</span><br><span class="line">    type: <span class="string">'PointLayer'</span>,</span><br><span class="line">    shape: <span class="string">'circle'</span>,</span><br><span class="line">    color: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">    size: <span class="number">3</span>,</span><br><span class="line">    style: &#123;</span><br><span class="line">      stroke: <span class="string">'#fff'</span>,</span><br><span class="line">      strokeWidth: <span class="number">2</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  mid_point: &#123;</span><br><span class="line">    point: &#123;</span><br><span class="line">      type: <span class="string">'PointLayer'</span>,</span><br><span class="line">      shape: <span class="string">'circle'</span>,</span><br><span class="line">      color: <span class="string">'#fbb03b'</span>,</span><br><span class="line">      size: <span class="number">3</span>,</span><br><span class="line">      style: &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-Calculate-Type-新增功能"><a href="#3-Calculate-Type-新增功能" class="headerlink" title="3. Calculate Type (新增功能)"></a>3. Calculate Type (新增功能)</h3><p>可以不依赖 Draw UI 组件，独立的使用每一个 Calculate</p>
<ul>
<li>getDistance 和 getArea 方法可用于距离和面积测量</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getDistance, getArea &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取两个经纬度之间距离</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>[lngLat.lng, lngLat.lat],</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>[lngLat.lng, lngLat.lat]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="variable">string</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">getDistance([<span class="number">120</span>, <span class="number">30</span>], [<span class="number">121</span>,<span class="number">30</span>]) <span class="comment">// km</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取 polygon 的面积</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>feature.geometry</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="variable">string</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">getArea(&#123;</span><br><span class="line">  type: <span class="string">'Polygon'</span>,</span><br><span class="line">  coordinates: [</span><br><span class="line">    [</span><br><span class="line">      [<span class="number">44.29687499999999</span>, <span class="number">55.3791104480105</span>],</span><br><span class="line">      [<span class="number">28.4765625</span>, <span class="number">47.754097979680026</span>],</span><br><span class="line">      [<span class="number">27.0703125</span>, <span class="number">38.8225909761771</span>],</span><br><span class="line">      [<span class="number">42.890625</span>, <span class="number">33.43144133557529</span>],</span><br><span class="line">      [<span class="number">73.47656249999999</span>, <span class="number">37.43997405227057</span>],</span><br><span class="line">      [<span class="number">85.4296875</span>, <span class="number">47.989921667414194</span>],</span><br><span class="line">      [<span class="number">79.1015625</span>, <span class="number">60.58696734225869</span>],</span><br><span class="line">      [<span class="number">44.29687499999999</span>, <span class="number">55.3791104480105</span>]</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;) <span class="comment">// km^2</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-CalculateLine-测量距离"><a href="#3-1-CalculateLine-测量距离" class="headerlink" title="3.1 CalculateLine 测量距离"></a>3.1 CalculateLine 测量距离</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CalculateLine &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span>;</span><br><span class="line"><span class="keyword">const</span> calculateLine = <span class="keyword">new</span> CalculateLine(scene, option);</span><br><span class="line">calculateLine.enable();</span><br></pre></td></tr></table></figure>
<ul>
<li>事件</li>
</ul>
<p><code>calculate-line-start</code> 开始测量会派发</p>
<p><code>calculate-line-end</code> 结束测量会派发</p>
<ul>
<li>calculateLineOption 测量距离配置</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Default</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">style</td>
<td style="text-align:left">Object</td>
<td style="text-align:left"></td>
<td style="text-align:left">框选样式</td>
</tr>
</tbody>
</table>
<ul>
<li>style 默认配置</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  line: &#123;</span><br><span class="line">    type: <span class="string">'LineLayer'</span>,</span><br><span class="line">    shape: <span class="string">'line'</span>,</span><br><span class="line">    size: <span class="number">1</span>,</span><br><span class="line">    color: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">    style: &#123;</span><br><span class="line">      opacity: <span class="number">1</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  point: &#123;</span><br><span class="line">    type: <span class="string">'PointLayer'</span>,</span><br><span class="line">    shape: <span class="string">'circle'</span>,</span><br><span class="line">    color: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">    size: <span class="number">3</span>,</span><br><span class="line">    style: &#123;</span><br><span class="line">      stroke: <span class="string">'#fff'</span>,</span><br><span class="line">      strokeWidth: <span class="number">2</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-CalculateArea-测量面积"><a href="#3-2-CalculateArea-测量面积" class="headerlink" title="3.2 CalculateArea 测量面积"></a>3.2 CalculateArea 测量面积</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CalculateArea &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span>;</span><br><span class="line"><span class="keyword">const</span> calculateArea = <span class="keyword">new</span> CalculateArea(scene, option);</span><br><span class="line">calculateArea.enable();</span><br></pre></td></tr></table></figure>
<ul>
<li>事件</li>
</ul>
<p><code>calculate-area-start</code> 开始测量会派发</p>
<p><code>calculate-area-end</code> 结束测量会派发</p>
<ul>
<li>calculateAreaOption 测量面积配置</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Default</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">style</td>
<td style="text-align:left">Object</td>
<td style="text-align:left"></td>
<td style="text-align:left">框选样式</td>
</tr>
</tbody>
</table>
<ul>
<li>style 默认配置</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  polygon: &#123;</span><br><span class="line">    type: <span class="string">'PolygonLayer'</span>,</span><br><span class="line">    shape: <span class="string">'fill'</span>,</span><br><span class="line">    color: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">    style: &#123;</span><br><span class="line">      opacity: <span class="number">0.1</span>,</span><br><span class="line">      stroke: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">      strokeWidth: <span class="number">1</span>,</span><br><span class="line">      strokeOpacity: <span class="number">1</span>,</span><br><span class="line">      lineType: <span class="string">'solid'</span>,</span><br><span class="line">      dashArray: [<span class="number">2</span>, <span class="number">2</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  point: &#123;</span><br><span class="line">    type: <span class="string">'PointLayer'</span>,</span><br><span class="line">    shape: <span class="string">'circle'</span>,</span><br><span class="line">    color: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">    size: <span class="number">3</span>,</span><br><span class="line">    style: &#123;</span><br><span class="line">      stroke: <span class="string">'#fff'</span>,</span><br><span class="line">      strokeWidth: <span class="number">2</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>方法</li>
</ul>
<p><code>enable</code> 开始测量，在地图上点选，双击完成之后会自动结束。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calculate.enable();</span><br></pre></td></tr></table></figure>
<p><code>disable</code> 清除所有测量结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calculate.disable();</span><br></pre></td></tr></table></figure>
<h3 id="4-RectZoom-新增功能"><a href="#4-RectZoom-新增功能" class="headerlink" title="4. RectZoom (新增功能)"></a>4. RectZoom (新增功能)</h3><p>矩形框选缩放，可以拉框选中，地图根据框选的位置为中心进行放大到最佳比例尺显示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RectZoom &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span></span><br><span class="line"><span class="keyword">const</span> rectZoom = <span class="keyword">new</span> RectZoom(scene, option)</span><br></pre></td></tr></table></figure>
<ul>
<li>rectZoomOption</li>
</ul>
<p>框选配置</p>
<table>
<thead>
<tr>
<th style="text-align:left">name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Default</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">style</td>
<td style="text-align:left">Object</td>
<td style="text-align:left"></td>
<td style="text-align:left">框选样式</td>
</tr>
<tr>
<td style="text-align:left">step</td>
<td style="text-align:left">Number</td>
<td style="text-align:left">1</td>
<td style="text-align:left">每次缩放层级</td>
</tr>
</tbody>
</table>
<ul>
<li>style</li>
</ul>
<p>默认配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: <span class="string">'PolygonLayer'</span>,</span><br><span class="line">  shape: <span class="string">'fill'</span>,</span><br><span class="line">  color: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">  style: &#123;</span><br><span class="line">    opacity: <span class="number">0.1</span>,</span><br><span class="line">    stroke: <span class="string">'#3bb2d0'</span>,</span><br><span class="line">    strokeWidth: <span class="number">1</span>,</span><br><span class="line">    strokeOpacity: <span class="number">1</span>,</span><br><span class="line">    lineType: <span class="string">'solid'</span>,</span><br><span class="line">    dashArray: [<span class="number">2</span>, <span class="number">2</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>方法</li>
</ul>
<p><code>enable</code> 开始框选，框选完成之后会自动结束。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rectZoom.enable(<span class="string">'zoomIn'</span>) <span class="comment">// 放大</span></span><br><span class="line">rectZoom.enable(<span class="string">'zoomOut'</span>) <span class="comment">// 缩小</span></span><br><span class="line">rectZoom.enable() <span class="comment">// 只框选</span></span><br></pre></td></tr></table></figure>
<ul>
<li>事件</li>
</ul>
<p><code>draw.create</code> 绘制完成时触发该事件, 返回 feature 对应的数据</p>
<h3 id="5-CircleZoom-新增功能"><a href="#5-CircleZoom-新增功能" class="headerlink" title="5. CircleZoom (新增功能)"></a>5. CircleZoom (新增功能)</h3><p>圆形框选缩放，可以拉框选中，地图根据框选的位置为中心进行放大到最佳比例尺显示, 参数、方法和事件同 RectZoom</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CircleZoom &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span></span><br><span class="line"><span class="keyword">const</span> circleZoom = <span class="keyword">new</span> CircleZoom(scene, option)</span><br></pre></td></tr></table></figure>
<h3 id="6-PolygonZoom-新增功能"><a href="#6-PolygonZoom-新增功能" class="headerlink" title="6. PolygonZoom (新增功能)"></a>6. PolygonZoom (新增功能)</h3><p>多边形框选缩放，可以拉框选中，地图根据框选的位置为中心进行放大到最佳比例尺显示, 参数、方法和事件同 RectZoom</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PolygonZoom &#125; <span class="keyword">from</span> <span class="string">'cci-lib-l7-draw'</span></span><br><span class="line"><span class="keyword">const</span> polygonZoom = <span class="keyword">new</span> PolygonZoom(scene, option)</span><br></pre></td></tr></table></figure>
<h2 id="五、cci-map-可视化组件"><a href="#五、cci-map-可视化组件" class="headerlink" title="五、cci-map 可视化组件"></a>五、cci-map 可视化组件</h2><p> @antv/l7 原有可视化图层和覆盖物( <code>PointLayer, LineLayer, PolygonLayer, Marker, Popup, ImageLayer, RasterLayer, HeatmapLayer, CityBuildingLayer</code>)可在初始化时通过 <code>dataCoordinateSystem</code>  参数指定数据的坐标系，内部会根据传入的数据坐标系，自动将数据转换为地图引擎需要的坐标系坐标数据， <code>dataCoordinateSystem</code>  参数不传则默认不做数据转换</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap, PointLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    style: <span class="string">'dark'</span>,</span><br><span class="line">    center: [ <span class="number">112.345</span>, <span class="number">30.455</span> ],</span><br><span class="line">    zoom: <span class="number">14.89</span>,</span><br><span class="line">    minZoom: <span class="number">10</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> pointLayer = <span class="keyword">new</span> PointLayer(&#123;</span><br><span class="line">    dataCoordinateSystem: <span class="string">'wgs84'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .source(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"FeatureCollection"</span>,</span><br><span class="line">      <span class="string">"features"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">          <span class="string">"properties"</span>: &#123;&#125;,</span><br><span class="line">          <span class="string">"geometry"</span>: &#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"Point"</span>,</span><br><span class="line">            <span class="string">"coordinates"</span>: [<span class="number">112.345</span>, <span class="number">30.455</span>] <span class="comment">// wgs84 坐标会转化为 gcj02 坐标</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">  .color(<span class="string">'red'</span>)</span><br><span class="line"></span><br><span class="line">  scene.addLayer(pointLayer);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="1-鹰眼组件"><a href="#1-鹰眼组件" class="headerlink" title="1. 鹰眼组件"></a>1. 鹰眼组件</h3><p>HawkEye 是鹰眼图组件</p>
<h4 id="1-1-参数"><a href="#1-1-参数" class="headerlink" title="1.1 参数"></a>1.1 参数</h4><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">可选值</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">visible</td>
<td style="text-align:left">控制鹰眼图显示隐藏</td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">-</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">sceneConfig</td>
<td style="text-align:left">分别以 amap 或者 mapbox 地图实例的 scene 配置</td>
<td style="text-align:left">Object</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">bigScene</td>
<td style="text-align:left">外层地图 CMap 实例</td>
<td style="text-align:left">Object</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">zoomGap</td>
<td style="text-align:left">外层地图和鹰眼地图缩放级别之差</td>
<td style="text-align:left">Number</td>
<td style="text-align:left">-</td>
<td style="text-align:left">3</td>
</tr>
</tbody>
</table>
<h4 id="1-2-示例"><a href="#1-2-示例" class="headerlink" title="1.2 示例"></a>1.2 示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div style=&quot;width:100%;height:100%;&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;map&quot;/&gt;</span><br><span class="line">    &lt;HawkEye</span><br><span class="line">      ref=&quot;hawkEye&quot;</span><br><span class="line">      :visible=&apos;show&apos;</span><br><span class="line">      :bigScene=&quot;bigScene&quot;</span><br><span class="line">      :sceneConfig=&quot;hawkEyeSceneConfig&quot;  </span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div id=&quot;mini-map&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/HawkEye&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; CMap, GaodeMap, HawkEye &#125; from &apos;cci-map&apos;</span><br><span class="line">// import &#123; CMap, GaodeMap &#125; from &apos;cci-map&apos;</span><br><span class="line">// import HawkEye from &apos;cci-cp-l7-hawk-eye&apos;</span><br><span class="line"></span><br><span class="line">const mapInstanceConfig = &#123;</span><br><span class="line">  viewMode: &apos;3D&apos;,</span><br><span class="line">  resizeEnable: true,</span><br><span class="line">  zoom: 12, // 初始化地图层级</span><br><span class="line">  pitch: 0,</span><br><span class="line">  rotation: 0,</span><br><span class="line">  center: [ 116.30470275878906, 39.88352811449648 ], // 初始化地图中心点</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      show: true,</span><br><span class="line">      hawkEyeSceneConfig: &#123;&#125;,</span><br><span class="line">      bigScene: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    HawkEye</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    toggle() &#123;</span><br><span class="line">      this.show = !this.show</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    const scene = new CMap(&#123;</span><br><span class="line">      id: &apos;map&apos;,</span><br><span class="line">      map: new GaodeMap(mapInstanceConfig)</span><br><span class="line">    &#125;)</span><br><span class="line">    scene.on(&apos;loaded&apos;, () =&gt; &#123;</span><br><span class="line">      this.hawkEyeSceneConfig = &#123;</span><br><span class="line">        id: &apos;mini-map&apos;,</span><br><span class="line">        map: new GaodeMap(mapInstanceConfig)</span><br><span class="line">      &#125;</span><br><span class="line">      this.bigScene = scene</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">#map &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br><span class="line">#map .l7-scene &#123;</span><br><span class="line">  position: absolute !important;</span><br><span class="line">&#125;</span><br><span class="line">#mini-map&#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100px;</span><br><span class="line">  border: 1px solid black;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-echarts-图层"><a href="#2-echarts-图层" class="headerlink" title="2. echarts 图层"></a>2. echarts 图层</h3><p>如果 cci-map 使用 script 脚本引入，在使用 EchartsLayer 时需要先引入 echarts 库</p>
<h4 id="2-1-parser-参数"><a href="#2-1-parser-参数" class="headerlink" title="2.1 parser 参数"></a>2.1 parser 参数</h4><p>调用图层 <code>source</code> 方法，第一个参数设置为 echarts 配置，第二个参数设置 parser 参数； 如果第一个参数为空对象， 之后通过调用图层 <code>setData</code> 方法传入 echarts 配置。echarts 配置中 series 配置必须通过 <code>coordinateSystem</code> 配置当前地图类型，地图类型可以通过 <code>scene.mapService.getType</code> 配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'echarts'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-示例"><a href="#2-2-示例" class="headerlink" title="2.2 示例"></a>2.2 示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, Mapbox, EchartsLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, Mapbox &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; EchartsLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    pitch: <span class="number">30</span>,</span><br><span class="line">    zoom: <span class="number">10</span>,</span><br><span class="line">    center: [<span class="number">120.264263</span>, <span class="number">30.14</span>], <span class="comment">// 初始化地图中心点</span></span><br><span class="line">    token: <span class="string">'48463d4ad0a6bd804a336d9ed317717e'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">scene.on(<span class="string">'loaded'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="string">'[&#123;"type":"1-2","coords":[[&#123;"coord":["120.273318","30.156055"],"type":"1"&#125;,&#123;"coord":["120.278434","30.162534"],"type":"2"&#125;],[&#123;"coord":["120.285249","30.158228"],"type":"1"&#125;,&#123;"coord":["120.28387","30.158531"],"type":"2"&#125;],[&#123;"coord":["120.223365","30.177374"],"type":"1"&#125;,&#123;"coord":["120.229814","30.183639"],"type":"2"&#125;],[&#123;"coord":["120.23561","30.179176"],"type":"1"&#125;,&#123;"coord":["120.234944","30.178863"],"type":"2"&#125;],[&#123;"coord":["120.263922","30.154831"],"type":"2"&#125;],[&#123;"coord":["120.281604","30.156878"],"type":"2"&#125;],[&#123;"coord":["120.273278","30.153959"],"type":"2"&#125;],[&#123;"coord":["120.283706","30.165705"],"type":"2"&#125;],[&#123;"coord":["120.255151","30.165263"],"type":"2"&#125;],[&#123;"coord":["120.282449","30.166185"],"type":"1"&#125;,&#123;"coord":["120.282677","30.165139"],"type":"2"&#125;],[&#123;"coord":["120.269503","30.15329"],"type":"1"&#125;,&#123;"coord":["120.269503","30.15329"],"type":"2"&#125;],[&#123;"coord":["120.255637","30.149547"],"type":"2"&#125;],[&#123;"coord":["120.236102","30.165584"],"type":"1"&#125;,&#123;"coord":["120.236102","30.165584"],"type":"2"&#125;],[&#123;"coord":["120.23914","30.159275"],"type":"1"&#125;,&#123;"coord":["120.23914","30.159275"],"type":"2"&#125;]]&#125;,&#123;"type":"2-3","coords":[[&#123;"coord":["120.278434","30.162534"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.278434","30.162534"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.28387","30.158531"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.28387","30.158531"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.229814","30.183639"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.229814","30.183639"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.234944","30.178863"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.234944","30.178863"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.263922","30.154831"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.263922","30.154831"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.281604","30.156878"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.281604","30.156878"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.273278","30.153959"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.273278","30.153959"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.283706","30.165705"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.283706","30.165705"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.255151","30.165263"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.255151","30.165263"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.282677","30.165139"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.282677","30.165139"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.269503","30.15329"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.269503","30.15329"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.255637","30.149547"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.255637","30.149547"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.236102","30.165584"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.236102","30.165584"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;],[&#123;"coord":["120.23914","30.159275"],"type":"2"&#125;,&#123;"coord":["120.270583","30.100995"],"type":"3"&#125;],[&#123;"coord":["120.23914","30.159275"],"type":"2"&#125;,&#123;"coord":["120.271154","30.077699"],"type":"3"&#125;]]&#125;]'</span></span><br><span class="line">    </span><br><span class="line">   	<span class="keyword">const</span> lines = <span class="built_in">JSON</span>.parse(data)</span><br><span class="line">    <span class="keyword">const</span> layer = <span class="keyword">new</span> EchartsLayer()</span><br><span class="line">      .source(</span><br><span class="line">        &#123;&#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          parser: &#123;</span><br><span class="line">            type: <span class="string">'echarts'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    scene.addLayer(layer)</span><br><span class="line"></span><br><span class="line">    layer.setData(&#123;</span><br><span class="line">      radiusAxis: &#123;</span><br><span class="line">        show: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      angleAxis: &#123;</span><br><span class="line">        type: <span class="string">"value"</span>,</span><br><span class="line">        show: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      series: lines.map(<span class="function">(<span class="params">&#123; type, coords &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          type: <span class="string">"lines"</span>,</span><br><span class="line">          animation: <span class="literal">false</span>,</span><br><span class="line">          zlevel: <span class="number">999</span>,</span><br><span class="line">          coordinateSystem: scene.mapService.getType(), <span class="comment">// series 必须配置当前地图类型，通过 scene.mapService.getType 方法获取 </span></span><br><span class="line">          lineStyle: &#123;</span><br><span class="line">            color: type === <span class="string">"1-2"</span> ? <span class="string">"#5ad8a6"</span> : <span class="string">"#a6c84c"</span>,</span><br><span class="line">            width: <span class="number">1</span>,</span><br><span class="line">            opacity: <span class="number">0.6</span>,</span><br><span class="line">            curveness: <span class="number">0.5</span></span><br><span class="line">          &#125;,</span><br><span class="line">          effect: &#123;</span><br><span class="line">            show: <span class="literal">true</span>,</span><br><span class="line">            symbol: <span class="string">"triangle"</span>,</span><br><span class="line">            symbolSize: <span class="number">10</span></span><br><span class="line">          &#125;,</span><br><span class="line">          data: coords.filter(<span class="function"><span class="params">line</span> =&gt;</span> line.length === <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-自定义图层"><a href="#3-自定义图层" class="headerlink" title="3. 自定义图层"></a>3. 自定义图层</h3><p>通过自定义图层用户可以绘制 canvas，svg 和 dom</p>
<ul>
<li><p>初始化参数</p>
<p>| 参数   | 说明                                              | 类型     | 可选值 | 默认值 |<br>| :—– | :———————————————— | :——- | :—– | :—– |<br>| dom    | 绘制元素，可以 canvas 节点、dom 节点或者 svg 节点 |          | -      | -      |<br>| render | 渲染方法, 在地图初始化和地图拖拽缩放时调用        | Function |        |        |</p>
</li>
<li><p>parser 参数（调用图层 <code>source</code> 方法，第一个参数设置为空对象，第二个参数设置 parser 参数）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'custom'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="3-1-canvas"><a href="#3-1-canvas" class="headerlink" title="3.1 canvas"></a>3.1 canvas</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap, CustomLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CustomLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="keyword">const</span> center = [<span class="number">120.26</span>, <span class="number">30.14</span>]</span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    pitch: <span class="number">30</span>,</span><br><span class="line">    zoom: <span class="number">10</span>,</span><br><span class="line">    center, <span class="comment">// 初始化地图中心点</span></span><br><span class="line">    token: <span class="string">'48463d4ad0a6bd804a336d9ed317717e'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1. 设置 canvas 元素和 render 方法</span></span><br><span class="line">  <span class="keyword">const</span> pos = scene.lngLatToContainer(center)</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>)</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">"2d"</span>)</span><br><span class="line">    ctx.fillStyle = <span class="string">'#08f'</span></span><br><span class="line">    ctx.strokeStyle = <span class="string">'#fff'</span></span><br><span class="line">    ctx.beginPath()</span><br><span class="line">    <span class="keyword">const</span> r = <span class="number">50</span></span><br><span class="line">    ctx.moveTo(pos.x + r, pos.y)</span><br><span class="line">    ctx.arc(pos.x, pos.y, r, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI)</span><br><span class="line">    ctx.lineWidth = <span class="number">6</span></span><br><span class="line">    ctx.closePath()</span><br><span class="line">    ctx.stroke()</span><br><span class="line">    ctx.fill()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2. 加载自定义 canvas 图层</span></span><br><span class="line">  <span class="keyword">const</span> layer = <span class="keyword">new</span> CustomLayer(&#123;</span><br><span class="line">    dom: canvas,</span><br><span class="line">    render</span><br><span class="line">  &#125;)</span><br><span class="line">  .source(&#123;&#125;, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'custom'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  scene.addLayer(layer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-svg"><a href="#3-2-svg" class="headerlink" title="3.2 svg"></a>3.2 svg</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap, CustomLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CustomLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="keyword">const</span> center = [<span class="number">120.26</span>, <span class="number">30.14</span>]</span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    pitch: <span class="number">30</span>,</span><br><span class="line">    zoom: <span class="number">10</span>,</span><br><span class="line">    center, <span class="comment">// 初始化地图中心点</span></span><br><span class="line">    token: <span class="string">'48463d4ad0a6bd804a336d9ed317717e'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1. 设置 svg 元素和 render 方法</span></span><br><span class="line">  <span class="keyword">const</span> pos = scene.lngLatToContainer(center)</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElementNS(<span class="string">'http://www.w3.org/2000/svg'</span>, <span class="string">'svg'</span>)</span><br><span class="line">  canvas.setAttribute(<span class="string">'xmlns'</span>, <span class="string">'http://www.w3.org/2000/svg'</span>)</span><br><span class="line">  <span class="keyword">const</span> path = <span class="built_in">document</span>.createElementNS(<span class="string">'http://www.w3.org/2000/svg'</span>, <span class="string">'path'</span>)</span><br><span class="line">  path.onclick = <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'svg path clicked'</span>) &#125;</span><br><span class="line">  <span class="keyword">var</span> styleText = []</span><br><span class="line">  styleText.push(<span class="string">'stroke:red'</span>)</span><br><span class="line">  styleText.push(<span class="string">'fill:green'</span>)</span><br><span class="line">  styleText.push(<span class="string">'fill-opacity:0.3'</span>)</span><br><span class="line">  path.style.cssText = styleText.join(<span class="string">';'</span>)</span><br><span class="line">  canvas.appendChild(path)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">buildPath</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> paths = []</span><br><span class="line">    <span class="keyword">const</span> &#123; x, y &#125; = pos</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; <span class="number">6</span>; k += <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> ag = <span class="built_in">Math</span>.PI * <span class="number">60</span> / <span class="number">180</span> * k</span><br><span class="line">      <span class="keyword">const</span> centerX = x + <span class="built_in">Math</span>.cos(ag) * <span class="number">50</span></span><br><span class="line">      <span class="keyword">const</span> centerY = y + <span class="built_in">Math</span>.sin(ag) * <span class="number">50</span></span><br><span class="line">      paths.push((k === <span class="number">0</span> ? <span class="string">'M'</span> : <span class="string">'L'</span>) + centerX + <span class="string">' '</span> + centerY)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> paths.join(<span class="string">' '</span>) + <span class="string">' Z'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newPath = buildPath()</span><br><span class="line">    path.setAttribute(<span class="string">'d'</span>, newPath)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2. 加载自定义 svg 图层</span></span><br><span class="line">  <span class="keyword">const</span> layer = <span class="keyword">new</span> CustomLayer(&#123;</span><br><span class="line">    dom: canvas,</span><br><span class="line">    render</span><br><span class="line">  &#125;)</span><br><span class="line">  .source(&#123;&#125;, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'custom'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  scene.addLayer(layer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-dom"><a href="#3-3-dom" class="headerlink" title="3.3 dom"></a>3.3 dom</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap, CustomLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CustomLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="keyword">const</span> center = [<span class="number">120.26</span>, <span class="number">30.14</span>]</span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    pitch: <span class="number">30</span>,</span><br><span class="line">    zoom: <span class="number">10</span>,</span><br><span class="line">    center, <span class="comment">// 初始化地图中心点</span></span><br><span class="line">    token: <span class="string">'48463d4ad0a6bd804a336d9ed317717e'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1. 设置 dom 元素和 render 方法</span></span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    canvas.style.background = <span class="string">'rgba(0, 0, 0, 0.7)'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2. 加载自定义 dom 图层</span></span><br><span class="line">  <span class="keyword">const</span> layer = <span class="keyword">new</span> CustomLayer(&#123;</span><br><span class="line">    dom: canvas,</span><br><span class="line">    render</span><br><span class="line">  &#125;)</span><br><span class="line">  .source(&#123;&#125;, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'custom'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  scene.addLayer(layer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-wms-wmts-图层"><a href="#4-wms-wmts-图层" class="headerlink" title="4. wms/wmts 图层"></a>4. wms/wmts 图层</h3><p>将瓦片图层加载到地图上</p>
<p>默认支持 EPSG:3857, 还支持 EPSG:4326 </p>
<h4 id="4-1-初始化参数"><a href="#4-1-初始化参数" class="headerlink" title="4.1 初始化参数"></a>4.1 初始化参数</h4><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">可选值</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">minZoom</td>
<td style="text-align:left">图层最小缩放层级</td>
<td style="text-align:left">Number</td>
<td style="text-align:left">-</td>
<td style="text-align:left">3</td>
</tr>
<tr>
<td style="text-align:left">maxZoom</td>
<td style="text-align:left">图层最大缩放层级</td>
<td style="text-align:left">Number</td>
<td style="text-align:left">-</td>
<td style="text-align:left">19</td>
</tr>
</tbody>
</table>
<h4 id="4-2-wms-url-请求参数"><a href="#4-2-wms-url-请求参数" class="headerlink" title="4.2 wms url 请求参数"></a>4.2 wms url 请求参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  url: <span class="string">'https://img.nj.gov/imagerywms/Natural2015'</span>, <span class="comment">// url 前缀</span></span><br><span class="line">  params: &#123;</span><br><span class="line">    layers: <span class="string">'Natural2015'</span>, <span class="comment">// layers 图层名</span></span><br><span class="line">    version: <span class="string">'1.1.1'</span>, <span class="comment">// version 版本号</span></span><br><span class="line">    format: <span class="string">'image/png'</span>, <span class="comment">// format 格式</span></span><br><span class="line">    transparent: <span class="literal">true</span>, <span class="comment">// transparent 是否背景透明</span></span><br><span class="line">    styles: <span class="string">''</span> <span class="comment">// styles 样式名，默认为空</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-wmts-url-请求参数"><a href="#4-3-wmts-url-请求参数" class="headerlink" title="4.3 wmts url 请求参数"></a>4.3 wmts url 请求参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  url: <span class="string">'https://img.nj.gov/imagerywms/Natural2015'</span>, <span class="comment">// url 前缀</span></span><br><span class="line">  params: &#123;</span><br><span class="line">    Layers: <span class="string">'Natural2015'</span>, <span class="comment">// layers 图层名</span></span><br><span class="line">    Version: <span class="string">'1.1.1'</span>, <span class="comment">// version 版本号</span></span><br><span class="line">    Format: <span class="string">'image/png'</span>, <span class="comment">// format 格式</span></span><br><span class="line">    Transparent: <span class="literal">true</span>, <span class="comment">// transparent 是否背景透明</span></span><br><span class="line">    Styles: <span class="string">''</span> <span class="comment">// styles 样式名，默认为空</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-4-parser-参数"><a href="#4-4-parser-参数" class="headerlink" title="4.4 parser 参数"></a>4.4 parser 参数</h4><p>调用图层 <code>source</code> 方法，第一个参数配置 wms/wmts url 请求参数，第二个参数设置 parser 参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    crs: <span class="string">'EPSG:3857'</span> <span class="comment">// crs 默认支持 3857，还支持 'EPSG:4326'</span></span><br><span class="line">    type: <span class="string">'wms'</span> <span class="comment">// wms 图层设置 type: 'wms'</span></span><br><span class="line">    <span class="comment">// type: 'wmts' // wmts 图层设置 type: 'wmts'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-5-示例"><a href="#4-5-示例" class="headerlink" title="4.5 示例"></a>4.5 示例</h4><ul>
<li>wms</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, Mapbox, WMSLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, Mapbox &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; WMSLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="comment">// 如果 wmts 引入 WMTSLayer</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> Mapbox(&#123;</span><br><span class="line">    style: <span class="string">'mapbox://styles/mapbox/streets-v11'</span>,</span><br><span class="line">    center: [<span class="number">-74.5447</span>, <span class="number">40.6892</span>],</span><br><span class="line">    zoom: <span class="number">8</span>,</span><br><span class="line">    token: <span class="string">'pk.eyJ1IjoicXdlcnJnaGoiLCJhIjoiY2p5cXY5aGtuMDQwMjNkbGdjYTJ5MWIxeSJ9.2ro1n4MvUCzJiV1m4mrxAA'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 如果 wmts， new WMTSLayer()</span></span><br><span class="line">  <span class="keyword">const</span> layer = <span class="keyword">new</span> WMSLayer(&#123;</span><br><span class="line">    minZoom: <span class="number">5</span>,</span><br><span class="line">    maxZoom: <span class="number">18</span>,</span><br><span class="line">    tileSize: <span class="number">256</span></span><br><span class="line">  &#125;)</span><br><span class="line">  layer.source(</span><br><span class="line">    &#123;</span><br><span class="line">      url: <span class="string">'https://img.nj.gov/imagerywms/Natural2015'</span>,</span><br><span class="line">      params: &#123;</span><br><span class="line">        layers: <span class="string">'Natural2015'</span>,</span><br><span class="line">        version: <span class="string">'1.1.1'</span>,</span><br><span class="line">        format: <span class="string">'image/png'</span>,</span><br><span class="line">        transparent: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      parser: &#123;</span><br><span class="line">        type: <span class="string">'wms'</span>, <span class="comment">// type: 'wmts' 如果是 wmts 设置</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  scene.addLayer(layer)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>wmts 4326</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Scene, Mapbox, WMTSLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; Scene, Mapbox &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; WMTSLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="keyword">const</span> center = [<span class="number">105.08052356963802</span>, <span class="number">36.04231948670001</span>]</span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> Scene(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> Mapbox(&#123;</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    center,</span><br><span class="line">    zoom: <span class="number">4</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> layer = <span class="keyword">new</span> WMTSLayer()</span><br><span class="line">  layer.source(</span><br><span class="line">    &#123;</span><br><span class="line">      url: <span class="string">'https://t2.tianditu.gov.cn/vec_c/wmts?SERVICE=WMTS&amp;REQUEST=GetTile&amp;VERSION=1.0.0&amp;LAYER=vec&amp;STYLE=default&amp;TILEMATRIXSET=c&amp;FORMAT=tiles&amp;TILECOL=&#123;x&#125;&amp;TILEROW=&#123;y&#125;&amp;TILEMATRIX=&#123;z&#125;&amp;tk=81559dbe079ce57eebaff4a81ca226df'</span>,</span><br><span class="line">      params: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      parser: &#123;</span><br><span class="line">        type: <span class="string">'wmts'</span>,</span><br><span class="line">        crs: <span class="string">'EPSG:4326'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  scene.addLayer(layer)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="5-3d-tiles-图层"><a href="#5-3d-tiles-图层" class="headerlink" title="5. 3d tiles 图层"></a>5. 3d tiles 图层</h3><p>加载 3d tiles 图层</p>
<ul>
<li><p>需首先加载 <a href="https://a.amap.com/jsapi_demos/static/data3d/lib/three.117.js" target="_blank" rel="noopener">three 库</a> 和 <a href="https://a.amap.com/jsapi_demos/static/data3d/lib/GLTFLoader.117.min.js" target="_blank" rel="noopener">gltfLoader 库</a></p>
</li>
<li><p>地图底图 mapbox 只支持 EPSG:3857 的 tileset.json 文件 </p>
</li>
</ul>
<h4 id="5-1-初始化参数"><a href="#5-1-初始化参数" class="headerlink" title="5.1 初始化参数"></a>5.1 初始化参数</h4><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">可选值</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">url</td>
<td style="text-align:left">tileset.json 的地址</td>
<td style="text-align:left">String</td>
<td style="text-align:left">-</td>
<td style="text-align:left">-</td>
</tr>
</tbody>
</table>
<h4 id="5-2-parser-参数"><a href="#5-2-parser-参数" class="headerlink" title="5.2  parser 参数"></a>5.2  parser 参数</h4><p>调用图层 <code>source</code> 方法，第一个参数配置空对象，第二个参数设置 parser 参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'3dtiles'</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-3-示例"><a href="#5-3-示例" class="headerlink" title="5.3 示例"></a>5.3 示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMapV2, Tiles3DLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMapV2 &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; Tiles3DLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMapV2(&#123;</span><br><span class="line">    style: <span class="string">'dark'</span>,</span><br><span class="line">    center: [<span class="number">121.502325</span>, <span class="number">31.238165</span>],</span><br><span class="line">    pitch: <span class="number">90</span>,</span><br><span class="line">    rotation: <span class="number">-50</span>,</span><br><span class="line">    zoom: <span class="number">16</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> layer = <span class="keyword">new</span> Tiles3DLayer(&#123;</span><br><span class="line">    url: <span class="string">'https://a.amap.com/jsapi_demos/static/data3d/single.json'</span> <span class="comment">// 3d Tiles 入口文件</span></span><br><span class="line">  &#125;).source(&#123;&#125;, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'3dtiles'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  scene.addLayer(layer)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="6-轨迹回放组件"><a href="#6-轨迹回放组件" class="headerlink" title="6. 轨迹回放组件"></a>6. 轨迹回放组件</h3><p>RoutePlay 是轨迹回放组件</p>
<h4 id="6-1-参数"><a href="#6-1-参数" class="headerlink" title="6.1 参数"></a>6.1 参数</h4><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>必传</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>scene</td>
<td>实例化场景</td>
<td>Object</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>fastSpeed</td>
<td>快速速度配置（正整数）</td>
<td>Number</td>
<td></td>
<td>3</td>
</tr>
<tr>
<td>normalSpeed</td>
<td>正常速度配置（正整数）</td>
<td>Number</td>
<td></td>
<td>2</td>
</tr>
<tr>
<td>lowSpeed</td>
<td>慢速速度配置（正整数）</td>
<td>Number</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>isShowRouteLayer</td>
<td>是否显示轨迹</td>
<td>Boolean</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>isShowVisitedLayer</td>
<td>是否显示实时经过轨迹</td>
<td>Boolean</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>isShowMarker</td>
<td>是否显示marker（随轨迹运动点）</td>
<td>Boolean</td>
<td></td>
<td>true</td>
</tr>
<tr>
<td>marker</td>
<td>可外部传入 marker</td>
<td>Object</td>
<td></td>
<td></td>
</tr>
<tr>
<td>routeLayer</td>
<td>可外部传入 轨迹图层（LineLayer 实例）</td>
<td>Object</td>
<td></td>
<td></td>
</tr>
<tr>
<td>visitedLayer</td>
<td>可外部传入 实时经过轨迹图层（LineLayer 实例）</td>
<td>Object</td>
<td></td>
<td></td>
</tr>
<tr>
<td>route</td>
<td>轨迹标准 geojson 数据</td>
<td>Object</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>size</td>
<td>轨迹线宽</td>
<td>Number</td>
<td></td>
<td>4</td>
</tr>
<tr>
<td>color</td>
<td>轨迹颜色</td>
<td>String</td>
<td></td>
<td>#2896f6</td>
</tr>
<tr>
<td>visitedSize</td>
<td>实时经过轨迹线宽</td>
<td>Number</td>
<td></td>
<td>4</td>
</tr>
<tr>
<td>visitedColor</td>
<td>实时经过轨迹颜色</td>
<td>String</td>
<td></td>
<td>#374048</td>
</tr>
<tr>
<td>markerEventList</td>
<td>marker 事件列表（数组，’mousemove’,’click’,’mousedown’,’mouseup’,’dblclick’,’contextmenu’,’mouseover’,’mouseout’）</td>
<td>Array</td>
<td></td>
<td>[‘click’]</td>
</tr>
<tr>
<td>routeEventList</td>
<td>轨迹图层事件列表（数组，’mousemove’,’click’,’mousedown’,’mouseup’,’dblclick’,’contextmenu’,’mouseover’,’mouseout’）</td>
<td>Array</td>
<td></td>
<td>[‘click’]</td>
</tr>
<tr>
<td>visitedEventList</td>
<td>实时经过轨迹图层 事件列表（数组，’mousemove’,’click’,’mousedown’,’mouseup’,’dblclick’,’contextmenu’,’mouseover’,’mouseout’）</td>
<td>Array</td>
<td></td>
<td>[‘click’]</td>
</tr>
</tbody>
</table>
<h4 id="6-2-方法"><a href="#6-2-方法" class="headerlink" title="6.2 方法"></a>6.2 方法</h4><p><strong>start</strong></p>
<p>开始播放</p>
<p><strong>pause</strong></p>
<p>暂停</p>
<p><strong>stop</strong></p>
<p>停止</p>
<p><strong>reset</strong></p>
<p>重置，播放速度为 normalSpeed</p>
<p><strong>speedUp</strong> </p>
<p>设置速度为 fastSpeed</p>
<p><strong>speedDown</strong> </p>
<p>设置速度为 lowSpeed</p>
<p><strong>seekTo</strong></p>
<p>跳转执行位置播放</p>
<p>参数：num 0-1之间小数</p>
<h4 id="6-3-示例"><a href="#6-3-示例" class="headerlink" title="6.3 示例"></a>6.3 示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  import &#123; CMap, GaodeMap, RoutePlay &#125; from &apos;cci-map&apos;</span><br><span class="line">  // import &#123; CMap, GaodeMap &#125; from &apos;cci-map&apos;</span><br><span class="line">	// import RoutePlay from &quot;cci-cp-l7-route&quot;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    components: &#123;</span><br><span class="line">      RoutePlay</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        scene: null,</span><br><span class="line">        routeData: &#123;</span><br><span class="line">          type: &quot;FeatureCollection&quot;,</span><br><span class="line">          features: [</span><br><span class="line">            &#123;</span><br><span class="line">              type: &quot;Feature&quot;,</span><br><span class="line">              properties: &#123;&#125;,</span><br><span class="line">              geometry: &#123;</span><br><span class="line">                type: &quot;LineString&quot;,</span><br><span class="line">                coordinates: [</span><br><span class="line">                  [105.6005859375, 30.65681556429287],</span><br><span class="line">                  [107.95166015624999, 31.98944183792288],</span><br><span class="line">                  [107.95166015624999, 31.98944183792288],</span><br><span class="line">                  [109.3798828125, 30.031055426540206],</span><br><span class="line">                  [107.7978515625, 29.935895213372444]</span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">      const scene = new CMap(&#123;</span><br><span class="line">        id: &apos;map&apos;,</span><br><span class="line">        map: new GaodeMap(&#123;</span><br><span class="line">          center: [106.790327, 31.095636],</span><br><span class="line">          pitch: 0,</span><br><span class="line">          zoom: 7,</span><br><span class="line">          style: &apos;light&apos;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      start() &#123;</span><br><span class="line">        this.$refs.route &amp;&amp; this.$refs.route.start()</span><br><span class="line">      &#125;,</span><br><span class="line">      pause() &#123;</span><br><span class="line">        this.$refs.route &amp;&amp; this.$refs.route.pause()</span><br><span class="line">      &#125;,</span><br><span class="line">      stop() &#123;</span><br><span class="line">        this.$refs.route &amp;&amp; this.$refs.route.stop()</span><br><span class="line">      &#125;,</span><br><span class="line">      reset() &#123;</span><br><span class="line">        this.$refs.route &amp;&amp; this.$refs.route.reset()</span><br><span class="line">      &#125;,</span><br><span class="line">      speedUp() &#123;</span><br><span class="line">        this.$refs.route &amp;&amp; this.$refs.route.speedUp()</span><br><span class="line">      &#125;,</span><br><span class="line">      speedDown() &#123;</span><br><span class="line">        this.$refs.route &amp;&amp; this.$refs.route.speedDown()</span><br><span class="line">      &#125;,</span><br><span class="line">      seekTo() &#123;</span><br><span class="line">        this.$refs.route &amp;&amp; this.$refs.route.seekTo(0.5)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;map&quot; style=&quot;width:100%;height:100%;position: absolute;top: 0;bottom: 0;&quot;&gt;</span><br><span class="line">    &lt;RoutePlay</span><br><span class="line">      ref=&quot;route&quot;</span><br><span class="line">      :scene=&quot;scene&quot;</span><br><span class="line">      :route=&quot;routeData&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;div class=&quot;buttons&quot;&gt;</span><br><span class="line">      &lt;button @click=&quot;start&quot;&gt;</span><br><span class="line">        开始</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button @click=&quot;pause&quot;&gt;</span><br><span class="line">        暂停</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button @click=&quot;stop&quot;&gt;</span><br><span class="line">        结束</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button @click=&quot;reset&quot;&gt;</span><br><span class="line">        重置</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button @click=&quot;speedUp&quot;&gt;</span><br><span class="line">        加速</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button @click=&quot;speedDown&quot;&gt;</span><br><span class="line">        减速</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button @click=&quot;seekTo&quot;&gt;</span><br><span class="line">        指定 50% 位置播放</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">  .buttons&#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    z-index: 1;</span><br><span class="line">    display: flex;</span><br><span class="line">  &#125;</span><br><span class="line">  button&#123;</span><br><span class="line">    margin-right: 5px;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="六、图层发布和使用"><a href="#六、图层发布和使用" class="headerlink" title="六、图层发布和使用"></a>六、图层发布和使用</h2><ul>
<li>对于标准天地图，使用 cci-map 的 Mapbox</li>
<li>对于天地图自定义坐标系，使用 cci-map 的 maptalks 结合 proj4 实现自定义天地图投影坐标系，可在地图基础上叠加 cci-map 可视化图层和 wmts/wms 图层</li>
</ul>
<h3 id="1-对接流程"><a href="#1-对接流程" class="headerlink" title="1. 对接流程"></a>1. 对接流程</h3><p><img src="https://z3.ax1x.com/2021/11/17/I4mi9S.png" alt></p>
<h3 id="2-图层发布后对接实例"><a href="#2-图层发布后对接实例" class="headerlink" title="2. 图层发布后对接实例"></a>2. 图层发布后对接实例</h3><p>自定义天地图投影坐标系目前使用 leaflet 实现（项目需要加载 leaflet，proj4， proj4leaflet 库文件），cci-map 会在下一个版本接入 maptalks 引擎，届时可以通过 maptalks 结合 proj4 实现自定义天地图投影坐标系</p>
<ul>
<li>页面源码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;map&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import &#123; CMap, GaodeMap, Mapbox, MapTalks, WMSLayer, CoordsTransform &#125; from &apos;@cci/map&apos;</span><br><span class="line">  // import &#123; CMap, GaodeMap, Mapbox, MapTalks &#125; from &apos;cci-map&apos;</span><br><span class="line">	// import &#123; WMSLayer &#125; from &apos;cci-layers&apos;</span><br><span class="line">  // import &#123; CoordsTransform &#125; from &apos;cci-utils&apos;</span><br><span class="line">  import mapboxgl from &apos;mapbox-gl&apos;</span><br><span class="line">  window.mapboxgl = mapboxgl</span><br><span class="line"></span><br><span class="line">  import * as maptalks from &apos;maptalks&apos;</span><br><span class="line">  import proj4 from &apos;proj4&apos;</span><br><span class="line"></span><br><span class="line">  function isJSON(val) &#123;</span><br><span class="line">    if (typeof val !== &apos;string&apos;) &#123;</span><br><span class="line">      return false</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">      const obj = JSON.parse(val)</span><br><span class="line">      if (Object.prototype.toString.call(obj) === &apos;[object Object]&apos;) &#123;</span><br><span class="line">        return true</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      return false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getQuery() &#123;</span><br><span class="line">    const formattedParams = &#123;&#125;</span><br><span class="line">    let params = location.href.split(&quot;?&quot;)[1] || &apos;&apos;</span><br><span class="line">    params = params.split(&quot;&amp;&quot;)</span><br><span class="line">    for (let i = 0; i &lt; params.length; i++) &#123;</span><br><span class="line">      formattedParams[params[i].split(&quot;=&quot;)[0]] = params[i].split(&quot;=&quot;)[1]</span><br><span class="line">    &#125;</span><br><span class="line">    return formattedParams</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const BAIDU_MAP_TYPE = 2</span><br><span class="line">  const GAODE_MAP_TYPE = 1</span><br><span class="line">  const MAPBOX_MAP_TYPE = 3</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">      layerInfo() &#123;</span><br><span class="line">        const layerInfo = decodeURIComponent(getQuery().layerInfo || &#123;&#125;)</span><br><span class="line">        return isJSON(layerInfo) ? JSON.parse(layerInfo) : layerInfo</span><br><span class="line">      &#125;,</span><br><span class="line">      baseMapType() &#123;</span><br><span class="line">        return Number(this.layerInfo &amp;&amp; this.layerInfo.baseMapType || 3)</span><br><span class="line">      &#125;,</span><br><span class="line">      layerName() &#123;</span><br><span class="line">        return this.layerInfo &amp;&amp; this.layerInfo.layerName || &apos;&apos;</span><br><span class="line">      &#125;,</span><br><span class="line">      token() &#123;</span><br><span class="line">        return this.layerInfo &amp;&amp; this.layerInfo.token || 1</span><br><span class="line">      &#125;,</span><br><span class="line">      bbox() &#123;</span><br><span class="line">        return this.layerInfo &amp;&amp; this.layerInfo.boundingBox || &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      crs() &#123;</span><br><span class="line">        return this.bbox &amp;&amp; this.bbox.crs || &apos;EPSG:3857&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">      this.initMap()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      fitBounds() &#123;</span><br><span class="line">        if (Object.keys(this.bbox).length) &#123;</span><br><span class="line">          const bbox = this.bbox</span><br><span class="line">          if (this.baseMapType === MAPBOX_MAP_TYPE) &#123;</span><br><span class="line">            this.boudns = [[bbox.minY, bbox.minX], [bbox.maxY, bbox.maxX]]</span><br><span class="line">            this.map.fitBounds(this.bounds)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            if (this.baseMapType === GAODE_MAP_TYPE) &#123;</span><br><span class="line">              // 转为高德</span><br><span class="line">              this.bounds = [CoordsTransform.wgs84togcj02(bbox.minX, bbox.minY), CoordsTransform.wgs84togcj02(bbox.maxX, bbox.maxY)]</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.bounds = [[bbox.minX, bbox.minY], [bbox.maxX, bbox.maxY]]</span><br><span class="line">            &#125;</span><br><span class="line">            this.scene.fitBounds(this.bounds)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      createWMSLayer() &#123;</span><br><span class="line">        const layerName = this.layerName</span><br><span class="line">        if (!layerName) return</span><br><span class="line">        </span><br><span class="line">        if (this.baseMapType === MAPBOX_MAP_TYPE) &#123;</span><br><span class="line">          L.tileLayer.wms(`/withauthV2/$&#123;layerName&#125;/$&#123;this.token&#125;/wms`, &#123;</span><br><span class="line">            layers: layerName,</span><br><span class="line">            transparent: true,</span><br><span class="line">            styles: &apos;&apos;,</span><br><span class="line">            format: &apos;image/png&apos;,</span><br><span class="line">            version: &apos;1.1.1&apos;,</span><br><span class="line">            srs: this.crs</span><br><span class="line">          &#125;).addTo(this.map)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          const layer = new WMSLayer(&#123;</span><br><span class="line">            minZoom: 5,</span><br><span class="line">            maxZoom: 18,</span><br><span class="line">            tileSize: 256</span><br><span class="line">          &#125;)</span><br><span class="line">          layer.source(</span><br><span class="line">            &#123;</span><br><span class="line">              url: `/withauthV2/$&#123;layerName&#125;/$&#123;this.token&#125;/wms`,</span><br><span class="line">              params: &#123;</span><br><span class="line">                layers: layerName,</span><br><span class="line">                transparent: true,</span><br><span class="line">                styles: &apos;&apos;,</span><br><span class="line">                format: &apos;image/png&apos;,</span><br><span class="line">                version: &apos;1.1.1&apos;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              parser: &#123;</span><br><span class="line">                type: &apos;wms&apos;,</span><br><span class="line">                crs: this.crs</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          )</span><br><span class="line">          this.scene.addLayer(layer)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // const layer = new WMSLayer(&#123;</span><br><span class="line">        //   minZoom: 5,</span><br><span class="line">        //   maxZoom: 18,</span><br><span class="line">        //   tileSize: 256</span><br><span class="line">        // &#125;)</span><br><span class="line">        // layer.source(</span><br><span class="line">        //   &#123;</span><br><span class="line">        //     url: `/withauthV2/$&#123;layerName&#125;/$&#123;this.token&#125;/wms`,</span><br><span class="line">        //     params: &#123;</span><br><span class="line">        //       layers: layerName,</span><br><span class="line">        //       transparent: true,</span><br><span class="line">        //       styles: &apos;&apos;,</span><br><span class="line">        //       format: &apos;image/png&apos;,</span><br><span class="line">        //       version: &apos;1.1.1&apos;</span><br><span class="line">        //     &#125;</span><br><span class="line">        //   &#125;,</span><br><span class="line">        //   &#123;</span><br><span class="line">        //     parser: &#123;</span><br><span class="line">        //       type: &apos;wms&apos;,</span><br><span class="line">        //       crs: this.crs</span><br><span class="line">        //     &#125;</span><br><span class="line">        //   &#125;</span><br><span class="line">        // )</span><br><span class="line">        // this.scene.addLayer(layer)</span><br><span class="line">      &#125;,</span><br><span class="line">      initMap() &#123;</span><br><span class="line">        const center = [120.153576, 30.287459]// 默认中心点</span><br><span class="line">        const zoom = 11 // 默认缩放层级</span><br><span class="line"></span><br><span class="line">        this.scene = null</span><br><span class="line"></span><br><span class="line">        if (this.baseMapType === GAODE_MAP_TYPE) &#123;</span><br><span class="line">          this.scene = new CMap(&#123;</span><br><span class="line">            id: &apos;map&apos;,</span><br><span class="line">            map: new GaodeMap(&#123;</span><br><span class="line">              zoom, // 初始化地图层级</span><br><span class="line">              center, // 初始化地图中心点</span><br><span class="line">              token: &apos;48463d4ad0a6bd804a336d9ed317717e&apos;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">          this.scene.on(&apos;loaded&apos;, () =&gt; &#123;</span><br><span class="line">            this.fitBounds()</span><br><span class="line">            this.createWMSLayer()</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; else if (this.baseMapType === BAIDU_MAP_TYPE) &#123;</span><br><span class="line">          mapboxgl.accessToken = &apos;pk.eyJ1IjoicXdlcnJnaGoiLCJhIjoiY2p5cXY5aGtuMDQwMjNkbGdjYTJ5MWIxeSJ9.2ro1n4MvUCzJiV1m4mrxAA&apos;</span><br><span class="line">          const map = new mapboxgl.Map(&#123;</span><br><span class="line">            container: &apos;map&apos;,</span><br><span class="line">            style: &#123;</span><br><span class="line">              &quot;name&quot;: &quot;mapbox_baidu&quot;,</span><br><span class="line">              &apos;version&apos;: 8,</span><br><span class="line">              &apos;sources&apos;: &#123;&#125;,</span><br><span class="line">              &apos;layers&apos;: []</span><br><span class="line">            &#125;,</span><br><span class="line">            center,</span><br><span class="line">            zoom</span><br><span class="line">          &#125;)</span><br><span class="line">          this.scene = new CMap(&#123;</span><br><span class="line">            id: &apos;map&apos;,</span><br><span class="line">            map: new Mapbox(&#123;</span><br><span class="line">              mapInstance: map</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">          this.scene.on(&apos;loaded&apos;, async() =&gt; &#123;</span><br><span class="line">            const module = await import(&apos;./baiduLayer&apos;)</span><br><span class="line">            const BaiduLayer = module.default</span><br><span class="line">            map.addLayer(new BaiduLayer())</span><br><span class="line">            this.fitBounds()</span><br><span class="line">            this.createWMSLayer()</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          // 自定义投影坐标系天地图</span><br><span class="line">          const CRS_4490 = new L.Proj.CRS(</span><br><span class="line">            &quot;EPSG:4490&quot;,</span><br><span class="line">            &quot;+proj=longlat +ellps=GRS80 +no_defs&quot;,</span><br><span class="line">            &#123;</span><br><span class="line">              resolutions: [</span><br><span class="line">                0.00549933137239034, // Level 0</span><br><span class="line">                0.00274966568619517, // Level 1</span><br><span class="line">                0.00137483284309758, // Level 2</span><br><span class="line">                0.000687416421548792, // Level 3</span><br><span class="line">                0.000343708210774396, // Level 4</span><br><span class="line">                0.000171854105387198,</span><br><span class="line">                8.5927052693599e-5,</span><br><span class="line">                4.29635263467995e-5,</span><br><span class="line">                2.14817631733998e-5,</span><br><span class="line">                1.07408815866999e-5,</span><br><span class="line">                5.37044079334994e-6,</span><br><span class="line">                2.68522039667497e-6,</span><br><span class="line">                1.34261019833748e-6</span><br><span class="line">              ],</span><br><span class="line">              origin: [118.122911693886, 31.2869311022836]</span><br><span class="line">            &#125;</span><br><span class="line">          )</span><br><span class="line">          this.map = L.map(&quot;map&quot;, &#123;</span><br><span class="line">            minZoom: 1,</span><br><span class="line">            maxZoom: 20,</span><br><span class="line">            center: [30.0869311022836, 119.822911693886],</span><br><span class="line">            zoom: 1,</span><br><span class="line">            zoomControl: true,</span><br><span class="line">            attributionControl: true,</span><br><span class="line">            crs: CRS_4490,</span><br><span class="line">            editable: true</span><br><span class="line">          &#125;)</span><br><span class="line">          const url =</span><br><span class="line">            &quot;http://172.18.109.232:8080/E36CCEA93443D1495DB9B9F2B2FFE348CB1A367D75176F815040AB19E54CDCA5DAAA25813AF965E2ABD0CC2463DD1223/PBS/rest/services/hzsyraster/Mapserver/&quot;</span><br><span class="line">          const basemap = new L.TileLayer(url + &quot;/tile/&#123;z&#125;/&#123;y&#125;/&#123;x&#125;&quot;, &#123;</span><br><span class="line">            tileSize: 256,</span><br><span class="line">            maxZoom: 12</span><br><span class="line">          &#125;)</span><br><span class="line">          this.map.addLayer(basemap)</span><br><span class="line"></span><br><span class="line">          this.map.on(&apos;load&apos;, () =&gt; &#123;</span><br><span class="line">            this.fitBounds()</span><br><span class="line">            this.createWMSLayer()</span><br><span class="line">          &#125;)</span><br><span class="line">          </span><br><span class="line">          // const proj4490 = &quot;+proj=longlat +ellps=GRS80 +no_defs&quot;</span><br><span class="line">          // const projection = proj4(&apos;WGS84&apos;, proj4490)</span><br><span class="line">          // const spatialReference = &#123;</span><br><span class="line">          //   projection: &#123;</span><br><span class="line">          //     code: &apos;EPSG4490&apos;,</span><br><span class="line">          //     project: function(c) &#123;</span><br><span class="line">          //       const pc = projection.forward(c.toArray())</span><br><span class="line">          //       return new maptalks.Coordinate(pc)</span><br><span class="line">          //     &#125;,</span><br><span class="line">          //     unproject: function(pc) &#123;</span><br><span class="line">          //       const c = projection.inverse(pc.toArray())</span><br><span class="line">          //       return new maptalks.Coordinate(c)</span><br><span class="line">          //     &#125;</span><br><span class="line">          //   &#125;, // geo projection, defined by proj4js</span><br><span class="line">          //   resolutions: [</span><br><span class="line">          //     0.00549933137239034, // Level 0</span><br><span class="line">          //     0.00274966568619517, // Level 1</span><br><span class="line">          //     0.00137483284309758, // Level 2</span><br><span class="line">          //     0.000687416421548792, // Level 3</span><br><span class="line">          //     0.000343708210774396, // Level 4</span><br><span class="line">          //     0.000171854105387198,</span><br><span class="line">          //     8.5927052693599e-5,</span><br><span class="line">          //     4.29635263467995e-5,</span><br><span class="line">          //     2.14817631733998e-5,</span><br><span class="line">          //     1.07408815866999e-5,</span><br><span class="line">          //     5.37044079334994e-6,</span><br><span class="line">          //     2.68522039667497e-6,</span><br><span class="line">          //     1.34261019833748e-6</span><br><span class="line">          //   ],</span><br><span class="line">          //   &apos;fullExtent&apos;: &#123;</span><br><span class="line">          //     &apos;top&apos;: 90,</span><br><span class="line">          //     &apos;left&apos;: -180,</span><br><span class="line">          //     &apos;bottom&apos;: -90,</span><br><span class="line">          //     &apos;right&apos;: 180</span><br><span class="line">          //   &#125;</span><br><span class="line">          // &#125;</span><br><span class="line"></span><br><span class="line">          // const map = new maptalks.Map(&apos;map&apos;, &#123;</span><br><span class="line">          //   center,</span><br><span class="line">          //   zoom,</span><br><span class="line">          //   spatialReference,</span><br><span class="line">          //   baseLayer: new maptalks.TileLayer(&apos;base&apos;, &#123;</span><br><span class="line">          //     urlTemplate: &apos;http://183.134.200.102:8080/DD1223/E36CCEA93443D1495DB9B9F2B2FFE348CB1A367D75176F815040AB19E54CDCA5DAAA25813AF965E2ABD0CC2463DD1223/PBS/rest/services/hzsyvector/Mapserver/tile/&#123;z&#125;/&#123;y&#125;/&#123;x&#125;&apos;,</span><br><span class="line">          //     spatialReference,</span><br><span class="line">          //     tileSystem: [1, -1, 118.122911693886, 31.2869311022836]</span><br><span class="line">          //   &#125;)</span><br><span class="line">          // &#125;)</span><br><span class="line"></span><br><span class="line">          // this.scene = new CMap(&#123;</span><br><span class="line">          //   id: &apos;map&apos;,</span><br><span class="line">          //   map: new MapTalks(&#123;</span><br><span class="line">          //     mapInstance: map</span><br><span class="line">          //   &#125;)</span><br><span class="line">          // &#125;)</span><br><span class="line">          // this.scene.on(&apos;loaded&apos;, async() =&gt; &#123;</span><br><span class="line">          //   this.fitBounds()</span><br><span class="line">          //   this.createWMSLayer()</span><br><span class="line">          // &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">  display: none;</span><br><span class="line">&#125;</span><br><span class="line">#map &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 99.5%;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>页面函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变量说明</span></span><br><span class="line">baseMapType 底图类型：<span class="number">1</span>-高德 <span class="number">2</span>-百度 <span class="number">3</span>-天地图</span><br><span class="line">layerName 图层名称</span><br><span class="line">token 图层token</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数说明</span></span><br><span class="line"><span class="comment">// 初始化地图</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initMap</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 获取图层边界，地图自适应边界</span></span><br><span class="line"><span class="function"><span class="title">function</span> <span class="title">fitBounds</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 加载 <span class="title">wms</span> 图层</span></span><br><span class="line"><span class="function"><span class="title">function</span> <span class="title">createWMSLayer</span>(<span class="params"></span>)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>页面源码依赖的百度 layer 代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CoordsTransform &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CoordsTransform &#125; from 'cci-utils'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Xa</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> a === <span class="string">"function"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Wa</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> a === <span class="string">"number"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Za</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> a === <span class="string">"string"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Db</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> a !== <span class="string">"undefined"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Eb</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> a === <span class="string">"object"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">H</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">isNaN</span>(a) &amp;&amp; (a = Hb(a), a = <span class="built_in">isNaN</span>(a) ? <span class="number">0</span> : a)</span><br><span class="line">  Za(a) &amp;&amp; (a = <span class="built_in">parseFloat</span>(a))</span><br><span class="line">  <span class="built_in">isNaN</span>(b) &amp;&amp; (b = Hb(b), b = <span class="built_in">isNaN</span>(b) ? <span class="number">0</span> : b)</span><br><span class="line">  Za(b) &amp;&amp; (b = <span class="built_in">parseFloat</span>(b))</span><br><span class="line">  <span class="keyword">this</span>.lng = a</span><br><span class="line">  <span class="keyword">this</span>.lat = b</span><br><span class="line">&#125;</span><br><span class="line">H.eM = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a &amp;&amp; a.lng &lt;= <span class="number">180</span> &amp;&amp; a.lng &gt;= <span class="number">-180</span> &amp;&amp; a.lat &lt;= <span class="number">74</span> &amp;&amp; a.lat &gt;= <span class="number">-74</span></span><br><span class="line">&#125;</span><br><span class="line">H.prototype.nb = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a &amp;&amp; <span class="keyword">this</span>.lat == a.lat &amp;&amp; <span class="keyword">this</span>.lng == a.lng</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="literal">null</span></span><br><span class="line"><span class="keyword">var</span> j = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaiduProjection</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.lP = <span class="number">6370996.81</span></span><br><span class="line">    <span class="keyword">this</span>.tG = [<span class="number">1.289059486E7</span>, <span class="number">8362377.87</span>, <span class="number">5591021</span>, <span class="number">3481989.83</span>, <span class="number">1678043.12</span>, <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">this</span>.Eu = [<span class="number">75</span>, <span class="number">60</span>, <span class="number">45</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">this</span>.rP = [</span><br><span class="line">      [<span class="number">1.410526172116255E-8</span>, <span class="number">8.98305509648872E-6</span>, <span class="number">-1.9939833816331</span>, <span class="number">200.9824383106796</span>, <span class="number">-187.2403703815547</span>, <span class="number">91.6087516669843</span>, <span class="number">-23.38765649603339</span>, <span class="number">2.57121317296198</span>, <span class="number">-0.03801003308653</span>, <span class="number">1.73379812E7</span>],</span><br><span class="line">      [<span class="number">-7.435856389565537E-9</span>, <span class="number">8.983055097726239E-6</span>, <span class="number">-0.78625201886289</span>, <span class="number">96.32687599759846</span>, <span class="number">-1.85204757529826</span>, <span class="number">-59.36935905485877</span>, <span class="number">47.40033549296737</span>, <span class="number">-16.50741931063887</span>, <span class="number">2.28786674699375</span>, <span class="number">1.026014486E7</span>],</span><br><span class="line">      [<span class="number">-3.030883460898826E-8</span>, <span class="number">8.98305509983578E-6</span>, <span class="number">0.30071316287616</span>, <span class="number">59.74293618442277</span>, <span class="number">7.357984074871</span>, <span class="number">-25.38371002664745</span>, <span class="number">13.45380521110908</span>, <span class="number">-3.29883767235584</span>, <span class="number">0.32710905363475</span>, <span class="number">6856817.37</span>],</span><br><span class="line">      [<span class="number">-1.981981304930552E-8</span>, <span class="number">8.983055099779535E-6</span>, <span class="number">0.03278182852591</span>, <span class="number">40.31678527705744</span>, <span class="number">0.65659298677277</span>, <span class="number">-4.44255534477492</span>, <span class="number">0.85341911805263</span>, <span class="number">0.12923347998204</span>, <span class="number">-0.04625736007561</span>, <span class="number">4482777.06</span>],</span><br><span class="line">      [<span class="number">3.09191371068437E-9</span>, <span class="number">8.983055096812155E-6</span>, <span class="number">6.995724062E-5</span>, <span class="number">23.10934304144901</span>, <span class="number">-2.3663490511E-4</span>, <span class="number">-0.6321817810242</span>, <span class="number">-0.00663494467273</span>, <span class="number">0.03430082397953</span>, <span class="number">-0.00466043876332</span>, <span class="number">2555164.4</span>],</span><br><span class="line">      [<span class="number">2.890871144776878E-9</span>, <span class="number">8.983055095805407E-6</span>, <span class="number">-3.068298E-8</span>, <span class="number">7.47137025468032</span>, <span class="number">-3.53937994E-6</span>, <span class="number">-0.02145144861037</span>, <span class="number">-1.234426596E-5</span>, <span class="number">1.0322952773E-4</span>, <span class="number">-3.23890364E-6</span>, <span class="number">826088.5</span>]</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">this</span>.qG = [</span><br><span class="line">      [<span class="number">-0.0015702102444</span>, <span class="number">111320.7020616939</span>, <span class="number">1704480524535203</span>, <span class="number">-10338987376042340</span>, <span class="number">26112667856603880</span>, <span class="number">-35149669176653700</span>, <span class="number">26595700718403920</span>, <span class="number">-10725012454188240</span>, <span class="number">1800819912950474</span>, <span class="number">82.5</span>],</span><br><span class="line">      [<span class="number">8.277824516172526E-4</span>, <span class="number">111320.7020463578</span>, <span class="number">6.477955746671607E8</span>, <span class="number">-4.082003173641316E9</span>, <span class="number">1.077490566351142E10</span>, <span class="number">-1.517187553151559E10</span>, <span class="number">1.205306533862167E10</span>, <span class="number">-5.124939663577472E9</span>, <span class="number">9.133119359512032E8</span>, <span class="number">67.5</span>],</span><br><span class="line">      [<span class="number">0.00337398766765</span>, <span class="number">111320.7020202162</span>, <span class="number">4481351.045890365</span>, <span class="number">-2.339375119931662E7</span>, <span class="number">7.968221547186455E7</span>, <span class="number">-1.159649932797253E8</span>, <span class="number">9.723671115602145E7</span>, <span class="number">-4.366194633752821E7</span>, <span class="number">8477230.501135234</span>, <span class="number">52.5</span>],</span><br><span class="line">      [<span class="number">0.00220636496208</span>, <span class="number">111320.7020209128</span>, <span class="number">51751.86112841131</span>, <span class="number">3796837.749470245</span>, <span class="number">992013.7397791013</span>, <span class="number">-1221952.21711287</span>, <span class="number">1340652.697009075</span>, <span class="number">-620943.6990984312</span>, <span class="number">144416.9293806241</span>, <span class="number">37.5</span>],</span><br><span class="line">      [<span class="number">-3.441963504368392E-4</span>, <span class="number">111320.7020576856</span>, <span class="number">278.2353980772752</span>, <span class="number">2485758.690035394</span>, <span class="number">6070.750963243378</span>, <span class="number">54821.18345352118</span>, <span class="number">9540.606633304236</span>, <span class="number">-2710.55326746645</span>, <span class="number">1405.483844121726</span>, <span class="number">22.5</span>],</span><br><span class="line">      [<span class="number">-3.218135878613132E-4</span>, <span class="number">111320.7020701615</span>, <span class="number">0.00369383431289</span>, <span class="number">823725.6402795718</span>, <span class="number">0.46104986909093</span>, <span class="number">2351.343141331292</span>, <span class="number">1.58060784298199</span>, <span class="number">8.77738589078284</span>, <span class="number">0.37238884252424</span>, <span class="number">7.45</span>]</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">  w2(a, b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!a || !b) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> c; <span class="keyword">var</span> d; <span class="keyword">var</span> a = <span class="keyword">this</span>.Ab(a)</span><br><span class="line">    <span class="keyword">if</span> (!a) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    c = <span class="keyword">this</span>.Tk(a.lng)</span><br><span class="line">    d = <span class="keyword">this</span>.Tk(a.lat)</span><br><span class="line">    b = <span class="keyword">this</span>.Ab(b)</span><br><span class="line">    <span class="keyword">return</span> !b ? <span class="number">0</span> : <span class="keyword">this</span>.Re(c, <span class="keyword">this</span>.Tk(b.lng), d, <span class="keyword">this</span>.Tk(b.lat))</span><br><span class="line">  &#125;</span><br><span class="line">  Zo(a, b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!a || !b) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    a.lng = <span class="keyword">this</span>.OD(a.lng, <span class="number">-180</span>, <span class="number">180</span>)</span><br><span class="line">    a.lat = <span class="keyword">this</span>.SD(a.lat, <span class="number">-74</span>, <span class="number">74</span>)</span><br><span class="line">    b.lng = <span class="keyword">this</span>.OD(b.lng, <span class="number">-180</span>, <span class="number">180</span>)</span><br><span class="line">    b.lat = <span class="keyword">this</span>.SD(b.lat, <span class="number">-74</span>, <span class="number">74</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.Re(<span class="keyword">this</span>.Tk(a.lng), <span class="keyword">this</span>.Tk(b.lng), <span class="keyword">this</span>.Tk(a.lat), <span class="keyword">this</span>.Tk(b.lat))</span><br><span class="line">  &#125;</span><br><span class="line">  Ab(a) &#123;</span><br><span class="line">    <span class="keyword">if</span> (a === p || a === j) <span class="keyword">return</span> <span class="keyword">new</span> H(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">var</span> b, c</span><br><span class="line">    b = <span class="keyword">new</span> H(<span class="built_in">Math</span>.abs(a.lng), <span class="built_in">Math</span>.abs(a.lat))</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> d = <span class="number">0</span>; d &lt; <span class="keyword">this</span>.tG.length; d++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (b.lat &gt;= <span class="keyword">this</span>.tG[d]) &#123;</span><br><span class="line">        c = <span class="keyword">this</span>.rP[d]</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    a = <span class="keyword">this</span>.qK(a, c)</span><br><span class="line">    <span class="keyword">return</span> a = <span class="keyword">new</span> H(a.lng.toFixed(<span class="number">6</span>), a.lat.toFixed(<span class="number">6</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  zb(a) &#123;</span><br><span class="line">    <span class="keyword">if</span> (a === p || a === j || a.lng &gt; <span class="number">180</span> || a.lng &lt; <span class="number">-180</span> || a.lat &gt; <span class="number">90</span> || a.lat &lt; <span class="number">-90</span>) <span class="keyword">return</span> <span class="keyword">new</span> H(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">var</span> b, c</span><br><span class="line">    a.lng = <span class="keyword">this</span>.OD(a.lng, <span class="number">-180</span>, <span class="number">180</span>)</span><br><span class="line">    a.lat = <span class="keyword">this</span>.SD(a.lat, <span class="number">-74</span>, <span class="number">74</span>)</span><br><span class="line">    b = <span class="keyword">new</span> H(a.lng, a.lat)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> d = <span class="number">0</span>; d &lt; <span class="keyword">this</span>.Eu.length; d++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (b.lat &gt;= <span class="keyword">this</span>.Eu[d]) &#123;</span><br><span class="line">        c = <span class="keyword">this</span>.qG[d]</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!c) &#123;</span><br><span class="line">      <span class="keyword">for</span> (d = <span class="number">0</span>; d &lt; <span class="keyword">this</span>.Eu.length; d++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b.lat &lt;= -<span class="keyword">this</span>.Eu[d]) &#123;</span><br><span class="line">          c = <span class="keyword">this</span>.qG[d]</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    a = <span class="keyword">this</span>.qK(a, c)</span><br><span class="line">    <span class="keyword">return</span> a = <span class="keyword">new</span> H(a.lng.toFixed(<span class="number">2</span>), a.lat.toFixed(<span class="number">2</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  qK(a, b) &#123; <span class="comment">// 百度坐标便宜</span></span><br><span class="line">    <span class="keyword">if</span> (a &amp;&amp; b) &#123;</span><br><span class="line">      <span class="keyword">var</span> c = b[<span class="number">0</span>] + b[<span class="number">1</span>] * <span class="built_in">Math</span>.abs(a.lng)</span><br><span class="line">      <span class="keyword">var</span> d = <span class="built_in">Math</span>.abs(a.lat) / b[<span class="number">9</span>]</span><br><span class="line">      <span class="keyword">var</span> d = b[<span class="number">2</span>] + b[<span class="number">3</span>] * d + b[<span class="number">4</span>] * d * d + b[<span class="number">5</span>] * d * d * d + b[<span class="number">6</span>] * d * d * d * d + b[<span class="number">7</span>] * d * d * d * d * d + b[<span class="number">8</span>] * d * d * d * d * d * d</span><br><span class="line">      <span class="keyword">var</span> c = c * (a.lng &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">var</span> d = d * (a.lat &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> H(c, d)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Re(a, b, c, d) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.lP * <span class="built_in">Math</span>.acos(<span class="built_in">Math</span>.sin(c) * <span class="built_in">Math</span>.sin(d) + <span class="built_in">Math</span>.cos(c) * <span class="built_in">Math</span>.cos(d) * <span class="built_in">Math</span>.cos(b - a))</span><br><span class="line">  &#125;</span><br><span class="line">  Tk(a) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.PI * a / <span class="number">180</span></span><br><span class="line">  &#125;</span><br><span class="line">  v4(a) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">180</span> * a / <span class="built_in">Math</span>.PI</span><br><span class="line">  &#125;</span><br><span class="line">  SD(a, b, c) &#123;</span><br><span class="line">    b != p &amp;&amp; (a = <span class="built_in">Math</span>.max(a, b))</span><br><span class="line">    c != p &amp;&amp; (a = <span class="built_in">Math</span>.min(a, c))</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">  &#125;</span><br><span class="line">  OD(a, b, c) &#123;</span><br><span class="line">    <span class="keyword">for</span> (; a &gt; c;) a -= c - b</span><br><span class="line">    <span class="keyword">for</span> (; a &lt; b;) a += c - b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">MapboxBaiduLayer_new</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.id = <span class="string">'mapbox_baidu_layer_new'</span></span><br><span class="line">    <span class="keyword">this</span>.type = <span class="string">'custom'</span></span><br><span class="line">    <span class="keyword">this</span>.renderingMode = <span class="string">'2d'</span></span><br><span class="line">    <span class="keyword">this</span>.allImages = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.curImages = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>._tileSize = <span class="number">256</span></span><br><span class="line">    <span class="keyword">this</span>.renderImgs = []</span><br><span class="line">    <span class="keyword">this</span>.oldRendAllImageMap = []</span><br><span class="line">    <span class="keyword">this</span>._tileOnlineArr = [<span class="string">"http://online0.map.bdimg.com/tile/"</span>, <span class="string">"http://online1.map.bdimg.com/tile/"</span>, <span class="string">"http://online2.map.bdimg.com/tile/"</span>, <span class="string">"http://online3.map.bdimg.com/tile/"</span>, <span class="string">"http://online4.map.bdimg.com/tile/"</span>]</span><br><span class="line">    <span class="keyword">this</span>.vertCode =</span><br><span class="line">            <span class="string">'attribute vec2 a_position;'</span> +</span><br><span class="line">            <span class="string">'attribute vec2 a_texCoord; '</span> +</span><br><span class="line">            <span class="string">'varying vec2 v_texCoord; '</span> +</span><br><span class="line">            <span class="string">"uniform mat4 u_matrix;"</span> +</span><br><span class="line">            <span class="string">'void main() &#123; '</span> +</span><br><span class="line">            <span class="string">"gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);"</span> +</span><br><span class="line">            <span class="string">'v_texCoord = a_texCoord; '</span> +</span><br><span class="line">            <span class="string">'&#125; '</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 片段着色器的sourse</span></span><br><span class="line">    <span class="keyword">this</span>.fragCode =</span><br><span class="line">            <span class="string">'precision mediump float; '</span> +</span><br><span class="line">            <span class="string">'uniform sampler2D u_image;'</span> +</span><br><span class="line">            <span class="string">'varying vec2 v_texCoord;'</span> +</span><br><span class="line">            <span class="string">'void main() &#123; '</span> +</span><br><span class="line">            <span class="string">'gl_FragColor = texture2D(u_image, v_texCoord);'</span> +</span><br><span class="line">            <span class="string">'&#125;'</span></span><br><span class="line">  &#125;</span><br><span class="line">  getTileUrl(row, col, level) &#123;</span><br><span class="line">    <span class="keyword">var</span> udt = <span class="string">"20180426"</span></span><br><span class="line">    <span class="keyword">var</span> style = <span class="string">"pl"</span></span><br><span class="line">    <span class="keyword">var</span> baseUrl = <span class="keyword">this</span>._tileOnlineArr[<span class="built_in">Math</span>.abs(col + row) % <span class="keyword">this</span>._tileOnlineArr.length]</span><br><span class="line">    <span class="keyword">var</span> url = baseUrl + <span class="string">"?qt=tile&amp;x="</span> + col + <span class="string">"&amp;y="</span> + row + <span class="string">"&amp;z="</span> + level + <span class="string">"&amp;styles="</span> + style + <span class="string">"&amp;scaler=1&amp;color_dep=32&amp;colors=50&amp;udt="</span> + udt</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过百度的行列号得到这个百度切片对应的wgs84的坐标范围</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">R</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">C</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">L</span></span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  getWgs84BoundByBaiduRCL(R, C, L) &#123;</span><br><span class="line">    <span class="comment">// 有纠偏</span></span><br><span class="line">    <span class="keyword">var</span> tileM = <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">18</span> - L) * <span class="keyword">this</span>._tileSize<span class="comment">// 计算该层级下一张图片的大小</span></span><br><span class="line">    <span class="keyword">var</span> minX = C * tileM</span><br><span class="line">    <span class="keyword">var</span> minY = R * tileM</span><br><span class="line">    <span class="keyword">var</span> maxX = minX + tileM</span><br><span class="line">    <span class="keyword">var</span> maxY = minY + tileM</span><br><span class="line">    <span class="keyword">var</span> baiduProjection = <span class="keyword">new</span> BaiduProjection()</span><br><span class="line">    <span class="keyword">var</span> baiduWgsSW = baiduProjection.Ab(&#123; <span class="attr">lng</span>: minX, <span class="attr">lat</span>: minY &#125;)</span><br><span class="line">    <span class="keyword">var</span> baiduWgsNE = baiduProjection.Ab(&#123; <span class="attr">lng</span>: maxX, <span class="attr">lat</span>: maxY &#125;)</span><br><span class="line">    <span class="keyword">var</span> baiduWgsSE = baiduProjection.Ab(&#123; <span class="attr">lng</span>: minX, <span class="attr">lat</span>: maxY &#125;)</span><br><span class="line">    <span class="keyword">var</span> baiduWgsNW = baiduProjection.Ab(&#123; <span class="attr">lng</span>: maxX, <span class="attr">lat</span>: minY &#125;)</span><br><span class="line">    <span class="comment">// console.log(minX + ":" + minY + ":" + baiduWgsSW.lng + ":" + baiduWgsSW.lat + ":" + maxX + ":" + maxY + ":" + baiduWgsNE.lng + ":" + baiduWgsNE.lat);</span></span><br><span class="line">    <span class="keyword">var</span> guojiaSW = CoordsTransform.bd09togcj02(baiduWgsSW.lng, baiduWgsSW.lat)</span><br><span class="line">    <span class="keyword">var</span> guojiaNE = CoordsTransform.bd09togcj02(baiduWgsNE.lng, baiduWgsNE.lat)</span><br><span class="line">    <span class="keyword">var</span> guojiaSE = CoordsTransform.bd09togcj02(baiduWgsSE.lng, baiduWgsSE.lat)</span><br><span class="line">    <span class="keyword">var</span> guojiaNW = CoordsTransform.bd09togcj02(baiduWgsNW.lng, baiduWgsNW.lat)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wgs84SW = CoordsTransform.gcj02towgs84(guojiaSW[<span class="number">0</span>], guojiaSW[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">var</span> wgs84NE = CoordsTransform.gcj02towgs84(guojiaNE[<span class="number">0</span>], guojiaNE[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">var</span> wgs84SE = CoordsTransform.gcj02towgs84(guojiaSE[<span class="number">0</span>], guojiaSE[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">var</span> wgs84NW = CoordsTransform.gcj02towgs84(guojiaNW[<span class="number">0</span>], guojiaNW[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      sw: &#123; <span class="attr">lng</span>: wgs84SW[<span class="number">0</span>], <span class="attr">lat</span>: wgs84SW[<span class="number">1</span>] &#125;,</span><br><span class="line">      ne: &#123; <span class="attr">lng</span>: wgs84NE[<span class="number">0</span>], <span class="attr">lat</span>: wgs84NE[<span class="number">1</span>] &#125;,</span><br><span class="line">      se: &#123; <span class="attr">lng</span>: wgs84SE[<span class="number">0</span>], <span class="attr">lat</span>: wgs84SE[<span class="number">1</span>] &#125;,</span><br><span class="line">      nw: &#123; <span class="attr">lng</span>: wgs84NW[<span class="number">0</span>], <span class="attr">lat</span>: wgs84NW[<span class="number">1</span>] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过一个界别和wgs84的经纬度得到在百度里面的行列号和lebel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">level</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">wgs84p</span></span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  getBaiduRCLByWgs84LngLat(level, wgs84p) &#123;</span><br><span class="line">    <span class="comment">// 先将转成百度</span></span><br><span class="line">    <span class="keyword">var</span> guojiaP = CoordsTransform.wgs84togcj02(wgs84p.lng, wgs84p.lat)<span class="comment">// 转换成国标</span></span><br><span class="line">    <span class="keyword">var</span> baiduP = CoordsTransform.gcj02tobd09(guojiaP[<span class="number">0</span>], guojiaP[<span class="number">1</span>])<span class="comment">// 国标转百度 得到的 baiduP[0] 表示lng ， baiduP[1] 表示lat</span></span><br><span class="line">    <span class="comment">// 百度经纬度在转百度米坐标</span></span><br><span class="line">    <span class="keyword">var</span> baiduXY = <span class="keyword">new</span> BaiduProjection().zb(&#123;</span><br><span class="line">      lng: baiduP[<span class="number">0</span>],</span><br><span class="line">      lat: baiduP[<span class="number">1</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> t = <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">18</span> - level)<span class="comment">// 最顶层的一张照片是当前层级的多少张照片</span></span><br><span class="line">    <span class="keyword">var</span> k = <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">18</span> - level) * <span class="keyword">this</span>._tileSize<span class="comment">// 计算每一个图片表示墨卡托坐标系的大小</span></span><br><span class="line">    <span class="keyword">var</span> col = <span class="built_in">Math</span>.floor(baiduXY.lng / k)<span class="comment">// 地图切片的行号</span></span><br><span class="line">    <span class="keyword">var</span> row = <span class="built_in">Math</span>.floor(baiduXY.lat / k)<span class="comment">// 地图切片的列号 纬度</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      R: row,</span><br><span class="line">      C: col,</span><br><span class="line">      L: level</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getBoundImages() &#123; <span class="comment">// 得到地图当前范围的切片信息</span></span><br><span class="line">    <span class="keyword">var</span> old = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="keyword">var</span> bounds = <span class="keyword">this</span>.map.getBounds()</span><br><span class="line">    <span class="keyword">var</span> level = <span class="built_in">Math</span>.ceil(<span class="keyword">this</span>.map.getZoom()) + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (level &gt; <span class="number">20</span>) &#123;</span><br><span class="line">      level = <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> tileM = <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">18</span> - level) * <span class="keyword">this</span>._tileSize<span class="comment">// 计算每一个图片表示墨卡托坐标系的大小</span></span><br><span class="line">    <span class="keyword">var</span> minRC = <span class="keyword">this</span>.getBaiduRCLByWgs84LngLat(level, bounds._sw)</span><br><span class="line">    <span class="keyword">var</span> maxRC = <span class="keyword">this</span>.getBaiduRCLByWgs84LngLat(level, bounds._ne)</span><br><span class="line">    <span class="keyword">this</span>.curImages = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> temRow = minRC.R; temRow &lt;= maxRC.R; temRow++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> temCol = minRC.C; temCol &lt;= maxRC.C; temCol++) &#123;</span><br><span class="line">        <span class="keyword">var</span> infoStr = level + <span class="string">"_"</span> + temRow + <span class="string">"_"</span> + temCol</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.allImages[infoStr] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> wgs84Bound = <span class="keyword">this</span>.getWgs84BoundByBaiduRCL(temRow, temCol, level)</span><br><span class="line">          <span class="keyword">var</span> swWebgl = mapboxgl.MercatorCoordinate.fromLngLat(wgs84Bound.sw)</span><br><span class="line">          <span class="keyword">var</span> neWebgl = mapboxgl.MercatorCoordinate.fromLngLat(wgs84Bound.ne)</span><br><span class="line">          <span class="keyword">var</span> seWebgl = mapboxgl.MercatorCoordinate.fromLngLat(wgs84Bound.se)</span><br><span class="line">          <span class="keyword">var</span> nwWebgl = mapboxgl.MercatorCoordinate.fromLngLat(wgs84Bound.nw)</span><br><span class="line">          <span class="keyword">var</span> webglBound = &#123;</span><br><span class="line">            sw: &#123; <span class="attr">lng</span>: swWebgl.x, <span class="attr">lat</span>: swWebgl.y &#125;,</span><br><span class="line">            ne: &#123; <span class="attr">lng</span>: neWebgl.x, <span class="attr">lat</span>: neWebgl.y &#125;,</span><br><span class="line">            se: &#123; <span class="attr">lng</span>: seWebgl.x, <span class="attr">lat</span>: seWebgl.y &#125;,</span><br><span class="line">            nw: &#123; <span class="attr">lng</span>: nwWebgl.x, <span class="attr">lat</span>: nwWebgl.y &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">this</span>.allImages[infoStr] = &#123;</span><br><span class="line">            bounds: webglBound,</span><br><span class="line">            url: <span class="keyword">this</span>.getTileUrl(temRow, temCol, level)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.curImages.push(<span class="keyword">this</span>.allImages[infoStr])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(new Date().getTime() - old);</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建一个这色器程序</span></span><br><span class="line">  creatProgram(gl, vertSourse, fragSourse) &#123;</span><br><span class="line">    <span class="comment">// 创建顶点着色器</span></span><br><span class="line">    <span class="keyword">var</span> vertShader = gl.createShader(gl.VERTEX_SHADER)</span><br><span class="line">    gl.shaderSource(vertShader, vertSourse) <span class="comment">// 为一个顶点着色器设定一个源</span></span><br><span class="line">    gl.compileShader(vertShader) <span class="comment">// 编译一个顶点着色器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个片段着色器</span></span><br><span class="line">    <span class="keyword">var</span> fragShader = gl.createShader(gl.FRAGMENT_SHADER)</span><br><span class="line">    gl.shaderSource(fragShader, fragSourse) <span class="comment">// 为片段着色器设定一个源</span></span><br><span class="line">    gl.compileShader(fragShader) <span class="comment">// 编译片段着色器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个画图的应用</span></span><br><span class="line">    <span class="keyword">var</span> program = gl.createProgram()</span><br><span class="line">    gl.attachShader(program, vertShader) <span class="comment">// 为这个应用添加顶点着色器</span></span><br><span class="line">    gl.attachShader(program, fragShader) <span class="comment">// 为这个应用添加片段着色器</span></span><br><span class="line"></span><br><span class="line">    gl.linkProgram(program) <span class="comment">// 链接一个应用</span></span><br><span class="line">    <span class="keyword">return</span> program</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  render(gl, matrix) &#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">    _this.rendAllImageMap = []</span><br><span class="line">    <span class="keyword">var</span> program = <span class="keyword">this</span>.creatProgram(gl, <span class="keyword">this</span>.vertCode, <span class="keyword">this</span>.fragCode)</span><br><span class="line">    <span class="comment">// 设置纹理的Buffter</span></span><br><span class="line">    gl.useProgram(program)<span class="comment">// 一个render里面最好只有一个program，不然层序会卡死</span></span><br><span class="line">    <span class="keyword">this</span>.renderkey = <span class="built_in">Math</span>.random()</span><br><span class="line">    <span class="keyword">var</span> curenderkey = <span class="keyword">this</span>.renderkey<span class="comment">// 记录是不是同一次渲染，因为不是同一次渲染的话就不需要渲染已经过期的图片</span></span><br><span class="line">    _this.rendImages(gl, matrix, _this.oldRendAllImageMap, program)<span class="comment">// 先渲染一次上回加载的图片</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> imageObj <span class="keyword">of</span> <span class="keyword">this</span>.curImages) &#123;</span><br><span class="line">      <span class="keyword">this</span>.loadImage(imageObj, <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (curenderkey == _this.renderkey) &#123; <span class="comment">// 不是同一</span></span><br><span class="line">          _this.rendAllImageMap.push(obj)</span><br><span class="line">          <span class="keyword">if</span> (_this.rendAllImageMap.length == _this.curImages.length) &#123;</span><br><span class="line">            _this.rendImages(gl, matrix, _this.rendAllImageMap, program)</span><br><span class="line">            _this.oldRendAllImageMap = _this.rendAllImageMap<span class="comment">// 将上一次渲染成功的图片进行保存，保持界面能够平缓过度</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 不是最新的渲染要求就不进行渲染</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  loadImage(imageObj, callback) &#123;</span><br><span class="line">    <span class="keyword">var</span> image = <span class="keyword">new</span> Image()</span><br><span class="line">    image.crossOrigin = <span class="string">"anonymous"</span></span><br><span class="line">    image.src = imageObj.url <span class="comment">// MUST BE SAME DOMAIN!!!</span></span><br><span class="line">    <span class="comment">// 判断图片是否在缓存中</span></span><br><span class="line">    <span class="keyword">if</span> (image.complete) &#123;</span><br><span class="line">      imageObj.img = image</span><br><span class="line">      callback.call(image, imageObj)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 图片加载到浏览器的缓存中回调函数</span></span><br><span class="line">    image.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      imageObj.img = image</span><br><span class="line">      callback.call(image, imageObj)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 渲染多张图片</span></span><br><span class="line">  rendImages(gl, matrix, images, program) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> imageObj <span class="keyword">of</span> images) &#123;</span><br><span class="line">      <span class="keyword">var</span> texcoordLocation = gl.getAttribLocation(program, <span class="string">"a_texCoord"</span>)<span class="comment">// 获取着色器里面的文理坐标的变量的指针</span></span><br><span class="line">      gl.enableVertexAttribArray(texcoordLocation)<span class="comment">// 激活这个指针</span></span><br><span class="line">      gl.bindBuffer(gl.ARRAY_BUFFER, <span class="keyword">this</span>.texcoordBuffer)<span class="comment">// 将缓冲区绑定到该指针上</span></span><br><span class="line">      gl.vertexAttribPointer(texcoordLocation, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>)<span class="comment">// 指定读取缓冲区的方式</span></span><br><span class="line">      gl.texImage2D(gl.TEXTURE_2D, <span class="number">0</span>, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, imageObj.img)<span class="comment">// 上传图像到纹理</span></span><br><span class="line">      <span class="keyword">var</span> uImage = gl.getUniformLocation(program, <span class="string">"u_image"</span>)<span class="comment">// 获取纹理对象的指针</span></span><br><span class="line">      gl.uniform1i(uImage, <span class="number">0</span>)<span class="comment">// 因为上面激活TEXTURE0 表示第一个纹理，所以这个地方使用第一个纹理，但是索引是0</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> positionBuffer = gl.createBuffer()</span><br><span class="line">      gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer)</span><br><span class="line">      <span class="keyword">this</span>.setImageBufferData(gl, imageObj)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> u_matrix = gl.getUniformLocation(program, <span class="string">"u_matrix"</span>)</span><br><span class="line">      gl.uniformMatrix4fv(u_matrix, <span class="literal">false</span>, matrix)<span class="comment">// 设置作色器里面的变换矩阵</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> positionLocation = gl.getAttribLocation(program, <span class="string">"a_position"</span>)</span><br><span class="line">      gl.enableVertexAttribArray(positionLocation)</span><br><span class="line">      gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer)</span><br><span class="line">      gl.vertexAttribPointer(positionLocation, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">      gl.drawArrays(gl.TRIANGLES, <span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setImageBufferData(gl, imageObj) &#123;</span><br><span class="line">    <span class="keyword">var</span> bounds = imageObj.bounds</span><br><span class="line">    <span class="keyword">var</span> arr = [</span><br><span class="line">      bounds.sw.lng, bounds.sw.lat,</span><br><span class="line">      bounds.nw.lng, bounds.nw.lat,</span><br><span class="line">      bounds.se.lng, bounds.se.lat,</span><br><span class="line">      bounds.se.lng, bounds.se.lat,</span><br><span class="line">      bounds.nw.lng, bounds.nw.lat,</span><br><span class="line">      bounds.ne.lng, bounds.ne.lat</span><br><span class="line">    ]</span><br><span class="line">    gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(arr), gl.STATIC_DRAW)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onAdd(map, gl) &#123;</span><br><span class="line">    <span class="keyword">this</span>.map = map</span><br><span class="line">    <span class="keyword">this</span>.createTextureBuffer(gl)</span><br><span class="line">  &#125;</span><br><span class="line">  prerender(gl, matrix) &#123;</span><br><span class="line">    <span class="keyword">this</span>.getBoundImages()</span><br><span class="line">  &#125;</span><br><span class="line">  createTextureBuffer(gl) &#123;</span><br><span class="line">    <span class="comment">// 创建文理的坐标的缓冲区</span></span><br><span class="line">    <span class="keyword">var</span> texcoordBuffer = gl.createBuffer()<span class="comment">// 创建一个缓冲区</span></span><br><span class="line">    gl.bindBuffer(gl.ARRAY_BUFFER, texcoordBuffer)<span class="comment">// 指定该缓冲区为数组缓冲区</span></span><br><span class="line">    <span class="comment">// 这个地方要注意图片颠倒问题</span></span><br><span class="line">    gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">      <span class="number">0.0</span>, <span class="number">1.0</span>,</span><br><span class="line">      <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">      <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">      <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">      <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">      <span class="number">1.0</span>, <span class="number">0.0</span></span><br><span class="line">    ]), gl.STATIC_DRAW)<span class="comment">// 将具体的数组放到缓冲区里面</span></span><br><span class="line">    <span class="keyword">this</span>.texcoordBuffer = texcoordBuffer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> texture = gl.createTexture()</span><br><span class="line">    gl.bindTexture(gl.TEXTURE_2D, texture)</span><br><span class="line">    <span class="comment">// 设置参数，让我们可以绘制任何尺寸的图像</span></span><br><span class="line">    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE) <span class="comment">// TEXTURE_WRAP_S 横向平铺的方式 CLAMP_TO_EDGE表明不重复</span></span><br><span class="line">    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE) <span class="comment">// TEXTURE_WRAP_T 纵向平铺的方式</span></span><br><span class="line">    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST) <span class="comment">// TEXTURE_MIN_FILTER 缩小的颜色选取方法 NEAREST就近取色，不进行颜色插值 速度快</span></span><br><span class="line">    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST) <span class="comment">// TEXTURE_MAG_FILTER 放大的颜色选取方法</span></span><br><span class="line">    gl.activeTexture(gl.TEXTURE0)<span class="comment">// 激活一个纹理</span></span><br><span class="line">    gl.bindTexture(gl.TEXTURE_2D, texture) <span class="comment">// 绑定一个文理到gl.TEXTURE0</span></span><br><span class="line">  &#125;</span><br><span class="line">  onRemove(map) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NullIslandLayer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.id = <span class="string">'null-island'</span></span><br><span class="line">    <span class="keyword">this</span>.type = <span class="string">'custom'</span></span><br><span class="line">    <span class="keyword">this</span>.renderingMode = <span class="string">'2d'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onAdd(map, gl) &#123;</span><br><span class="line">    <span class="keyword">const</span> vertexSource = <span class="string">`</span></span><br><span class="line"><span class="string">        uniform mat4 u_matrix;</span></span><br><span class="line"><span class="string">        void main() &#123;</span></span><br><span class="line"><span class="string">            gl_Position = u_matrix* vec4(0.5, 0.5, 0.0, 1.0);</span></span><br><span class="line"><span class="string">            gl_PointSize = 200.0;</span></span><br><span class="line"><span class="string">        &#125;`</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> fragmentSource = <span class="string">`</span></span><br><span class="line"><span class="string">        void main() &#123;</span></span><br><span class="line"><span class="string">            gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);</span></span><br><span class="line"><span class="string">        &#125;`</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> vertexShader = gl.createShader(gl.VERTEX_SHADER)</span><br><span class="line">    gl.shaderSource(vertexShader, vertexSource)</span><br><span class="line">    gl.compileShader(vertexShader)</span><br><span class="line">    <span class="keyword">const</span> fragmentShader = gl.createShader(gl.FRAGMENT_SHADER)</span><br><span class="line">    gl.shaderSource(fragmentShader, fragmentSource)</span><br><span class="line">    gl.compileShader(fragmentShader)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.program = gl.createProgram()</span><br><span class="line">    gl.attachShader(<span class="keyword">this</span>.program, vertexShader)</span><br><span class="line">    gl.attachShader(<span class="keyword">this</span>.program, fragmentShader)</span><br><span class="line">    gl.linkProgram(<span class="keyword">this</span>.program)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render(gl, matrix) &#123;</span><br><span class="line">    gl.useProgram(<span class="keyword">this</span>.program)</span><br><span class="line">    gl.uniformMatrix4fv(gl.getUniformLocation(<span class="keyword">this</span>.program, <span class="string">"u_matrix"</span>), <span class="literal">false</span>, matrix)</span><br><span class="line">    gl.drawArrays(gl.POINTS, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="七、常用代码示例"><a href="#七、常用代码示例" class="headerlink" title="七、常用代码示例"></a>七、常用代码示例</h2><h3 id="1-CMap-属性、方法和事件"><a href="#1-CMap-属性、方法和事件" class="headerlink" title="1. CMap 属性、方法和事件"></a>1. CMap 属性、方法和事件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Module 引用</span></span><br><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    style: <span class="string">'dark'</span>,</span><br><span class="line">    center: [<span class="number">110.770672</span>, <span class="number">34.159869</span>],</span><br><span class="line">    pitch: <span class="number">45</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// CDN 使用方法</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CciMap.CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> CciMap.GaodeMap(&#123;</span><br><span class="line">    style: <span class="string">'dark'</span>,</span><br><span class="line">    center: [<span class="number">110.770672</span>, <span class="number">34.159869</span>],</span><br><span class="line">    pitch: <span class="number">45</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>可以通过 scene map 属性获取 map 实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = scene.map;</span><br></pre></td></tr></table></figure>
<p>为了统一不同底图之前的接口差异, 在 scene 层对 map 的方法做了统一，因此一些地图的操作方法可以通过 scene 调用这样，切换不同底图时保证表现一致</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CciMap.CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> CciMap.GaodeMap(&#123;</span><br><span class="line">    style: <span class="string">'dark'</span>,</span><br><span class="line">    center: [<span class="number">110.770672</span>, <span class="number">34.159869</span>],</span><br><span class="line">    pitch: <span class="number">45</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="1-1-Map-配置项"><a href="#1-1-Map-配置项" class="headerlink" title="1.1 Map 配置项"></a>1.1 Map 配置项</h4><ul>
<li>zoom 初始化缩放等级</li>
</ul>
<p>地图初始显示级别 {number}  Mapbox （0-24） 高德 （2-19)</p>
<ul>
<li>center 地图中心</li>
</ul>
<p>地图初始中心经纬度 {Lnglat}</p>
<ul>
<li>pitch 地图倾角</li>
</ul>
<p>地图初始俯仰角度 {number}  default 0</p>
<ul>
<li>style 地图图样式</li>
</ul>
<p>简化地图样式设置，内置了三种主题默认样式, 高德，mapbox, maptalks 都可以使用 (dark, light, normal, blank 无底图)</p>
<p>除了内置的样式，也可传入自定义的其他属性</p>
<p>比如高德地图 ⚠️ 高德地图样式 增加 <code>isPublic=true</code> 参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  style: <span class="string">'amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true'</span>; <span class="comment">// 设置方法和高德地图一致</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>minZoom 最小缩放等级</li>
</ul>
<p>地图最小缩放等级 {number}  default 0 Mapbox 0-24） 高德 （2-19）</p>
<ul>
<li>maxZoom 最大缩放等级</li>
</ul>
<p>地图最大缩放等级 {number}  default 22 Mapbox（0-24） 高德 （2-19）</p>
<ul>
<li>rotateEnable 是否允许旋转</li>
</ul>
<p>地图是否可旋转 {Boolean} default true</p>
<h4 id="1-2-Layer-方法"><a href="#1-2-Layer-方法" class="headerlink" title="1.2 Layer 方法"></a>1.2 Layer 方法</h4><p><strong>addLayer(layer) 增加图层对象</strong></p>
<p>参数 :</p>
<ul>
<li><code>layer</code> {ILayer} 图层对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.addLayer(layer);</span><br></pre></td></tr></table></figure>
<p><strong>getLayer(id) 获取对应的图层对象</strong></p>
<p>参数 :</p>
<ul>
<li><code>id</code> {string}</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.getLayer(<span class="string">'layerID'</span>);</span><br></pre></td></tr></table></figure>
<p><strong>getLayers() 获取所有的地图图层</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.getLayers();</span><br></pre></td></tr></table></figure>
<p><strong>getLayerByName(name) 根据图层名称获取图层</strong></p>
<p>参数</p>
<ul>
<li><code>name</code> {string} layer 初始化可配置图层 name</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.getLayerByName(name); <span class="comment">// return Layer 图层对象</span></span><br></pre></td></tr></table></figure>
<p><strong>removeLayer 移除 layer 图层</strong></p>
<p>参数 :</p>
<ul>
<li><code>layer</code> {Layer}</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.removeLayer(layer);</span><br></pre></td></tr></table></figure>
<p><strong>removeAllLayer() 移除所有的图层对象</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.removeAllLayer();</span><br></pre></td></tr></table></figure>
<h4 id="1-3-控制组件方法"><a href="#1-3-控制组件方法" class="headerlink" title="1.3 控制组件方法"></a>1.3 控制组件方法</h4><p><strong>addControl(ctl) 添加组件控件</strong></p>
<p>参数 :</p>
<ul>
<li><code>crl</code> { IControl } 用户创建的控件对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.addControl(ctl);</span><br></pre></td></tr></table></figure>
<p><strong>removeControl(ctr) 移除用户添加的组件控件</strong></p>
<p>参数 :</p>
<ul>
<li><code>ctl</code> { IControl } 用户创建的控件对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.removeControl(ctl);</span><br></pre></td></tr></table></figure>
<p><strong>getControlByName(name) 根据控件的名称来获取控件</strong></p>
<ul>
<li><code>name</code> { string }</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zoomControl = <span class="keyword">new</span> Zoom(&#123;</span><br><span class="line">  <span class="comment">// zoom 控件</span></span><br><span class="line">  name: <span class="string">'z1'</span>, <span class="comment">// 用户传入的控件名称（也可以不传入，该控件默认名称为 zoom）</span></span><br><span class="line">  position: <span class="string">'topright'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">scene.getControlByName(<span class="string">'z1'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="1-4-标记方法"><a href="#1-4-标记方法" class="headerlink" title="1.4 标记方法"></a>1.4 标记方法</h4><p><strong>addMarker(maker) 往场景中添加标记对象</strong></p>
<p>参数 :</p>
<ul>
<li><code>maker</code> { IMarker } Marker 实例</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> marker = <span class="keyword">new</span> Marker(&#123;</span><br><span class="line">  element: el,</span><br><span class="line">&#125;).setLnglat(&#123; <span class="attr">lng</span>: nodes[i].x * <span class="number">1</span>, <span class="attr">lat</span>: nodes[i].y &#125;);</span><br><span class="line">scene.addMarker(marker);</span><br></pre></td></tr></table></figure>
<p><strong>addMarkerLayer(layer) 添加 Marker 统一管理图层</strong></p>
<p>当用户需要添加许多个 Marker 实例时，为了方便管理可以使用 markerLayer 对象统一管理</p>
<p>参数 :</p>
<ul>
<li><code>layer</code> { IMarkerLayer } 标记图层对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> markerLayer = <span class="keyword">new</span> MarkerLayer();</span><br><span class="line">scene.addMarkerLayer(markerLayer);</span><br></pre></td></tr></table></figure>
<p><strong>removeMarkerLayer(layer) 移除标签图层</strong></p>
<p>参数 :</p>
<ul>
<li><code>layer</code> { IMarkerLayer } 标记图层对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.removeMarkerLayer(markerLayer);</span><br></pre></td></tr></table></figure>
<p><strong>removeAllMakers() 移除场景中所有的标签对象</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.removeAllMakers();</span><br></pre></td></tr></table></figure>
<h4 id="1-4-地图方法"><a href="#1-4-地图方法" class="headerlink" title="1.4 地图方法"></a>1.4 地图方法</h4><p><strong>getZoom 获取当前缩放等级</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.getZoom(); <span class="comment">// return &#123;float&#125;  当前缩放等级</span></span><br></pre></td></tr></table></figure>
<p><strong>getCenter() 获取地图中心</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.getCenter(); <span class="comment">// return &#123;Lnglat&#125; :地图中心点</span></span><br></pre></td></tr></table></figure>
<p><strong>getSize() 获取地图容器大小</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.getSize(); <span class="comment">// return &#123; Object &#125; 地图容器的 width,height</span></span><br></pre></td></tr></table></figure>
<p><strong>getPitch() 获取地图倾角</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.getPitch(); <span class="comment">// return &#123;number&#125; pitch</span></span><br></pre></td></tr></table></figure>
<p><strong>getContainer 获取地图容器</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.getContainer(); <span class="comment">// return htmlElement</span></span><br></pre></td></tr></table></figure>
<p><strong>setMapStyle 设置地图样式</strong></p>
<p>参数：<code>style</code> {string} 地图样式 具体样式格式和各底图设置方法一致</p>
<p>内置了三种地图样式，AMAP 和 MapBox, MapTalks 都适用</p>
<ul>
<li>light</li>
<li>dark</li>
<li>normal</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 快捷名称设置</span></span><br><span class="line">scene.setMapStyle(<span class="string">'light'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapbox 主题设置</span></span><br><span class="line">scene.setMapStyle(<span class="string">'mapbox://styles/mapbox/streets-v11'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// AMap</span></span><br><span class="line">scene.setMapStyle(</span><br><span class="line">  <span class="string">'amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true'</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>setCenter() 设置地图中心点</strong></p>
<p>参数：<code>center</code> {LngLat} 地图中心点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.setCenter([lng, lat]);</span><br></pre></td></tr></table></figure>
<p><strong>setZoomAndCenter 设置地图缩放等级和中心点</strong></p>
<p>参数：</p>
<ul>
<li>zoom {number}</li>
<li>center {LngLat}</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.setZoomAndCenter(zoom, center);</span><br></pre></td></tr></table></figure>
<p><strong>setRotation 设置地图旋转</strong></p>
<p>设置地图顺时针旋转角度，旋转原点为地图容器中心点，取值范围 [0-360]</p>
<p>参数： <code>rotation</code> {number}</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.setRotation(rotation);</span><br></pre></td></tr></table></figure>
<p><strong>zoomIn 地图放大一级</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.zoomIn();</span><br></pre></td></tr></table></figure>
<p><strong>zoomOut 地图缩小一级</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.ZoomOUt();</span><br></pre></td></tr></table></figure>
<p><strong>panTo 地图平移到指定的位置</strong></p>
<p>参数：</p>
<ul>
<li><code>center</code> LngLat 中心位置坐标</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.panTo(LngLat);</span><br></pre></td></tr></table></figure>
<p><strong>panBy 地图平移</strong></p>
<p>以像素为单位沿 X 方向和 Y 方向移动地图</p>
<p>参数：</p>
<ul>
<li><code>x</code> {number} 水平方向移动像素 向右为正方向</li>
<li><code>y</code> {number} 垂直方向移动像素 向下为正方向</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.panBy(x, y);</span><br></pre></td></tr></table></figure>
<p><strong>setPitch 设置地图仰俯角度</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.setPitch(pitch);</span><br></pre></td></tr></table></figure>
<p><strong>setMapStatus 设置地图状态</strong></p>
<p>可用来关闭地图的一些交互操作</p>
<p>参数 :</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> IStatusOptions &#123;</span><br><span class="line">  showIndoorMap: boolean;</span><br><span class="line">  resizeEnable: boolean;</span><br><span class="line">  dragEnable: boolean;</span><br><span class="line">  keyboardEnable: boolean;</span><br><span class="line">  doubleClickZoom: boolean;</span><br><span class="line">  zoomEnable: boolean;</span><br><span class="line">  rotateEnable: boolean;</span><br><span class="line">scene.setMapStatus(&#123; <span class="attr">dragEnable</span>: <span class="literal">false</span> &#125;);</span><br></pre></td></tr></table></figure>
<p><strong>fitBounds 设置地图缩放范围</strong></p>
<p>地图缩放到某个范围内</p>
<p>参数 :</p>
<ul>
<li><code>extent</code> { array} 经纬度范围 [[minlng,minlat],[maxlng,maxlat]]</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scene.fitBounds([</span><br><span class="line">  [<span class="number">112</span>, <span class="number">32</span>],</span><br><span class="line">  [<span class="number">114</span>, <span class="number">35</span>],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p><strong>containerToLngLat 画布坐标转经纬度</strong></p>
<p>画布坐标转经纬度坐标</p>
<p>参数 :</p>
<ul>
<li>pixel 画布的坐标 [x ,y ] {array }</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.pixelToLngLat([10,10]);</span><br></pre></td></tr></table></figure>
<p><strong>lngLatToContainer 经纬度转画布坐标</strong></p>
<p>参数 :</p>
<ul>
<li>lnglat 经纬度坐标 [lng,lat ] {array }</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.lngLatToPixel([120,10]);</span><br></pre></td></tr></table></figure>
<p><strong>pixelToLngLat 像素坐标转经纬度</strong></p>
<p>像素坐标：不同级别下地图上某点的位置</p>
<p>参数 :</p>
<ul>
<li>pixel 画布的坐标 [x ,y ] {array }</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.pixelToLngLat([10,10]);</span><br></pre></td></tr></table></figure>
<p><strong>lngLatToPixel 经纬度转像素坐标</strong></p>
<p>经纬度坐标转像素坐标</p>
<p>参数 :</p>
<ul>
<li>lnglat 经纬度坐标 [lng,lat ] {array }</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.lngLatToPixel([120,10]);</span><br></pre></td></tr></table></figure>
<p><strong>exportMap 导出地图图片</strong></p>
<p>导出地图，目前仅支持导出可视化层，不支持底图导出</p>
<ul>
<li>参数 type <code>png|jpg</code> 默认 png</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.exportMap(<span class="string">'png'</span>);</span><br></pre></td></tr></table></figure>
<p><strong>destroy 场景销毁</strong></p>
<p>scene 销毁方法，离开页面，或者不需要使用地图可以调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.destroy();</span><br></pre></td></tr></table></figure>
<h4 id="1-5-iconfont-映射支持"><a href="#1-5-iconfont-映射支持" class="headerlink" title="1.5 iconfont 映射支持"></a>1.5 iconfont 映射支持</h4><p><strong>addIconFont(name, fontUnicode) 增加对数据中 unicode 的映射支持</strong></p>
<p>支持对用户传入的数据进行 unicode 的映射，在内部维护一组名称和对应 key 的键值对</p>
<p>参数 :</p>
<ul>
<li><code>name</code> {string}</li>
<li><code>fontUnicode</code> {string}</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">scene.addIconFont(<span class="string">'icon1'</span>, <span class="string">'&amp;#xe64b;'</span>);</span><br><span class="line">scene.addIconFont(<span class="string">'icon2'</span>, <span class="string">'&amp;#xe64c;'</span>);</span><br><span class="line">scene.addFontFace(fontFamily, fontPath);</span><br><span class="line"><span class="keyword">const</span> pointIconFontLayer = <span class="keyword">new</span> PointLayer(&#123;&#125;)</span><br><span class="line">  .source(</span><br><span class="line">    [</span><br><span class="line">      &#123;</span><br><span class="line">        j: <span class="number">140</span>,</span><br><span class="line">        w: <span class="number">34</span>,</span><br><span class="line">        m: <span class="string">'icon1'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        j: <span class="number">140</span>,</span><br><span class="line">        w: <span class="number">36</span>,</span><br><span class="line">        m: <span class="string">'icon2'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    &#123;</span><br><span class="line">      parser: &#123;</span><br><span class="line">        type: <span class="string">'json'</span>,</span><br><span class="line">        x: <span class="string">'j'</span>,</span><br><span class="line">        y: <span class="string">'w'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  )</span><br><span class="line">  .shape(<span class="string">'m'</span>, <span class="string">'text'</span>)</span><br><span class="line">  .size(<span class="number">12</span>)</span><br><span class="line">  .color(<span class="string">'w'</span>, [<span class="string">'#f00'</span>, <span class="string">'#f00'</span>, <span class="string">'#0f0'</span>])</span><br><span class="line">  .style(&#123;</span><br><span class="line">    fontFamily,</span><br><span class="line">    iconfont: <span class="literal">true</span>,</span><br><span class="line">    textAllowOverlap: <span class="literal">true</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">scene.addLayer(pointIconFontLayer);</span><br></pre></td></tr></table></figure>
<p><strong>addIconFonts(options) 同时传入多组 name - unicode 的键值对</strong></p>
<p>参数 :</p>
<ul>
<li><code>options</code> { Array&lt;[name, unicode]&gt; }</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scene.addIconFonts([</span><br><span class="line">  [<span class="string">'icon1'</span>, <span class="string">'&amp;#xe64b;'</span>],</span><br><span class="line">  [<span class="string">'icon2'</span>, <span class="string">'&amp;#xe64c;'</span>],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<h4 id="1-6-全局资源"><a href="#1-6-全局资源" class="headerlink" title="1.6 全局资源"></a>1.6 全局资源</h4><p><strong>addImage(id, img) 全局中添加的图片资源</strong></p>
<p>参数 :</p>
<ul>
<li><code>id</code> {string}</li>
<li><code>img</code> {HTMLImageElement | File | string}</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scene.addImage(</span><br><span class="line">  <span class="string">'02'</span>,</span><br><span class="line">  <span class="string">'https://gw.alipayobjects.com/zos/bmw-prod/ce83fc30-701f-415b-9750-4b146f4b3dd6.svg'</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>hasImage(id) 判断是否已经在全局添加过相应的图片资源</strong></p>
<p>参数 :</p>
<ul>
<li><code>id</code> {string}</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.hasImage(<span class="string">'imageID'</span>);</span><br></pre></td></tr></table></figure>
<p><strong>removeImage(id) 全局删除图片资源</strong></p>
<p>参数 :</p>
<ul>
<li><code>id</code> {string}</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.removeImage(<span class="string">'imageID'</span>);</span><br></pre></td></tr></table></figure>
<p><strong>addFontFace(fontFamily, fontPath) 添加字体文件</strong></p>
<p>参数 :</p>
<ul>
<li><code>fontFamily</code> {string} 用户为自己定义的字体名称</li>
<li><code>fontPath</code> {string} 导入的文件地址</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fontFamily = <span class="string">'iconfont'</span>;</span><br><span class="line"><span class="keyword">let</span> fontPath =</span><br><span class="line">  <span class="string">'//at.alicdn.com/t/font_2534097_iiet9d3nekn.woff2?t=1620444089776'</span>;</span><br><span class="line">scene.addFontFace(fontFamily, fontPath);</span><br></pre></td></tr></table></figure>
<h4 id="1-7-事件"><a href="#1-7-事件" class="headerlink" title="1.7 事件"></a>1.7 事件</h4><p>cci-map 针对不同地图的事件对象进行兼容，访问事件对象的经纬度 调用 <code>getFormatEventObj</code> 方法会返回含有 lng，lat 的经纬度对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getFormatEventObj &#125;  <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">scene.on(<span class="string">'click'</span>, e =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; lng, lat &#125; = getFormatEventObj(e) <span class="comment">// e.lnglat</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>on 事件监听</li>
</ul>
<p><code>eventName</code> {string} 事件名 <code>handler</code> {function } 事件回调函数</p>
<ul>
<li>off</li>
</ul>
<p>移除事件监听 <code>eventName</code> {string} 事件名 <code>handler</code> {function } 事件回调函数</p>
<ul>
<li>loaded</li>
</ul>
<p>scene 初始化完成事件，scene 初始化完成添加 Layer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>resize 地图容器变化事件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.on(<span class="string">'resize'</span>, () =&gt; &#123;&#125;); <span class="comment">// 地图容器大小改变事件</span></span><br></pre></td></tr></table></figure>
<ul>
<li>地图事件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;&#125;); <span class="comment">//地图加载完成触发</span></span><br><span class="line">scene.on(<span class="string">'mapmove'</span>, () =&gt; &#123;&#125;); <span class="comment">// 地图平移时触发事件</span></span><br><span class="line">scene.on(<span class="string">'movestart'</span>, () =&gt; &#123;&#125;); <span class="comment">// 地图平移开始时触发</span></span><br><span class="line">scene.on(<span class="string">'moveend'</span>, () =&gt; &#123;&#125;); <span class="comment">// 地图移动结束后触发，包括平移，以及中心点变化的缩放。如地图有拖拽缓动效果，则在缓动结束后触发</span></span><br><span class="line">scene.on(<span class="string">'zoomchange'</span>, () =&gt; &#123;&#125;); <span class="comment">// 地图缩放级别更改后触发</span></span><br><span class="line">scene.on(<span class="string">'zoomstart'</span>, () =&gt; &#123;&#125;); <span class="comment">// 缩放开始时触发</span></span><br><span class="line">scene.on(<span class="string">'zoomend'</span>, () =&gt; &#123;&#125;); <span class="comment">// 缩放停止时触发</span></span><br></pre></td></tr></table></figure>
<p>其他地图事件可以查看相应底图的事件文档,地图事件也可以通过 CMap.map 进行设置 <a href="https://docs.mapbox.com/mapbox-gl-js/api/#map.event" target="_blank" rel="noopener">Mapbox</a> <a href="https://lbs.amap.com/api/javascript-api/reference/map" target="_blank" rel="noopener">高德</a></p>
<ul>
<li>鼠标事件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scene.on(<span class="string">'click'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标左键点击事件</span></span><br><span class="line">scene.on(<span class="string">'dblclick'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标左键双击事件</span></span><br><span class="line">scene.on(<span class="string">'mousemove'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标在地图上移动时触发</span></span><br><span class="line">scene.on(<span class="string">'mousewheel'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标滚轮开始缩放地图时触发</span></span><br><span class="line">scene.on(<span class="string">'mouseover'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标移入地图容器内时触发</span></span><br><span class="line">scene.on(<span class="string">'mouseout'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标移出地图容器时触发</span></span><br><span class="line">scene.on(<span class="string">'mouseup'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标在地图上单击抬起时触发</span></span><br><span class="line">scene.on(<span class="string">'mousedown'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标在地图上单击按下时触发</span></span><br><span class="line">scene.on(<span class="string">'contextmenu'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标右键单击事件</span></span><br><span class="line">scene.on(<span class="string">'dragstart'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">//开始拖拽地图时触发</span></span><br><span class="line">scene.on(<span class="string">'dragging'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 拖拽地图过程中触发</span></span><br><span class="line">scene.on(<span class="string">'dragend'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">//停止拖拽地图时触发。如地图有拖拽缓动效果，则在拽停止，缓动开始前触发</span></span><br></pre></td></tr></table></figure>
<h3 id="2-地球模式"><a href="#2-地球模式" class="headerlink" title="2 地球模式"></a>2 地球模式</h3><p>Earth 相较于高德地图、mapbox 地图，是完全不同的一种表现形式，提供了全球视角下的可视化展示能力，为用户提供了更多的地理信息可视化表现形式。</p>
<p>✨ 为了区别普通的地图，提供了全新的 Earth 地图类型以及对应的 EarthLayer 图层</p>
<h4 id="2-1-支持的图层类型"><a href="#2-1-支持的图层类型" class="headerlink" title="2.1 支持的图层类型"></a>2.1 支持的图层类型</h4><p>点图层</p>
<ul>
<li>平面点</li>
<li>圆柱点</li>
</ul>
<p>线图层</p>
<ul>
<li>3D 弧线</li>
</ul>
<h4 id="2-2-使用"><a href="#2-2-使用" class="headerlink" title="2.2 使用"></a>2.2 使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、引入对应模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; Earth, EarthLayer, CMap &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 2、构建 Earth Map</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">      id: <span class="string">'map'</span>,</span><br><span class="line">      map: <span class="keyword">new</span> Earth(&#123;&#125;),</span><br><span class="line">    &#125;);</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 3、构建地球图层，当前的 shape 为 base，表示基础球体</span></span><br><span class="line"><span class="keyword">const</span> earthlayer = <span class="keyword">new</span> EarthLayer()</span><br><span class="line">  .source(</span><br><span class="line">    <span class="comment">// 地球表面的纹理</span></span><br><span class="line">    <span class="string">'https://gw.alipayobjects.com/mdn/rms_23a451/afts/img/A*3-3NSpqRqUoAAAAAAAAAAAAAARQnAQ'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      parser: &#123;</span><br><span class="line">        type: <span class="string">'image'</span>,</span><br><span class="line">        extent: [<span class="number">121.168</span>, <span class="number">30.2828</span>, <span class="number">121.384</span>, <span class="number">30.421</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  )</span><br><span class="line">  .color(<span class="string">'#f00'</span>)</span><br><span class="line">  .shape(<span class="string">'base'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">1.0</span>,</span><br><span class="line">    radius: <span class="number">40</span>,</span><br><span class="line">    globelOtions: &#123;</span><br><span class="line">      ambientRatio: <span class="number">0.6</span>, <span class="comment">// 环境光</span></span><br><span class="line">      diffuseRatio: <span class="number">0.4</span>, <span class="comment">// 漫反射</span></span><br><span class="line">      specularRatio: <span class="number">0.1</span>, <span class="comment">// 高光反射</span></span><br><span class="line">      earthTime: <span class="number">0.1</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .animate(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、添加基础地球球体</span></span><br><span class="line">scene.addLayer(earthlayer);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 经过上述的步骤，我们就可以在场景中添加一个基础的地球了</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-独立的地图类型-Earth"><a href="#2-3-独立的地图类型-Earth" class="headerlink" title="2.3 独立的地图类型 Earth"></a>2.3 独立的地图类型 Earth</h4><h5 id="2-3-1-构造函数-Earth-args"><a href="#2-3-1-构造函数-Earth-args" class="headerlink" title="2.3.1 构造函数 Earth(args)"></a>2.3.1 构造函数 Earth(args)</h5><p>作为 Earth 的基础地图类型，Earth 提供了地球系统的相机系统，目前只需要传入一个空对象。</p>
<ul>
<li>args: {}</li>
</ul>
<h5 id="2-3-2-rotateY-option-force-boolean-regScale-number"><a href="#2-3-2-rotateY-option-force-boolean-regScale-number" class="headerlink" title="2.3.2 rotateY(option: { force: boolean; regScale: number})"></a>2.3.2 rotateY(option: { force: boolean; regScale: number})</h5><p>提供了简单的方法控制地球系统的旋转（实际上控制的是相机的旋转）</p>
<ul>
<li>force: false 判断是否强制生效，默认该方法的优先级比用户鼠标操作要低，当用户操作相机的时候，该方法会失效</li>
<li>regScale: 0.01 旋转的角度（视觉上地球的旋转角度）， regScale 表示的并不是实际的旋转角度，而是单位旋转角度的比例<br>🌟 单位旋转角度 = Math.min(this.earthCameraZoom * this.earthCameraZoom, 1)</li>
</ul>
<h4 id="2-4-地图图层-EarthLayer"><a href="#2-4-地图图层-EarthLayer" class="headerlink" title="2.4 地图图层 EarthLayer"></a>2.4 地图图层 EarthLayer</h4><p>地球图层区别于普通高德地图和 Mapbox 地图的图层，只在地球模式下可以被使用，用于表示地球的球体、大气层、辉光等效果。<br>🌟 使用不同的 shape 参数表示区别不同的地球图层</p>
<h5 id="2-4-1-地球球体图层-baseLayer"><a href="#2-4-1-地球球体图层-baseLayer" class="headerlink" title="2.4.1 地球球体图层 baseLayer"></a>2.4.1 地球球体图层 baseLayer</h5><ul>
<li>source(map, parser) map: 地球表面纹理贴图的地址 parser: 解析器，目前只需要写固定的对象值即可 { parser: { type: “image” } }</li>
<li>shape: ‘base’<br>🌟 目前支持的 shape 类型有 base、atomSphere、bloomSphere，当用户的 shape 参数不被识别时，自动降级为 base 类型</li>
<li>globelOtions: style 方法中的参数 ambientRatio: 环境光、diffuseRatio: 漫反射、specularRatio: 高光反射</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> earthlayer = <span class="keyword">new</span> EarthLayer()</span><br><span class="line">  .source(</span><br><span class="line">    <span class="string">'https://gw.alipayobjects.com/mdn/rms_23a451/afts/img/A*3-3NSpqRqUoAAAAAAAAAAAAAARQnAQ'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      parser: &#123;</span><br><span class="line">        type: <span class="string">'image'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  )</span><br><span class="line">  .shape(<span class="string">'base'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    globelOtions: &#123;</span><br><span class="line">      ambientRatio: <span class="number">0.6</span>, <span class="comment">// 环境光</span></span><br><span class="line">      diffuseRatio: <span class="number">0.4</span>, <span class="comment">// 漫反射</span></span><br><span class="line">      specularRatio: <span class="number">0.1</span>, <span class="comment">// 高光反射</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h5 id="2-4-2-地球内发光-大气图层-atomLayer"><a href="#2-4-2-地球内发光-大气图层-atomLayer" class="headerlink" title="2.4.2 地球内发光/大气图层 atomLayer"></a>2.4.2 地球内发光/大气图层 atomLayer</h5><p>atomLayer 作为地球的效果图层，不需要传入数据，所以可以不调用 source 方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> atomLayer = <span class="keyword">new</span> EarthLayer()</span><br><span class="line">  .color(<span class="string">'#2E8AE6'</span>)</span><br><span class="line">  .shape(<span class="string">'atomSphere'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    <span class="comment">// 可以控制发光程度</span></span><br><span class="line">    opacity: <span class="number">1</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h5 id="2-4-3-地球内外发光-辉光图层-bloomLayer"><a href="#2-4-3-地球内外发光-辉光图层-bloomLayer" class="headerlink" title="2.4.3 地球内外发光/辉光图层 bloomLayer"></a>2.4.3 地球内外发光/辉光图层 bloomLayer</h5><p>bloomLayer 作为地球的效果图层，不需要传入数据，所以可以不调用 source 方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bloomLayer = <span class="keyword">new</span> EarthLayer()</span><br><span class="line">  .color(<span class="string">'#fff'</span>)</span><br><span class="line">  .shape(<span class="string">'bloomSphere'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">0.5</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2-5-示例代码"><a href="#2-5-示例代码" class="headerlink" title="2.5 示例代码"></a>2.5 示例代码</h4><p>地球模式下使用飞线图层无需做额外的操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, EarthLayer, LineLayer, Earth &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; CMap, EarthLayer, Earth &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; LineLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> Earth(&#123;&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 地球模式下背景色默认为 #000 通过 setBgColor 方法我们可以设置可视化层的背景色</span></span><br><span class="line">scene.setBgColor(<span class="string">'#333'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flydata = [&#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">100.992541</span>, <span class="number">15.870032</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">114.727669</span>, <span class="number">4.535277</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">9.501785</span>, <span class="number">56.26392</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">-66.590149</span>, <span class="number">18.220833</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">174.885971</span>, <span class="number">-40.900557</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">104.990963</span>, <span class="number">12.565679</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">6.129582999999999</span>, <span class="number">49.815273</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">8.468945999999999</span>, <span class="number">60.47202399999999</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">108.277199</span>, <span class="number">14.058324</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">-95.712891</span>, <span class="number">37.09024</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">121.49917</span>, <span class="number">25.12653</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">-9.429499000000002</span>, <span class="number">6.428055</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">127.766922</span>, <span class="number">35.907757</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">10.451526</span>, <span class="number">51.165691</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">23.881275</span>, <span class="number">55.169438</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">34.851612</span>, <span class="number">31.046051</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">53.847818</span>, <span class="number">23.424076</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">102.495496</span>, <span class="number">19.85627</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">21.824312</span>, <span class="number">39.074208</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">25.48583</span>, <span class="number">42.733883</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">15.472962</span>, <span class="number">49.81749199999999</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">78.96288</span>, <span class="number">20.593684</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">-3.435973</span>, <span class="number">55.378051</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">33.429859</span>, <span class="number">35.126413</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">8.227511999999999</span>, <span class="number">46.818188</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">114.066662</span>, <span class="number">22.588638</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">14.550072</span>, <span class="number">47.516231</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">2.213749</span>, <span class="number">46.227638</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">12.56738</span>, <span class="number">41.87194</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">105.318756</span>, <span class="number">61.52401</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">80.77179699999999</span>, <span class="number">7.873053999999999</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">5.291265999999999</span>, <span class="number">52.132633</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">35.243322</span>, <span class="number">38.963745</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">18.643501</span>, <span class="number">60.12816100000001</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">25.748151</span>, <span class="number">61.92410999999999</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">-3.74922</span>, <span class="number">40.46366700000001</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">113.551538</span>, <span class="number">22.109432</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">4.469936</span>, <span class="number">50.503887</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">-106.346771</span>, <span class="number">56.130366</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">138.252924</span>, <span class="number">36.204824</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">17.679076</span>, <span class="number">43.915886</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">-88.49765</span>, <span class="number">17.189877</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">25.013607</span>, <span class="number">58.595272</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">101.975766</span>, <span class="number">4.210484</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">-8.24389</span>, <span class="number">53.41291</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">-8.224454</span>, <span class="number">39.39987199999999</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">133.775136</span>, <span class="number">-25.274398</span> ]] &#125;, &#123; <span class="attr">coord</span>: [[ <span class="number">104.195397</span>, <span class="number">35.86166</span> ], [ <span class="number">121.774017</span>, <span class="number">12.879721</span> ]] &#125;];</span><br><span class="line"><span class="keyword">const</span> flyLine = <span class="keyword">new</span> LineLayer(&#123; <span class="attr">blend</span>: <span class="string">'normal'</span> &#125;)</span><br><span class="line">  .source(flydata, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'json'</span>,</span><br><span class="line">      coordinates: <span class="string">'coord'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .color(<span class="string">'#b97feb'</span>)</span><br><span class="line">  .shape(<span class="string">'arc3d'</span>)</span><br><span class="line">  .size(<span class="number">0.5</span>)</span><br><span class="line">  .active(<span class="literal">true</span>)</span><br><span class="line">  .animate(&#123;</span><br><span class="line">    interval: <span class="number">2</span>,</span><br><span class="line">    trailLength: <span class="number">2</span>,</span><br><span class="line">    duration: <span class="number">1</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">1</span>,</span><br><span class="line">    segmentNumber: <span class="number">60</span>,</span><br><span class="line">    globalArcHeight: <span class="number">20</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> earthlayer = <span class="keyword">new</span> EarthLayer()</span><br><span class="line">  .source(</span><br><span class="line">    <span class="string">'https://gw.alipayobjects.com/mdn/rms_23a451/afts/img/A*3-3NSpqRqUoAAAAAAAAAAAAAARQnAQ'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      parser: &#123;</span><br><span class="line">        type: <span class="string">'image'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .color(<span class="string">'#2E8AE6'</span>)</span><br><span class="line">  .shape(<span class="string">'fill'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    globelOtions: &#123;</span><br><span class="line">      ambientRatio: <span class="number">0.6</span>, <span class="comment">// 环境光</span></span><br><span class="line">      diffuseRatio: <span class="number">0.4</span>, <span class="comment">// 漫反射</span></span><br><span class="line">      specularRatio: <span class="number">0.1</span> <span class="comment">// 高光反射</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .animate(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> atomLayer = <span class="keyword">new</span> EarthLayer()</span><br><span class="line">  .color(<span class="string">'#2E8AE6'</span>)</span><br><span class="line">  .shape(<span class="string">'atomSphere'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">1</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bloomLayer = <span class="keyword">new</span> EarthLayer().color(<span class="string">'#fff'</span>).shape(<span class="string">'bloomSphere'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">0.7</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  scene.addLayer(earthlayer);</span><br><span class="line"></span><br><span class="line">  scene.addLayer(atomLayer);</span><br><span class="line">  scene.addLayer(bloomLayer);</span><br><span class="line"></span><br><span class="line">  scene.addLayer(flyLine);</span><br><span class="line"></span><br><span class="line">  earthlayer.setEarthTime(<span class="number">4.0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在地球模式下使用点图层无需做额外的操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, PointLayer, EarthLayer, Earth &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, EarthLayer, Earth &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; PointLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> Earth(&#123;&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> d = [</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.61865234375</span>, <span class="attr">lat</span>: <span class="number">25.29437116258816</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.058349609375</span>, <span class="attr">lat</span>: <span class="number">25.015928763367857</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.7177734375</span>, <span class="attr">lat</span>: <span class="number">24.587090339209634</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.28930664062499</span>, <span class="attr">lat</span>: <span class="number">23.936054914599815</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.12451171875</span>, <span class="attr">lat</span>: <span class="number">23.553916518321625</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.08056640625</span>, <span class="attr">lat</span>: <span class="number">23.120153621695614</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.234375</span>, <span class="attr">lat</span>: <span class="number">22.867317960075614</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.43212890625</span>, <span class="attr">lat</span>: <span class="number">22.52270570348246</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.65185546875</span>, <span class="attr">lat</span>: <span class="number">22.370396344320053</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.750732421875</span>, <span class="attr">lat</span>: <span class="number">21.922663209325922</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.948486328125</span>, <span class="attr">lat</span>: <span class="number">22.268764039073968</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.124267578125</span>, <span class="attr">lat</span>: <span class="number">22.806567100271522</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.56372070312499</span>, <span class="attr">lat</span>: <span class="number">23.915970370510227</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.88232421875</span>, <span class="attr">lat</span>: <span class="number">24.557116164309626</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.95922851562501</span>, <span class="attr">lat</span>: <span class="number">25.075648445630527</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">109.97314453125</span>, <span class="attr">lat</span>: <span class="number">20.076570104545173</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">108.896484375</span>, <span class="attr">lat</span>: <span class="number">19.663280219987662</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">108.61083984375</span>, <span class="attr">lat</span>: <span class="number">18.979025953255267</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">108.80859375</span>, <span class="attr">lat</span>: <span class="number">18.47960905583197</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">109.599609375</span>, <span class="attr">lat</span>: <span class="number">18.35452552912664</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">110.32470703125</span>, <span class="attr">lat</span>: <span class="number">18.771115062337024</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">111.005859375</span>, <span class="attr">lat</span>: <span class="number">19.78738018198621</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">127.657407</span>, <span class="attr">lat</span>: <span class="number">49.76027</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">129.397818</span>, <span class="attr">lat</span>: <span class="number">49.4406</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">130.582293</span>, <span class="attr">lat</span>: <span class="number">48.729687</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">130.987282</span>, <span class="attr">lat</span>: <span class="number">47.790132</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">132.506672</span>, <span class="attr">lat</span>: <span class="number">47.78897</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">133.373596</span>, <span class="attr">lat</span>: <span class="number">48.183442</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">135.026311</span>, <span class="attr">lat</span>: <span class="number">48.47823</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">134.500814</span>, <span class="attr">lat</span>: <span class="number">47.57844</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">134.112362</span>, <span class="attr">lat</span>: <span class="number">47.212467</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">133.769644</span>, <span class="attr">lat</span>: <span class="number">46.116927</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">133.097127</span>, <span class="attr">lat</span>: <span class="number">45.144066</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">131.883454</span>, <span class="attr">lat</span>: <span class="number">45.321162</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">131.025212</span>, <span class="attr">lat</span>: <span class="number">44.967953</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">131.288555</span>, <span class="attr">lat</span>: <span class="number">44.11152</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">131.144688</span>, <span class="attr">lat</span>: <span class="number">42.92999</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">130.633866</span>, <span class="attr">lat</span>: <span class="number">42.903015</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">130.640016</span>, <span class="attr">lat</span>: <span class="number">42.395009</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">129.994267</span>, <span class="attr">lat</span>: <span class="number">42.985387</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">129.596669</span>, <span class="attr">lat</span>: <span class="number">42.424982</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">128.052215</span>, <span class="attr">lat</span>: <span class="number">41.994285</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">128.208433</span>, <span class="attr">lat</span>: <span class="number">41.466772</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">127.343783</span>, <span class="attr">lat</span>: <span class="number">41.503152</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">126.869083</span>, <span class="attr">lat</span>: <span class="number">41.816569</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">126.182045</span>, <span class="attr">lat</span>: <span class="number">41.107336</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">125.079942</span>, <span class="attr">lat</span>: <span class="number">40.569824</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">124.265625</span>, <span class="attr">lat</span>: <span class="number">39.928493</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">122.86757</span>, <span class="attr">lat</span>: <span class="number">39.637788</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">122.131388</span>, <span class="attr">lat</span>: <span class="number">39.170452</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.054554</span>, <span class="attr">lat</span>: <span class="number">38.897471</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.585995</span>, <span class="attr">lat</span>: <span class="number">39.360854</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.376757</span>, <span class="attr">lat</span>: <span class="number">39.750261</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">122.168595</span>, <span class="attr">lat</span>: <span class="number">40.422443</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.640359</span>, <span class="attr">lat</span>: <span class="number">40.94639</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.768629</span>, <span class="attr">lat</span>: <span class="number">40.593388</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.639602</span>, <span class="attr">lat</span>: <span class="number">39.898056</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.023464</span>, <span class="attr">lat</span>: <span class="number">39.252333</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">118.042749</span>, <span class="attr">lat</span>: <span class="number">39.204274</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">117.532702</span>, <span class="attr">lat</span>: <span class="number">38.737636</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">118.059699</span>, <span class="attr">lat</span>: <span class="number">38.061476</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">118.87815</span>, <span class="attr">lat</span>: <span class="number">37.897325</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">118.911636</span>, <span class="attr">lat</span>: <span class="number">37.448464</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.702802</span>, <span class="attr">lat</span>: <span class="number">37.156389</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.823457</span>, <span class="attr">lat</span>: <span class="number">37.870428</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.711259</span>, <span class="attr">lat</span>: <span class="number">37.481123</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">122.357937</span>, <span class="attr">lat</span>: <span class="number">37.454484</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">122.519995</span>, <span class="attr">lat</span>: <span class="number">36.930614</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.104164</span>, <span class="attr">lat</span>: <span class="number">36.651329</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.637009</span>, <span class="attr">lat</span>: <span class="number">36.11144</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.664562</span>, <span class="attr">lat</span>: <span class="number">35.609791</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.151208</span>, <span class="attr">lat</span>: <span class="number">34.909859</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.227525</span>, <span class="attr">lat</span>: <span class="number">34.360332</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.620369</span>, <span class="attr">lat</span>: <span class="number">33.376723</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.229014</span>, <span class="attr">lat</span>: <span class="number">32.460319</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.908146</span>, <span class="attr">lat</span>: <span class="number">31.692174</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.891919</span>, <span class="attr">lat</span>: <span class="number">30.949352</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.264257</span>, <span class="attr">lat</span>: <span class="number">30.676267</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.503519</span>, <span class="attr">lat</span>: <span class="number">30.142915</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">122.092114</span>, <span class="attr">lat</span>: <span class="number">29.83252</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.938428</span>, <span class="attr">lat</span>: <span class="number">29.018022</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.684439</span>, <span class="attr">lat</span>: <span class="number">28.225513</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.125661</span>, <span class="attr">lat</span>: <span class="number">28.135673</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.395473</span>, <span class="attr">lat</span>: <span class="number">27.053207</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.585497</span>, <span class="attr">lat</span>: <span class="number">25.740781</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">118.656871</span>, <span class="attr">lat</span>: <span class="number">24.547391</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">117.281606</span>, <span class="attr">lat</span>: <span class="number">23.624501</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">115.890735</span>, <span class="attr">lat</span>: <span class="number">22.782873</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">114.763827</span>, <span class="attr">lat</span>: <span class="number">22.668074</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">114.152547</span>, <span class="attr">lat</span>: <span class="number">22.22376</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">113.80678</span>, <span class="attr">lat</span>: <span class="number">22.54834</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">113.241078</span>, <span class="attr">lat</span>: <span class="number">22.051367</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">111.843592</span>, <span class="attr">lat</span>: <span class="number">21.550494</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">110.785466</span>, <span class="attr">lat</span>: <span class="number">21.397144</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">110.444039</span>, <span class="attr">lat</span>: <span class="number">20.341033</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">109.889861</span>, <span class="attr">lat</span>: <span class="number">20.282457</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">109.627655</span>, <span class="attr">lat</span>: <span class="number">21.008227</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">109.864488</span>, <span class="attr">lat</span>: <span class="number">21.395051</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">108.522813</span>, <span class="attr">lat</span>: <span class="number">21.715212</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">108.05018</span>, <span class="attr">lat</span>: <span class="number">21.55238</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">107.04342</span>, <span class="attr">lat</span>: <span class="number">21.811899</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">106.567273</span>, <span class="attr">lat</span>: <span class="number">22.218205</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">106.725403</span>, <span class="attr">lat</span>: <span class="number">22.794268</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">105.811247</span>, <span class="attr">lat</span>: <span class="number">22.976892</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">105.329209</span>, <span class="attr">lat</span>: <span class="number">23.352063</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">104.476858</span>, <span class="attr">lat</span>: <span class="number">22.81915</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">103.504515</span>, <span class="attr">lat</span>: <span class="number">22.703757</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">102.706992</span>, <span class="attr">lat</span>: <span class="number">22.708795</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">102.170436</span>, <span class="attr">lat</span>: <span class="number">22.464753</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">101.652018</span>, <span class="attr">lat</span>: <span class="number">22.318199</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">101.80312</span>, <span class="attr">lat</span>: <span class="number">21.174367</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">101.270026</span>, <span class="attr">lat</span>: <span class="number">21.201652</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">101.180005</span>, <span class="attr">lat</span>: <span class="number">21.436573</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">101.150033</span>, <span class="attr">lat</span>: <span class="number">21.849984</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">100.416538</span>, <span class="attr">lat</span>: <span class="number">21.558839</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">99.983489</span>, <span class="attr">lat</span>: <span class="number">21.742937</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">99.240899</span>, <span class="attr">lat</span>: <span class="number">22.118314</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">99.531992</span>, <span class="attr">lat</span>: <span class="number">22.949039</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">98.898749</span>, <span class="attr">lat</span>: <span class="number">23.142722</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">98.660262</span>, <span class="attr">lat</span>: <span class="number">24.063286</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">97.60472</span>, <span class="attr">lat</span>: <span class="number">23.897405</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">97.724609</span>, <span class="attr">lat</span>: <span class="number">25.083637</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">98.671838</span>, <span class="attr">lat</span>: <span class="number">25.918703</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">98.712094</span>, <span class="attr">lat</span>: <span class="number">26.743536</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">98.68269</span>, <span class="attr">lat</span>: <span class="number">27.508812</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">98.246231</span>, <span class="attr">lat</span>: <span class="number">27.747221</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">97.911988</span>, <span class="attr">lat</span>: <span class="number">28.335945</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">97.327114</span>, <span class="attr">lat</span>: <span class="number">28.261583</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">96.248833</span>, <span class="attr">lat</span>: <span class="number">28.411031</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">96.586591</span>, <span class="attr">lat</span>: <span class="number">28.83098</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">96.117679</span>, <span class="attr">lat</span>: <span class="number">29.452802</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">95.404802</span>, <span class="attr">lat</span>: <span class="number">29.031717</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">94.56599</span>, <span class="attr">lat</span>: <span class="number">29.277438</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">93.413348</span>, <span class="attr">lat</span>: <span class="number">28.640629</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">92.503119</span>, <span class="attr">lat</span>: <span class="number">27.896876</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">91.696657</span>, <span class="attr">lat</span>: <span class="number">27.771742</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">91.258854</span>, <span class="attr">lat</span>: <span class="number">28.040614</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">90.730514</span>, <span class="attr">lat</span>: <span class="number">28.064954</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">90.015829</span>, <span class="attr">lat</span>: <span class="number">28.296439</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">89.47581</span>, <span class="attr">lat</span>: <span class="number">28.042759</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">88.814248</span>, <span class="attr">lat</span>: <span class="number">27.299316</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">88.730326</span>, <span class="attr">lat</span>: <span class="number">28.086865</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">88.120441</span>, <span class="attr">lat</span>: <span class="number">27.876542</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">86.954517</span>, <span class="attr">lat</span>: <span class="number">27.974262</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">85.82332</span>, <span class="attr">lat</span>: <span class="number">28.203576</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">85.011638</span>, <span class="attr">lat</span>: <span class="number">28.642774</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">84.23458</span>, <span class="attr">lat</span>: <span class="number">28.839894</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">83.898993</span>, <span class="attr">lat</span>: <span class="number">29.320226</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">83.337115</span>, <span class="attr">lat</span>: <span class="number">29.463732</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">82.327513</span>, <span class="attr">lat</span>: <span class="number">30.115268</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">81.525804</span>, <span class="attr">lat</span>: <span class="number">30.422717</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">81.111256</span>, <span class="attr">lat</span>: <span class="number">30.183481</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">79.721367</span>, <span class="attr">lat</span>: <span class="number">30.882715</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">78.738894</span>, <span class="attr">lat</span>: <span class="number">31.515906</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">78.458446</span>, <span class="attr">lat</span>: <span class="number">32.618164</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">79.176129</span>, <span class="attr">lat</span>: <span class="number">32.48378</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">79.208892</span>, <span class="attr">lat</span>: <span class="number">32.994395</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">78.811086</span>, <span class="attr">lat</span>: <span class="number">33.506198</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">78.912269</span>, <span class="attr">lat</span>: <span class="number">34.321936</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">77.837451</span>, <span class="attr">lat</span>: <span class="number">35.49401</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">76.192848</span>, <span class="attr">lat</span>: <span class="number">35.898403</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">75.896897</span>, <span class="attr">lat</span>: <span class="number">36.666806</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">75.158028</span>, <span class="attr">lat</span>: <span class="number">37.133031</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">74.980002</span>, <span class="attr">lat</span>: <span class="number">37.41999</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">74.829986</span>, <span class="attr">lat</span>: <span class="number">37.990007</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">74.864816</span>, <span class="attr">lat</span>: <span class="number">38.378846</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">74.257514</span>, <span class="attr">lat</span>: <span class="number">38.606507</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">73.928852</span>, <span class="attr">lat</span>: <span class="number">38.505815</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">73.675379</span>, <span class="attr">lat</span>: <span class="number">39.431237</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">73.960013</span>, <span class="attr">lat</span>: <span class="number">39.660008</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">73.822244</span>, <span class="attr">lat</span>: <span class="number">39.893973</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">74.776862</span>, <span class="attr">lat</span>: <span class="number">40.366425</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">75.467828</span>, <span class="attr">lat</span>: <span class="number">40.562072</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">76.526368</span>, <span class="attr">lat</span>: <span class="number">40.427946</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">76.904484</span>, <span class="attr">lat</span>: <span class="number">41.066486</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">78.187197</span>, <span class="attr">lat</span>: <span class="number">41.185316</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">78.543661</span>, <span class="attr">lat</span>: <span class="number">41.582243</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">80.11943</span>, <span class="attr">lat</span>: <span class="number">42.123941</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">80.25999</span>, <span class="attr">lat</span>: <span class="number">42.349999</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">80.18015</span>, <span class="attr">lat</span>: <span class="number">42.920068</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">80.866206</span>, <span class="attr">lat</span>: <span class="number">43.180362</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">79.966106</span>, <span class="attr">lat</span>: <span class="number">44.917517</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">81.947071</span>, <span class="attr">lat</span>: <span class="number">45.317027</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">82.458926</span>, <span class="attr">lat</span>: <span class="number">45.53965</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">83.180484</span>, <span class="attr">lat</span>: <span class="number">47.330031</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">85.16429</span>, <span class="attr">lat</span>: <span class="number">47.000956</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">85.720484</span>, <span class="attr">lat</span>: <span class="number">47.452969</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">85.768233</span>, <span class="attr">lat</span>: <span class="number">48.455751</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">86.598776</span>, <span class="attr">lat</span>: <span class="number">48.549182</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">87.35997</span>, <span class="attr">lat</span>: <span class="number">49.214981</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">87.751264</span>, <span class="attr">lat</span>: <span class="number">49.297198</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">88.013832</span>, <span class="attr">lat</span>: <span class="number">48.599463</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">88.854298</span>, <span class="attr">lat</span>: <span class="number">48.069082</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">90.280826</span>, <span class="attr">lat</span>: <span class="number">47.693549</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">90.970809</span>, <span class="attr">lat</span>: <span class="number">46.888146</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">90.585768</span>, <span class="attr">lat</span>: <span class="number">45.719716</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">90.94554</span>, <span class="attr">lat</span>: <span class="number">45.286073</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">92.133891</span>, <span class="attr">lat</span>: <span class="number">45.115076</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">93.480734</span>, <span class="attr">lat</span>: <span class="number">44.975472</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">94.688929</span>, <span class="attr">lat</span>: <span class="number">44.352332</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">95.306875</span>, <span class="attr">lat</span>: <span class="number">44.241331</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">95.762455</span>, <span class="attr">lat</span>: <span class="number">43.319449</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">96.349396</span>, <span class="attr">lat</span>: <span class="number">42.725635</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">97.451757</span>, <span class="attr">lat</span>: <span class="number">42.74889</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">99.515817</span>, <span class="attr">lat</span>: <span class="number">42.524691</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">100.845866</span>, <span class="attr">lat</span>: <span class="number">42.663804</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">101.83304</span>, <span class="attr">lat</span>: <span class="number">42.514873</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">103.312278</span>, <span class="attr">lat</span>: <span class="number">41.907468</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">104.522282</span>, <span class="attr">lat</span>: <span class="number">41.908347</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">104.964994</span>, <span class="attr">lat</span>: <span class="number">41.59741</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">106.129316</span>, <span class="attr">lat</span>: <span class="number">42.134328</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">107.744773</span>, <span class="attr">lat</span>: <span class="number">42.481516</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">109.243596</span>, <span class="attr">lat</span>: <span class="number">42.519446</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">110.412103</span>, <span class="attr">lat</span>: <span class="number">42.871234</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">111.129682</span>, <span class="attr">lat</span>: <span class="number">43.406834</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">111.829588</span>, <span class="attr">lat</span>: <span class="number">43.743118</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">111.667737</span>, <span class="attr">lat</span>: <span class="number">44.073176</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">111.348377</span>, <span class="attr">lat</span>: <span class="number">44.457442</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">111.873306</span>, <span class="attr">lat</span>: <span class="number">45.102079</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">112.436062</span>, <span class="attr">lat</span>: <span class="number">45.011646</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">113.463907</span>, <span class="attr">lat</span>: <span class="number">44.808893</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">114.460332</span>, <span class="attr">lat</span>: <span class="number">45.339817</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">115.985096</span>, <span class="attr">lat</span>: <span class="number">45.727235</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">116.717868</span>, <span class="attr">lat</span>: <span class="number">46.388202</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">117.421701</span>, <span class="attr">lat</span>: <span class="number">46.672733</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">118.874326</span>, <span class="attr">lat</span>: <span class="number">46.805412</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.66327</span>, <span class="attr">lat</span>: <span class="number">46.69268</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.772824</span>, <span class="attr">lat</span>: <span class="number">47.048059</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">118.866574</span>, <span class="attr">lat</span>: <span class="number">47.74706</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">118.064143</span>, <span class="attr">lat</span>: <span class="number">48.06673</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">117.295507</span>, <span class="attr">lat</span>: <span class="number">47.697709</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">116.308953</span>, <span class="attr">lat</span>: <span class="number">47.85341</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">115.742837</span>, <span class="attr">lat</span>: <span class="number">47.726545</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">115.485282</span>, <span class="attr">lat</span>: <span class="number">48.135383</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">116.191802</span>, <span class="attr">lat</span>: <span class="number">49.134598</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">116.678801</span>, <span class="attr">lat</span>: <span class="number">49.888531</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">117.879244</span>, <span class="attr">lat</span>: <span class="number">49.510983</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.288461</span>, <span class="attr">lat</span>: <span class="number">50.142883</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">119.279366</span>, <span class="attr">lat</span>: <span class="number">50.582908</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.18205</span>, <span class="attr">lat</span>: <span class="number">51.643566</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.738191</span>, <span class="attr">lat</span>: <span class="number">51.964115</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.725789</span>, <span class="attr">lat</span>: <span class="number">52.516226</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">120.177089</span>, <span class="attr">lat</span>: <span class="number">52.753886</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">121.003085</span>, <span class="attr">lat</span>: <span class="number">53.251401</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">122.245748</span>, <span class="attr">lat</span>: <span class="number">53.431726</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">123.571507</span>, <span class="attr">lat</span>: <span class="number">53.458804</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">125.068211</span>, <span class="attr">lat</span>: <span class="number">53.161045</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">125.946349</span>, <span class="attr">lat</span>: <span class="number">52.792799</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">126.564399</span>, <span class="attr">lat</span>: <span class="number">51.784255</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">126.939157</span>, <span class="attr">lat</span>: <span class="number">51.353894</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">127.287456</span>, <span class="attr">lat</span>: <span class="number">50.739797</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lng</span>: <span class="number">127.657407</span>, <span class="attr">lat</span>: <span class="number">49.76027</span> &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pointlayer = <span class="keyword">new</span> PointLayer()</span><br><span class="line">  .source(</span><br><span class="line">    d,</span><br><span class="line">    &#123;</span><br><span class="line">      parser: &#123;</span><br><span class="line">        type: <span class="string">'json'</span>,</span><br><span class="line">        x: <span class="string">'lng'</span>,</span><br><span class="line">        y: <span class="string">'lat'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .shape(<span class="string">'cylinder'</span>)</span><br><span class="line">  .color(<span class="string">'#f00'</span>)</span><br><span class="line">  .size(<span class="string">''</span>, () =&gt; [ <span class="number">1</span>, <span class="number">1</span>, <span class="number">10</span> ])</span><br><span class="line">  .active(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> earthlayer = <span class="keyword">new</span> EarthLayer()</span><br><span class="line">  .source(</span><br><span class="line">    <span class="string">'https://gw.alipayobjects.com/mdn/rms_23a451/afts/img/A*3-3NSpqRqUoAAAAAAAAAAAAAARQnAQ'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      parser: &#123;</span><br><span class="line">        type: <span class="string">'image'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .shape(<span class="string">'fill'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">1.0</span>,</span><br><span class="line">    radius: <span class="number">40</span>,</span><br><span class="line">    globelOtions: &#123;</span><br><span class="line">      ambientRatio: <span class="number">0.6</span>, <span class="comment">// 环境光</span></span><br><span class="line">      diffuseRatio: <span class="number">0.4</span>, <span class="comment">// 漫反射</span></span><br><span class="line">      specularRatio: <span class="number">0.1</span> <span class="comment">// 高光反射</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .animate(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> atomLayer = <span class="keyword">new</span> EarthLayer()</span><br><span class="line">  .color(<span class="string">'#2E8AE6'</span>)</span><br><span class="line">  .shape(<span class="string">'atomSphere'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">1</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bloomLayer = <span class="keyword">new</span> EarthLayer().color(<span class="string">'#fff'</span>).shape(<span class="string">'bloomSphere'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">0.6</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  scene.addLayer(earthlayer);</span><br><span class="line">  scene.addLayer(pointlayer);</span><br><span class="line"></span><br><span class="line">  scene.addLayer(atomLayer);</span><br><span class="line">  scene.addLayer(bloomLayer);</span><br><span class="line"></span><br><span class="line">  earthlayer.setEarthTime(<span class="number">4.0</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-数据"><a href="#3-数据" class="headerlink" title="3. 数据"></a>3. 数据</h3><h4 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h4><p>source 地理数据处理模块，主要包含数据解析（parser)，和数据处理（transform）</p>
<ul>
<li>data</li>
<li>option<ul>
<li>cluster <strong>boolean</strong> 是否聚合</li>
<li>clusterOption 聚合配置项</li>
<li>parser 数据解析配置</li>
<li>transforms 数据处理配置</li>
</ul>
</li>
</ul>
<h5 id="3-1-1-parser"><a href="#3-1-1-parser" class="headerlink" title="3.1.1 parser"></a>3.1.1 parser</h5><p>不同数据类型处理成统一数据格式。矢量数据包括 GeoJON， CSV，Json 等不同数据格式，栅格数据，包括 Raster，Image 数据。将来还会支持瓦片格式数据。</p>
<p>空间数据分矢量数据和栅格数据两大类</p>
<ul>
<li>矢量数据 支持 csv，geojson，json 三种数据类型</li>
<li>栅格数据 支持 image，Raster</li>
</ul>
<h5 id="3-1-2-transform"><a href="#3-1-2-transform" class="headerlink" title="3.1.2 transform"></a>3.1.2 transform</h5><p>数据转换，数据统计，网格布局，数据聚合等数据操作。</p>
<h4 id="3-2-API"><a href="#3-2-API" class="headerlink" title="3.2 API"></a>3.2 API</h4><p><strong>cluster <code>boolean</code> 可选 可以只设置</strong></p>
<p><strong>clusterOption 可选</strong></p>
<ul>
<li>radius 聚合半径 <strong>number</strong> default 40</li>
<li>minZoom: 最小聚合缩放等级 <strong>number</strong> default 0</li>
<li>maxZoom: 最大聚合缩放等级 <strong>number</strong> default 16</li>
</ul>
<p><strong>parser 配置项</strong></p>
<ul>
<li>type: <code>csv|json|geojson|image|raster</code></li>
<li>其他可选配置项，具体和数据格式相关</li>
</ul>
<p><a href="https://www.yuque.com/antv/l7/dm2zll" target="_blank" rel="noopener">geojson</a> 数据为默认数据格式，可以 不设置 parser 参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.source(data);</span><br></pre></td></tr></table></figure>
<p><strong>Source 更新</strong></p>
<p>如果数据发生改变，可以需要更新数据 可以通过调用 layer 的 setData 方法实现数据的更新</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.setData(data);</span><br></pre></td></tr></table></figure>
<p><strong>getClustersLeaves(cluster_id)</strong></p>
<p>聚合图使用，获取聚合节点的原始数据</p>
<p>参数： id 聚合节点的 cluster_id</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">layer.on(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(source.getClustersLeaves(e.feature.cluster_id));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>getClustersLeaves(cluster_id)</strong></p>
<p>聚合图使用，获取聚合节点的原始数据</p>
<p>参数： id 聚合节点的 cluster_id</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">layer.on(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(source.getClustersLeaves(e.feature.cluster_id));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="3-3-transforms"><a href="#3-3-transforms" class="headerlink" title="3.3 transforms"></a>3.3 transforms</h4><p>tranforms 处理的是的标准化之后的数据 标准化之后的数据结构包括 coordinates 地理坐标字段，以及其他属性字段。</p>
<p>处理完之后返回的也是标准数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"coordinates"</span>: [[]], <span class="comment">// 地理坐标字段</span></span><br><span class="line">    <span class="attr">"_id"</span>: <span class="string">"122"</span>, <span class="comment">// 标准化之后新增字段</span></span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"test"</span>,</span><br><span class="line">    <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>目前支持两种热力图使用的数据处理方法 grid，hexagon transform 配置项</p>
<ul>
<li>type 数据处理类型</li>
<li>tansform cfg 数据处理配置项</li>
</ul>
<h5 id="3-3-1-grid"><a href="#3-3-1-grid" class="headerlink" title="3.3.1 grid"></a>3.3.1 grid</h5><p>生成方格网布局，根据数据字段统计，主要在网格热力图中使用</p>
<ul>
<li>type: ‘grid’,</li>
<li>size: 网格半径</li>
<li>field: 数据统计字段</li>
<li>method: 聚合方法  count,max,min,sum,mean 5 个统计维度</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">layer.source(data, &#123;</span><br><span class="line">  transforms: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">'grid'</span>,</span><br><span class="line">      size: <span class="number">15000</span>,</span><br><span class="line">      field: <span class="string">'v'</span>,</span><br><span class="line">      method: <span class="string">'sum'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="3-3-2-hexagon"><a href="#3-3-2-hexagon" class="headerlink" title="3.3.2 hexagon"></a>3.3.2 hexagon</h5><p>生成六边形网格布局，根据数据字段统计</p>
<ul>
<li>type: ‘hexagon’,</li>
<li>size: 网格半径</li>
<li>field: 数据统计字段</li>
<li>method:聚合方法  count,max,min,sum,mean 5 个统计维度</li>
</ul>
<h5 id="3-3-3-join"><a href="#3-3-3-join" class="headerlink" title="3.3.3 join"></a>3.3.3 join</h5><p>数据连接，业务中跟多情况是地理数据和业务数据分开的两套数据，我们可与通过 join 方法将地理数据和业务数据进行关联。</p>
<p>配置项</p>
<ul>
<li>type: join</li>
<li>sourceField 需要连接的业务数据字段名称</li>
<li>data 需要连接的数据源 仅支持 json 格式</li>
<li>targetField 关联的地理数据字段名称</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  type: <span class="string">'FeatureCollection'</span>,</span><br><span class="line">  features: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">'Feature'</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        city: <span class="string">'北京'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      geometry: &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data2 = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'北京'</span>,</span><br><span class="line">    value: <span class="number">13</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'天津'</span>,</span><br><span class="line">    value: <span class="number">20</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="comment">// data 是地理数据</span></span><br><span class="line"><span class="comment">// data2 属性数据或者业务数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过join方法我们就可以将两个数据连接到一起</span></span><br><span class="line"></span><br><span class="line">layer</span><br><span class="line">  .source(data, &#123;</span><br><span class="line">    transforms: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'join'</span>,</span><br><span class="line">        sourceField: <span class="string">'name'</span>, <span class="comment">//data1 对应字段名</span></span><br><span class="line">        targetField: <span class="string">'city'</span>, <span class="comment">// data 对应字段名 绑定到的地理数据</span></span><br><span class="line">        data: data2,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;)</span><br><span class="line">  .color(<span class="string">'value'</span>); <span class="comment">// 可以采用data1的value字段进行数据到颜色的映射</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-GeoJSON"><a href="#3-4-GeoJSON" class="headerlink" title="3.4 GeoJSON"></a>3.4 GeoJSON</h4><p>GeoJSON 是一种对各种地理数据结构进行编码的格式。GeoJSON 对象可以表示几何、特征或者特征集合。GeoJSON 支持下面几何类型：点、线、面、多点、多线、多面和几何集合。GeoJSON 里的特征包含一个几何对象和其他属性，特征集合表示一系列特征。 <a href="https://tools.ietf.org/html/draft-butler-geojson-06" target="_blank" rel="noopener">The GeoJSON Format</a>。</p>
<p>source 支持  传入 Geometry 集合 FeatureCollection</p>
<h5 id="3-4-1-Feature-Collection-Object"><a href="#3-4-1-Feature-Collection-Object" class="headerlink" title="3.4.1 Feature Collection Object"></a>3.4.1 Feature Collection Object</h5><p>一个 feature Colletion 由对个 feature 组成</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"FeatureCollection"</span>,</span><br><span class="line">  <span class="attr">"features"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"tom"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"geometry"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"Polygon"</span>,</span><br><span class="line">        <span class="attr">"coordinates"</span>: [</span><br><span class="line">          [</span><br><span class="line">            [<span class="number">-2.8125</span>, <span class="number">34.59704151614417</span>],</span><br><span class="line">            [<span class="number">65.390625</span>, <span class="number">34.59704151614417</span>],</span><br><span class="line">            [<span class="number">65.390625</span>, <span class="number">61.10078883158897</span>],</span><br><span class="line">            [<span class="number">-2.8125</span>, <span class="number">61.10078883158897</span>],</span><br><span class="line">            [<span class="number">-2.8125</span>, <span class="number">34.59704151614417</span>]</span><br><span class="line">          ]</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-4-2-Feature-Object"><a href="#3-4-2-Feature-Object" class="headerlink" title="3.4.2 Feature Object"></a>3.4.2 Feature Object</h5><p>一个 feature 有 geometry 空间信息，properties 属性信息，其中 geometry 是必须字段</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">  <span class="attr">"properties"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"geometry"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-4-3-Gemetry-Object"><a href="#3-4-3-Gemetry-Object" class="headerlink" title="3.4.3 Gemetry Object"></a>3.4.3 Gemetry Object</h5><p>支持 Gemetry Object 类型</p>
<ul>
<li>Point</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"Point"</span>,</span><br><span class="line">  <span class="attr">"coordinates"</span>: [<span class="number">100.0</span>, <span class="number">0.0</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>MultiPoint</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"MultiPoint"</span>,</span><br><span class="line">  <span class="attr">"coordinates"</span>: [</span><br><span class="line">    [<span class="number">100.0</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="number">101.0</span>, <span class="number">1.0</span>]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>LineSring</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"LineString"</span>,</span><br><span class="line">  <span class="attr">"coordinates"</span>: [</span><br><span class="line">    [<span class="number">100.0</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="number">101.0</span>, <span class="number">1.0</span>]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>MultiLineString</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"MultiLineString"</span>,</span><br><span class="line">  <span class="attr">"coordinates"</span>: [</span><br><span class="line">    [</span><br><span class="line">      [<span class="number">100.0</span>, <span class="number">0.0</span>],</span><br><span class="line">      [<span class="number">101.0</span>, <span class="number">1.0</span>]</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">      [<span class="number">102.0</span>, <span class="number">2.0</span>],</span><br><span class="line">      [<span class="number">103.0</span>, <span class="number">3.0</span>]</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Polygon</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"Polygon"</span>,</span><br><span class="line">  <span class="attr">"coordinates"</span>: [</span><br><span class="line">    [</span><br><span class="line">      [<span class="number">100.0</span>, <span class="number">0.0</span>],</span><br><span class="line">      [<span class="number">101.0</span>, <span class="number">0.0</span>],</span><br><span class="line">      [<span class="number">101.0</span>, <span class="number">1.0</span>],</span><br><span class="line">      [<span class="number">100.0</span>, <span class="number">1.0</span>],</span><br><span class="line">      [<span class="number">100.0</span>, <span class="number">0.0</span>]</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Polygon With holes:</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"Polygon"</span>,</span><br><span class="line">  <span class="attr">"coordinates"</span>: [</span><br><span class="line">    [</span><br><span class="line">      [<span class="number">-170.0</span>, <span class="number">10.0</span>],</span><br><span class="line">      [<span class="number">170.0</span>, <span class="number">10.0</span>],</span><br><span class="line">      [<span class="number">170.0</span>, <span class="number">-10.0</span>],</span><br><span class="line">      [<span class="number">-170.0</span>, <span class="number">-10.0</span>],</span><br><span class="line">      [<span class="number">-170.0</span>, <span class="number">10.0</span>]</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">      [<span class="number">175.0</span>, <span class="number">5.0</span>],</span><br><span class="line">      [<span class="number">-175.0</span>, <span class="number">5.0</span>],</span><br><span class="line">      [<span class="number">-175.0</span>, <span class="number">-5.0</span>],</span><br><span class="line">      [<span class="number">175.0</span>, <span class="number">-5.0</span>],</span><br><span class="line">      [<span class="number">175.0</span>, <span class="number">5.0</span>]</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>MultiPolygon</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"MultiPolygon"</span>,</span><br><span class="line">  <span class="attr">"coordinates"</span>: [</span><br><span class="line">    [</span><br><span class="line">      [</span><br><span class="line">        [<span class="number">102.0</span>, <span class="number">2.0</span>],</span><br><span class="line">        [<span class="number">103.0</span>, <span class="number">2.0</span>],</span><br><span class="line">        [<span class="number">103.0</span>, <span class="number">3.0</span>],</span><br><span class="line">        [<span class="number">102.0</span>, <span class="number">3.0</span>],</span><br><span class="line">        [<span class="number">102.0</span>, <span class="number">2.0</span>]</span><br><span class="line">      ]</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">      [</span><br><span class="line">        [<span class="number">100.0</span>, <span class="number">0.0</span>],</span><br><span class="line">        [<span class="number">101.0</span>, <span class="number">0.0</span>],</span><br><span class="line">        [<span class="number">101.0</span>, <span class="number">1.0</span>],</span><br><span class="line">        [<span class="number">100.0</span>, <span class="number">1.0</span>],</span><br><span class="line">        [<span class="number">100.0</span>, <span class="number">0.0</span>]</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        [<span class="number">100.2</span>, <span class="number">0.2</span>],</span><br><span class="line">        [<span class="number">100.8</span>, <span class="number">0.2</span>],</span><br><span class="line">        [<span class="number">100.8</span>, <span class="number">0.8</span>],</span><br><span class="line">        [<span class="number">100.2</span>, <span class="number">0.8</span>],</span><br><span class="line">        [<span class="number">100.2</span>, <span class="number">0.2</span>]</span><br><span class="line">      ]</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://l7.antv.vision/zh/docs/api/source/geojson" target="_blank" rel="noopener">geojson 详细文档</a></p>
<h5 id="3-4-4-Geojson-相关的-JS-库"><a href="#3-4-4-Geojson-相关的-JS-库" class="headerlink" title="3.4.4 Geojson 相关的 JS 库"></a>3.4.4 Geojson 相关的 JS 库</h5><ul>
<li>地理统计分析工具</li>
</ul>
<p><a href="http://turfjs.org/" target="_blank" rel="noopener">turfjs</a>:  地理数据计算，处理，统计，分析的 Javascript 库</p>
<ul>
<li>在线工具：</li>
</ul>
<p><a href="http://geojson.io/" target="_blank" rel="noopener">http://geojson.io/</a>   可以在线查看，绘制，修改 GeoJSON 数据</p>
<p><a href="https://mapshaper.org/" target="_blank" rel="noopener">https://mapshaper.org/</a> 可以查看较大的 geojson，还能够简化 GeoJSON 数据</p>
<p>GeoJSON 虽然是通用的的地理数据格式，在具体使用场景中，数据服务人员可能并不熟悉 GeoJON,或者没有生成 GeoJON 的工具， 因此对数据定义了 Parser 的概念，你的数据可以是任何格式，使用指定数据对应的地理信息字段即可。</p>
<h4 id="3-5-JSON"><a href="#3-5-JSON" class="headerlink" title="3.5 JSON"></a>3.5 JSON</h4><p>GeoJSON 虽然是通用的地理数据格式，在具体使用场景中，数据服务人员可能并不熟悉 GeoJON, 或者没有生成 GeoJON 的工具， 因此 对数据定义了 Parser 的概念，你的数据可以是任何格式，使用指定数据对应的地理信息字段即可。</p>
<p>⚠️ json 不是标准的地理数据结构，因此在使用时务必要设置 Parser。Parser 支持两种解析方式</p>
<h5 id="3-5-1-简易解析方式"><a href="#3-5-1-简易解析方式" class="headerlink" title="3.5.1 简易解析方式"></a>3.5.1 简易解析方式</h5><p>该方式只支持解析的点数据，或者只有两个点的线段，或者弧线数据</p>
<ul>
<li>type <code>string</code> 必选 <code>json</code></li>
<li>x <code>string</code> 点数据表示 经度</li>
<li>y <code>string</code> 点数据表示 纬度</li>
<li>x1 <code>string</code> 经度</li>
<li>x2 <code>string</code> 纬度</li>
</ul>
<p>如果数据是点数据，只需要设置 x,y 字段即可</p>
<p>如果是线段，弧线数据，需要知道起止点坐标既，x,y,x1,y1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'json'</span>,</span><br><span class="line">    x: <span class="string">'lng'</span>,</span><br><span class="line">    y: <span class="string">'lat'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="3-5-2-通用解析方式"><a href="#3-5-2-通用解析方式" class="headerlink" title="3.5.2 通用解析方式"></a>3.5.2 通用解析方式</h5><p>可也解析任意复杂的点，线面</p>
<ul>
<li>type <code>string</code> 必选 <code>json</code></li>
<li>coordinates <code>array</code> 必选，主要用于表达比较复杂的格式，等同于 geojson coordinates 属性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'json'</span>,</span><br><span class="line">    coordinates: <span class="string">'coord'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="3-5-3-点数据实例"><a href="#3-5-3-点数据实例" class="headerlink" title="3.5.3 点数据实例"></a>3.5.3 点数据实例</h5><p>简易解析</p>
<ul>
<li>type json</li>
<li>x: 经度字段</li>
<li>y: 纬度字段</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = [</span><br><span class="line">  &#123;</span><br><span class="line">    lng: <span class="number">112.345</span>,</span><br><span class="line">    lat: <span class="number">30.455</span>,</span><br><span class="line">    value: <span class="number">10</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    lng: <span class="number">114.345</span>,</span><br><span class="line">    lat: <span class="number">31.455</span>,</span><br><span class="line">    value: <span class="number">10</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'json'</span>,</span><br><span class="line">    x: <span class="string">'lng'</span>,</span><br><span class="line">    y: <span class="string">'lat'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>通用解析</p>
<p><a href="https://l7.antv.vision/zh/docs/api/source/geojson##point" target="_blank" rel="noopener">点 coodinates 数据格式</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = [</span><br><span class="line">  &#123;</span><br><span class="line">    coord: [<span class="number">112.345</span>, <span class="number">30.455</span>],</span><br><span class="line">    value: <span class="number">10</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    coord: [<span class="number">114.345</span>, <span class="number">32.455</span>],</span><br><span class="line">    value: <span class="number">10</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'json'</span>,</span><br><span class="line">    coordinates: <span class="string">'coord'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="3-5-4-线数据示例"><a href="#3-5-4-线数据示例" class="headerlink" title="3.5.4 线数据示例"></a>3.5.4 线数据示例</h5><p>简易解析</p>
<ul>
<li>type: json</li>
<li>x <code>string</code> 经度</li>
<li>y <code>string</code> 纬度</li>
<li>x1 <code>string</code> 经度</li>
<li>x2 <code>string</code> 纬度</li>
</ul>
<p>简易解析只支持两个点组成的线段，主要再绘制弧线的时候比较常用，只需指定线段的起止点坐标</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = [</span><br><span class="line">  &#123;</span><br><span class="line">    lng1: <span class="number">112.345</span>,</span><br><span class="line">    lat1: <span class="number">30.455</span>,</span><br><span class="line">    lng2: <span class="number">112.345</span>,</span><br><span class="line">    lat2: <span class="number">30.455</span>,</span><br><span class="line">    value: <span class="number">10</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    lng1: <span class="number">114.345</span>,</span><br><span class="line">    lat1: <span class="number">31.455</span>,</span><br><span class="line">    lng2: <span class="number">112.345</span>,</span><br><span class="line">    lat2: <span class="number">30.455</span>,</span><br><span class="line">    value: <span class="number">10</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'json'</span>,</span><br><span class="line">    x: <span class="string">'lng1'</span>,</span><br><span class="line">    y: <span class="string">'lat1'</span>,</span><br><span class="line">    x1: <span class="string">'lng1'</span>,</span><br><span class="line">    y1: <span class="string">'lat2'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>通用解析</p>
<p>绘制线段、弧线也支持使用 coordinates 组织数据</p>
<p>coordinates 包含两个坐标， 第一个坐标 对应 x, y 第二个坐标 对应 x1, y1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="string">'1'</span>,</span><br><span class="line">    coord: [</span><br><span class="line">      [<span class="number">101.953125</span>, <span class="number">50.51342652633956</span>],</span><br><span class="line">      [<span class="number">119.17968749999999</span>, <span class="number">33.137551192346145</span>],</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'json'</span>,</span><br><span class="line">    coordinates: <span class="string">'coord'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果需要使用绘制轨迹数据，需要通过 coodinates 指定线的点序列。</p>
<p>coordinate 格式 geojson 的 coordinate 字段 支持 LineString, MultiLineString</p>
<p><a href="https://l7.antv.vision/zh/docs/api/source/geojson#linesring" target="_blank" rel="noopener">线 coodinates 数据格式</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  name: <span class="string">'path1'</span>,</span><br><span class="line">  path: [</span><br><span class="line">    [<span class="number">58.00781249999999</span>, <span class="number">32.84267363195431</span>],</span><br><span class="line">    [<span class="number">85.78125</span>, <span class="number">25.16517336866393</span>],</span><br><span class="line">    [<span class="number">101.953125</span>, <span class="number">41.77131167976407</span>],</span><br><span class="line">    [<span class="number">114.9609375</span>, <span class="number">39.639537564366684</span>],</span><br><span class="line">    [<span class="number">117.42187500000001</span>, <span class="number">28.613459424004414</span>],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用时通过 coordinates 指定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'json'</span>,</span><br><span class="line">    coordinates: <span class="string">'path'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="3-5-5-面数据示例"><a href="#3-5-5-面数据示例" class="headerlink" title="3.5.5 面数据示例"></a>3.5.5 面数据示例</h5><p>面数据 coordinates 字段比较复杂不支持简易的解析方式</p>
<p>通用解析</p>
<p>需要指定 coordinates 字段, 格式同 GeoJSON 的 coordinates 字段</p>
<p><a href="https://l7.antv.vision/zh/docs/api/source/geojson/#polygon" target="_blank" rel="noopener">面 coodinates 数据格式</a></p>
<p><strong>注意面数据 coord 是三层数据结构</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    type: <span class="string">'Polygon'</span>,</span><br><span class="line">    geometryCoord: [</span><br><span class="line">      [</span><br><span class="line">        [<span class="number">115.1806640625</span>, <span class="number">30.637912028341123</span>],</span><br><span class="line">        [<span class="number">114.9609375</span>, <span class="number">29.152161283318915</span>],</span><br><span class="line">        [<span class="number">117.79541015625001</span>, <span class="number">27.430289738862594</span>],</span><br><span class="line">        [<span class="number">118.740234375</span>, <span class="number">29.420460341013133</span>],</span><br><span class="line">        [<span class="number">117.46582031249999</span>, <span class="number">31.50362930577303</span>],</span><br><span class="line">        [<span class="number">115.1806640625</span>, <span class="number">30.637912028341123</span>],</span><br><span class="line">      ],</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'json'</span>,</span><br><span class="line">    coordinates: <span class="string">'geometryCoord'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="3-6-CSV"><a href="#3-6-CSV" class="headerlink" title="3.6 CSV"></a>3.6 CSV</h4><p>支持 CSV 以逗号分隔的 CSV 数据加载。</p>
<p>CSV 是文本数据结构，很难表达复杂的地理数据结构，因此 CSV 仅支持两种数据结构</p>
<ul>
<li>点数据 需要指定经度，纬度坐标</li>
<li>线段，弧线数据 需要指定 起止点的 经度，纬度坐标</li>
</ul>
<h5 id="3-6-1-parser"><a href="#3-6-1-parser" class="headerlink" title="3.6.1 parser"></a>3.6.1 parser</h5><ul>
<li>type string 必选 json</li>
<li>x string 点数据表示 经度</li>
<li>y string 点数据表示 纬度</li>
<li>x1 string 经度</li>
<li>x2 string 纬度</li>
</ul>
<p>点数据通过 CSV 加载</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// layer.source(data, &#123;</span></span><br><span class="line"><span class="comment">//   parser: &#123;</span></span><br><span class="line"><span class="comment">//     type: 'csv',</span></span><br><span class="line"><span class="comment">//     x: 'lng',</span></span><br><span class="line"><span class="comment">//     y: 'lat',</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="keyword">import</span> &#123; CMap, PointLayer, GaodeMap &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    style: <span class="string">'dark'</span>,</span><br><span class="line">    center: [ <span class="number">112</span>, <span class="number">23.69</span> ],</span><br><span class="line">    zoom: <span class="number">2.5</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  fetch(</span><br><span class="line">    <span class="string">'https://gw.alipayobjects.com/os/basement_prod/9078fd36-ce8d-4ee2-91bc-605db8315fdf.csv'</span></span><br><span class="line">  )</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.text())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> pointLayer = <span class="keyword">new</span> PointLayer(&#123;&#125;)</span><br><span class="line">        .source(data, &#123;</span><br><span class="line">          parser: &#123;</span><br><span class="line">            type: <span class="string">'csv'</span>,</span><br><span class="line">            x: <span class="string">'Longitude'</span>,</span><br><span class="line">            y: <span class="string">'Latitude'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .shape(<span class="string">'circle'</span>)</span><br><span class="line">        .active(<span class="literal">true</span>)</span><br><span class="line">        .animate(<span class="literal">true</span>)</span><br><span class="line">        .size(<span class="number">56</span>)</span><br><span class="line">        .color(<span class="string">'#4cfd47'</span>)</span><br><span class="line">        .style(&#123;</span><br><span class="line">          opacity: <span class="number">1</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      scene.addLayer(pointLayer);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>线段弧线数据通过 CSV 加载</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// layer.source(data, &#123;</span></span><br><span class="line"><span class="comment">//   parser: &#123;</span></span><br><span class="line"><span class="comment">//     type: 'csv',</span></span><br><span class="line"><span class="comment">//     x: 'lng1',</span></span><br><span class="line"><span class="comment">//     y: 'lat1',</span></span><br><span class="line"><span class="comment">//     x1: 'lng1',</span></span><br><span class="line"><span class="comment">//     y1: 'lat2',</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="keyword">import</span> &#123; CMap, LineLayer, Mapbox &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> Mapbox(&#123;</span><br><span class="line">    style: <span class="string">'dark'</span>,</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    center: [ <span class="number">107.77791556935472</span>, <span class="number">35.443286920228644</span> ],</span><br><span class="line">    zoom: <span class="number">2.9142882493605033</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  fetch(<span class="string">'https://gw.alipayobjects.com/os/rmsportal/UEXQMifxtkQlYfChpPwT.txt'</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.text())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> layer = <span class="keyword">new</span> LineLayer(&#123;&#125;)</span><br><span class="line">        .source(data, &#123;</span><br><span class="line">          parser: &#123;</span><br><span class="line">            type: <span class="string">'csv'</span>,</span><br><span class="line">            x: <span class="string">'lng1'</span>,</span><br><span class="line">            y: <span class="string">'lat1'</span>,</span><br><span class="line">            x1: <span class="string">'lng2'</span>,</span><br><span class="line">            y1: <span class="string">'lat2'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .size(<span class="number">1</span>)</span><br><span class="line">        .shape(<span class="string">'arc'</span>)</span><br><span class="line">        .color(<span class="string">'#8C1EB2'</span>)</span><br><span class="line">        .style(&#123;</span><br><span class="line">          opacity: <span class="number">0.8</span>,</span><br><span class="line">          blur: <span class="number">0.99</span></span><br><span class="line">        &#125;);</span><br><span class="line">      scene.addLayer(layer);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="3-7-Image"><a href="#3-7-Image" class="headerlink" title="3.7 Image"></a>3.7 Image</h4><p>Image 数据主要用于在地图根据经纬度范围添加图图片，比如一幅纸制地图扫描版你要放在地图显示。</p>
<h5 id="3-7-1-parser"><a href="#3-7-1-parser" class="headerlink" title="3.7.1 parser"></a>3.7.1 parser</h5><ul>
<li>type: image</li>
<li>extent: 图像的经纬度范围 [minlng, minlat,maxLng, maxLat]</li>
</ul>
<p>根据图片的经纬度范围，将图片添加到地图上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">layer.source(</span><br><span class="line">  <span class="string">'https://gw.alipayobjects.com/zos/rmsportal/FnHFeFklTzKDdUESRNDv.jpg'</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'image'</span>,</span><br><span class="line">      extent: [<span class="number">121.168</span>, <span class="number">30.2828</span>, <span class="number">121.384</span>, <span class="number">30.4219</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="3-8-栅格"><a href="#3-8-栅格" class="headerlink" title="3.8 栅格"></a>3.8 栅格</h4><p>Raster 图层主要实现栅格数据的可视化，栅格数据主要来源是卫星遥感数据，如数字高程图，植被分布图，夜光图。</p>
<h5 id="3-8-1-parser"><a href="#3-8-1-parser" class="headerlink" title="3.8.1 parser"></a>3.8.1 parser</h5><ul>
<li>type: raster</li>
<li>extent: 栅格的经纬度范围 [minlng, minlat,maxLng, maxLat]</li>
<li>width 数据宽度</li>
<li>height 数据高度</li>
</ul>
<p>根据图片的经纬度范围，将图片添加到地图上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">layer.source(</span><br><span class="line">  <span class="string">'https://gw.alipayobjects.com/zos/rmsportal/FnHFeFklTzKDdUESRNDv.jpg'</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'raster'</span>,</span><br><span class="line">      extent: [<span class="number">121.168</span>, <span class="number">30.2828</span>, <span class="number">121.384</span>, <span class="number">30.4219</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="4-组件"><a href="#4-组件" class="headerlink" title="4 组件"></a>4 组件</h3><h4 id="4-1-Control-控件"><a href="#4-1-Control-控件" class="headerlink" title="4.1 Control 控件"></a>4.1 Control 控件</h4><p>地图组件用于控制地图的状态如果平移，缩放，或者展示地图一些的辅助信息如图例、比例尺。</p>
<p>目前支持 Control</p>
<ul>
<li>Zoom 放大缩小</li>
<li>Scale 比例尺</li>
<li>Layers 图层列表</li>
</ul>
<h5 id="4-1-1-构造函数-option"><a href="#4-1-1-构造函数-option" class="headerlink" title="4.1.1 构造函数 option"></a>4.1.1 构造函数 option</h5><p>position: <code>string</code> 控件位置支持 8 个方位</p>
<ul>
<li>bottomright</li>
<li>topright</li>
<li>bottomleft</li>
<li>topleft</li>
<li>topcenter</li>
<li>bottomcenter</li>
<li>leftcenter</li>
<li>rightcenter</li>
</ul>
<h5 id="4-1-2-Zoom-组件"><a href="#4-1-2-Zoom-组件" class="headerlink" title="4.1.2 Zoom 组件"></a>4.1.2 Zoom 组件</h5><p>放大缩小组件 默认左上角</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Zoom &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="keyword">const</span> zoomControl = <span class="keyword">new</span> Zoom(&#123;</span><br><span class="line">  position: <span class="string">'topleft'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">scene.addControl(zoomControl);</span><br></pre></td></tr></table></figure>
<h5 id="4-1-3-Scale-组件"><a href="#4-1-3-Scale-组件" class="headerlink" title="4.1.3 Scale 组件"></a>4.1.3 Scale 组件</h5><p>比例尺组件 默认左下角</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Scale &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="keyword">const</span> scaleControl = <span class="keyword">new</span> Scale(&#123;</span><br><span class="line">  position: <span class="string">'bottomleft'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">scene.addControl(scaleControl);</span><br></pre></td></tr></table></figure>
<h5 id="4-1-4-Layers"><a href="#4-1-4-Layers" class="headerlink" title="4.1.4 Layers"></a>4.1.4 Layers</h5><p>图层列表目前支持可视化的图层控制</p>
<p>option 控件配置项 overlayers 将一组图层添加到图层列表， overlayers Object key: 列表显示的图层名字可以自定义 layer: 图层对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Layers &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="keyword">const</span> layer = &#123;</span><br><span class="line">  图层一: layer1,</span><br><span class="line">  图层二: layer2,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> overlayers = &#123;</span><br><span class="line">  点图层: layer,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> layersControl = <span class="keyword">new</span> Layers(&#123;</span><br><span class="line">  overlayers,</span><br><span class="line">&#125;);</span><br><span class="line">scene.addControl(layersControl);</span><br></pre></td></tr></table></figure>
<h4 id="4-2-Popup-信息框"><a href="#4-2-Popup-信息框" class="headerlink" title="4.2 Popup 信息框"></a>4.2 Popup 信息框</h4><p>地图标注信息窗口，用于展示地图要素的属性信息</p>
<h5 id="4-2-1-构造函数-option"><a href="#4-2-1-构造函数-option" class="headerlink" title="4.2.1 构造函数 option"></a>4.2.1 构造函数 option</h5><ul>
<li>closeButton 是否显示关闭按钮，布尔值，默认为 true。</li>
<li>closeButtonOffsets 显示关闭按钮时生效，[number, number]，默认为 [0, 0]，以右上角为起始点。</li>
<li>closeOnClick 是否在点击地图的时候关闭弹框，布尔值，默认为 true</li>
<li>maxWidth 弹框最宽值，默认为 240px</li>
<li>anchor 弹框锚点，默认值为 bottom，可选值有 center、top、top-left、left、bottom-left、bottom、bottom-right、right、top-right</li>
</ul>
<h5 id="4-2-2-方法"><a href="#4-2-2-方法" class="headerlink" title="4.2.2 方法"></a>4.2.2 方法</h5><ul>
<li><strong>setLnglat</strong> 设置 popup 的经纬度位置</li>
</ul>
<p>参数：lnglat 支持数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">112</span>, <span class="number">32</span>];</span><br></pre></td></tr></table></figure>
<p>经纬度对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lnglat = &#123;</span><br><span class="line">  lng: <span class="number">112.323</span>,</span><br><span class="line">  lat: <span class="number">30.456</span>,</span><br><span class="line">&#125;;</span><br><span class="line">popup.setLnglat([<span class="number">112</span>, <span class="number">32</span>]);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>setHTML</strong> 设置 popup html 内容</li>
</ul>
<p>参数：html 字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = <span class="string">`&lt;p&gt;省份</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;feature.s&#125;</span> &lt;/p&gt;&lt;p&gt;地区</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;feature.m&#125;</span>&lt;/p&gt;&lt;p&gt;数值</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;feature.t&#125;</span>&lt;/p&gt;`</span>;</span><br><span class="line">popup.setHTML(html);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>setDOMContent</strong></li>
</ul>
<p>参数：htmlNode dom 对象 区别于 setHtml 对象只能传字符串</p>
<ul>
<li><strong>setText</strong></li>
</ul>
<p>设置 popup 显示文本内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popup.setText(<span class="string">'hello world'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>setMaxWidth</strong></li>
</ul>
<p>设置 popup 最大宽度</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popup.setMaxWidth(<span class="string">'300px'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>open</strong></li>
</ul>
<p>显示 popup</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popup.open();</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>close</strong></li>
</ul>
<p>关闭 popup</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popup.close();</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>remove</strong></li>
</ul>
<p>移除 popup</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popup.remove();</span><br></pre></td></tr></table></figure>
<h5 id="4-2-3-事件"><a href="#4-2-3-事件" class="headerlink" title="4.2.3 事件"></a>4.2.3 事件</h5><ul>
<li>open</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popup.on(<span class="string">'open'</span>, () =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>close</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popup.on(<span class="string">'close'</span>, () =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="4-2-4-示例代码"><a href="#4-2-4-示例代码" class="headerlink" title="4.2.4 示例代码"></a>4.2.4 示例代码</h5><p>添加 popup</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, Popup, Mapbox &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, Mapbox &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; Popup &#125; from 'cci-layers'</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> Mapbox(&#123;</span><br><span class="line">    style: <span class="string">'light'</span>,</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    center: [ <span class="number">121.4316962</span>, <span class="number">31.26082325</span> ],</span><br><span class="line">    zoom: <span class="number">12.056</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">	<span class="keyword">var</span> html = <span class="string">'&lt;p&gt;测试&lt;/p&gt;'</span>;</span><br><span class="line">	<span class="keyword">const</span> popup = <span class="keyword">new</span> Popup(&#123;</span><br><span class="line">    offsets: [ <span class="number">0</span>, <span class="number">20</span> ]</span><br><span class="line">  &#125;).setLnglat([<span class="number">112</span>, <span class="number">32</span>]).setHTML(html);</span><br><span class="line">  scene.addPopup(popup)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>通过组件实例化 popup</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; CMap, Popup, Mapbox &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; CMap, Mapbox &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; Popup &#125; from 'cci-layers'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> comp = &#123;</span><br><span class="line">	render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="comment">// 编写 vue 单页面组件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> VuePopup = Vue.extend(comp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> Mapbox(&#123;</span><br><span class="line">    style: <span class="string">'light'</span>,</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    center: [ <span class="number">121.4316962</span>, <span class="number">31.26082325</span> ],</span><br><span class="line">    zoom: <span class="number">12.056</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> popup = <span class="keyword">new</span> Popup(&#123;</span><br><span class="line">    offsets: [ <span class="number">0</span>, <span class="number">20</span> ]</span><br><span class="line">  &#125;).setLnglat([<span class="number">112</span>, <span class="number">32</span>])</span><br><span class="line">	.setHTML(VuePopup.$mount().$el) <span class="comment">// 可传入 dom，推荐</span></span><br><span class="line">	<span class="comment">// .setHTML(VuePopup.$mount().$el.outerHTML) // 可传入 html 字符串</span></span><br><span class="line">  scene.addPopup(popup)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="4-3-Marker-标注"><a href="#4-3-Marker-标注" class="headerlink" title="4.3 Marker 标注"></a>4.3 Marker 标注</h4><p>Marker 地图标注 目前只支持 2D Dom 标注</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const Marker = new CciMap.Marker(option)</span><br><span class="line">scene.addMarker(marker)</span><br></pre></td></tr></table></figure>
<h5 id="4-3-1-构造函数-option"><a href="#4-3-1-构造函数-option" class="headerlink" title="4.3.1 构造函数 option"></a>4.3.1 构造函数 option</h5><ul>
<li>color    <code>string</code> <img src="https://gw.alipayobjects.com/mdn/antv_site/afts/img/A*BJ6cTpDcuLcAAAAAAAAAAABkARQnAQ" alt="map-marker.png"> 设置默认 marker 的颜色</li>
<li>element  <code>Dom|string</code>  自定义 marker Dom 节点，可以是 dom 实例，也可以是 dom id</li>
<li>anchor   <code>string</code> 锚点位置  支持 center, top, top-left, top-right, bottom, bottom-left,bottom-right,left, right</li>
<li>offsets  <code>Array</code> 偏移量  [ 0, 0 ] 分别表示 X, Y 的偏移量</li>
<li>extData 用户自定义属性，支持任意数据类型，存储 marker 属性信息</li>
</ul>
<h5 id="4-3-2-方法"><a href="#4-3-2-方法" class="headerlink" title="4.3.2 方法"></a>4.3.2 方法</h5><ul>
<li><strong>setLnglat</strong></li>
</ul>
<p>设置 marker 经纬度位置</p>
<ul>
<li><strong>remove</strong></li>
</ul>
<p>移除 marker</p>
<ul>
<li><strong>getElement</strong></li>
</ul>
<p>获取 marker dom Element</p>
<ul>
<li><strong>setElement</strong> 设置 element 通过此方法更新 Marker 样式</li>
</ul>
<p>参数：element <code>dom</code></p>
<ul>
<li><strong>getLngLat</strong></li>
</ul>
<p>获取 marker 经纬度坐标</p>
<ul>
<li><strong>togglePopup</strong></li>
</ul>
<p>开启或者关闭 marker 弹出框</p>
<ul>
<li><strong>openPopup</strong></li>
</ul>
<p>打开 Popup</p>
<ul>
<li><strong>closePopup</strong></li>
</ul>
<p>关闭 popup</p>
<ul>
<li><strong>setPopup</strong></li>
</ul>
<p>为 marker 设置 popup</p>
<ul>
<li><strong>getPopup</strong></li>
</ul>
<p>获取 marker 弹出框</p>
<ul>
<li><strong>getExtData</strong></li>
</ul>
<p>获取用户自定义数据</p>
<ul>
<li><strong>setExtData(data)</strong></li>
</ul>
<p>设置用户自定义数据</p>
<h5 id="4-3-3-事件"><a href="#4-3-3-事件" class="headerlink" title="4.3.3 事件"></a>4.3.3 事件</h5><p>鼠标事件</p>
<ul>
<li>mousemove</li>
<li>click</li>
<li>mousedown</li>
<li>mouseup</li>
<li>dblclick</li>
<li>contextmenu</li>
<li>mouseover</li>
<li>mouseout</li>
</ul>
<p>事件返回数据</p>
<ul>
<li>target 事件触发源</li>
<li>data extData 用户自定义数据</li>
<li>lnglat marker 经纬度</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">marker.on(<span class="string">'click'</span>, (e) =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="4-3-4-示例代码"><a href="#4-3-4-示例代码" class="headerlink" title="4.3.4 示例代码"></a>4.3.4 示例代码</h5><p>默认 Marker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const marker = new CciMap.Marker(&#123;color:&apos;blue&apos;&#125;)</span><br></pre></td></tr></table></figure>
<p>自定义 Marker</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="string">'label'</span>);</span><br><span class="line">el.className = <span class="string">'labelclass'</span>;</span><br><span class="line">el.textContent = data[i].v;</span><br><span class="line">el.style.background = getColor(data[i].v);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> marker = <span class="keyword">new</span> CciMap.Marker(&#123;</span><br><span class="line">  element: el,</span><br><span class="line">&#125;).setLnglat([data[i].x, data[i].y]);</span><br><span class="line"></span><br><span class="line">scene.addMarker(marker);</span><br></pre></td></tr></table></figure>
<p>设置 popup</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> popup = <span class="keyword">new</span> CciMap.Popup(&#123;</span><br><span class="line">  anchor: <span class="string">'left'</span>,</span><br><span class="line">&#125;).setText(item.name);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> CciMap.Marker(&#123;</span><br><span class="line">  element: el,</span><br><span class="line">&#125;)</span><br><span class="line">  .setLnglat(item.coordinates)</span><br><span class="line">  .setPopup(popup);</span><br></pre></td></tr></table></figure>
<h4 id="4-4-Marker-图层"><a href="#4-4-Marker-图层" class="headerlink" title="4.4 Marker 图层"></a>4.4 Marker 图层</h4><p>MarkerLayer 是 Marker 的升级版，Marker 是独立的地图标注，MarkerLayer 则是统一管理大量的 Marker 数据。</p>
<p>技术差异</p>
<ul>
<li>Marker Dom 绘制一个地图元素</li>
<li>MarkerLayer 统一管理多个 DomMarker</li>
<li>PointLayer 通过 WebGL 绘制元素。</li>
</ul>
<p>功能差异</p>
<ul>
<li>MarkerLayer 元素的自定义性比较强，任何 HTML+ CSS 的组合都可以绘制在地图上。</li>
<li>PointLayer 自定义性比较弱，实现成本比较高，优势可以绘制大量的数据，性能比较好。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Marker, MarkerLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="keyword">const</span> markerLayer = <span class="keyword">new</span> MarkerLayer(option);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 addMarker方法 将多个Marker添加到Layer</span></span><br><span class="line"></span><br><span class="line">scene.addMarkerLayer(markerLayer);</span><br></pre></td></tr></table></figure>
<h5 id="4-4-1-构造函数-option"><a href="#4-4-1-构造函数-option" class="headerlink" title="4.4.1 构造函数 option"></a>4.4.1 构造函数 option</h5><ul>
<li>cluster 聚合 <code>boolean</code> 默认 <code>false</code></li>
<li>clusterOption 聚合配置<ul>
<li>field <code>string</code> 聚合统计字段</li>
<li>method <code>sum| max| min| mean</code></li>
<li>element <code>function</code> 通过回调函数设置聚合 Marker 的样式，返回 dom 元素 回调函数包含以下参数</li>
<li>point_count 默认 聚合元素个数</li>
<li>clusterData <code>Array</code> 聚合节点的原始数据</li>
<li>point_sum 聚合求和 根据 field 和 method 计算</li>
<li>point_max 聚合最大值 根据 field 和 method 计算</li>
<li>point_min 聚合最小值 根据 field 和 method 计算</li>
<li>point_mean 聚合平均值 根据 field 和 method 计算</li>
</ul>
</li>
</ul>
<h5 id="4-4-2-方法"><a href="#4-4-2-方法" class="headerlink" title="4.4.2 方法"></a>4.4.2 方法</h5><ul>
<li><strong>addMarker</strong></li>
</ul>
<p>参数： marker <code>IMarker</code> 需要添加的 Marker</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 Marker 对象实例化一个 Marker</span></span><br><span class="line"><span class="keyword">const</span> marker = <span class="keyword">new</span> Marker().setLnglat(); <span class="comment">// 添加进Marker必须设置经纬度才能添加</span></span><br><span class="line">markerLayer.addMarker(marker);</span><br></pre></td></tr></table></figure>
<p>为 Marker 添加属性信息, 如果聚合参数设置统计配置项 <code>field| method</code>需要为 Marker 添加属性信息。通过 Marker 的 extData 配置项设置 Marker 属性信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> marker = <span class="keyword">new</span> Marker(&#123;</span><br><span class="line">  extData: nodes.features[i].properties,</span><br><span class="line">&#125;).setLnglat(&#123;</span><br><span class="line">  lng: coordinates[<span class="number">0</span>],</span><br><span class="line">  lat: coordinates[<span class="number">1</span>],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>removeMarker</strong></li>
</ul>
<p>从 MarkerLayer 移除 Marker</p>
<ul>
<li><strong>getMarkers</strong></li>
</ul>
<p>获取 MarkerLayer 中的所有 Marker</p>
<ul>
<li><strong>clear</strong></li>
</ul>
<p>清除掉所有的 Marker</p>
<h5 id="4-4-3-CMap-类方法"><a href="#4-4-3-CMap-类方法" class="headerlink" title="4.4.3 CMap 类方法"></a>4.4.3 CMap 类方法</h5><ul>
<li><strong>addMarkerLayer</strong></li>
</ul>
<p>添加 MarkerLayer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.addMarkerLayer(layer);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>removeMarkerLayer</strong></li>
</ul>
<p>移除 MarkerLayer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.removeMarkerLayer(layer);</span><br></pre></td></tr></table></figure>
<h5 id="4-4-4-示例"><a href="#4-4-4-示例" class="headerlink" title="4.4.4 示例"></a>4.4.4 示例</h5><p>markerLayer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, Marker, MarkerLayer, GaodeMap &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    style: <span class="string">'light'</span>,</span><br><span class="line">    center: [ <span class="number">105.790327</span>, <span class="number">36.495636</span> ],</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    zoom: <span class="number">4</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  addMarkers()</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMarkers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fetch(</span><br><span class="line">    <span class="string">'https://gw.alipayobjects.com/os/basement_prod/67f47049-8787-45fc-acfe-e19924afe032.json'</span></span><br><span class="line">  )</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">    .then(<span class="function"><span class="params">nodes</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> markerLayer = <span class="keyword">new</span> MarkerLayer();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nodes.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nodes[i].g !== <span class="string">'1'</span> || nodes[i].v === <span class="string">''</span>) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'label'</span>);</span><br><span class="line">        el.className = <span class="string">'labelclass'</span>;</span><br><span class="line">        el.textContent = nodes[i].v + <span class="string">'℃'</span>;</span><br><span class="line">        el.style.background = getColor(nodes[i].v);</span><br><span class="line">        el.style.borderColor = getColor(nodes[i].v);</span><br><span class="line">        <span class="keyword">const</span> marker = <span class="keyword">new</span> Marker(&#123;</span><br><span class="line">          element: el</span><br><span class="line">        &#125;).setLnglat(&#123; <span class="attr">lng</span>: nodes[i].x * <span class="number">1</span>, <span class="attr">lat</span>: nodes[i].y &#125;);</span><br><span class="line">        markerLayer.addMarker(marker);</span><br><span class="line">      &#125;</span><br><span class="line">      scene.addMarkerLayer(markerLayer);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getColor</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> colors = [ <span class="string">'#ffffe5'</span>, <span class="string">'#f7fcb9'</span>, <span class="string">'#d9f0a3'</span>, <span class="string">'#addd8e'</span>, <span class="string">'#78c679'</span>, <span class="string">'#41ab5d'</span>, <span class="string">'#238443'</span>, <span class="string">'#005a32'</span> ];</span><br><span class="line">  <span class="keyword">return</span> v &gt; <span class="number">50</span></span><br><span class="line">    ? colors[<span class="number">7</span>]</span><br><span class="line">    : v &gt; <span class="number">40</span></span><br><span class="line">      ? colors[<span class="number">6</span>]</span><br><span class="line">      : v &gt; <span class="number">30</span></span><br><span class="line">        ? colors[<span class="number">5</span>]</span><br><span class="line">        : v &gt; <span class="number">20</span></span><br><span class="line">          ? colors[<span class="number">4</span>]</span><br><span class="line">          : v &gt; <span class="number">10</span></span><br><span class="line">            ? colors[<span class="number">3</span>]</span><br><span class="line">            : v &gt; <span class="number">5</span></span><br><span class="line">              ? colors[<span class="number">2</span>]</span><br><span class="line">              : v &gt; <span class="number">0</span></span><br><span class="line">                ? colors[<span class="number">1</span>]</span><br><span class="line">                : colors[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>markerLayer 聚合</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, Marker, MarkerLayer, GaodeMap &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    style: <span class="string">'light'</span>,</span><br><span class="line">    center: [ <span class="number">105.790327</span>, <span class="number">36.495636</span> ],</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    zoom: <span class="number">4</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  addMarkers();</span><br><span class="line">  scene.render();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMarkers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fetch(</span><br><span class="line">    <span class="string">'https://gw.alipayobjects.com/os/basement_prod/d3564b06-670f-46ea-8edb-842f7010a7c6.json'</span></span><br><span class="line">  )</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">    .then(<span class="function"><span class="params">nodes</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> markerLayer = <span class="keyword">new</span> MarkerLayer(&#123;</span><br><span class="line">        cluster: <span class="literal">true</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nodes.features.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; coordinates &#125; = nodes.features[i].geometry;</span><br><span class="line">        <span class="keyword">const</span> marker = <span class="keyword">new</span> Marker().setLnglat(&#123;</span><br><span class="line">          lng: coordinates[<span class="number">0</span>],</span><br><span class="line">          lat: coordinates[<span class="number">1</span>]</span><br><span class="line">        &#125;);</span><br><span class="line">        markerLayer.addMarker(marker);</span><br><span class="line">      &#125;</span><br><span class="line">      scene.addMarkerLayer(markerLayer);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-图层"><a href="#5-图层" class="headerlink" title="5 图层"></a>5 图层</h3><h4 id="5-1-图层基类"><a href="#5-1-图层基类" class="headerlink" title="5.1 图层基类"></a>5.1 图层基类</h4><p> Layer 接口设计遵循图形语法，所有图层都继承于该基类。</p>
<p>语法示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> Layer(option)</span><br><span class="line">  .source()</span><br><span class="line">  .color()</span><br><span class="line">  .size()</span><br><span class="line">  .shape()</span><br><span class="line">  .style();</span><br><span class="line"></span><br><span class="line">scene.addLayer(layer);</span><br></pre></td></tr></table></figure>
<h5 id="5-1-1-构造函数配置项"><a href="#5-1-1-构造函数配置项" class="headerlink" title="5.1.1 构造函数配置项"></a>5.1.1 构造函数配置项</h5><ul>
<li>name</li>
</ul>
<p><em>string</em> <strong>optional</strong> <em>default:</em> 自动数字编号</p>
<p>设置图层名称,可根据 name 获取 layer;</p>
<ul>
<li>visible</li>
</ul>
<p>图层是否可见  {bool } default true</p>
<ul>
<li>zIndex</li>
</ul>
<p>图层绘制顺序，数值大绘制在上层，可以控制图层绘制的上下层级 {int}  default 0</p>
<ul>
<li>minZoom</li>
</ul>
<p>图层显示最小缩放等级，（0-18）  {number}  Mapbox （0-24） 高德 （2-19）</p>
<ul>
<li>maxZoom</li>
</ul>
<p>图层显示最大缩放等级 （0-18）  {number}  Mapbox （0-24） 高德 （2-19）</p>
<ul>
<li>autoFit</li>
</ul>
<p>layer 初始化完成之后，是否自动缩放到图层范围 {bool } default false</p>
<ul>
<li>pickingBuffer</li>
</ul>
<p>图层拾取缓存机制，如 1px 宽度的线鼠标很难拾取(点击)到, 通过设置该参数可扩大拾取的范围 {number} default 0</p>
<ul>
<li>blend</li>
</ul>
<p>图层元素混合效果 （normal 正常效果 默认， additive 叠加模式 subtractive 相减模式 max 最大值）</p>
<h5 id="5-1-2-方法"><a href="#5-1-2-方法" class="headerlink" title="5.1.2 方法"></a>5.1.2 方法</h5><h6 id="5-1-2-1-数据方法"><a href="#5-1-2-1-数据方法" class="headerlink" title="5.1.2.1 数据方法"></a>5.1.2.1 数据方法</h6><p><strong>source</strong></p>
<p>数据源为 layer 设置数据 source(data,config)</p>
<p>参数 </p>
<p>-data {geojson|json|csv} 源数据</p>
<ul>
<li>config  可选  数据源配置项<ul>
<li>parser 数据解析，默认是解析层 geojson</li>
<li>transforms [transform，transform ] 数据处理转换 可设置多个</li>
</ul>
</li>
</ul>
<p>parser 和  transforms 参见数据配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'csv'</span>,</span><br><span class="line">    x: <span class="string">'lng'</span>,</span><br><span class="line">    y: <span class="string">'lat'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  transforms: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">'map'</span>,</span><br><span class="line">      callback: <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> [x, y] = item.coordinates;</span><br><span class="line">        item.lat = item.lat * <span class="number">1</span>;</span><br><span class="line">        item.lng = item.lng * <span class="number">1</span>;</span><br><span class="line">        item.v = item.v * <span class="number">1</span>;</span><br><span class="line">        item.coordinates = [x * <span class="number">1</span>, y * <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">'hexagon'</span>,</span><br><span class="line">      size: <span class="number">6000</span>,</span><br><span class="line">      field: <span class="string">'v'</span>,</span><br><span class="line">      method: <span class="string">'sum'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>scale</strong></p>
<p>设置数据字段映射方法</p>
<ul>
<li><code>field</code> 字段名。</li>
<li><code>scaleConfig</code> 列定义配置，对象类型，可配置的属性如下：</li>
</ul>
<p>连续型</p>
<ul>
<li>linear 线性</li>
<li>log</li>
<li>pow 指数型</li>
</ul>
<p>连续分类型</p>
<ul>
<li>quantile 等分位</li>
<li>quantize 等间距</li>
</ul>
<p>枚举型</p>
<ul>
<li>cat 枚举</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">layer.scale(<span class="string">'name'</span>, &#123;</span><br><span class="line">  type: <span class="string">'cat'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置多个scale</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字段名为 key, value 为scale配置项</span></span><br><span class="line"></span><br><span class="line">layer.scale(&#123;</span><br><span class="line">  name: &#123;</span><br><span class="line">    type: <span class="string">'cat'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  value: &#123;</span><br><span class="line">    type: <span class="string">'linear'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-1-2-2-视觉编码方法"><a href="#5-1-2-2-视觉编码方法" class="headerlink" title="5.1.2.2 视觉编码方法"></a>5.1.2.2 视觉编码方法</h6><p>可视化编码是将数据转换为可视形式的过程，目前支持形状（shape），大小(size)，颜色(color) 3 种视觉通道，你可以指定数据字段，为不同要素设置不同的图形属性。</p>
<p><strong>size</strong></p>
<p>将数据值映射到图形的大小上的方法,具体 size 的表示具体意义可以查看对应图层的文档</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pointLayer.size(<span class="number">10</span>); <span class="comment">// 常量</span></span><br><span class="line">pointLayer.size(<span class="string">'type'</span>); <span class="comment">// 使用字段映射到大小</span></span><br><span class="line">pointLayer.size(<span class="string">'type'</span>, [<span class="number">0</span>, <span class="number">10</span>]); <span class="comment">// 使用字段映射到大小，并指定最大值和最小值</span></span><br><span class="line">pointLayer.size(<span class="string">'type'</span>, (type) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 回调函数</span></span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'a'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>size(value）</strong></li>
</ul>
<p>传入数字常量，如  <code>pointLayer.size(20)</code></p>
<ul>
<li><strong>size(field)</strong></li>
</ul>
<p>根据 field 字段的值映射大小，使用默认的<code>最大值 max:10</code> 和<code>最小值 min: 1</code>。</p>
<ul>
<li><strong>size(field, callback)</strong></li>
</ul>
<p>使用回调函数控制图形大小。</p>
<p>参数：<code>callback</code>: function 回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pointLayer.size(<span class="string">'age'</span>, (value) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (value === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>color</strong></p>
<p>将数据值映射到图形的颜色上的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">layer.color(<span class="string">'red'</span>); <span class="comment">// 常量颜色</span></span><br><span class="line">layer.color(<span class="string">'type'</span>); <span class="comment">// 对 type 字段进行映射，使用内置的颜色</span></span><br><span class="line">layer.color(<span class="string">'type'</span>, [<span class="string">'red'</span>, <span class="string">'blue'</span>]); <span class="comment">// 指定颜色</span></span><br><span class="line">layer.color(<span class="string">'type'</span>, (type) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 通过回调函数</span></span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'a'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'red'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'blue'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">layer.color(<span class="string">'type*value'</span>, (type, value) =&gt; &#123;</span><br><span class="line">  <span class="comment">//多个参数，通过回调函数</span></span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'a'</span> &amp;&amp; value &gt; <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'red'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'blue'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>color(value)</strong></li>
</ul>
<p>参数：<code>value</code> ：string 只支持接收一个参数</p>
<p>value 可以是：映射至颜色属性的数据源字段名，如果数据源中不存在这个字段名的话，则按照常量进行解析，这时会使用默认提供的颜色;  也可直接指定某一个具体的颜色值 color，如 ‘#fff’, ‘white’,’rgba(255,0,0,0.5)’ ,rgb(255,0,1) 等</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">layer.color(<span class="string">'name'</span>); <span class="comment">// 映射数据字段</span></span><br><span class="line">layer.color(<span class="string">'white'</span>); <span class="comment">// 指定颜色</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>color(field, colors)</strong></li>
</ul>
<p>参数：<code>field</code>: stringfield 为映射至颜色属性的数据源字段名，也支持指定多个参数。<code>colors</code>: string | array | function</p>
<p>colors 的参数有以下情况： 如果为空，即未指定颜色的数组，那么使用内置的全局的颜色；如果需要指定颜色，则需要以数组格式传入，那么分类的颜色按照数组中的颜色确定。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">layer.color(<span class="string">'name'</span>); <span class="comment">// 使用默认的颜色</span></span><br><span class="line">layer.color(<span class="string">'name'</span>, [<span class="string">'red'</span>, <span class="string">'blue'</span>]); <span class="comment">// 使用传入的指定颜色</span></span><br></pre></td></tr></table></figure>
<p>colors 如果是回调函数，则该回调函数的参数为对应字段的数值，具体使用如下，当 color 映射为多个字段时，参数按照字段声明的顺序传入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">layer.color(<span class="string">'gender'</span>, (value) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (value === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'red'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'blue'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">layer.color(<span class="string">'gender*age'</span>, (gender, age) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (age === <span class="number">20</span> &amp;&amp; gender == <span class="string">' 男'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'red'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'blue'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>shape</strong></p>
<p>将数据值映射到图形的形状上的方法。</p>
<ul>
<li><strong>shape(shape)</strong></li>
</ul>
<p>参数<code>shape</code> string</p>
<p>只支持接收一个参数，指定几何图像对象绘制的形状。下表列出了不同的 图层 几何图形对象支持的 shape 形状</p>
<table>
<thead>
<tr>
<th style="text-align:left">layer 类型</th>
<th style="text-align:left">shape 类型</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">point</td>
<td style="text-align:left">2d:point,circle, square, triangle,hexagon,image,text 3d:circle,triangle,hexagon,square</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">line</td>
<td style="text-align:left">line,arc, arc3d, greatcircle</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">polygon</td>
<td style="text-align:left">fill,line, extrude</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>shape(field, shapes)</strong></p>
</li>
<li><p><strong>shape(field, callback)</strong></p>
</li>
</ul>
<p><strong>style</strong></p>
<p>全局设置图形显示属性</p>
<ul>
<li>opacity  设置透明度</li>
<li>stroke 线填充颜色 仅点图层支持</li>
<li>offsets 偏移量 [number, number] x 和 y 方向偏移 仅支持 pointLayer</li>
<li>strokeWidth 线的宽度 仅点图层支持</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">layer.style(&#123;</span><br><span class="line">  opacity: <span class="number">0.8</span>,</span><br><span class="line">  stroke: <span class="string">'white'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-1-2-3-通用样式数据纹理映射"><a href="#5-1-2-3-通用样式数据纹理映射" class="headerlink" title="5.1.2.3 通用样式数据纹理映射"></a>5.1.2.3 通用样式数据纹理映射</h6><p>从 L7 2.5 开始，各图层样式将逐步支持样式数据映射</p>
<table>
<thead>
<tr>
<th style="text-align:left">layer 类型</th>
<th style="text-align:left">支持的样式字段</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">point/fill</td>
<td style="text-align:left">opacity、strokeOpacity、strokeWidth、stroke、offsets</td>
<td style="text-align:left">shape circle、triangle…</td>
</tr>
<tr>
<td style="text-align:left">point/image</td>
<td style="text-align:left">opacity、offsets</td>
<td style="text-align:left">offsets 经纬度偏移</td>
</tr>
<tr>
<td style="text-align:left">point/normal</td>
<td style="text-align:left">opacity、offsets</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">point/text</td>
<td style="text-align:left">opacity、strokeWidth、stroke、textOffset</td>
<td style="text-align:left">textOffset 相对文字画布位置的偏移</td>
</tr>
<tr>
<td style="text-align:left">point/extrude</td>
<td style="text-align:left">opacity</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">polygon/fill</td>
<td style="text-align:left">opacity</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">polygon/extrude</td>
<td style="text-align:left">opacity</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">line/line</td>
<td style="text-align:left">opacity</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">line/arc</td>
<td style="text-align:left">opacity</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">line/arc3d</td>
<td style="text-align:left">opacity</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">line/great_circle</td>
<td style="text-align:left">opacity</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, PointLayer, GaodeMap &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map';</span></span><br><span class="line"><span class="comment">// import &#123; PointLayer &#125; from 'cci-layers';</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    center: [ <span class="number">112</span>, <span class="number">30.267069</span> ],</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    style: <span class="string">'dark'</span>,</span><br><span class="line">    zoom: <span class="number">6</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  fetch(<span class="string">'https://gw.alipayobjects.com/os/bmw-prod/450b2d95-006c-4bad-8269-15729269e142.json'</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> layer = <span class="keyword">new</span> PointLayer()</span><br><span class="line">        .source(data, &#123;</span><br><span class="line">          parser: &#123;</span><br><span class="line">            type: <span class="string">'json'</span>,</span><br><span class="line">            x: <span class="string">'lng'</span>,</span><br><span class="line">            y: <span class="string">'lat'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .shape(<span class="string">'circle'</span>)</span><br><span class="line">        .color(<span class="string">'color'</span>)</span><br><span class="line">        .size(<span class="string">'value'</span>, v =&gt; <span class="number">5</span> + <span class="number">15</span> * v)</span><br><span class="line">        .style(&#123;</span><br><span class="line">          stroke: <span class="string">'strokeColor'</span>,</span><br><span class="line">          strokeWidth: <span class="string">'strokeWidth'</span>,</span><br><span class="line">          strokeOpacity: [</span><br><span class="line">            <span class="string">'strokeOpacity'</span>,</span><br><span class="line">            d =&gt; &#123;</span><br><span class="line">              <span class="keyword">return</span> d * <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line"></span><br><span class="line">          opacity: <span class="string">'opacity'</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .active(<span class="literal">true</span>);</span><br><span class="line">      scene.addLayer(layer);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-1-2-4-线图层纹理方法"><a href="#5-1-2-4-线图层纹理方法" class="headerlink" title="5.1.2.4 线图层纹理方法"></a>5.1.2.4 线图层纹理方法</h6><p>目前在线图层上单独加上了纹理方法的支持</p>
<p>为图层绑定纹理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先在全局加载图片资源</span></span><br><span class="line">scene.addImage(</span><br><span class="line">  <span class="string">'plane'</span>,</span><br><span class="line">  <span class="string">'https://gw.alipayobjects.com/zos/bmw-prod/0ca1668e-38c2-4010-8568-b57cb33839b9.svg'</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> LineLayer(&#123;</span><br><span class="line">  blend: <span class="string">'normal'</span>,</span><br><span class="line">&#125;)</span><br><span class="line">  .source(data, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'json'</span>,</span><br><span class="line">      x: <span class="string">'lng1'</span>,</span><br><span class="line">      y: <span class="string">'lat1'</span>,</span><br><span class="line">      x1: <span class="string">'lng2'</span>,</span><br><span class="line">      y1: <span class="string">'lat2'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .size(<span class="number">25</span>)</span><br><span class="line">  .shape(<span class="string">'arc'</span>)</span><br><span class="line">  .texture(<span class="string">'plane'</span>) <span class="comment">// 为图层绑定纹理</span></span><br><span class="line">  .color(<span class="string">'#8C1EB2'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    lineTexture: <span class="literal">true</span>, <span class="comment">// 开启线的贴图功能</span></span><br><span class="line">    iconStep: <span class="number">30</span>, <span class="comment">// 设置贴图纹理的间距</span></span><br><span class="line">    textureBlend: <span class="string">'replace'</span>, <span class="comment">// 设置纹理混合方式，默认值为 normal，可选值有 normal/replace 两种</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-1-2-5-图层更新方法"><a href="#5-1-2-5-图层更新方法" class="headerlink" title="5.1.2.5 图层更新方法"></a>5.1.2.5 图层更新方法</h6><p>如果已经添加了图层，需要修改图层显示样式可以再次调用图形映射方法，然后调用 <code>scene.render()</code>更新渲染即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">layer.color(<span class="string">'blue'</span>);</span><br><span class="line">layer.size(<span class="number">10</span>);</span><br><span class="line">layer.style(&#123;&#125;);</span><br><span class="line">scene.render();</span><br></pre></td></tr></table></figure>
<p><strong>setData</strong></p>
<p>更新 Source 数据</p>
<p>参数:</p>
<ul>
<li>data 数据</li>
<li>option 默认和初始配置项一致，如果数据格式相同可不设置</li>
</ul>
<p>调用 setData 方法会自动更新图层渲染</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.setData(data);</span><br></pre></td></tr></table></figure>
<p><strong>setBlend(type)</strong></p>
<p>设置图层叠加方法 参数：</p>
<ul>
<li>type blend 类型</li>
</ul>
<h6 id="5-1-2-6-图层控制方法"><a href="#5-1-2-6-图层控制方法" class="headerlink" title="5.1.2.6 图层控制方法"></a>5.1.2.6 图层控制方法</h6><p><strong>show</strong></p>
<p>图层显示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.show();</span><br></pre></td></tr></table></figure>
<p><strong>hide</strong></p>
<p>图层隐藏</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.hide();</span><br></pre></td></tr></table></figure>
<p><strong>isVisible</strong></p>
<p>图层是否可见</p>
<p>return <code>true | false</code></p>
<p><strong>setIndex</strong></p>
<p>设置图层绘制顺序</p>
<p><strong>fitBounds</strong></p>
<p>缩放到图层范围</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.fitBounds();</span><br></pre></td></tr></table></figure>
<p><strong>setMinZoom</strong></p>
<p>设置图层最小缩放等级</p>
<p>参数</p>
<ul>
<li>zoom {number}</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.setMinZoom(zoom);</span><br></pre></td></tr></table></figure>
<p><strong>setMaxZoom</strong></p>
<p>设置图层最大缩放等级</p>
<p>参数</p>
<ul>
<li>zoom {number}</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.setMaxZoom(zoom)</span><br></pre></td></tr></table></figure>
<h6 id="5-1-2-7-图层交互方法"><a href="#5-1-2-7-图层交互方法" class="headerlink" title="5.1.2.7 图层交互方法"></a>5.1.2.7 图层交互方法</h6><p><strong>active</strong></p>
<p>开启或者关闭 mousehover 元素高亮效果</p>
<p>参数： activeOption | boolean</p>
<p>activeOption -color 填充颜色</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启 Active  使用默认高亮颜色</span></span><br><span class="line">layer.active(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  开启 Active  自定义高亮颜色</span></span><br><span class="line"></span><br><span class="line">layer.active(&#123;</span><br><span class="line">  color: <span class="string">'red'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭高亮效果</span></span><br><span class="line">layer.active(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p><strong>setActive</strong></p>
<p>根据元素 ID 设置指定元素 hover 高亮</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.setActive(id);</span><br></pre></td></tr></table></figure>
<p><strong>select</strong></p>
<p>开启或者关闭 mouseclick 元素选中高亮效果</p>
<p>参数： selectOption | boolean</p>
<p>selectOption -color 填充颜色</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启 Active  使用默认高亮颜色</span></span><br><span class="line">layer.select(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  开启 Active  自定义高亮颜色</span></span><br><span class="line"></span><br><span class="line">layer.select(&#123;</span><br><span class="line">  color: <span class="string">'red'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭高亮效果</span></span><br><span class="line">layer.select(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p><strong>setSelect</strong></p>
<p>根据元素 ID 设置指定元素 click 选中 高亮</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.setSelect(id);</span><br></pre></td></tr></table></figure>
<h6 id="5-1-2-8-图层框选"><a href="#5-1-2-8-图层框选" class="headerlink" title="5.1.2.8 图层框选"></a>5.1.2.8 图层框选</h6><p><strong>boxSelect</strong></p>
<p>参数 option</p>
<ul>
<li>box [x1: number, y1: number, x2: number, y2: number] 相较于</li>
<li>cb (…args: any[]) =&gt; void 传入的回调方法，返回框选内部的 feature</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">layer.boxSelect(box, cb);</span><br><span class="line"><span class="comment">// (x1, y1), (x2, y2) 框选的方框左上角和右下角相对于地图左上角的像素坐标</span></span><br><span class="line"><span class="comment">// cb 是传入的回调函数，回调函数返回的参数是选中的 feature 对象数组，对象的字段和用户传入的数据相关</span></span><br></pre></td></tr></table></figure>
<h5 id="5-1-3-事件"><a href="#5-1-3-事件" class="headerlink" title="5.1.3 事件"></a>5.1.3 事件</h5><p>鼠标事件回调参数 target</p>
<ul>
<li>x: number 鼠标  在地图位置 x 坐标</li>
<li>y: number 鼠标  在地图位置 y 坐标</li>
<li>type: string 鼠标事件类型</li>
<li>lngLat: 经度度对象 {lng:number, lat: number }; 鼠标所在位置经纬度</li>
<li>feature: any; 数据选中的地理要素信息</li>
<li>featureId: number | null; 数据选中的地理要素的 ID</li>
</ul>
<p><strong>click</strong></p>
<p>点击事件</p>
<p><strong>mousemove</strong></p>
<p>鼠标移动事件</p>
<p><strong>mouseout</strong></p>
<p>鼠标移除</p>
<p><strong>mouseup</strong></p>
<p>鼠标按下</p>
<p><strong>mousedown</strong></p>
<p>鼠标向下</p>
<p><strong>contextmenu</strong></p>
<p>鼠标右键</p>
<p><strong>unclick</strong></p>
<p>点击未拾取到元素</p>
<p><strong>unmousemove</strong></p>
<p>鼠标移动未拾取到元素</p>
<p><strong>unmouseup</strong></p>
<p>鼠标抬起未拾取到元素</p>
<p><strong>unmousedown</strong></p>
<p>鼠标按下未拾取到元素</p>
<p><strong>uncontextmenu</strong></p>
<p>鼠标右键位拾取到元素</p>
<p><strong>unpick</strong></p>
<p>所有鼠标事件未拾取到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">layer.on(<span class="string">'click'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标左键点击图层事件</span></span><br><span class="line">layer.on(<span class="string">'mouseenter'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标进入图层要素</span></span><br><span class="line">layer.on(<span class="string">'mousemove'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标在图层上移动时触发</span></span><br><span class="line">layer.on(<span class="string">'mouseout'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标移出图层要素时触发</span></span><br><span class="line">layer.on(<span class="string">'mouseup'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标在图层上单击抬起时触发</span></span><br><span class="line">layer.on(<span class="string">'mousedown'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 鼠标在图层上单击按下时触发</span></span><br><span class="line">layer.on(<span class="string">'contextmenu'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 图层要素点击右键菜单</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 鼠标在图层外的事件</span></span><br><span class="line">layer.on(<span class="string">'unclick'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 图层外点击</span></span><br><span class="line">layer.on(<span class="string">'unmousemove'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 图层外移动</span></span><br><span class="line">layer.on(<span class="string">'unmouseup'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 图层外鼠标抬起</span></span><br><span class="line">layer.on(<span class="string">'unmousedown'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 图层外单击按下时触发</span></span><br><span class="line">layer.on(<span class="string">'uncontextmenu'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 图层外点击右键</span></span><br><span class="line">layer.on(<span class="string">'unpick'</span>, (ev) =&gt; &#123;&#125;); <span class="comment">// 图层外的操作的所有事件</span></span><br></pre></td></tr></table></figure>
<p><strong>inited 图层事件</strong></p>
<p>参数 option</p>
<ul>
<li>target 当前 layer</li>
<li>type 事件类型</li>
</ul>
<p>图层初始化完成后触发</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.on(<span class="string">'inited'</span>, (option) =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>add 图层事件</strong></p>
<p>图层添加到 scene</p>
<p>参数 option</p>
<ul>
<li>target 当前 layer</li>
<li>type 事件类型</li>
</ul>
<p><strong>remove 图层事件</strong></p>
<p>图层移除时触发</p>
<p>参数 option</p>
<ul>
<li><p>target 当前 layer</p>
</li>
<li><p>type 事件类</p>
</li>
</ul>
<h4 id="5-2-点图层"><a href="#5-2-点图层" class="headerlink" title="5.2 点图层"></a>5.2 点图层</h4><h5 id="5-2-1-PointLayer-介绍"><a href="#5-2-1-PointLayer-介绍" class="headerlink" title="5.2.1 PointLayer 介绍"></a>5.2.1 PointLayer 介绍</h5><p>点数据的展示，数据源支持 JSON,GeoJSON,CSV 三种数据格式。</p>
<p>shape 支持</p>
<ul>
<li>3D 类型 柱图</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;cylinder&apos;, &apos;triangleColumn&apos;, &apos;hexagonColumn&apos;, &apos;squareColumn&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>2D 符号图**</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;circle&apos;, &apos;square&apos;, &apos;hexagon&apos;, &apos;triangle&apos;，  &apos;pentagon&apos;,  &apos;octogon&apos;, &apos;hexagram&apos;,&apos;rhombus&apos;,  &apos;vesica&apos;</span><br></pre></td></tr></table></figure>
<p>基本图形代码示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PointLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; PointLayer &#125; from 'cci-layers'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> layer = PointLayer(&#123;</span><br><span class="line">  zIndex: <span class="number">2</span>,</span><br><span class="line">&#125;)</span><br><span class="line">  .source(data.list, &#123;</span><br><span class="line">    type: <span class="string">'array'</span>,</span><br><span class="line">    x: <span class="string">'j'</span>,</span><br><span class="line">    y: <span class="string">'w'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .shape(<span class="string">'cylinder'</span>)</span><br><span class="line">  .size(<span class="string">'t'</span>, (level) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">4</span>, <span class="number">4</span>, level + <span class="number">40</span>];</span><br><span class="line">  &#125;)</span><br><span class="line">  .color(<span class="string">'t'</span>, [</span><br><span class="line">    <span class="string">'#002466'</span>,</span><br><span class="line">    <span class="string">'#105CB3'</span>,</span><br><span class="line">    <span class="string">'#2894E0'</span>,</span><br><span class="line">    <span class="string">'#CFF6FF'</span>,</span><br><span class="line">    <span class="string">'#FFF5B8'</span>,</span><br><span class="line">    <span class="string">'#FFAB5C'</span>,</span><br><span class="line">    <span class="string">'#F27049'</span>,</span><br><span class="line">    <span class="string">'#730D1C'</span>,</span><br><span class="line">  ])</span><br></pre></td></tr></table></figure>
<h5 id="5-2-2-气泡图"><a href="#5-2-2-气泡图" class="headerlink" title="5.2.2 气泡图"></a>5.2.2 气泡图</h5><h6 id="5-2-2-1-基础使用"><a href="#5-2-2-1-基础使用" class="headerlink" title="5.2.2.1 基础使用"></a>5.2.2.1 基础使用</h6><p>气泡图通过 PointLayer 对象实例化，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PointLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; PointLayer &#125; from 'cci-layers'</span></span><br></pre></td></tr></table></figure>
<h6 id="5-2-2-2-shape"><a href="#5-2-2-2-shape" class="headerlink" title="5.2.2.2 shape"></a>5.2.2.2 shape</h6><p>通常气泡图 shape 设置为 <strong>circle</strong></p>
<h6 id="5-2-2-3-size"><a href="#5-2-2-3-size" class="headerlink" title="5.2.2.3 size"></a>5.2.2.3 size</h6><p>气泡图大小，需要指定数据映射字段</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bubble = <span class="keyword">new</span> PointLayer()</span><br><span class="line">  .source(data)</span><br><span class="line">  .shape(circle)</span><br><span class="line">  .size(<span class="string">'mag'</span>, [<span class="number">0</span>, <span class="number">25</span>])</span><br><span class="line">  .color(<span class="string">'red'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">0.3</span>,</span><br><span class="line">    strokeWidth: <span class="number">1</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-2-2-4-animate"><a href="#5-2-2-4-animate" class="headerlink" title="5.2.2.4 animate"></a>5.2.2.4 animate</h6><p>气泡图支持水波动画效果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启关闭动画</span></span><br><span class="line">layer.animate(<span class="literal">true</span>);</span><br><span class="line">layer.animate(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<h6 id="5-2-2-5-水波配置项"><a href="#5-2-2-5-水波配置项" class="headerlink" title="5.2.2.5 水波配置项"></a>5.2.2.5 水波配置项</h6><ul>
<li>speed 水波速度</li>
<li>rings 水波环数</li>
</ul>
<h6 id="5-2-2-6-tips"><a href="#5-2-2-6-tips" class="headerlink" title="5.2.2.6 tips"></a>5.2.2.6 tips</h6><p>目前 style 的配置项只支持全局设置，不支持数据映射。</p>
<p>如果 opacity 设置为 0.3 则所有的气泡都是 0.3</p>
<p>style 方法如果没有设置 stroke, 默认于气泡的填充色相同</p>
<h5 id="5-2-3-散点图"><a href="#5-2-3-散点图" class="headerlink" title="5.2.3 散点图"></a>5.2.3 散点图</h5><p>在地理区域上放置相等大小的圆点，用来表示地域上的空间布局或数据分布。</p>
<h6 id="5-2-3-1-使用"><a href="#5-2-3-1-使用" class="headerlink" title="5.2.3.1 使用"></a>5.2.3.1 使用</h6><p>散点图通过 PointLayer 对象实例化</p>
<h6 id="5-2-3-2-shape"><a href="#5-2-3-2-shape" class="headerlink" title="5.2.3.2 shape"></a>5.2.3.2 shape</h6><ul>
<li>circle</li>
<li>square</li>
<li>hexagon</li>
<li>triangle</li>
<li>pentagon</li>
<li>octogon</li>
<li>hexagram</li>
<li>rhombus</li>
<li>vesica</li>
</ul>
<p>散点图 shape 一般设置成常量</p>
<h6 id="5-2-3-3-color"><a href="#5-2-3-3-color" class="headerlink" title="5.2.3.3 color"></a>5.2.3.3 color</h6><p>color 可以根据数据的差异设置成不同颜色，表示数据的不同分类。</p>
<h6 id="5-2-3-4-size"><a href="#5-2-3-4-size" class="headerlink" title="5.2.3.4 size"></a>5.2.3.4 size</h6><p>散点图一般等大小的图形, size 一般设置成常量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scatter = <span class="keyword">new</span> PointLayer()</span><br><span class="line">  .source(data)</span><br><span class="line">  .shape(circle)</span><br><span class="line">  .size(<span class="number">5</span>)</span><br><span class="line">  .color(<span class="string">'red'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">0.3</span>,</span><br><span class="line">    strokeWidth: <span class="number">1</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h5 id="5-2-4-亮度图"><a href="#5-2-4-亮度图" class="headerlink" title="5.2.4 亮度图"></a>5.2.4 亮度图</h5><p>亮度图又称点密度图，单位面积的内点的个数越多，亮度会越亮，亮度图一般用来表达海量点数据分布情况</p>
<h6 id="5-2-4-1-shape"><a href="#5-2-4-1-shape" class="headerlink" title="5.2.4.1 shape"></a>5.2.4.1 shape</h6><ul>
<li>dot 如果需要使用亮度图可以将 shape 设置为 dot,或者不设置 shape</li>
</ul>
<h6 id="5-2-4-2-color"><a href="#5-2-4-2-color" class="headerlink" title="5.2.4.2 color"></a>5.2.4.2 color</h6><ul>
<li>无权重 如果数据没有权重可以将颜色设置为常量，渲染时会自动进行颜色叠加，点越多颜色越亮</li>
<li>有权重 如果数据有权重可以设置一组同一色相，不同亮度的色带，值越大亮度会越亮。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pointLayer = <span class="keyword">new</span> PointLayer()</span><br><span class="line">  .source(data)</span><br><span class="line">  .size(<span class="number">2</span>)</span><br><span class="line">  .shape(<span class="string">'dot'</span>)</span><br><span class="line">  .color(<span class="string">'h8'</span>, [</span><br><span class="line">    <span class="string">'#0A3663'</span>,</span><br><span class="line">    <span class="string">'#1558AC'</span>,</span><br><span class="line">    <span class="string">'#3771D9'</span>,</span><br><span class="line">    <span class="string">'#4D89E5'</span>,</span><br><span class="line">    <span class="string">'#64A5D3'</span>,</span><br><span class="line">    <span class="string">'#72BED6'</span>,</span><br><span class="line">    <span class="string">'#83CED6'</span>,</span><br><span class="line">    <span class="string">'#A6E1E0'</span>,</span><br><span class="line">    <span class="string">'#B8EFE2'</span>,</span><br><span class="line">    <span class="string">'#D7F9F0'</span>,</span><br><span class="line">  ])</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">1</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">scene.addLayer(pointLayer);</span><br></pre></td></tr></table></figure>
<h5 id="5-2-5-符号图"><a href="#5-2-5-符号图" class="headerlink" title="5.2.5 符号图"></a>5.2.5 符号图</h5><p>在地理区域上放置不同图片作为符号，通常表示不同地理要素分布情况</p>
<h6 id="5-2-5-1-使用"><a href="#5-2-5-1-使用" class="headerlink" title="5.2.5.1 使用"></a>5.2.5.1 使用</h6><p>符号图 通过 PointLayer 对象实例化，将 shape 设置成图片符号</p>
<h6 id="5-2-5-2-shape"><a href="#5-2-5-2-shape" class="headerlink" title="5.2.5.2 shape"></a>5.2.5.2 shape</h6><p>通过 scene addImage 方法</p>
<p>addImage() 参数：</p>
<ul>
<li>id 图片的 id,</li>
<li>url 图片的 url</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scene.addImage(</span><br><span class="line">  <span class="string">'00'</span>,</span><br><span class="line">  <span class="string">'https://gw.alipayobjects.com/zos/basement_prod/604b5e7f-309e-40db-b95b-4fac746c5153.svg'</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>⚠️ 符号图的 ID 不能与点图层已有 shape 名称相同，比如不能设置 circle</p>
<p>符号图需要把 shape 设置成图片的 id，同样符号图 shape 也支持数据映射</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scatter = <span class="keyword">new</span> PointLayer()</span><br><span class="line">  .source(data)</span><br><span class="line">  .shape(<span class="string">'00'</span>)</span><br><span class="line">  .size(<span class="number">5</span>)</span><br><span class="line">  .color(<span class="string">'red'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">0.3</span>,</span><br><span class="line">    strokeWidth: <span class="number">1</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h5 id="5-2-6-文本标注"><a href="#5-2-6-文本标注" class="headerlink" title="5.2.6 文本标注"></a>5.2.6 文本标注</h5><p>为图层添加文本标注</p>
<h6 id="5-2-6-1-使用"><a href="#5-2-6-1-使用" class="headerlink" title="5.2.6.1 使用"></a>5.2.6.1 使用</h6><p>地图标注需要添加一个新的图层的实现</p>
<h6 id="5-2-6-2-shape"><a href="#5-2-6-2-shape" class="headerlink" title="5.2.6.2 shape"></a>5.2.6.2 shape</h6><ul>
<li>field 标注的字段名称</li>
<li>shapeType ‘text’</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.shape(<span class="string">'name'</span>, <span class="string">'text'</span>);</span><br></pre></td></tr></table></figure>
<h6 id="5-2-6-3-style"><a href="#5-2-6-3-style" class="headerlink" title="5.2.6.3 style"></a>5.2.6.3 style</h6><ul>
<li>opacity <code>number</code></li>
<li>textAnchor <code>string</code> 文本相对锚点的位置 <code>&#39;right&#39; | &#39;top-right&#39; | &#39;left&#39; | &#39;bottom-right&#39; | &#39;left&#39; | &#39;top-left&#39; | &#39;bottom-left&#39; | &#39;bottom&#39; | &#39;bottom-right&#39; | &#39;bottom-left&#39; | &#39;top&#39; | &#39;top-right&#39; | &#39;top-left&#39; | &#39;center&#39;;</code></li>
<li>padding: <code>number</code> 文本包围盒 padding [水平，垂直]，影响碰撞检测结果，避免相邻文本靠的太近</li>
<li>spacing: number 文本间隔</li>
<li>stroke: <code>string</code>; 描边颜色</li>
<li>strokeWidth <code>number</code> 描边宽度</li>
<li>strokeOpacity <code>number</code> 描边透明度</li>
<li>fontWeight <code>string</code> 字体粗细</li>
<li>fontFamily <code>string</code> 字号</li>
<li>textOffset <code>[number, number]</code> 文本偏移量</li>
<li>textAllowOverlap: <code>boolean</code> 是否允许文字遮盖</li>
</ul>
<h5 id="5-2-7-聚合图"><a href="#5-2-7-聚合图" class="headerlink" title="5.2.7 聚合图"></a>5.2.7 聚合图</h5><h6 id="5-2-7-1-使用"><a href="#5-2-7-1-使用" class="headerlink" title="5.2.7.1 使用"></a>5.2.7.1 使用</h6><p>目前只有点数据支持聚类方法</p>
<p>数据聚合主要从数据层数据，因此需要在 Source 方法配置 cluster 参数</p>
<h6 id="5-2-7-2-Source"><a href="#5-2-7-2-Source" class="headerlink" title="5.2.7.2 Source"></a>5.2.7.2 Source</h6><p>参见数据 source 部分</p>
<h6 id="5-2-7-3-配置项"><a href="#5-2-7-3-配置项" class="headerlink" title="5.2.7.3 配置项"></a>5.2.7.3 配置项</h6><ul>
<li>cluster <strong>boolean</strong> 是否聚合</li>
<li>clusterOption 聚合配置项<ul>
<li>radius 聚合半径 <strong>number</strong> default 40</li>
<li>minZoom: 最小聚合缩放等级 <strong>number</strong> default 0</li>
<li>maxZoom: 最大聚合缩放等级 <strong>number</strong> default 16</li>
</ul>
</li>
</ul>
<p>数据聚合之后，数据会增加 point<em>count 属性，在可视化渲染时可以根据 point</em>count 进行数据映射。</p>
<h6 id="5-2-7-4-方法"><a href="#5-2-7-4-方法" class="headerlink" title="5.2.7.4 方法"></a>5.2.7.4 方法</h6><ul>
<li><strong>getClusters(zoom: number)</strong></li>
</ul>
<p>获取指定缩放等级的聚合数据</p>
<p>参数：zoom 缩放等级</p>
<ul>
<li><strong>getClustersLeaves(id: string)</strong></li>
</ul>
<p>根据 id 获取聚合节点的数据，每个聚合节点会有一个唯一 ID</p>
<p>参数：id 聚合数据 id</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">layer.source(pointsData, &#123;</span><br><span class="line">  cluster: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置配置项</span></span><br><span class="line">layer.source(pointsData, &#123;</span><br><span class="line">  cluster: <span class="literal">true</span>,</span><br><span class="line">  clusterOption: &#123;</span><br><span class="line">    radius: <span class="number">40</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>getClustersLeaves </strong></li>
</ul>
<p>获取聚合节点的原始数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = layer.getSource();</span><br><span class="line">source.getClustersLeaves(id);</span><br><span class="line">layer.on(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(source.getClustersLeaves(e.feature.cluster_id));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-2-7-5-tips"><a href="#5-2-7-5-tips" class="headerlink" title="5.2.7.5 tips"></a>5.2.7.5 tips</h6><p>PointLayer 的聚合图采用 WebGL 绘制，不支持自定义具体聚合样式，如果有自定义的需求可以使用 MarkerLayer 的聚合功能，你可以通过 Dom 完全自定义样式</p>
<h5 id="5-2-8-3D-柱状图"><a href="#5-2-8-3D-柱状图" class="headerlink" title="5.2.8 3D 柱状图"></a>5.2.8 3D 柱状图</h5><p>3D 柱图地理区域上方会显示不同高度的柱体，主题的高度与其在数据集中的数值会成正比。</p>
<h6 id="5-2-8-1-使用"><a href="#5-2-8-1-使用" class="headerlink" title="5.2.8.1 使用"></a>5.2.8.1 使用</h6><p>3D 柱图通过 PointLayer 对象实例化，将 shape 设置成不同的 3Dshape</p>
<h6 id="5-2-8-2-shape"><a href="#5-2-8-2-shape" class="headerlink" title="5.2.8.2 shape"></a>5.2.8.2 shape</h6><p>3D Shape 支持</p>
<ul>
<li>cylinder</li>
<li>triangleColumn</li>
<li>hexagonColumn</li>
<li>squareColumn</li>
</ul>
<h6 id="5-2-8-3-size"><a href="#5-2-8-3-size" class="headerlink" title="5.2.8.3 size"></a>5.2.8.3 size</h6><p>3D 柱图 size 需要设置三个维度 [w, l, z]</p>
<ul>
<li>w 宽</li>
<li>l 长</li>
<li>z 高度</li>
</ul>
<p>size 设置成常量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.size([2,2,3])</span><br></pre></td></tr></table></figure>
<p>size 回调函数设置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> layer.size(<span class="string">'unit_price'</span>, h =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> [ <span class="number">6</span>, <span class="number">6</span>, h / <span class="number">500</span> ];</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">const</span> column = <span class="keyword">new</span> PointLayer(&#123;&#125;)</span><br><span class="line">  .source(data)</span><br><span class="line">  .shape(<span class="string">'name'</span>, [</span><br><span class="line">    <span class="string">'cylinder'</span>,</span><br><span class="line">    <span class="string">'triangleColumn'</span>,</span><br><span class="line">    <span class="string">'hexagonColumn'</span>,</span><br><span class="line">    <span class="string">'squareColumn'</span>,</span><br><span class="line">  ])</span><br><span class="line">  .size(<span class="string">'unit_price'</span>, (h) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">6</span>, <span class="number">6</span>, h / <span class="number">500</span>];</span><br><span class="line">  &#125;)</span><br><span class="line">  .color(<span class="string">'name'</span>, [<span class="string">'#5B8FF9'</span>, <span class="string">'#70E3B5'</span>, <span class="string">'#FFD458'</span>, <span class="string">'#FF7C6A'</span>])</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">1.0</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="5-3-线图层"><a href="#5-3-线图层" class="headerlink" title="5.3 线图层"></a>5.3 线图层</h4><h5 id="5-3-1-LineLayer"><a href="#5-3-1-LineLayer" class="headerlink" title="5.3.1 LineLayer"></a>5.3.1 LineLayer</h5><h6 id="5-3-1-1-shape"><a href="#5-3-1-1-shape" class="headerlink" title="5.3.1.1 shape"></a>5.3.1.1 shape</h6><p>线图层支持 4 种 shape</p>
<ul>
<li>line 绘制路径图，</li>
<li>arc 绘制弧线 通过贝塞尔曲线算法技术弧线</li>
<li>greatcircle 大圆航线，地图两个点的最近距离不是两个点连线，而是大圆航线</li>
<li>arc3d 3d 弧线地图 3D 视角</li>
</ul>
<p>⚠️ 弧线只需要设置起止点坐标即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">new LineLayer()</span><br><span class="line">.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: &apos;csv&apos;,</span><br><span class="line">    x: &apos;lng1&apos;,</span><br><span class="line">    y: &apos;lat1&apos;,</span><br><span class="line">    x1: &apos;lng2&apos;,</span><br><span class="line">    y1: &apos;lat2&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果 geojson 数据绘制弧线图 coordinates 第一对坐标为起点，第二对为终点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;type&quot;: &quot;FeatureCollection&quot;,</span><br><span class="line">  &quot;features&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;Feature&quot;,</span><br><span class="line">      &quot;properties&quot;: &#123;&#125;,</span><br><span class="line">      &quot;geometry&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;LineString&quot;,</span><br><span class="line">        &quot;coordinates&quot;: [</span><br><span class="line">          [</span><br><span class="line">            106.5234375,</span><br><span class="line">            57.51582286553883</span><br><span class="line">          ],</span><br><span class="line">          [</span><br><span class="line">            136.40625,</span><br><span class="line">            61.77312286453146</span><br><span class="line">          ]</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="5-3-1-2-size"><a href="#5-3-1-2-size" class="headerlink" title="5.3.1.2 size"></a>5.3.1.2 size</h6><p>线图层 可以设置高度</p>
<ul>
<li>size 类型为 number 则表示 line 的宽度</li>
<li>size 类型为 [number , number] 分别表示宽度和高度</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lineLayer.size(<span class="number">1</span>); <span class="comment">// 线的宽度为 1</span></span><br><span class="line">lineLayer.size([<span class="number">1</span>, <span class="number">2</span>]); <span class="comment">// 宽度为1，高度2</span></span><br></pre></td></tr></table></figure>
<h6 id="5-3-1-3-设置渐变色"><a href="#5-3-1-3-设置渐变色" class="headerlink" title="5.3.1.3 设置渐变色"></a>5.3.1.3 设置渐变色</h6><p>线图层通过在 style 中设置起始颜色和终点颜色来设置颜色渐变，渐变色的优先级比 color 方法设置的颜色更高</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> LineLayer(&#123;&#125;)</span><br><span class="line">  .source(data, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'csv'</span>,</span><br><span class="line">      x: <span class="string">'lng1'</span>,</span><br><span class="line">      y: <span class="string">'lat1'</span>,</span><br><span class="line">      x1: <span class="string">'lng2'</span>,</span><br><span class="line">      y1: <span class="string">'lat2'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .size(<span class="number">1</span>)</span><br><span class="line">  .shape(<span class="string">'arc'</span>)</span><br><span class="line">  .color(<span class="string">'#8C1EB2'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    sourceColor: <span class="string">'#f00'</span>,  <span class="comment">// 起点颜色</span></span><br><span class="line">    targetColor: <span class="string">'#0f0'</span>   <span class="comment">// 终点颜色</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-3-1-4-animate"><a href="#5-3-1-4-animate" class="headerlink" title="5.3.1.4 animate"></a>5.3.1.4 animate</h6><p>开启关闭动画</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">layer.animate(<span class="literal">true</span>);</span><br><span class="line">layer.animate(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>设置动画参数</p>
<ul>
<li>duration 动画时间 单位(s)秒</li>
<li>interval 轨迹间隔, 取值区间 0 - 1</li>
<li>trailLength 轨迹长度 取值区间 0 - 1</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">layer.animate(&#123;</span><br><span class="line">  duration: <span class="number">4</span>,</span><br><span class="line">  interval: <span class="number">0.2</span>,</span><br><span class="line">  trailLength: <span class="number">0.1</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>参数动画介绍</p>
<p>目前动画参数为相对单位，我们默认一条线段的长度为 1 <img src="https://gw.alipayobjects.com/mdn/rms_855bab/afts/img/A*IBBfSIkb51cAAAAAAAAAAABkARQnAQ" alt="L7 动画参数"></p>
<p>如果 interval = 0.2,则一条轨迹将会分成 5 段，如果 interval = 0.5 则为两段。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> LineLayer(&#123;&#125;)</span><br><span class="line">  .source(data, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'csv'</span>,</span><br><span class="line">      x: <span class="string">'lng1'</span>,</span><br><span class="line">      y: <span class="string">'lat1'</span>,</span><br><span class="line">      x1: <span class="string">'lng2'</span>,</span><br><span class="line">      y1: <span class="string">'lat2'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .size(<span class="number">1</span>)</span><br><span class="line">  .shape(<span class="string">'arc'</span>)</span><br><span class="line">  .color(<span class="string">'#8C1EB2'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">0.8</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h5 id="5-3-2-弧线图"><a href="#5-3-2-弧线图" class="headerlink" title="5.3.2 弧线图"></a>5.3.2 弧线图</h5><h6 id="5-3-2-1-数据"><a href="#5-3-2-1-数据" class="headerlink" title="5.3.2.1 数据"></a>5.3.2.1 数据</h6><p>绘制弧线只需提供起止点坐标即可（起止点调换位置，弧线的形状会对称相反，飞线动画的方向也会相反）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'csv'</span>,</span><br><span class="line">    x: <span class="string">'lng1'</span>,</span><br><span class="line">    y: <span class="string">'lat1'</span>,</span><br><span class="line">    x1: <span class="string">'lng2'</span>,</span><br><span class="line">    y1: <span class="string">'lat2'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-3-2-2-shape"><a href="#5-3-2-2-shape" class="headerlink" title="5.3.2.2 shape"></a>5.3.2.2 shape</h6><p>弧线支持三种弧线算法</p>
<ul>
<li>arc 绘制弧线 通过贝塞尔曲线算法技术弧线</li>
<li>greatcircle 大圆航线，地图两个点的最近距离不是两个点连线，而是大圆航线</li>
<li>arc3d 3d 弧线地图 3D 视角</li>
</ul>
<h6 id="5-3-2-3-animate"><a href="#5-3-2-3-animate" class="headerlink" title="5.3.2.3 animate"></a>5.3.2.3 animate</h6><p>参见线图层通用 animate 设置</p>
<h6 id="5-3-2-4-示例代码"><a href="#5-3-2-4-示例代码" class="headerlink" title="5.3.2.4 示例代码"></a>5.3.2.4 示例代码</h6><p>弧线地图</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, LineLayer, Mapbox &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map';</span></span><br><span class="line"><span class="comment">// import &#123; PointLayer &#125; from 'cci-layers';</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> Mapbox(&#123;</span><br><span class="line">    style: <span class="string">'dark'</span>,</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    center: [ <span class="number">107.77791556935472</span>, <span class="number">35.443286920228644</span> ],</span><br><span class="line">    zoom: <span class="number">2.9142882493605033</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  fetch(<span class="string">'https://gw.alipayobjects.com/os/rmsportal/UEXQMifxtkQlYfChpPwT.txt'</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.text())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> layer = <span class="keyword">new</span> LineLayer(&#123;&#125;)</span><br><span class="line">        .source(data, &#123;</span><br><span class="line">          parser: &#123;</span><br><span class="line">            type: <span class="string">'csv'</span>,</span><br><span class="line">            x: <span class="string">'lng1'</span>,</span><br><span class="line">            y: <span class="string">'lat1'</span>,</span><br><span class="line">            x1: <span class="string">'lng2'</span>,</span><br><span class="line">            y1: <span class="string">'lat2'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .size(<span class="number">1</span>)</span><br><span class="line">        .shape(<span class="string">'arc'</span>)</span><br><span class="line">        .color(<span class="string">'#8C1EB2'</span>)</span><br><span class="line">        .style(&#123;</span><br><span class="line">          opacity: <span class="number">0.8</span>,</span><br><span class="line">          blur: <span class="number">0.99</span></span><br><span class="line">        &#125;);</span><br><span class="line">      scene.addLayer(layer);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="5-3-3-路径图"><a href="#5-3-3-路径图" class="headerlink" title="5.3.3 路径图"></a>5.3.3 路径图</h5><h6 id="5-3-3-1-shape"><a href="#5-3-3-1-shape" class="headerlink" title="5.3.3.1 shape"></a>5.3.3.1 shape</h6><p>shape 设置成 line 即可绘制路线图</p>
<ul>
<li>line</li>
</ul>
<h6 id="5-3-3-2-size"><a href="#5-3-3-2-size" class="headerlink" title="5.3.3.2 size"></a>5.3.3.2 size</h6><p>路径图线的 size 支持两个维度</p>
<ul>
<li>width 宽度</li>
<li>height 高度</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">layer.size([<span class="number">2</span>, <span class="number">10</span>]); <span class="comment">// 绘制宽度为2，高度为10的路径</span></span><br><span class="line"></span><br><span class="line">layer.size(<span class="string">'height'</span>, []);</span><br></pre></td></tr></table></figure>
<h4 id="5-4-面图层"><a href="#5-4-面图层" class="headerlink" title="5.4 面图层"></a>5.4 面图层</h4><h5 id="5-4-1-PolygonLayer"><a href="#5-4-1-PolygonLayer" class="headerlink" title="5.4.1 PolygonLayer"></a>5.4.1 PolygonLayer</h5><p>绘制 2D 多边形以及沿 Z 轴拉伸后的 3D 图形。</p>
<h6 id="5-4-1-1-使用"><a href="#5-4-1-1-使用" class="headerlink" title="5.4.1.1 使用"></a>5.4.1.1 使用</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PolygonLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br></pre></td></tr></table></figure>
<h6 id="5-4-1-2-shape"><a href="#5-4-1-2-shape" class="headerlink" title="5.4.1.2 shape"></a>5.4.1.2 shape</h6><p>填充图支持 3 种 shape</p>
<ul>
<li>fill 绘制填充面 不支持数据映射</li>
<li>line 绘制填充图描边 不支持数据映射</li>
<li>extrude 对填充图 3D 拉伸 不支持数据映射</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PolyonLayer.shape(<span class="string">'fill'</span>);</span><br><span class="line">PolyonLayer.shape(<span class="string">'line'</span>).size(<span class="number">1</span>); <span class="comment">// size 表示线宽度</span></span><br><span class="line">PolyonLayer.shape(<span class="string">'extrude'</span>).size(<span class="number">10</span>); <span class="comment">// size 表示高度</span></span><br></pre></td></tr></table></figure>
<h5 id="5-4-2-3D填充图"><a href="#5-4-2-3D填充图" class="headerlink" title="5.4.2 3D填充图"></a>5.4.2 3D填充图</h5><h6 id="5-4-2-1-使用"><a href="#5-4-2-1-使用" class="headerlink" title="5.4.2.1 使用"></a>5.4.2.1 使用</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PolygonLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> PolygonLayer();</span><br></pre></td></tr></table></figure>
<h6 id="5-4-2-2-shape"><a href="#5-4-2-2-shape" class="headerlink" title="5.4.2.2 shape"></a>5.4.2.2 shape</h6><p>3D Polygon 将多边形沿 Z 轴向上拉伸</p>
<ul>
<li>extrude 常量不支持数据映射</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.shape(<span class="string">'extrude'</span>);</span><br></pre></td></tr></table></figure>
<h6 id="5-4-2-3-size"><a href="#5-4-2-3-size" class="headerlink" title="5.4.2.3 size"></a>5.4.2.3 size</h6><p>size 代表拉伸的高度，支持数据映射</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">layer.size(<span class="number">10</span>); <span class="comment">// 高度设置成常量</span></span><br><span class="line">layer.size(<span class="string">'floor'</span>, [<span class="number">0</span>, <span class="number">2000</span>]); <span class="comment">// 根据floor字段进行数据映射默认为线</span></span><br><span class="line">layer.size(<span class="string">'floor'</span>, (floor) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 通过回调函数设置size</span></span><br><span class="line">  <span class="keyword">return</span> floor * <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="5-4-3-填充图"><a href="#5-4-3-填充图" class="headerlink" title="5.4.3 填充图"></a>5.4.3 填充图</h5><h6 id="5-4-3-1-使用"><a href="#5-4-3-1-使用" class="headerlink" title="5.4.3.1 使用"></a>5.4.3.1 使用</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PolygonLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; PointLayer &#125; from 'cci-layers';</span></span><br><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> PolygonLayer();</span><br></pre></td></tr></table></figure>
<h6 id="5-4-3-2-shape"><a href="#5-4-3-2-shape" class="headerlink" title="5.4.3.2 shape"></a>5.4.3.2 shape</h6><p>绘制填充图，shape 为<code>fill</code> 常量不支持数据映射</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.shape(<span class="string">'fill'</span>);</span><br></pre></td></tr></table></figure>
<h6 id="5-4-3-3-size"><a href="#5-4-3-3-size" class="headerlink" title="5.4.3.3 size"></a>5.4.3.3 size</h6><p>填充图无 size 不需要设置 size</p>
<h4 id="5-5-城市建筑"><a href="#5-5-城市建筑" class="headerlink" title="5.5 城市建筑"></a>5.5 城市建筑</h4><h5 id="5-5-1-使用"><a href="#5-5-1-使用" class="headerlink" title="5.5.1 使用"></a>5.5.1 使用</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CityBuildingLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; CityBuildingLayer &#125; from 'cci-layers';</span></span><br></pre></td></tr></table></figure>
<h5 id="5-5-2-style"><a href="#5-5-2-style" class="headerlink" title="5.5.2 style"></a>5.5.2 style</h5><ul>
<li>baseColor 楼房颜色,</li>
<li>windowColor: 窗户颜色,</li>
<li>brightColor: 点亮窗户颜色</li>
</ul>
<p>其他 style 配置项同图层基类 style 配置</p>
<h5 id="5-5-3-animate"><a href="#5-5-3-animate" class="headerlink" title="5.5.3 animate"></a>5.5.3 animate</h5><p>开启动画效果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.animate(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>自定义动画频率需 关闭默认动画，通过 setLight 方法不断更新时间</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.animate(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>setLight(time)</strong></li>
</ul>
<p>参数 time : 时间 毫秒</p>
<h5 id="5-5-4-完整代码"><a href="#5-5-4-完整代码" class="headerlink" title="5.5.4 完整代码"></a>5.5.4 完整代码</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pointLayer = <span class="keyword">new</span> CityBuildingLayer();</span><br><span class="line">pointLayer</span><br><span class="line">  .source(<span class="keyword">await</span> response.json())</span><br><span class="line">  .size(<span class="string">'floor'</span>, [<span class="number">0</span>, <span class="number">500</span>])</span><br><span class="line">  .color(<span class="string">'rgba(242,246,250,1.0)'</span>)</span><br><span class="line">  .animate(&#123;</span><br><span class="line">    enable: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    opacity: <span class="number">1.0</span>,</span><br><span class="line">    baseColor: <span class="string">'rgb(16,16,16)'</span>,</span><br><span class="line">    windowColor: <span class="string">'rgb(30,60,89)'</span>,</span><br><span class="line">    brightColor: <span class="string">'rgb(255,176,38)'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">scene.addLayer(pointLayer);</span><br></pre></td></tr></table></figure>
<h4 id="5-6-图片图层"><a href="#5-6-图片图层" class="headerlink" title="5.6 图片图层"></a>5.6 图片图层</h4><p>将图片添加到地图上，需要指定图片的经纬度范围</p>
<h5 id="5-6-1-使用"><a href="#5-6-1-使用" class="headerlink" title="5.6.1 使用"></a>5.6.1 使用</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ImageLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; ImageLayer &#125; from 'cci-layers'</span></span><br></pre></td></tr></table></figure>
<h5 id="5-6-2-代码示例"><a href="#5-6-2-代码示例" class="headerlink" title="5.6.2 代码示例"></a>5.6.2 代码示例</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> ImageLayer(&#123;&#125;);</span><br><span class="line">layer.source(</span><br><span class="line">  <span class="string">'https://gw.alipayobjects.com/zos/rmsportal/FnHFeFklTzKDdUESRNDv.jpg'</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'image'</span>,</span><br><span class="line">      extent: [<span class="number">121.168</span>, <span class="number">30.2828</span>, <span class="number">121.384</span>, <span class="number">30.4219</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="5-7-栅格图层"><a href="#5-7-栅格图层" class="headerlink" title="5.7 栅格图层"></a>5.7 栅格图层</h4><p>Raster 图层主要实现栅格数据的可视化，栅格数据主要来源是卫星遥感数据，如数字高程图，植被分布图，夜光图。</p>
<p>外部需要提前对栅格数据格式 如 tiff 进行解析，好做为 Source 传入。</p>
<h5 id="5-7-1-使用"><a href="#5-7-1-使用" class="headerlink" title="5.7.1 使用"></a>5.7.1 使用</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RasterLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; RasterLayer &#125; from 'cci-layers'</span></span><br></pre></td></tr></table></figure>
<h5 id="5-7-2-source"><a href="#5-7-2-source" class="headerlink" title="5.7.2 source"></a>5.7.2 source</h5><p>参见数据 source 的 raster 部分</p>
<h5 id="5-7-3-shape"><a href="#5-7-3-shape" class="headerlink" title="5.7.3 shape"></a>5.7.3 shape</h5><p>raster</p>
<h5 id="5-7-4-size"><a href="#5-7-4-size" class="headerlink" title="5.7.4 size"></a>5.7.4 size</h5><p>无</p>
<h5 id="5-7-5-color"><a href="#5-7-5-color" class="headerlink" title="5.7.5 color"></a>5.7.5 color</h5><p>无</p>
<h5 id="5-7-6-style"><a href="#5-7-6-style" class="headerlink" title="5.7.6 style"></a>5.7.6 style</h5><ul>
<li><p>clampLow Boolean 默认 false, 设置为 true，低于 domain 的数据将不显示</p>
</li>
<li><p>clampHigh Boolean 默认 false, 设置为 true，高于 domain 的数据将不显示</p>
</li>
<li><p>opacity: 0.8 Number 透明度</p>
</li>
<li><p>domain: [ 0, 8000 ] 数据映射区间</p>
</li>
<li><p>noDataValue Number noDataValue 不会显示</p>
</li>
<li><p>rampColors: { colors: [ ‘#FF4818’, ‘#F7B74A’, ‘#FFF598’, ‘#91EABC’, ‘#2EA9A1’, ‘#206C7C’ ], positions: [ 0, 0.2, 0.4, 0.6, 0.8, 1.0 ] } // 色带</p>
<p>⚠️ color, position 的长度要相同</p>
</li>
</ul>
<h4 id="5-8-热力图"><a href="#5-8-热力图" class="headerlink" title="5.8 热力图"></a>5.8 热力图</h4><h5 id="5-8-1-经典热力图"><a href="#5-8-1-经典热力图" class="headerlink" title="5.8.1 经典热力图"></a>5.8.1 经典热力图</h5><h6 id="5-8-1-1-使用"><a href="#5-8-1-1-使用" class="headerlink" title="5.8.1.1 使用"></a>5.8.1.1 使用</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeatmapLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; HeatmapLayer &#125; from 'cci-layers'</span></span><br></pre></td></tr></table></figure>
<h6 id="5-8-1-2-shape"><a href="#5-8-1-2-shape" class="headerlink" title="5.8.1.2 shape"></a>5.8.1.2 shape</h6><p>常量 heatmap</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.shape(<span class="string">'heatmap'</span>);</span><br></pre></td></tr></table></figure>
<h6 id="5-8-1-3-size"><a href="#5-8-1-3-size" class="headerlink" title="5.8.1.3 size"></a>5.8.1.3 size</h6><ul>
<li>field: 热力图权重字段</li>
<li>values: 数据映射区间 热力图显示 [0, 1] 效果最佳</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.size(<span class="string">'weight'</span>, [<span class="number">0</span>, <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<h6 id="5-8-1-4-color"><a href="#5-8-1-4-color" class="headerlink" title="5.8.1.4 color"></a>5.8.1.4 color</h6><p>heatmap 需要设置 color 方法，样式通过 style 设置</p>
<h6 id="5-8-1-5-style"><a href="#5-8-1-5-style" class="headerlink" title="5.8.1.5 style"></a>5.8.1.5 style</h6><ul>
<li><p>intensity  全局热力权重   推荐权重范围 1-5</p>
</li>
<li><p>radius  热力半径，单位像素</p>
</li>
<li><p>rampColors 色带参数</p>
<ul>
<li>colors 颜色数组</li>
<li>positions 数据区间</li>
</ul>
<p>⚠️ color, position 的长度要相同</p>
</li>
</ul>
<h6 id="5-8-1-6-完整代码"><a href="#5-8-1-6-完整代码" class="headerlink" title="5.8.1.6 完整代码"></a>5.8.1.6 完整代码</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">heatmapLayer()</span><br><span class="line">  .source(data)</span><br><span class="line">  .size(<span class="string">'mag'</span>, [<span class="number">0</span>, <span class="number">1</span>]) <span class="comment">// weight映射通道</span></span><br><span class="line">  .style(&#123;</span><br><span class="line">    intensity: <span class="number">3</span>,</span><br><span class="line">    radius: <span class="number">20</span>,</span><br><span class="line">    rampColors: &#123;</span><br><span class="line">      colors: [</span><br><span class="line">        <span class="string">'rgba(33,102,172,0.0)'</span>,</span><br><span class="line">        <span class="string">'rgb(103,169,207)'</span>,</span><br><span class="line">        <span class="string">'rgb(209,229,240)'</span>,</span><br><span class="line">        <span class="string">'rgb(253,219,199)'</span>,</span><br><span class="line">        <span class="string">'rgb(239,138,98)'</span>,</span><br><span class="line">        <span class="string">'rgb(178,24,43,1.0)'</span>,</span><br><span class="line">      ],</span><br><span class="line">      positions: [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.6</span>, <span class="number">0.8</span>, <span class="number">1.0</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h5 id="5-8-2-网格热力图"><a href="#5-8-2-网格热力图" class="headerlink" title="5.8.2 网格热力图"></a>5.8.2 网格热力图</h5><p>将一组点数据按照等大小的正方形网格进行聚合，一个正方形网格代表网格内所有点的统计值。方格热力图特点以方格网布局。</p>
<h6 id="5-8-2-1-使用"><a href="#5-8-2-1-使用" class="headerlink" title="5.8.2.1 使用"></a>5.8.2.1 使用</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeatmapLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; HeatmapLayer &#125; from 'cci-layers'</span></span><br></pre></td></tr></table></figure>
<h6 id="5-8-2-2-source"><a href="#5-8-2-2-source" class="headerlink" title="5.8.2.2 source"></a>5.8.2.2 source</h6><p>网格数据只支持点数据作为数据源，数据格式支持 csv、json、geojson.</p>
<h6 id="5-8-2-3-设置网格聚合参数"><a href="#5-8-2-3-设置网格聚合参数" class="headerlink" title="5.8.2.3 设置网格聚合参数"></a>5.8.2.3 设置网格聚合参数</h6><p>布局方法 通过 source 的 tansforms 属性配置</p>
<ul>
<li>type 数据聚合类型 grid</li>
<li>size 网格半径 单位 米</li>
<li>field 聚合字段</li>
<li>method 聚合方法  count,max,min,sum,mean 5 个统计维度</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'csv'</span>,</span><br><span class="line">    x: <span class="string">'lng'</span>,</span><br><span class="line">    y: <span class="string">'lat'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  transforms: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">'grid'</span>,</span><br><span class="line">      size: <span class="number">15000</span>,</span><br><span class="line">      field: <span class="string">'v'</span>,</span><br><span class="line">      method: <span class="string">'sum'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-8-2-4-shape"><a href="#5-8-2-4-shape" class="headerlink" title="5.8.2.4 shape"></a>5.8.2.4 shape</h6><p>网格热力图虽然是以标准四边形网格进行数据聚合，但是展示效果上可以设置为其形状，形状只支持常量</p>
<p>2d</p>
<ul>
<li>circle,</li>
<li>triangle</li>
<li>square</li>
<li>heaxgon</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.shape(<span class="string">'circle'</span>);</span><br></pre></td></tr></table></figure>
<p>3d</p>
<ul>
<li>cylinder</li>
<li>triangleColumn</li>
<li>hexagonColumn</li>
<li>squareColumn,</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.shape(<span class="string">'cylinder'</span>);</span><br></pre></td></tr></table></figure>
<h6 id="5-8-2-5-size"><a href="#5-8-2-5-size" class="headerlink" title="5.8.2.5 size"></a>5.8.2.5 size</h6><ul>
<li>2D shape</li>
</ul>
<p>不需要设置 size 方法</p>
<ul>
<li>3D 图形</li>
</ul>
<p>size 表示高度, 支持常量和数据映射</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">layer.size(<span class="number">10</span>); <span class="comment">// 常量</span></span><br><span class="line">layer.size(<span class="string">'value'</span>, [<span class="number">10</span>, <span class="number">50</span>]); <span class="comment">// 根据value 字段映射大小</span></span><br><span class="line">layer.size(<span class="string">'value'</span>, (value) =&gt; &#123;&#125;); <span class="comment">// 回调函数设置高度</span></span><br></pre></td></tr></table></figure>
<h6 id="5-8-2-6-color"><a href="#5-8-2-6-color" class="headerlink" title="5.8.2.6 color"></a>5.8.2.6 color</h6><p>同图层基类 color 方法</p>
<h6 id="5-8-2-7-style"><a href="#5-8-2-7-style" class="headerlink" title="5.8.2.7 style"></a>5.8.2.7 style</h6><ul>
<li>coverage 网格覆盖度 0 - 1</li>
<li>angle 网格旋转角度 0 - 360</li>
<li>opacity 透明度 0 - 1.0</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">layer.style(&#123;</span><br><span class="line">  coverage: <span class="number">0.9</span>,</span><br><span class="line">  angle: <span class="number">0</span>,</span><br><span class="line">  opacity: <span class="number">1.0</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-8-2-8-完整实例代码"><a href="#5-8-2-8-完整实例代码" class="headerlink" title="5.8.2.8 完整实例代码"></a>5.8.2.8 完整实例代码</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> HeatmapLayer(&#123;&#125;)</span><br><span class="line">  .source(data, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'csv'</span>,</span><br><span class="line">      x: <span class="string">'lng'</span>,</span><br><span class="line">      y: <span class="string">'lat'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    transforms: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'grid'</span>,</span><br><span class="line">        size: <span class="number">20000</span>,</span><br><span class="line">        field: <span class="string">'v'</span>,</span><br><span class="line">        method: <span class="string">'sum'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;)</span><br><span class="line">  .shape(<span class="string">'square'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    coverage: <span class="number">1</span>,</span><br><span class="line">    angle: <span class="number">0</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .color(<span class="string">'count'</span>, [</span><br><span class="line">    <span class="string">'#0B0030'</span>,</span><br><span class="line">    <span class="string">'#100243'</span>,</span><br><span class="line">    <span class="string">'#100243'</span>,</span><br><span class="line">    <span class="string">'#1B048B'</span>,</span><br><span class="line">    <span class="string">'#051FB7'</span>,</span><br><span class="line">    <span class="string">'#0350C1'</span>,</span><br><span class="line">    <span class="string">'#0350C1'</span>,</span><br><span class="line">    <span class="string">'#0072C4'</span>,</span><br><span class="line">    <span class="string">'#0796D3'</span>,</span><br><span class="line">    <span class="string">'#2BA9DF'</span>,</span><br><span class="line">    <span class="string">'#30C7C4'</span>,</span><br><span class="line">    <span class="string">'#6BD5A0'</span>,</span><br><span class="line">    <span class="string">'#A7ECB2'</span>,</span><br><span class="line">    <span class="string">'#D0F4CA'</span>,</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">scene.addLayer(layer);</span><br></pre></td></tr></table></figure>
<h5 id="5-8-3-蜂窝热力图"><a href="#5-8-3-蜂窝热力图" class="headerlink" title="5.8.3 蜂窝热力图"></a>5.8.3 蜂窝热力图</h5><p>将一组点数据按照等大小的六边形网格进行聚合，一个六边形网格代表网格内所有点的统计值。蜂窝热力图特点以六边形热力图网格布局</p>
<h6 id="5-8-3-1-使用"><a href="#5-8-3-1-使用" class="headerlink" title="5.8.3.1 使用"></a>5.8.3.1 使用</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeatmapLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; HeatmapLayer &#125; from 'cci-layers'</span></span><br></pre></td></tr></table></figure>
<h6 id="5-8-3-2-source"><a href="#5-8-3-2-source" class="headerlink" title="5.8.3.2 source"></a>5.8.3.2 source</h6><p>网格数据只支持点数据作为数据源，数据格式支持 csv、json、geojson.</p>
<h6 id="5-8-3-3-设置网格聚合参数"><a href="#5-8-3-3-设置网格聚合参数" class="headerlink" title="5.8.3.3 设置网格聚合参数"></a>5.8.3.3 设置网格聚合参数</h6><p>布局方法 通过 source 的 tansforms 属性配置</p>
<ul>
<li>type 数据聚合类型 hexagon</li>
<li>size 网格半径 单位 米</li>
<li>field 聚合字段</li>
<li>method 聚合方法 count,max,min,sum,mean 5 个统计维度</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">layer.source(data, &#123;</span><br><span class="line">  parser: &#123;</span><br><span class="line">    type: <span class="string">'csv'</span>,</span><br><span class="line">    x: <span class="string">'lng'</span>,</span><br><span class="line">    y: <span class="string">'lat'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  transforms: [</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">'hexagon'</span>,</span><br><span class="line">      size: <span class="number">15000</span>,</span><br><span class="line">      field: <span class="string">'v'</span>,</span><br><span class="line">      method: <span class="string">'sum'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-8-3-4-shape"><a href="#5-8-3-4-shape" class="headerlink" title="5.8.3.4 shape"></a>5.8.3.4 shape</h6><p>网格热力图虽然是以标准四边形网格进行数据聚合，但是展示效果上可以设置为其形状，形状只支持常量</p>
<p>2d</p>
<ul>
<li>circle,</li>
<li>triangle</li>
<li>square</li>
<li>heaxgon</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.shape(<span class="string">'circle'</span>);</span><br></pre></td></tr></table></figure>
<p>3d</p>
<ul>
<li>cylinder</li>
<li>triangleColumn</li>
<li>hexagonColumn</li>
<li>squareColumn,</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.shape(<span class="string">'cylinder'</span>);</span><br></pre></td></tr></table></figure>
<h6 id="5-8-3-5-size"><a href="#5-8-3-5-size" class="headerlink" title="5.8.3.5 size"></a>5.8.3.5 size</h6><ul>
<li>2D shape</li>
</ul>
<p>不需要设置 size 方法</p>
<ul>
<li>3D 图形</li>
</ul>
<p>size 表示高度, 支持常量和数据映射</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">layer.size(<span class="number">10</span>); <span class="comment">// 常量</span></span><br><span class="line">layer.size(<span class="string">'value'</span>, [<span class="number">10</span>, <span class="number">50</span>]); <span class="comment">// 根据value 字段映射大小</span></span><br><span class="line">layer.size(<span class="string">'value'</span>, (value) =&gt; &#123;&#125;); <span class="comment">// 回调函数设置高度</span></span><br></pre></td></tr></table></figure>
<h6 id="5-8-3-6-color"><a href="#5-8-3-6-color" class="headerlink" title="5.8.3.6 color"></a>5.8.3.6 color</h6><p>同图层基类 color 方法</p>
<h6 id="5-8-3-7-style"><a href="#5-8-3-7-style" class="headerlink" title="5.8.3.7 style"></a>5.8.3.7 style</h6><ul>
<li>coverage 网格覆盖度 0 - 1</li>
<li>angle 网格旋转角度 0 - 360</li>
<li>opacity 透明度 0 - 1.0</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">layer.style(&#123;</span><br><span class="line">  coverage: <span class="number">0.9</span>,</span><br><span class="line">  angle: <span class="number">0</span>,</span><br><span class="line">  opacity: <span class="number">1.0</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="5-8-3-8-完整代码"><a href="#5-8-3-8-完整代码" class="headerlink" title="5.8.3.8 完整代码"></a>5.8.3.8 完整代码</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> HeatmapLayer(&#123;</span><br><span class="line">  zIndex: <span class="number">2</span>,</span><br><span class="line">&#125;)</span><br><span class="line">  .souce(data, &#123;</span><br><span class="line">    parser: &#123;</span><br><span class="line">      type: <span class="string">'csv'</span>,</span><br><span class="line">      x: lng,</span><br><span class="line">      y: lat,</span><br><span class="line">    &#125;,</span><br><span class="line">    transforms: [</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">'hexagon'</span>,</span><br><span class="line">        size: <span class="number">1500</span>,</span><br><span class="line">        field: <span class="string">'count'</span>,</span><br><span class="line">        operation: <span class="string">'sum'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;)</span><br><span class="line">  .shape(<span class="string">'hexagon'</span>)</span><br><span class="line">  .color(<span class="string">'sum'</span>)</span><br><span class="line">  .style(&#123;</span><br><span class="line">    coverage: <span class="number">0.8</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="6-第三方引擎接入"><a href="#6-第三方引擎接入" class="headerlink" title="6 第三方引擎接入"></a>6 第三方引擎接入</h3><ul>
<li><p>支持允许用户接入第三方的渲染引擎对地图场景进行开发，threejs 作为当前最广泛使用的通用 3D 渲染引擎，将其集成后可以满足用户自定义开发的需求。</p>
</li>
<li><p>目前 Three 模块为了抹平不同地图底图之间的差异，提供了一些兼容方法，如 setMeshScale 方法，通过这些方法用户可以在不同的底图 环境中使用同一套代码。</p>
</li>
<li><p>目前提供的适配方法只负责 threejs 世界坐标到不同地图底图坐标的转化、 gl 上下文的共享以及渲染帧的同步，其余关于 3D 场景内容的搭建 与普通 threejs 应用的开发没有任何区别。</p>
</li>
<li><p>本身并没有集成 threejs，所以用于在使用 Three 模块的时候需要独立安装 threejs。</p>
</li>
</ul>
<p>✨ 目前官方提供的 threejs 兼容是根据 0.115.0 版本进行开发的，使用其他版本 threejs 可能会存在兼容问题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、引入对应模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; ThreeLayer, ThreeRender &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span>;</span><br><span class="line"><span class="comment">// import &#123; ThreeLayer, ThreeRender &#125; from 'cci-three'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> THREE <span class="keyword">from</span> <span class="string">'three'</span>;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 2、注册服务</span></span><br><span class="line">scene.registerRenderService(ThreeRender);</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 3、构建 threejs 图层对象并在其中添加 threejs 构建的网格对象</span></span><br><span class="line"><span class="keyword">const</span> threeJSLayer = <span class="keyword">new</span> ThreeLayer(&#123;</span><br><span class="line">  onAddMeshes: <span class="function">(<span class="params">threeScene: THREE.Scene, layer: ThreeLayer</span>) =&gt;</span> &#123;</span><br><span class="line">    threeScene.add(<span class="keyword">new</span> THREE.AmbientLight(<span class="number">0xffffff</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> sunlight = <span class="keyword">new</span> THREE.DirectionalLight(<span class="number">0xffffff</span>, <span class="number">0.25</span>);</span><br><span class="line">    sunlight.position.set(<span class="number">0</span>, <span class="number">80000000</span>, <span class="number">100000000</span>);</span><br><span class="line">    sunlight.matrixWorldNeedsUpdate = <span class="literal">true</span>;</span><br><span class="line">    threeScene.add(sunlight);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> center = scene.getCenter();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> cubeGeometry = <span class="keyword">new</span> THREE.BoxBufferGeometry(<span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>);</span><br><span class="line">    <span class="keyword">let</span> cubeMaterial = <span class="keyword">new</span> THREE.MeshNormalMaterial();</span><br><span class="line">    <span class="keyword">let</span> cube = <span class="keyword">new</span> THREE.Mesh(cubeGeometry, cubeMaterial);</span><br><span class="line"></span><br><span class="line">    layer.setObjectLngLat(cube, [center.lng + <span class="number">0.05</span>, center.lat], <span class="number">0</span>);</span><br><span class="line">    threeScene.add(cube);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">.source(data)</span><br><span class="line">.animate(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、添加 threejs 图层对象</span></span><br><span class="line">scene.addLayer(threeJSLayer);</span><br></pre></td></tr></table></figure>
<p>cci-map 将 threejs 的引用封装成一个特殊的图层对象，在使用上与其他的图层相同。</p>
<h4 id="6-1-构造函数-new-ThreeLayer"><a href="#6-1-构造函数-new-ThreeLayer" class="headerlink" title="6.1 构造函数 new ThreeLayer"></a>6.1 构造函数 new ThreeLayer</h4><p><strong>onAddMeshes</strong></p>
<p>该方法接受两个参数 threeScene: THREE.Scene, layer: ThreeLayer</p>
<ul>
<li>threeScene: 这是普通的 threejs 场景对象</li>
<li>layer: 提供的 threeLayer 对象，上面挂载了 threejs 空间适配到地图空间所需要的方法</li>
</ul>
<h4 id="6-2-ThreeLayer"><a href="#6-2-ThreeLayer" class="headerlink" title="6.2 ThreeLayer"></a>6.2 ThreeLayer</h4><p>用户新建的图层对象，同时也会在 onAddMesh 方法的第二个参数返回。</p>
<p>以下是挂载在 ThreeLayer 实例上的适配方法。</p>
<p><strong>getModelMatrix(lnglat, altitude, rotation, scale): Matrix</strong></p>
<ul>
<li>lnglat: [number, number] 经纬度</li>
<li>altitude: number = 0 相对高度</li>
<li>rotation: [number, number, number] = [0, 0, 0] 旋转角度</li>
<li>scale: [number, number, number] = [1, 1, 1] 缩放比例</li>
</ul>
<p>用户可以通过该方法计算在对应经纬度点位、相对高度、旋转角度和缩放的模型矩阵 该方法的返回值是 THREE.Matrix4 类型的矩阵</p>
<p><strong>applyObjectLngLat(object, lnglat, altibute): void</strong></p>
<ul>
<li>object: Object3D threejs 对象</li>
<li>lnglat: ILngLat[number, number] 经纬度</li>
<li>altitude = 0 相对高度</li>
</ul>
<p>用户可以通过该方法将 object 对象从当前位置向指定位置移动（地图经纬度坐标）</p>
<p><strong>setObjectLngLat(object, lnglat, altibute): void</strong></p>
<ul>
<li>object: Object3D threejs 对象</li>
<li>lnglat: ILngLat[number, number] 经纬度</li>
<li>altitude = 0 相对高度</li>
</ul>
<p>用户可以通过该方法设置 object 对象的位置（地图经纬度坐标）</p>
<p><strong>lnglatToCoord(lnglat): [number, number]</strong></p>
<ul>
<li>lnglat: ILngLat[number, number] 经纬度</li>
</ul>
<p>用户可以通过该方法将经纬度坐标转化成 threejs 世界坐标</p>
<p><strong>adjustMeshToMap(object): void</strong></p>
<ul>
<li>object: Object3D threejs 对象</li>
</ul>
<p>用户在添加 threejs 对象的前可以通过该方法调整 3D 对象的姿态，保证添加对象能正确显示</p>
<p>✨ 在 threejs 世界坐标中，默认的上方向为 Y 轴正方向，而在地图坐标中，默认的上方向为 Z 轴正方向</p>
<p>✨ 用户不一定使用该方法调整物体的姿态，也可以自己实现</p>
<p><strong>setMeshScale(object, x, y, z): void</strong></p>
<ul>
<li>object: Object3D threejs 对象</li>
<li>x: number = 1 x 轴方向的缩放比例</li>
<li>y: number = 1 y 轴方向的缩放比例</li>
<li>z: number = 1 z 轴方向的缩放比例</li>
</ul>
<p>用户可以通过该方法设置 threejs 对象缩放</p>
<p>✨ 其实通过设置 threejs 对象的 scale 属性一样能达到同样的效果，但是由于 mapbox 在计算模型矩阵的时候引入了特殊计算，所以无法直接设置 scale 属性进行缩放</p>
<p>✨ 同样的，可以直接修改 threejs 的 position、rotation 等调整 3D 对象的姿态</p>
<p><strong>addAnimateMixer(mixer): void</strong></p>
<ul>
<li>mixer: AnimationMixer threejs 的动画混合器</li>
</ul>
<p>用户通过该方法管理加载模型的动画</p>
<p><strong>getRenderCamera(): THREE.Camera</strong></p>
<p>返回根据当前地图场景参数下对应的 THREEJS 相机</p>
<h4 id="6-3-加载模型"><a href="#6-3-加载模型" class="headerlink" title="6.3 加载模型"></a>6.3 加载模型</h4><p>用户可以使用 threejs 提供的能力加载其支持的任意模型</p>
<p>✨ 以加载 gltf 模型为例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、引入加载器</span></span><br><span class="line"><span class="keyword">import</span> &#123; GLTFLoader &#125; <span class="keyword">from</span> <span class="string">'three/examples/jsm/loaders/GLTFLoader'</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> threeJSLayer = <span class="keyword">new</span> ThreeLayer(&#123;</span><br><span class="line">  onAddMeshes: <span class="function">(<span class="params">threeScene: THREE.Scene, layer: ThreeLayer</span>) =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 2、构建加载器</span></span><br><span class="line">    <span class="keyword">const</span> loader = <span class="keyword">new</span> GLTFLoader();</span><br><span class="line">    <span class="comment">// 3、加载模型</span></span><br><span class="line">    loader.load(<span class="string">'https://gw.alipayobjects.com/os/bmw-prod/3ca0a546-92d8-4ba0-a89c-017c218d5bea.gltf'</span>,</span><br><span class="line">    (gltf) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> model = gltf.scene;</span><br><span class="line">      layer.adjustMeshToMap(model);</span><br><span class="line">      layer.setMeshScale(model, <span class="number">1000</span>, <span class="number">1000</span>, <span class="number">1000</span>);</span><br><span class="line">      layer.setObjectLngLat( model, [center.lng, center.lat], <span class="number">0</span> );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4、播放模型上绑定的动画</span></span><br><span class="line">      <span class="keyword">const</span> animations = gltf.animations;</span><br><span class="line">      <span class="keyword">if</span> (animations &amp;&amp; animations.length) &#123;</span><br><span class="line">        <span class="keyword">const</span> mixer = <span class="keyword">new</span> THREE.AnimationMixer(model);</span><br><span class="line">        <span class="keyword">const</span> animation = animations[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">const</span> action = mixer.clipAction(animation);</span><br><span class="line">        action.play();</span><br><span class="line">        <span class="comment">// 5、由 cci-map 控制模型动画的播放</span></span><br><span class="line">        layer.addAnimateMixer(mixer);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).source(data)</span><br><span class="line">.animate(<span class="literal">true</span>) <span class="comment">// 若需要播放模型动画，请开启动画模式（或者场景中已经存在开启动画的图层）</span></span><br></pre></td></tr></table></figure>
<h2 id="八、服务"><a href="#八、服务" class="headerlink" title="八、服务"></a>八、服务</h2><h3 id="1-WFS"><a href="#1-WFS" class="headerlink" title="1 WFS"></a>1 WFS</h3><h4 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1.1 介绍"></a>1.1 介绍</h4><p>OGCWebFeatureService（WFS）接口标准定义了一组接口，用于在Internet上访问要素和要素属性级别的地理信息。特征是对现实世界现象的抽象，也就是说，它代表了世界上可以找到的任何事物。地理要素的属性或特征称为要素特性。WFS提供了检索或查询地理要素的方法，这种方法独立于它们发布的底层数据存储。如果WFS被授权这样做，该服务还可以更新或删除地理特征。WFS的实例还能够存储查询，以便使客户机应用程序能够在稍后的时间点检索或执行查询。</p>
<h5 id="1-1-1-历史"><a href="#1-1-1-历史" class="headerlink" title="1.1.1 历史"></a>1.1.1 历史</h5><p>WFS于2002年5月发布了1.0.0版，2005年5月发布了1.1.0版，2010年11月发布了2.0.0版。版本2.0.0是ISO 19142的基础。OGC于2014年7月发布了WFS版本2.0.2。</p>
<h5 id="1-1-2-版本"><a href="#1-1-2-版本" class="headerlink" title="1.1.2 版本"></a>1.1.2 版本</h5><p>2.0.2是当前最新版本</p>
<h5 id="1-1-3-测试套件"><a href="#1-1-3-测试套件" class="headerlink" title="1.1.3 测试套件"></a>1.1.3 测试套件</h5><ul>
<li><a href="https://github.com/opengeospatial/ets-wfs11" target="_blank" rel="noopener">WFS 1.1.0版</a></li>
<li><a href="https://github.com/opengeospatial/ets-wfs20" target="_blank" rel="noopener">WFS 2.0.0版</a></li>
</ul>
<h5 id="1-1-4-使用"><a href="#1-1-4-使用" class="headerlink" title="1.1.4 使用"></a>1.1.4 使用</h5><p>WFS标准通过高度可配置的界面提供地理要素数据。默认情况下，WFS返回的数据使用地理标记语言（GML），GML是作为可扩展标记语言（XML）编写的。不过，该标准的新版本也将支持JavaScript对象表示法（JSON）。政府机构、私人组织和学术机构使用本标准发布矢量地理空间数据集，以便于接收机构编制新地图或对所提供数据进行分析。</p>
<p>WFS为请求由地理要素及其属性组成的矢量地理空间数据提供了一个标准接口。这样做的好处是，WFS客户端可以从多个WFS服务器请求源数据，然后呈现数据以在客户端上显示，或者作为工作流的一部分进一步处理数据。该标准保证使用公共地理空间坐标参考系，可以将数据与其他数据一致地处理。使用常见数据类型（如文本字符串、日期和时间）编码的特性属性也可以得到一致的处理。</p>
<h5 id="1-1-5-与其他OGC标准的关系"><a href="#1-1-5-与其他OGC标准的关系" class="headerlink" title="1.1.5 与其他OGC标准的关系"></a>1.1.5 与其他OGC标准的关系</h5><ul>
<li>OGC网络地图块服务接口标准（WMS）：WMS标准更适合于需要渲染地图而不是源向量数据的地方。</li>
<li>Web地图块服务接口标准（WMTS）：WMTS标准更适合于发出许多并发请求的高度可伸缩系统需要静态呈现的地图。</li>
<li>OGC网络地图块服务接口标准（WCS）：WCS标准更适合于需要源覆盖数据（如栅格图像）的情况。</li>
<li>OGC地理标记语言（GML）：这个标准被WFS用作发布数据的默认编码格式。</li>
</ul>
<h4 id="1-2-WFS-操作概述"><a href="#1-2-WFS-操作概述" class="headerlink" title="1.2 WFS 操作概述"></a>1.2 WFS 操作概述</h4><p>WFS指定了许多不同的操作，所有服务器都需要支持这些操作：</p>
<ul>
<li><p>GetCapabilities</p>
<p>返回一个文档，该文档描述由服务器提供的WFS服务提供的功能和资源。</p>
</li>
<li><p>DescribeFeatureType</p>
<p>返回WFS实例提供或接受的功能类型和功能属性的结构描述。</p>
</li>
<li><p>ListStoredQueries</p>
<p>返回存储在WFS实例中的查询列表。</p>
</li>
<li><p>DescribeStoredQueries</p>
<p>返回存储在WFS实例中的查询的说明。</p>
</li>
<li><p>GetFeature</p>
<p>从通过WFS发布的数据存储中返回要素实例的选择。</p>
</li>
</ul>
<p>WFS服务器还可以提供以下可选操作：</p>
<ul>
<li><p>GetPropertyValue</p>
<p>检索一组要素实例的要素特性值或复杂要素特性值的一部分</p>
</li>
<li><p>GetFeatureWithLock</p>
<p>提供与GetFeature请求类似的功能，但具有锁定特性的附加功能，可能是为了后续更新或更改。</p>
</li>
<li><p>LockFeature</p>
<p>锁定一组要素实例，以便在锁定到位时，其他操作都不能修改数据。</p>
</li>
<li><p>交易</p>
<p>允许插入、更新或删除要素实例及其特性。</p>
</li>
<li><p>CreateStoredQuery</p>
<p>创建并存储一个查询，客户机可以在稍后的时间点快速轻松地触发该查询。</p>
</li>
<li><p>DropStoredQuery</p>
<p>从服务器中删除以前存储的查询</p>
</li>
</ul>
<h4 id="1-3-WFS-操作详细信息"><a href="#1-3-WFS-操作详细信息" class="headerlink" title="1.3 WFS 操作详细信息"></a>1.3 WFS 操作详细信息</h4><p>提供有关WFS服务器提供的操作类型的详细信息。该列表包括由WFS服务器的不同配置（正式称为一致性类）提供的操作。</p>
<table>
<thead>
<tr>
<th><strong>Operation</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GetCapabilities</code></td>
<td>检索有关服务的元数据，包括支持的操作和参数，以及可用功能类型的列表。</td>
</tr>
<tr>
<td><code>DescribeFeatureType</code></td>
<td>返回WFS实例提供或接受的功能类型和功能属性的结构描述。</td>
</tr>
<tr>
<td><code>GetFeature</code></td>
<td>从通过WFS发布的数据存储中返回要素实例的选择。</td>
</tr>
<tr>
<td><code>ListStoredQueries</code></td>
<td>返回存储在WFS实例中的查询列表。</td>
</tr>
<tr>
<td><code>DescribeStoredQueries</code></td>
<td>返回存储在WFS实例中的查询的说明。</td>
</tr>
<tr>
<td><code>GetPropertyValue</code> （可选）</td>
<td>检索一组要素实例的要素特性值或复杂要素特性值的一部分</td>
</tr>
<tr>
<td><code>GetFeatureWithLock</code> （可选）</td>
<td>提供与GetFeature请求类似的功能，但具有锁定特性的附加功能，可能是为了后续更新或更改。</td>
</tr>
<tr>
<td><code>LockFeature</code> （可选）</td>
<td>锁定一组要素实例，以便在锁定到位时，其他操作都不能修改数据。</td>
</tr>
<tr>
<td><code>Transaction</code> （可选）</td>
<td>允许修改或删除要素实例及其属性。</td>
</tr>
<tr>
<td><code>CreateStoredQuery</code> （可选）</td>
<td>创建并存储一个查询，客户机可以在稍后的时间点快速轻松地触发该查询。</td>
</tr>
<tr>
<td><code>DropStoredQuery</code> （可选）</td>
<td>从服务器中删除以前存储的查询。</td>
</tr>
</tbody>
</table>
<p>以下是可以发送到由简单和基本的WFS配置提供的操作的请求的示例（仅列出 GetFeature 和数据更新操作）</p>
<h5 id="1-3-1-GetFeature（用于数据查询）"><a href="#1-3-1-GetFeature（用于数据查询）" class="headerlink" title="1.3.1 GetFeature（用于数据查询）"></a>1.3.1 GetFeature（用于数据查询）</h5><p>WFS服务器响应 <strong>GetFeature</strong> 请求返回根据请求客户端设置的条件筛选的地理要素实例的集合。</p>
<p>请求可以通过httpget或httppost发送。为了简单起见，下面的示例请求仅通过httpget发送。</p>
<h6 id="1-3-1-1-请求"><a href="#1-3-1-1-请求" class="headerlink" title="1.3.1.1 请求"></a>1.3.1.1 请求</h6><p>最简单的GetFeature请求是下载特性集合而不受任何约束来过滤内容的请求。下面显示了此类请求的一个示例。这个 <code>GetFeature</code> request使用一组描述要返回的地理特征的参数来查询服务器。TYPENAMES参数确定要返回的要素实例集合。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://cite.deegree.org/deegree-webservices-3.4-RC3/services/wfs200?</span><br><span class="line">SERVICE=WFS&amp;</span><br><span class="line">VERSION=2.0.0&amp;</span><br><span class="line">REQUEST=GetFeature&amp;</span><br><span class="line">TYPENAMES=ps:ProtectedSite</span><br></pre></td></tr></table></figure>
<h6 id="1-3-1-2-响应"><a href="#1-3-1-2-响应" class="headerlink" title="1.3.1.2 响应"></a>1.3.1.2 响应</h6><p>从上述请求得到的响应摘要如下所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:FeatureCollection</span><br><span class="line">   timeStamp=&quot;2017-09-21T18:59:13&quot;</span><br><span class="line">   numberMatched=&quot;16&quot;</span><br><span class="line">   numberReturned=&quot;16&quot;</span><br><span class="line">   next=&quot;https://wfst.axl.aero/AxlRest/wfs?SERVICE=WFS&amp;amp;VERSION=2.0.2&amp;amp;REQUEST=GetFeature&amp;amp;TYPENAMES=ps:ProtectedSite&amp;amp;STARTINDEX=2&amp;amp;COUNT=1&quot;</span><br><span class="line">   xmlns:gts=&quot;http://www.isotc211.org/2005/gts&quot;</span><br><span class="line">   xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot;</span><br><span class="line">   xmlns:sch=&quot;http://purl.oclc.org/dsdl/schematron&quot;</span><br><span class="line">   xmlns:xml=&quot;http://www.w3.org/XML/1998/namespace&quot;</span><br><span class="line">   xmlns:base=&quot;urn:x-inspire:specification:gmlas:BaseTypes:3.2&quot;</span><br><span class="line">   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">   xmlns:gco=&quot;http://www.isotc211.org/2005/gco&quot;</span><br><span class="line">   xmlns:fes=&quot;http://www.opengis.net/fes/2.0&quot;</span><br><span class="line">   xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;</span><br><span class="line">   xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;</span><br><span class="line">   xmlns:ows=&quot;http://www.opengis.net/ows/1.1&quot;</span><br><span class="line">   xmlns:gmx=&quot;http://www.isotc211.org/2005/gmx&quot;</span><br><span class="line">   xmlns:gss=&quot;http://www.isotc211.org/2005/gss&quot;</span><br><span class="line">   xmlns:ps=&quot;urn:x-inspire:specification:gmlas:ProtectedSites:3.0&quot;</span><br><span class="line">   xmlns:gsr=&quot;http://www.isotc211.org/2005/gsr&quot;</span><br><span class="line">   xmlns:gn=&quot;urn:x-inspire:specification:gmlas:GeographicalNames:3.0&quot;</span><br><span class="line">   xmlns:smil20=&quot;http://www.w3.org/2001/SMIL20/&quot;</span><br><span class="line">   xmlns:sqm=&quot;http://axl.avitech.aero/aviWfsSqm/1.0&quot;</span><br><span class="line">   xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot;</span><br><span class="line">   xmlns:smil20lang=&quot;http://www.w3.org/2001/SMIL20/Language&quot;</span><br><span class="line">   xmlns:gmd=&quot;http://www.isotc211.org/2005/gmd&quot;</span><br><span class="line">   xsi:schemaLocation=&quot;http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd http://www.opengis.net/gml/3.2 http://schemas.opengis.net/gml/3.2.1/gml.xsd&quot;&gt;</span><br><span class="line">&lt;wfs:member xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot;&gt;</span><br><span class="line">  &lt;!-- oldId=none ;oldTime=1487178040 ; oldExpiry=0 ;  ; currentTime=1506020133 ; expired=true;--&gt;</span><br><span class="line">  &lt;ps:ProtectedSite xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot; xmlns:ps=&quot;urn:x-inspire:specification:gmlas:ProtectedSites:3.0&quot; gml:id=&quot;PS_PROTECTEDSITE_16cbb8db-cce1-4e8b-8733-83d53a910ebe&quot;&gt;</span><br><span class="line">...</span><br><span class="line">  &lt;/ps:ProtectedSite&gt;</span><br><span class="line">&lt;/wfs:member&gt;&lt;/wfs:FeatureCollection&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-1-3-计数参数"><a href="#1-3-1-3-计数参数" class="headerlink" title="1.3.1.3 计数参数"></a>1.3.1.3 计数参数</h6><p>可添加其他参数以进一步筛选或转换来自WFS的响应。指定参数值所需的信息，包括下面介绍的其他参数。</p>
<p>要在上面的GetFeature请求中包含其他参数，只需在URL的末尾添加一个与号（&amp;），然后添加参数名称、等号和要分配给参数的值。例如，下面的GetFeature请求将服务器返回的特性数限制为单个特性实例。限制响应的数量由count参数的值确定。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https://wfst.axl.aero/AxlRest/wfs?</span><br><span class="line">service=WFS&amp;</span><br><span class="line">version=2.0.0&amp;</span><br><span class="line">request=GetFeature&amp;</span><br><span class="line">TypeNames=ps:ProtectedSite&amp;</span><br><span class="line">count=1</span><br></pre></td></tr></table></figure>
<p>请求生成的响应如下所示。请注意，返回的特性实例的数量是1（由根目录中的numberReturned属性显示）wfs:FeatureCollection元素).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:FeatureCollection</span><br><span class="line">   timeStamp=&quot;2017-09-21T18:55:33&quot;</span><br><span class="line">   numberMatched=&quot;16&quot;</span><br><span class="line">   numberReturned=&quot;1&quot;</span><br><span class="line">   next=&quot;https://wfst.axl.aero/AxlRest/wfs?SERVICE=WFS&amp;amp;VERSION=2.0.2&amp;amp;REQUEST=GetFeature&amp;amp;TYPENAMES=ps:ProtectedSite&amp;amp;STARTINDEX=2&amp;amp;COUNT=1&quot;</span><br><span class="line">   xmlns:gts=&quot;http://www.isotc211.org/2005/gts&quot;</span><br><span class="line">   xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot;</span><br><span class="line">   xmlns:sch=&quot;http://purl.oclc.org/dsdl/schematron&quot;</span><br><span class="line">   xmlns:xml=&quot;http://www.w3.org/XML/1998/namespace&quot;</span><br><span class="line">   xmlns:base=&quot;urn:x-inspire:specification:gmlas:BaseTypes:3.2&quot;</span><br><span class="line">   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">   xmlns:gco=&quot;http://www.isotc211.org/2005/gco&quot;</span><br><span class="line">   xmlns:fes=&quot;http://www.opengis.net/fes/2.0&quot;</span><br><span class="line">   xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;</span><br><span class="line">   xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;</span><br><span class="line">   xmlns:ows=&quot;http://www.opengis.net/ows/1.1&quot;</span><br><span class="line">   xmlns:gmx=&quot;http://www.isotc211.org/2005/gmx&quot;</span><br><span class="line">   xmlns:gss=&quot;http://www.isotc211.org/2005/gss&quot;</span><br><span class="line">   xmlns:ps=&quot;urn:x-inspire:specification:gmlas:ProtectedSites:3.0&quot;</span><br><span class="line">   xmlns:gsr=&quot;http://www.isotc211.org/2005/gsr&quot;</span><br><span class="line">   xmlns:gn=&quot;urn:x-inspire:specification:gmlas:GeographicalNames:3.0&quot;</span><br><span class="line">   xmlns:smil20=&quot;http://www.w3.org/2001/SMIL20/&quot;</span><br><span class="line">   xmlns:sqm=&quot;http://axl.avitech.aero/aviWfsSqm/1.0&quot;</span><br><span class="line">   xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot;</span><br><span class="line">   xmlns:smil20lang=&quot;http://www.w3.org/2001/SMIL20/Language&quot;</span><br><span class="line">   xmlns:gmd=&quot;http://www.isotc211.org/2005/gmd&quot;</span><br><span class="line">   xsi:schemaLocation=&quot;http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd http://www.opengis.net/gml/3.2 http://schemas.opengis.net/gml/3.2.1/gml.xsd&quot;&gt;</span><br><span class="line">&lt;wfs:member xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot;&gt;</span><br><span class="line">  &lt;!-- oldId=none ;oldTime=1487178040 ; oldExpiry=0 ;  ; currentTime=1506020133 ; expired=true;--&gt;</span><br><span class="line">  &lt;ps:ProtectedSite xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot; xmlns:ps=&quot;urn:x-inspire:specification:gmlas:ProtectedSites:3.0&quot; gml:id=&quot;PS_PROTECTEDSITE_16cbb8db-cce1-4e8b-8733-83d53a910ebe&quot;&gt;</span><br><span class="line">    &lt;gml:name&gt;ProtectedSite1&lt;/gml:name&gt;</span><br><span class="line">    &lt;ps:geometry&gt;</span><br><span class="line">      &lt;gml:MultiSurface gml:id=&quot;PS_PROTECTEDSITE_16cbb8db-cce1-4e8b-8733-83d53a910ebe_PS_GEOMETRY&quot; srsName=&quot;urn:ogc:def:crs:EPSG::4326&quot;&gt;</span><br><span class="line">        &lt;gml:surfaceMember&gt;</span><br><span class="line">          &lt;gml:Polygon gml:id=&quot;GEOMETRY_7fd8f3e7-d283-4ce5-9722-e612bf465a3b&quot; srsName=&quot;urn:ogc:def:crs:EPSG::4326&quot;&gt;</span><br><span class="line">            &lt;gml:exterior&gt;</span><br><span class="line">              &lt;gml:LinearRing&gt;</span><br><span class="line">                &lt;gml:posList&gt;</span><br><span class="line">                                                                          51.628734 5.507951 51.629015 5.508402 51.629694 5.507409 51.628721 5.507150 51.628734</span><br><span class="line">                                                                          5.507951</span><br><span class="line">                                                                  &lt;/gml:posList&gt;</span><br><span class="line">              &lt;/gml:LinearRing&gt;</span><br><span class="line">            &lt;/gml:exterior&gt;</span><br><span class="line">          &lt;/gml:Polygon&gt;</span><br><span class="line">        &lt;/gml:surfaceMember&gt;</span><br><span class="line">      &lt;/gml:MultiSurface&gt;</span><br><span class="line">    &lt;/ps:geometry&gt;</span><br><span class="line">    &lt;ps:inspireID&gt;</span><br><span class="line">      &lt;base:Identifier&gt;</span><br><span class="line">        &lt;base:localId&gt;FB8DCB4E-03BB-4E8A-BB9D-04A44295DF58&lt;/base:localId&gt;</span><br><span class="line">        &lt;base:namespace&gt;NL.9930.EHS&lt;/base:namespace&gt;</span><br><span class="line">      &lt;/base:Identifier&gt;</span><br><span class="line">    &lt;/ps:inspireID&gt;</span><br><span class="line">    &lt;ps:siteDesignation&gt;</span><br><span class="line">      &lt;ps:DesignationType&gt;</span><br><span class="line">        &lt;ps:designationScheme&gt;ecologischeHoofdstructuur&lt;/ps:designationScheme&gt;</span><br><span class="line">        &lt;ps:designation&gt;ecologischeHoofdstructuur&lt;/ps:designation&gt;</span><br><span class="line">        &lt;ps:percentageUnderDesignation&gt;100&lt;/ps:percentageUnderDesignation&gt;</span><br><span class="line">      &lt;/ps:DesignationType&gt;</span><br><span class="line">    &lt;/ps:siteDesignation&gt;</span><br><span class="line">  &lt;/ps:ProtectedSite&gt;</span><br><span class="line">&lt;/wfs:member&gt;&lt;/wfs:FeatureCollection&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-1-4-边界框（BBOX）参数"><a href="#1-3-1-4-边界框（BBOX）参数" class="headerlink" title="1.3.1.4 边界框（BBOX）参数"></a>1.3.1.4 边界框（BBOX）参数</h6><p>可以添加到GetFeature请求的另一个参数是边界框（BBOX）的参数。此参数是一个逗号分隔的列表，由四个数字组成，表示应返回的要素实例的最小和最大边界坐标。下面显示了使用BBOX参数的示例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://cite.deegree.org/deegree-webservices-3.4-RC3/services/wfs200?service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;TypeNames=ps:ProtectedSite&amp;BBOX=51.607317,5.106151,51.629884,5.228022</span><br></pre></td></tr></table></figure>
<p>上面的请求返回的响应如下所示。为了简洁起见，这里提供了一些缺少的内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:FeatureCollection xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot; timeStamp=&quot;2017-09-21T18:14:50Z&quot; xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot; numberMatched=&quot;1&quot; numberReturned=&quot;1&quot;&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;ps:ProtectedSite xmlns:ps=&quot;urn:x-inspire:specification:gmlas:ProtectedSites:3.0&quot; gml:id=&quot;PS_PROTECTEDSITE_a367af0b-9457-4445-9cbd-eb48ae7a844a&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/ps:ProtectedSite&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;/wfs:FeatureCollection&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-1-5-PropetyName参数"><a href="#1-3-1-5-PropetyName参数" class="headerlink" title="1.3.1.5 PropetyName参数"></a>1.3.1.5 PropetyName参数</h6><p>可以添加到GetFeature请求的另一个参数是propertyName。此参数返回只包含指定属性的功能实例。在具有多个属性的功能类型通过带宽有限的网络提供服务的情况下，此功能尤其有用。客户机应用程序可以选择要在功能实例中返回的属性。下面显示了使用此参数的示例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://services.interactive-instruments.de/ogc-reference/simple/wfs?version=2.0.0&amp;request=getfeature&amp;service=wfs&amp;typenames=ci:City&amp;count=3&amp;propertyName=inhabitants</span><br></pre></td></tr></table></figure>
<p>上面的请求返回的响应如下所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:FeatureCollection timeStamp=&quot;2017-09-21T21:17:32.296+02:00&quot; numberReturned=&quot;3&quot; numberMatched=&quot;unknown&quot; xmlns=&quot;http://www.interactive-instruments.de/namespaces/demo/cities/4.1/cities&quot; xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot; xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;City gml:id=&quot;City.10&quot;&gt;</span><br><span class="line">&lt;location&gt;</span><br><span class="line">&lt;gml:Point gml:id=&quot;city.id.10.location.Geom_0&quot; srsName=&quot;urn:ogc:def:crs:EPSG::25832&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:pos&gt;486890.340 5881020.962&lt;/gml:pos&gt;</span><br><span class="line">&lt;/gml:Point&gt;</span><br><span class="line">&lt;/location&gt;</span><br><span class="line">&lt;inhabitants&gt;547300&lt;/inhabitants&gt;</span><br><span class="line">&lt;/City&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;City gml:id=&quot;City.11&quot;&gt;</span><br><span class="line">&lt;location&gt;</span><br><span class="line">&lt;gml:Point gml:id=&quot;city.id.11.location.Geom_0&quot; srsName=&quot;urn:ogc:def:crs:EPSG::25832&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:pos&gt;364883.268 5620035.394&lt;/gml:pos&gt;</span><br><span class="line">&lt;/gml:Point&gt;</span><br><span class="line">&lt;/location&gt;</span><br><span class="line">&lt;inhabitants&gt;324800&lt;/inhabitants&gt;</span><br><span class="line">&lt;/City&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;City gml:id=&quot;City.9&quot;&gt;</span><br><span class="line">&lt;location&gt;</span><br><span class="line">&lt;gml:Point gml:id=&quot;city.id.9.location.Geom_0&quot; srsName=&quot;urn:ogc:def:crs:EPSG::25832&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:pos&gt;361905.275 5702287.179&lt;/gml:pos&gt;</span><br><span class="line">&lt;/gml:Point&gt;</span><br><span class="line">&lt;/location&gt;</span><br><span class="line">&lt;inhabitants&gt;574600&lt;/inhabitants&gt;</span><br><span class="line">&lt;/City&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;/wfs:FeatureCollection&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-1-6-sortBy参数"><a href="#1-3-1-6-sortBy参数" class="headerlink" title="1.3.1.6 sortBy参数"></a>1.3.1.6 sortBy参数</h6><p>WFS返回的结果也可以通过sortBy参数按特定的顺序组织。此参数按指定参数确定的序列返回要素实例。在要素类型具有表示数量或总体的特性的情况下，此功能尤其有用。下面显示了使用此参数的示例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://services.interactive-instruments.de/ogc-reference/simple/wfs?version=2.0.0&amp;request=getfeature&amp;service=wfs&amp;typenames=ci:City&amp;sortBy=inhabitants&amp;propertyName=inhabitants</span><br></pre></td></tr></table></figure>
<p>由上述请求得到的响应如下所示。为了简洁起见，省略了一些内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;wfs:FeatureCollection timeStamp=&quot;2017-09-21T21:17:32.296+02:00&quot; numberReturned=&quot;11&quot; numberMatched=&quot;unknown&quot; xmlns=&quot;http://www.interactive-instruments.de/namespaces/demo/cities/4.1/cities&quot; xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot; xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;City gml:id=&quot;City.11&quot;&gt;</span><br><span class="line">&lt;location&gt;</span><br><span class="line">&lt;gml:Point gml:id=&quot;city.id.11.location.Geom_0&quot; srsName=&quot;urn:ogc:def:crs:EPSG::25832&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:pos&gt;364883.268 5620035.394&lt;/gml:pos&gt;</span><br><span class="line">&lt;/gml:Point&gt;</span><br><span class="line">&lt;/location&gt;</span><br><span class="line">&lt;inhabitants&gt;324800&lt;/inhabitants&gt;</span><br><span class="line">&lt;/City&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;City gml:id=&quot;City.10&quot;&gt;</span><br><span class="line">&lt;location&gt;</span><br><span class="line">&lt;gml:Point gml:id=&quot;city.id.10.location.Geom_0&quot; srsName=&quot;urn:ogc:def:crs:EPSG::25832&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:pos&gt;486890.340 5881020.962&lt;/gml:pos&gt;</span><br><span class="line">&lt;/gml:Point&gt;</span><br><span class="line">&lt;/location&gt;</span><br><span class="line">&lt;inhabitants&gt;547300&lt;/inhabitants&gt;</span><br><span class="line">&lt;/City&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;City gml:id=&quot;City.9&quot;&gt;</span><br><span class="line">&lt;location&gt;</span><br><span class="line">&lt;gml:Point gml:id=&quot;city.id.9.location.Geom_0&quot; srsName=&quot;urn:ogc:def:crs:EPSG::25832&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:pos&gt;361905.275 5702287.179&lt;/gml:pos&gt;</span><br><span class="line">&lt;/gml:Point&gt;</span><br><span class="line">&lt;/location&gt;</span><br><span class="line">&lt;inhabitants&gt;574600&lt;/inhabitants&gt;</span><br><span class="line">&lt;/City&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;/wfs:FeatureCollection&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-1-7-srsName参数"><a href="#1-3-1-7-srsName参数" class="headerlink" title="1.3.1.7 srsName参数"></a>1.3.1.7 srsName参数</h6><p>此参数用于指定用于编码要素几何图形的空间参考系。可以从GetCapabilities响应中标识每个要素类型所允许的空间参考系统。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://services.interactive-instruments.de/ogc-reference/simple/wfs?version=2.0.0&amp;request=getfeature&amp;service=wfs&amp;typenames=ci:City&amp;count=1&amp;srsName=urn:ogc:def:crs:EPSG::4326</span><br></pre></td></tr></table></figure>
<p>由上述请求得到的响应如下所示。为了简洁起见，省略了一些内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:FeatureCollection timeStamp=&quot;2017-09-21T21:26:02.213+02:00&quot; numberReturned=&quot;1&quot; numberMatched=&quot;unknown&quot; xmlns=&quot;http://www.interactive-instruments.de/namespaces/demo/cities/4.1/cities&quot; xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot; xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;</span><br><span class="line">&lt;wfs:boundedBy&gt;</span><br><span class="line">&lt;gml:Envelope srsName=&quot;urn:ogc:def:crs:EPSG::4326&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:lowerCorner&gt;52.521400003005 13.405700006106&lt;/gml:lowerCorner&gt;</span><br><span class="line">&lt;gml:upperCorner&gt;52.521400003005 13.405700006106&lt;/gml:upperCorner&gt;</span><br><span class="line">&lt;/gml:Envelope&gt;</span><br><span class="line">&lt;/wfs:boundedBy&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;City gml:id=&quot;City.1&quot;&gt;</span><br><span class="line">&lt;name&gt;Berlin&lt;/name&gt;</span><br><span class="line">&lt;location&gt;</span><br><span class="line">&lt;gml:Point gml:id=&quot;city.id.1.location.Geom_0&quot; srsName=&quot;urn:ogc:def:crs:EPSG::4326&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:pos&gt;52.521400003005 13.405700006106&lt;/gml:pos&gt;</span><br><span class="line">&lt;/gml:Point&gt;</span><br><span class="line">&lt;/location&gt;</span><br><span class="line">&lt;country&gt;Germany&lt;/country&gt;</span><br><span class="line">&lt;inhabitants&gt;3460700&lt;/inhabitants&gt;</span><br><span class="line">&lt;lzi&gt;2011-03-17T15:32:54Z&lt;/lzi&gt;</span><br><span class="line">&lt;function&gt;capital&lt;/function&gt;</span><br><span class="line">&lt;/City&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;/wfs:FeatureCollection&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-1-8-featureId参数"><a href="#1-3-1-8-featureId参数" class="headerlink" title="1.3.1.8 featureId参数"></a>1.3.1.8 featureId参数</h6><p>此参数用于筛选请求返回的功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/geoserver/wfs?</span><br><span class="line">request=GetFeature&amp;</span><br><span class="line">version=2.0.0&amp;</span><br><span class="line">typeName=topp:states&amp;</span><br><span class="line">FEATUREID=states.3</span><br></pre></td></tr></table></figure>
<p>由上述请求得到的响应如下所示。为了简洁起见，省略了一些内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:FeatureCollection xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot; xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot; xmlns:topp=&quot;http://www.openplans.org/topp&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; numberMatched=&quot;1&quot; numberReturned=&quot;1&quot; timeStamp=&quot;2017-09-21T19:38:52.788Z&quot;&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;topp:states gml:id=&quot;states.3&quot;&gt;</span><br><span class="line">&lt;topp:the_geom&gt;</span><br><span class="line">&lt;gml:MultiSurface srsName=&quot;urn:ogc:def:crs:EPSG::4326&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:surfaceMember&gt;&lt;gml:Polygon&gt;&lt;gml:exterior&gt;&lt;gml:LinearRing&gt;&lt;gml:posList&gt;38.557476 -75.70742 38.649551 -75.71106 38.83017 -75.724937 39.141548 -75.752922 39.247753 -75.761658 38.450451 -75.093094 38.455208 -75.350204 38.463066 -75.69915 38.557476 -75.70742&lt;/gml:posList&gt;&lt;/gml:LinearRing&gt;&lt;/gml:exterior&gt;&lt;/gml:Polygon&gt;&lt;/gml:surfaceMember&gt;</span><br><span class="line">&lt;/gml:MultiSurface&gt;</span><br><span class="line">&lt;/topp:the_geom&gt;</span><br><span class="line">&lt;topp:STATE_NAME&gt;Delaware&lt;/topp:STATE_NAME&gt;</span><br><span class="line">&lt;topp:SAMP_POP&gt;102776.0&lt;/topp:SAMP_POP&gt;</span><br><span class="line">&lt;/topp:states&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;/wfs:FeatureCollection&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-1-9-查询操作"><a href="#1-3-1-9-查询操作" class="headerlink" title="1.3.1.9 查询操作"></a>1.3.1.9 查询操作</h6><p>到目前为止，我们只展示了通过httpget方法作为url发送的GetFeature请求示例。也可以通过httppost方法将请求主体作为XML文档发送。</p>
<p>下面是一个GetFeature请求的示例，该请求包含一个查询操作，并通过httppost方法发送。</p>
<p>请求被发送到以下URL <a href="https://services.interactive-instruments.de/ogc-reference/simple/wfs" target="_blank" rel="noopener">https://services.interactive-instruments.de/ogc-reference/simple/wfs</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:GetFeature service=&quot;WFS&quot; version=&quot;2.0.0&quot;</span><br><span class="line">    xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot; xmlns:ci=&quot;http://www.interactive-instruments.de/namespaces/demo/cities/4.1/cities&quot; xmlns:fes=&quot;http://www.opengis.net/fes/2.0&quot;</span><br><span class="line">    xmlns:sf=&quot;http://www.openplans.org/spearfish&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd&quot;&gt;</span><br><span class="line">    &lt;wfs:Query typeNames=&quot;ci:City&quot;&gt;</span><br><span class="line">    &lt;wfs:PropertyName resolve=&quot;local&quot;&gt;ci:inhabitants&lt;/wfs:PropertyName&gt;</span><br><span class="line">        &lt;fes:Filter&gt;</span><br><span class="line">            &lt;fes:PropertyIsLessThan&gt;</span><br><span class="line">               &lt;fes:ValueReference&gt;ci:inhabitants&lt;/fes:ValueReference&gt;</span><br><span class="line">               &lt;fes:Literal&gt;400000&lt;/fes:Literal&gt;</span><br><span class="line">            &lt;/fes:PropertyIsLessThan&gt;</span><br><span class="line">        &lt;/fes:Filter&gt;</span><br><span class="line">    &lt;/wfs:Query&gt;</span><br><span class="line">&lt;/wfs:GetFeature&gt;</span><br></pre></td></tr></table></figure>
<p>上面的请求返回的响应如下所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:FeatureCollection timeStamp=&quot;2017-09-22T09:56:55.908+02:00&quot; numberReturned=&quot;1&quot; numberMatched=&quot;unknown&quot; xmlns=&quot;http://www.interactive-instruments.de/namespaces/demo/cities/4.1/cities&quot; xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot; xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.interactive-instruments.de/namespaces/demo/cities/4.1/cities https://services.interactive-instruments.de/ogc-reference/schema/demo/cities/4.1/Cities.xsd http://www.opengis.net/wfs/2.0 https://services.interactive-instruments.de/ogc-reference/schema/ogc/wfs/2.0/wfs.xsd http://www.opengis.net/gml/3.2 https://services.interactive-instruments.de/ogc-reference/schema/ogc/gml/3.2.1/gml.xsd http://www.opengis.net/gml/3.2 https://services.interactive-instruments.de/ogc-reference/schema/ogc/gml/3.2.1/gml.xsd&quot;&gt;</span><br><span class="line">&lt;wfs:boundedBy&gt;</span><br><span class="line">&lt;gml:Envelope srsName=&quot;urn:ogc:def:crs:EPSG::25832&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:lowerCorner&gt;364883.268 5620035.394&lt;/gml:lowerCorner&gt;</span><br><span class="line">&lt;gml:upperCorner&gt;364883.268 5620035.394&lt;/gml:upperCorner&gt;</span><br><span class="line">&lt;/gml:Envelope&gt;</span><br><span class="line">&lt;/wfs:boundedBy&gt;</span><br><span class="line">&lt;wfs:member&gt;</span><br><span class="line">&lt;City gml:id=&quot;City.11&quot;&gt;</span><br><span class="line">&lt;name&gt;Bonn&lt;/name&gt;</span><br><span class="line">&lt;location&gt;</span><br><span class="line">&lt;gml:Point gml:id=&quot;city.id.11.location.Geom_0&quot; srsName=&quot;urn:ogc:def:crs:EPSG::25832&quot; srsDimension=&quot;2&quot;&gt;</span><br><span class="line">&lt;gml:pos&gt;364883.268 5620035.394&lt;/gml:pos&gt;</span><br><span class="line">&lt;/gml:Point&gt;</span><br><span class="line">&lt;/location&gt;</span><br><span class="line">&lt;country&gt;Germany&lt;/country&gt;</span><br><span class="line">&lt;inhabitants&gt;324800&lt;/inhabitants&gt;</span><br><span class="line">&lt;/City&gt;</span><br><span class="line">&lt;/wfs:member&gt;</span><br><span class="line">&lt;/wfs:FeatureCollection&gt;</span><br></pre></td></tr></table></figure>
<h5 id="1-3-2-数据更新"><a href="#1-3-2-数据更新" class="headerlink" title="1.3.2 数据更新"></a>1.3.2 数据更新</h5><p>此可选操作允许更新或删除要素实例及其属性。该操作还可用于插入新功能。WFS标准不强制实施任何特定的安全模型，因此实现应该实现适合于其自身基础设施的安全模型。</p>
<h6 id="1-3-2-1-请求"><a href="#1-3-2-1-请求" class="headerlink" title="1.3.2.1 请求"></a>1.3.2.1 请求</h6><p>下面显示了一个请求示例。由于请求修改数据，我们建议安装一个WFS的本地实例。下面的示例针对本地托管的WFS实例进行了测试&lt;本地主机<a href="http://localhost：8080/geoserver/wfs&gt;" target="_blank" rel="noopener">http://localhost：8080/geoserver/wfs&gt;</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:Transaction version=&quot;2.0.0&quot; service=&quot;WFS&quot;</span><br><span class="line"> xmlns=&quot;http://www.someserver.com/myns&quot;</span><br><span class="line"> xmlns:fes=&quot;http://www.opengis.net/fes/2.0&quot;</span><br><span class="line"> xmlns:topp=&quot;http://www.openplans.org/topp&quot;</span><br><span class="line"> xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot;</span><br><span class="line"> xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line"> xsi:schemaLocation=&quot;http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0.0/wfs.xsd&quot;&gt;</span><br><span class="line"> &lt;wfs:Update typeName=&quot;topp:tasmania_roads&quot;&gt;</span><br><span class="line"> &lt;wfs:Property&gt;</span><br><span class="line"> &lt;wfs:ValueReference&gt;TYPE&lt;/wfs:ValueReference&gt;</span><br><span class="line"> &lt;wfs:Value&gt;road&lt;/wfs:Value&gt;</span><br><span class="line"> &lt;/wfs:Property&gt;</span><br><span class="line"> &lt;fes:Filter&gt;</span><br><span class="line"> &lt;fes:ResourceId rid=&quot;tasmania_roads.1&quot;/&gt;</span><br><span class="line"> &lt;/fes:Filter&gt;</span><br><span class="line"> &lt;/wfs:Update&gt;</span><br><span class="line">&lt;/wfs:Transaction&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-2-2-响应"><a href="#1-3-2-2-响应" class="headerlink" title="1.3.2.2 响应"></a>1.3.2.2 响应</h6><p>响应是一个XML文档，用于确认事务是否成功。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;wfs:TransactionResponse xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:fes=&quot;http://www.opengis.net/fes/2.0&quot; xmlns:wfs=&quot;http://www.opengis.net/wfs/2.0&quot; xmlns:gml=&quot;http://www.opengis.net/gml/3.2&quot; xmlns:ows=&quot;http://www.opengis.net/ows/1.1&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; version=&quot;2.0.0&quot; xsi:schemaLocation=&quot;http://www.opengis.net/wfs/2.0 http://localhost:8080/geoserver/schemas/wfs/2.0/wfs.xsd&quot;&gt;</span><br><span class="line">&lt;wfs:TransactionSummary&gt;</span><br><span class="line">&lt;wfs:totalInserted&gt;0&lt;/wfs:totalInserted&gt;</span><br><span class="line">&lt;wfs:totalUpdated&gt;1&lt;/wfs:totalUpdated&gt;</span><br><span class="line">&lt;wfs:totalReplaced&gt;0&lt;/wfs:totalReplaced&gt;</span><br><span class="line">&lt;wfs:totalDeleted&gt;0&lt;/wfs:totalDeleted&gt;</span><br><span class="line">&lt;/wfs:TransactionSummary&gt;</span><br><span class="line">&lt;wfs:UpdateResults&gt;&lt;wfs:Feature&gt;</span><br><span class="line">&lt;fes:ResourceId rid=&quot;tasmania_roads.1&quot;/&gt;</span><br><span class="line">&lt;/wfs:Feature&gt;</span><br><span class="line">&lt;/wfs:UpdateResults&gt;</span><br><span class="line">&lt;/wfs:TransactionResponse&gt;</span><br></pre></td></tr></table></figure>
<h4 id="1-4-城管原生-WFS-请求实例"><a href="#1-4-城管原生-WFS-请求实例" class="headerlink" title="1.4 城管原生 WFS 请求实例"></a>1.4 城管原生 WFS 请求实例</h4><p>GetFeature 不鉴权请求服务地址直接替换 layerName</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> layerName = <span class="string">'town_area_2'</span></span><br><span class="line"><span class="keyword">const</span> url = </span><br><span class="line"><span class="string">`http://172.18.34.198:8000/geoserver/gis/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=gis:<span class="subst">$&#123;layerName&#125;</span>&amp;maxFeatures=50&amp;outputFormat=application/json`</span></span><br><span class="line"></span><br><span class="line">fetch(url).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)  <span class="comment">// json 数据</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="1-5-基于-WFS-的增加、删除、修改、查询接口前端封装"><a href="#1-5-基于-WFS-的增加、删除、修改、查询接口前端封装" class="headerlink" title="1.5 基于 WFS 的增加、删除、修改、查询接口前端封装"></a>1.5 基于 WFS 的增加、删除、修改、查询接口前端封装</h4><h5 id="1-5-1-接口说明"><a href="#1-5-1-接口说明" class="headerlink" title="1.5.1 接口说明"></a>1.5.1 接口说明</h5><p>对用户输入的图层进行要素查询，返回 geojson</p>
<h5 id="1-5-2-参数说明"><a href="#1-5-2-参数说明" class="headerlink" title="1.5.2 参数说明"></a>1.5.2 参数说明</h5><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>ip</td>
<td>服务ip地址，城管委为172.18.34.198</td>
<td>字符串</td>
<td>是</td>
</tr>
<tr>
<td>port</td>
<td>服务端口号，城管委为8000</td>
<td>整数</td>
<td>是</td>
</tr>
<tr>
<td>workspace</td>
<td>工作空间，城管委为gis</td>
<td>字符串</td>
<td>是</td>
</tr>
<tr>
<td>layerName</td>
<td>图层名称，可登录城管委GIS系统-&gt;地图图层管理-&gt;物理图层管理获取需要的图层名</td>
<td>字符串</td>
<td>是</td>
</tr>
<tr>
<td>geomName</td>
<td>几何字段字段名，城管委数据为geom</td>
<td>字符串</td>
<td>是</td>
</tr>
<tr>
<td>maxFeatures</td>
<td>最大返回要素数量，不填全部返回，影响查询速度</td>
<td>整数</td>
<td>否</td>
</tr>
<tr>
<td>crs</td>
<td>返回数据坐标系，只需要提供code，默认EPSG:4326</td>
<td>字符串</td>
<td>否</td>
</tr>
<tr>
<td>filter</td>
<td>过滤条件</td>
<td>对象</td>
<td>否</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; WFST &#125; <span class="keyword">from</span> <span class="string">"cci-map"</span></span><br><span class="line"><span class="comment">// import &#123; WFST &#125; from 'cci-wfs'</span></span><br><span class="line"><span class="comment">// 数据查询</span></span><br><span class="line"><span class="keyword">let</span> wfst = <span class="keyword">new</span> WFST(&#123;</span><br><span class="line">  url: <span class="string">"http://&#123;ip&#125;:&#123;port&#125;/geoserver/&#123;workspace&#125;/wfs"</span>,</span><br><span class="line">  typeNS: <span class="string">"&#123;workspace&#125;"</span>,</span><br><span class="line">  typeName: <span class="string">"&#123;layerName&#125;"</span>,</span><br><span class="line">  geometryField: <span class="string">"&#123;geomName&#125;"</span>,</span><br><span class="line">  maxFeatures: <span class="number">50</span>,</span><br><span class="line">  crs: &#123;</span><br><span class="line">    code: <span class="string">"EPSG:4326"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">.on(<span class="string">'load'</span>, res =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).on(<span class="string">'error'</span>, error =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="1-5-3-filter-过滤器"><a href="#1-5-3-filter-过滤器" class="headerlink" title="1.5.3 filter 过滤器"></a>1.5.3 filter 过滤器</h5><p>OGC Filter Encoding v1.1.0 实现</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>构造函数</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ID</strong></td>
<td></td>
</tr>
<tr>
<td>GmlObjectId</td>
<td>GmlObjectIdFilter(value id)</td>
</tr>
<tr>
<td><strong>Comparisons</strong></td>
<td></td>
</tr>
<tr>
<td>PropertyIsEqualTo</td>
<td>OperatorFilter.EQ(propertyExpression firstArgument, literalExpression secondArgument, bool matchCase)</td>
</tr>
<tr>
<td>PropertyIsNotEqualTo</td>
<td>OperatorFilter.NotEQ(propertyExpression firstArgument, literalExpression secondArgument, bool matchCase)</td>
</tr>
<tr>
<td>PropertyIsLessThan</td>
<td>OperatorFilter.LT(propertyExpression firstArgument, literalExpression secondArgument, bool matchCase)</td>
</tr>
<tr>
<td>PropertyIsGreaterThan</td>
<td>OperatorFilter.GT(propertyExpression firstArgument, literalExpression secondArgument, bool matchCase)</td>
</tr>
<tr>
<td>PropertyIsLessThanOrEqualTo</td>
<td>OperatorFilter.LEQ(propertyExpression firstArgument, literalExpression secondArgument, bool matchCase)</td>
</tr>
<tr>
<td>PropertyIsGreaterThanOrEqualTo</td>
<td>OperatorFilter.GEQ(propertyExpression firstArgument, literalExpression secondArgument, bool matchCase)</td>
</tr>
<tr>
<td>PropertyIsLike</td>
<td>LikeFilter(string propertyName,string likeExpression,object attributes)</td>
</tr>
<tr>
<td>PropertyIsNull</td>
<td>IsNullFilter(string propertyName)</td>
</tr>
<tr>
<td>PropertyIsBetween</td>
<td>IsBetweenFilter(propertyExpression firstArgument, literalExpression lowerBoundary, literalExpression upperBoundary)</td>
</tr>
<tr>
<td><strong>Logic</strong></td>
<td></td>
</tr>
<tr>
<td>And</td>
<td>LogicFilter.And(expression[, expression]*)</td>
</tr>
<tr>
<td>Or</td>
<td>LogicFilter.Or(expression[, expression]*)</td>
</tr>
<tr>
<td>Not</td>
<td>LogicFilter.Not(filter)</td>
</tr>
<tr>
<td><strong>Geojson</strong></td>
<td></td>
</tr>
<tr>
<td>Geojson</td>
<td>Geojson(geojson,ICRS fromCRS, ICRS toCRS)</td>
</tr>
<tr>
<td><strong>Spatial</strong></td>
<td></td>
</tr>
<tr>
<td>Equals</td>
<td>SpatialFilter.Equals(string propertyName, Geojson geometry)</td>
</tr>
<tr>
<td>Disjoint</td>
<td>SpatialFilter.Disjoint(string geomPropertyName, Geojson geometry)</td>
</tr>
<tr>
<td>Touches</td>
<td>SpatialFilter.Touches(string geomPropertyName, Geojson geometry)</td>
</tr>
<tr>
<td>Within</td>
<td>SpatialFilter.Within(string geomPropertyName, Geojson geometry)</td>
</tr>
<tr>
<td>Overlaps</td>
<td>SpatialFilter.Overlaps(string geomPropertyName, Geojson geometry)</td>
</tr>
<tr>
<td>Crosses</td>
<td>SpatialFilter.Crosses(string geomPropertyName, Geojson geometry)</td>
</tr>
<tr>
<td>Intersects</td>
<td>SpatialFilter.Intersects(string geomPropertyName, Geojson geometry)</td>
</tr>
<tr>
<td>Contains</td>
<td>SpatialFilter.Contains(string geomPropertyName, Geojson geometry)</td>
</tr>
<tr>
<td><strong>Spatial distance buffer</strong></td>
<td></td>
</tr>
<tr>
<td>DWithin</td>
<td>DistanceBufferFilter.DWithin(string geomPropertyName, Geojson geometry,  value distance, string units)</td>
</tr>
<tr>
<td>Beyond</td>
<td>DistanceBufferFilter.Beyond(string geomPropertyName, Geojson geometry,  value distance, string units)</td>
</tr>
</tbody>
</table>
<h5 id="1-5-4-例子"><a href="#1-5-4-例子" class="headerlink" title="1.5.4 例子"></a>1.5.4 例子</h5><h6 id="1-5-4-1-WFS-查询"><a href="#1-5-4-1-WFS-查询" class="headerlink" title="1.5.4.1 WFS 查询"></a>1.5.4.1 WFS 查询</h6><ul>
<li>PropertyIsEqualTo 字段值等于</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; WFS, OperatorFilter &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; WFS, OperatorFilter &#125; from 'cci-wfs'</span></span><br><span class="line"><span class="comment">// OBJECTID=9</span></span><br><span class="line"><span class="comment">// matchCase属性，其值为true或false。如果此属性是true（默认值），则字符串比较区分大小写</span></span><br><span class="line"><span class="keyword">let</span> filter = OperatorFilter.EQ(<span class="string">"OBJECTID"</span>, <span class="string">"1109"</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">new</span> WFS(&#123;</span><br><span class="line">  url: <span class="string">"http://&#123;ip&#125;:&#123;port&#125;/geoserver/&#123;workspace&#125;/wfs"</span>,</span><br><span class="line">  typeNS: <span class="string">"&#123;workspace&#125;"</span>,</span><br><span class="line">  typeName: <span class="string">"&#123;layerName&#125;"</span>,</span><br><span class="line">  geometryField: <span class="string">"&#123;geomName&#125;"</span>,</span><br><span class="line">  filter: filter,</span><br><span class="line">  maxFeatures: <span class="number">50</span>,</span><br><span class="line">&#125;)</span><br><span class="line">.on(<span class="string">'load'</span>, res =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>Intersects</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; WFS, Geojson, SpatialFilter &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; WFS, Geojson, SpatialFilter &#125; from 'cci-wfs'</span></span><br><span class="line"><span class="comment">// 几何筛选</span></span><br><span class="line"><span class="keyword">const</span> geom = &#123;</span><br><span class="line">  type: <span class="string">"LineString"</span>,</span><br><span class="line">  coordinates: [</span><br><span class="line">    [<span class="number">120.03481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">    [<span class="number">120.33481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">    [<span class="number">120.33481352</span>, <span class="number">30.15337265</span>],</span><br><span class="line">    [<span class="number">120.03481352</span>, <span class="number">30.15337265</span>],</span><br><span class="line">    [<span class="number">120.03481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> geommm = Geojson(geom);</span><br><span class="line"><span class="keyword">let</span> filter = SpatialFilter.Intersects(geommm, <span class="string">"&#123;geomName&#125;"</span>);</span><br><span class="line"><span class="keyword">new</span> WFS(&#123;</span><br><span class="line">  url: <span class="string">"http://&#123;ip&#125;:&#123;port&#125;/geoserver/&#123;workspace&#125;/wfs"</span>,</span><br><span class="line">  typeNS: <span class="string">"&#123;workspace&#125;"</span>,</span><br><span class="line">  typeName: <span class="string">"&#123;layerName&#125;"</span>,</span><br><span class="line">  geometryField: <span class="string">"&#123;geomName&#125;"</span>,</span><br><span class="line">  filter: filter,</span><br><span class="line">  maxFeatures: <span class="number">50</span>,</span><br><span class="line">&#125;).on(<span class="string">'load'</span>, res =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>And</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; WFS, Geojson, LogicFilter, SpatialFilter, OperatorFilter &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span> </span><br><span class="line"><span class="comment">// import &#123; WFS, Geojson, LogicFilter, SpatialFilter, OperatorFilter &#125; from 'cci-wfs' </span></span><br><span class="line"><span class="comment">// and条件查询</span></span><br><span class="line"><span class="keyword">let</span> filter = OperatorFilter.EQ(<span class="string">"OBJECTID"</span>, <span class="string">"1109"</span>);</span><br><span class="line"><span class="keyword">const</span> geom = &#123;</span><br><span class="line">  type: <span class="string">"LineString"</span>,</span><br><span class="line">  coordinates: [</span><br><span class="line">    [<span class="number">120.03481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">    [<span class="number">120.33481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">    [<span class="number">120.33481352</span>, <span class="number">30.15337265</span>],</span><br><span class="line">    [<span class="number">120.03481352</span>, <span class="number">30.15337265</span>],</span><br><span class="line">    [<span class="number">120.03481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> geommm = Geojson(geom);</span><br><span class="line"><span class="keyword">let</span> filter1 = SpatialFilter.Intersects(geommm, <span class="string">"&#123;geomName&#125;"</span>);</span><br><span class="line"><span class="keyword">let</span> finf = LogicFilter.And(filter, filter1);</span><br><span class="line"><span class="keyword">new</span> WFS(&#123;</span><br><span class="line">  url: <span class="string">"http://&#123;ip&#125;:&#123;port&#125;/geoserver/&#123;workspace&#125;/wfs"</span>,</span><br><span class="line">  typeNS: <span class="string">"&#123;workspace&#125;"</span>,</span><br><span class="line">  typeName: <span class="string">"&#123;layerName&#125;"</span>,</span><br><span class="line">  geometryField: <span class="string">"&#123;geomName&#125;"</span>,</span><br><span class="line">  filter: finf,</span><br><span class="line">  maxFeatures: <span class="number">50</span>,</span><br><span class="line">&#125;).on(<span class="string">'load'</span>, res =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>Like</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; WFS, LikeFilter &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; WFS, LikeFilter &#125; from 'cci-wfs'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// wildCard 指定匹配零个或多个字符串字符的任何序列的模式字符</span></span><br><span class="line"><span class="comment">// singleChar 指定匹配任何单个字符串字符的模式字符</span></span><br><span class="line"><span class="comment">// escapeChar 指定可用于转义模式字符的转义字符</span></span><br><span class="line"><span class="comment">// matchCase属性，其值为true或false。如果此属性是true（默认值），则字符串比较区分大小写</span></span><br><span class="line"><span class="comment">// like查询</span></span><br><span class="line"><span class="keyword">const</span> attributes = &#123;</span><br><span class="line">  wildCard: <span class="string">'*'</span>,</span><br><span class="line">  singleChar: <span class="string">'#'</span>,</span><br><span class="line">  escapeChar: <span class="string">'!'</span>,</span><br><span class="line">  matchCase: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> likeFilter = LikeFilter(<span class="string">"网格编码"</span>, <span class="string">"*0707"</span>, attributes);</span><br><span class="line"><span class="keyword">new</span> WFS(&#123;</span><br><span class="line">  url: <span class="string">"http://&#123;ip&#125;:&#123;port&#125;/geoserver/&#123;workspace&#125;/wfs"</span>,</span><br><span class="line">  typeNS: <span class="string">"&#123;workspace&#125;"</span>,</span><br><span class="line">  typeName: <span class="string">"&#123;layerName&#125;"</span>,</span><br><span class="line">  geometryField: <span class="string">"&#123;geomName&#125;"</span>,</span><br><span class="line">  filter: likeFilter,</span><br><span class="line">  maxFeatures: <span class="number">50</span>,</span><br><span class="line">&#125;).on(<span class="string">'load'</span>, res =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>Between</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; WFS, IsBetweenFilter &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; WFS, IsBetweenFilter &#125; from 'cci-wfs' </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// between查询</span></span><br><span class="line"><span class="keyword">let</span> isBettwen = IsBetweenFilter(<span class="string">"AREA_1"</span>, <span class="number">14675</span>, <span class="number">20000</span>);</span><br><span class="line"><span class="keyword">new</span> WFS(&#123;</span><br><span class="line">  url: <span class="string">"http://&#123;ip&#125;:&#123;port&#125;/geoserver/&#123;workspace&#125;/wfs"</span>,</span><br><span class="line">  typeNS: <span class="string">"&#123;workspace&#125;"</span>,</span><br><span class="line">  typeName: <span class="string">"&#123;layerName&#125;"</span>,</span><br><span class="line">  geometryField: <span class="string">"&#123;geomName&#125;"</span>,</span><br><span class="line">  filter: isBettwen,</span><br><span class="line">  maxFeatures: <span class="number">50</span>,</span><br><span class="line">&#125;).on(<span class="string">'load'</span>, res =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>Not</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; WFS, IsBetweenFilter, NotFilter &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; WFS, IsBetweenFilter, NotFilter &#125; from 'cci-wfs' </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// not查询</span></span><br><span class="line"><span class="keyword">let</span> notisBettwen = NotFilter(</span><br><span class="line">  IsBetweenFilter(<span class="string">"AREA_1"</span>, <span class="number">14675</span>, <span class="number">20000</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">new</span> WFS(&#123;</span><br><span class="line">  url: <span class="string">"http://&#123;ip&#125;:&#123;port&#125;/geoserver/&#123;workspace&#125;/wfs"</span>,</span><br><span class="line">  typeNS: <span class="string">"&#123;workspace&#125;"</span>,</span><br><span class="line">  typeName: <span class="string">"&#123;layerName&#125;"</span>,</span><br><span class="line">  geometryField: <span class="string">"&#123;geomName&#125;"</span>,</span><br><span class="line">  filter: notisBettwen,</span><br><span class="line">  maxFeatures: <span class="number">50</span>,</span><br><span class="line">&#125;).on(<span class="string">'load'</span>, res =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>IsNull</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; WFS, IsNullFilter &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; WFS, IsNullFilter &#125; from 'cci-wfs' </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// isNull查询</span></span><br><span class="line"><span class="keyword">let</span> isNull = IsNullFilter(</span><br><span class="line">  <span class="string">'AREA'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">new</span> WFS(&#123;</span><br><span class="line">  url: <span class="string">"http://&#123;ip&#125;:&#123;port&#125;/geoserver/&#123;workspace&#125;/wfs"</span>,</span><br><span class="line">  typeNS: <span class="string">"&#123;workspace&#125;"</span>,</span><br><span class="line">  typeName: <span class="string">"&#123;layerName&#125;"</span>,</span><br><span class="line">  geometryField: <span class="string">"&#123;geomName&#125;"</span>,</span><br><span class="line">  filter: isNull,</span><br><span class="line">  maxFeatures: <span class="number">50</span>,</span><br><span class="line">&#125;).on(<span class="string">'load'</span>, res =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="1-5-4-2-WFS-T-在线编辑"><a href="#1-5-4-2-WFS-T-在线编辑" class="headerlink" title="1.5.4.2 WFS-T 在线编辑"></a>1.5.4.2 WFS-T 在线编辑</h6><ul>
<li>初始化</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; WFST &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; WFST &#125; from 'cci-wfs'</span></span><br><span class="line"><span class="keyword">let</span> wfst = <span class="keyword">new</span> WFST(&#123;</span><br><span class="line">  url: <span class="string">"http://&#123;ip&#125;:&#123;port&#125;/geoserver/gis/wfs"</span>,</span><br><span class="line">  typeNS: <span class="string">"&#123;workspaceName&#125;"</span>,</span><br><span class="line">  typeName: <span class="string">"&#123;layerName&#125;"</span>,</span><br><span class="line">  geometryField: <span class="string">"&#123;geomFieldName&#125;"</span>,</span><br><span class="line">  maxFeatures: <span class="number">50</span>,</span><br><span class="line">  crs: &#123;</span><br><span class="line">    code: <span class="string">"EPSG:4326"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;).on(<span class="string">'load'</span>, res =&gt; &#123;</span><br><span class="line">  <span class="comment">// 查询结果</span></span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>新增</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Geojson &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span> </span><br><span class="line"><span class="comment">// import &#123; Geojson &#125; from 'cci-wfs'</span></span><br><span class="line"><span class="comment">// 新增要素</span></span><br><span class="line"><span class="keyword">const</span> geom = &#123;</span><br><span class="line">  type: <span class="string">"LineString"</span>,</span><br><span class="line">  coordinates: [</span><br><span class="line">    [<span class="number">120.03481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">    [<span class="number">120.33481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">    [<span class="number">120.33481352</span>, <span class="number">30.15337265</span>],</span><br><span class="line">    [<span class="number">120.03481352</span>, <span class="number">30.15337265</span>],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> geommm = Geojson(geom);</span><br><span class="line"><span class="keyword">const</span> layerAdd = &#123;</span><br><span class="line">  id: <span class="number">1</span>, <span class="comment">// 用于标识未保存的数据，未保存的数据里唯一</span></span><br><span class="line">  feature: &#123; <span class="comment">// 记录要素信息，主键id自动生成</span></span><br><span class="line">    properties: &#123;&#125;,</span><br><span class="line">    geometry: geommm</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 完成操作时增加</span></span><br><span class="line">wfst.addLayer(layerAdd)</span><br><span class="line"><span class="comment">// 保存提交数据</span></span><br><span class="line">wfst.save();</span><br></pre></td></tr></table></figure>
<ul>
<li>编辑</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Geojson &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span> </span><br><span class="line"><span class="comment">// import &#123; Geojson &#125; from 'cci-wfs'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 编辑数据</span></span><br><span class="line"><span class="keyword">const</span> geomUpdate = &#123;</span><br><span class="line">  type: <span class="string">"LineString"</span>,</span><br><span class="line">  coordinates: [</span><br><span class="line">    [<span class="number">120.03481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">    [<span class="number">120.33481352</span>, <span class="number">30.35337265</span>],</span><br><span class="line">    [<span class="number">120.33481352</span>, <span class="number">30.15337265</span>]</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> updateGeom = Geojson(geomUpdate);</span><br><span class="line"><span class="keyword">const</span> layerUpdate = &#123;</span><br><span class="line">  id: <span class="number">2</span>,</span><br><span class="line">  feature: &#123;</span><br><span class="line">    id: <span class="string">'&#123;id&#125;'</span>,</span><br><span class="line">    <span class="comment">// 更新的属性</span></span><br><span class="line">    properties: &#123;</span><br><span class="line">      propertyName: <span class="string">"test"</span>,</span><br><span class="line">      propertyName2: <span class="string">"test2"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 更新的空间信息</span></span><br><span class="line">    geometry: updateGeom,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">wfst.editLayer(layerUpdate);</span><br><span class="line">wfst.save();</span><br></pre></td></tr></table></figure>
<ul>
<li>删除</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移除数据</span></span><br><span class="line"><span class="keyword">const</span> layerRemove = &#123;</span><br><span class="line">  id: <span class="number">2</span>,  <span class="comment">// 用于标识未保存的数据，未保存的数据里唯一</span></span><br><span class="line">  feature: &#123;</span><br><span class="line">    id: <span class="string">'&#123;id&#125;'</span> <span class="comment">// 数据中的id</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">wfst.removeLayer(layer);</span><br><span class="line">wfst.save();</span><br></pre></td></tr></table></figure>
<h3 id="2-搜索"><a href="#2-搜索" class="headerlink" title="2. 搜索"></a>2. 搜索</h3><h4 id="2-1-根据地址描述搜索地址接口"><a href="#2-1-根据地址描述搜索地址接口" class="headerlink" title="2.1 根据地址描述搜索地址接口"></a>2.1 根据地址描述搜索地址接口</h4><h5 id="2-1-1-接口说明"><a href="#2-1-1-接口说明" class="headerlink" title="2.1.1 接口说明"></a>2.1.1 接口说明</h5><p>对用户输入的地名地址进行搜索，返回标准地址。</p>
<h5 id="2-1-2-接口地址"><a href="#2-1-2-接口地址" class="headerlink" title="2.1.2 接口地址"></a>2.1.2 接口地址</h5><p><a href="http://172.18.34.198:8000/geocoding-web/geocode/getLocationByAddressV2" target="_blank" rel="noopener">http://172.18.34.198:8000/geocoding-web/geocode/getLocationByAddressV2</a></p>
<h5 id="2-1-3-请求方式"><a href="#2-1-3-请求方式" class="headerlink" title="2.1.3 请求方式"></a>2.1.3 请求方式</h5><p>GET/POST</p>
<h5 id="2-1-4-参数说明"><a href="#2-1-4-参数说明" class="headerlink" title="2.1.4 参数说明"></a>2.1.4 参数说明</h5><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>addr</td>
<td>待搜索的地址</td>
<td>字符串</td>
<td>是</td>
</tr>
<tr>
<td>page</td>
<td>结果分页参数，分页页码，默认 1</td>
<td>整数</td>
<td>否</td>
</tr>
<tr>
<td>limit</td>
<td>结果分页参数，每页结果数，默认 10</td>
<td>整数</td>
<td>否</td>
</tr>
<tr>
<td>where</td>
<td>地址类型查询条件参数， 查询楼栋： [{“key”:”address_type”,”logic”:0,”value”:1}] 查询户室： [{“key”:”address_type”,”logic”:0,”value”:0}] 查询室外地址： [{“key”:”address_type”,”logic”:5,”value”:1}] 查询非室外地址： [{“key”:”address_type”,”logic”:4,”value”:1}] 事件报送用： [{“key”:”address_type”,”logic”:8,”value”:[“0”,”1”,”61”,”62”,” 75”,”76”,”77”,”78”,”79”,”81”,”82”,”83”,”84”,”91”,”92”,”93 “,”94”,”95”,”96”,”97”,”98”]}]</td>
<td>json 格式的 字符串 Post 传。 form-data</td>
<td>否</td>
</tr>
</tbody>
</table>
<h5 id="2-1-5-请求示例"><a href="#2-1-5-请求示例" class="headerlink" title="2.1.5 请求示例"></a>2.1.5 请求示例</h5><p><a href="http://172.18.34.198:8000/geocoding-web/geocode/getLocationByAddressV2?addr=天街&amp;page=1&amp;limit=10" target="_blank" rel="noopener">http://172.18.34.198:8000/geocoding-web/geocode/getLocationByAddressV2?addr=天街&amp;page=1&amp;limit=10</a></p>
<h5 id="2-1-6-返回示例"><a href="#2-1-6-返回示例" class="headerlink" title="2.1.6 返回示例"></a>2.1.6 返回示例</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"code"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"操作成功"</span>,</span><br><span class="line">    <span class="string">"data"</span>: &#123;</span><br><span class="line">        <span class="string">"code"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"msg"</span>: <span class="string">"成功"</span>,</span><br><span class="line">        <span class="string">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"data"</span>: &#123;</span><br><span class="line">            <span class="string">"hits"</span>: <span class="number">7758591</span>,</span><br><span class="line">            <span class="string">"count"</span>: <span class="number">10000</span>,</span><br><span class="line">            <span class="string">"addrList"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.203829</span>,</span><br><span class="line">                            <span class="number">30.294988</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330104012021004910017"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"上城区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.203829</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">10</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330102016018004"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.203829</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.294988</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"红街天城"</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.45312497</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市上城区笕桥街道天新社区红街天城"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.294988</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"笕桥街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">91</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"天新社区"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.201323</span>,</span><br><span class="line">                            <span class="number">30.296952</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330104012021003910015"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"上城区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.201323</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">10</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330102016018003"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.201323</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.296952</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"红街公寓"</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.40010315</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市上城区笕桥街道天新社区红街公寓"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.296952</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"笕桥街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">91</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"天新社区"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.202346</span>,</span><br><span class="line">                            <span class="number">30.296307</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330104012021002910013"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"上城区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.202346</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">10</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330102016018002"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.202346</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.296307</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"红街公寓"</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.40010315</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市上城区笕桥街道天新社区红街公寓"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.296307</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"笕桥街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">91</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"天新社区"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.202134</span>,</span><br><span class="line">                            <span class="number">30.295621</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330104012021001910011"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"上城区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.202134</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">10</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330102016018001"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.202134</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.295621</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"红街公寓"</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.40010315</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市上城区笕桥街道天新社区红街公寓"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.295621</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"笕桥街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">91</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"天新社区"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.315471</span>,</span><br><span class="line">                            <span class="number">30.364963</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330110002014003000118"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"临平区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.315471</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">11</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330113002012003"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="string">"梵天寺"</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.315471</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.364963</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.39240736</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="string">"天小线"</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市临平区南苑街道天万社区3组天小线梵天寺"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.364963</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"南苑街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"天万社区"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="string">"3组"</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.210785</span>,</span><br><span class="line">                            <span class="number">30.353536</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"33010401300300198048X"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"上城区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.210785</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">10</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330102017026001"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.210785</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.353536</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"龙湖天街"</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.39240736</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市上城区丁兰街道丁兰街道直属网格龙湖天街"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.353536</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"丁兰街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">98</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"丁兰街道直属网格"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.209081</span>,</span><br><span class="line">                            <span class="number">30.353474</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330104013003001980244"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"上城区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.209081</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">11</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330102017026001"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="string">"西门"</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.209081</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.353474</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"龙湖天街"</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.39240736</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市上城区丁兰街道丁兰街道直属网格龙湖天街西门"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.353474</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"丁兰街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">98</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"丁兰街道直属网格"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.211064</span>,</span><br><span class="line">                            <span class="number">30.354779</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330104013003001980252"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"上城区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.211064</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">11</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330102017026001"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="string">"东门"</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.211064</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.354779</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"龙湖天街"</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.39240736</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市上城区丁兰街道丁兰街道直属网格龙湖天街东门"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.354779</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"丁兰街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">98</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"丁兰街道直属网格"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="string">"318号"</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.204213</span>,</span><br><span class="line">                            <span class="number">30.294643</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330104012021004000099"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"上城区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.204213</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">12</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330102016018004"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="string">"6幢"</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.204213</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.294643</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"红街天城"</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.39062497</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="string">"新风路"</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市上城区笕桥街道天新社区新风路318号红街天城6幢"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.294643</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"笕桥街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"天新社区"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="string">"318号"</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.203276</span>,</span><br><span class="line">                            <span class="number">30.294787</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330104012021004000080"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"上城区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.203276</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">12</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330102016018004"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="string">"5幢"</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.203276</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.294787</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"红街天城"</span>,</span><br><span class="line">                    <span class="string">"score"</span>: <span class="number">0.39062497</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="string">"新风路"</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市上城区笕桥街道天新社区新风路318号红街天城5幢"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.294787</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"笕桥街道"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"天新社区"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"is_delete"</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="number">0</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"success"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-1-7-返回参数说明"><a href="#2-1-7-返回参数说明" class="headerlink" title="2.1.7 返回参数说明"></a>2.1.7 返回参数说明</h5><p><img src="https://z3.ax1x.com/2021/11/24/oPtUNq.png" alt></p>
<h4 id="2-2-通过坐标点获取地址描述信息"><a href="#2-2-通过坐标点获取地址描述信息" class="headerlink" title="2.2 通过坐标点获取地址描述信息"></a>2.2 通过坐标点获取地址描述信息</h4><h5 id="2-2-1-接口说明"><a href="#2-2-1-接口说明" class="headerlink" title="2.2.1 接口说明"></a>2.2.1 接口说明</h5><p>根据坐标获取地址描述信息，通过输入的坐标，查询离输入坐标点最近的地址数据， 并返回输入坐标点相对于该条地址的坐标方位信息和相对距离。</p>
<h5 id="2-2-2-接口地址"><a href="#2-2-2-接口地址" class="headerlink" title="2.2.2 接口地址"></a>2.2.2 接口地址</h5><p><a href="http://172.18.34.198:8000/geocoding-web/geocode/getLocationByPoint" target="_blank" rel="noopener">http://172.18.34.198:8000/geocoding-web/geocode/getLocationByPoint</a></p>
<h5 id="2-2-3-请求方式"><a href="#2-2-3-请求方式" class="headerlink" title="2.2.3 请求方式"></a>2.2.3 请求方式</h5><p>GET/POST</p>
<h5 id="2-2-4-参数说明"><a href="#2-2-4-参数说明" class="headerlink" title="2.2.4 参数说明"></a>2.2.4 参数说明</h5><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>lat</td>
<td>纬度</td>
<td>Double</td>
<td>是</td>
</tr>
<tr>
<td>lon</td>
<td>经度</td>
<td>Double</td>
<td>是</td>
</tr>
<tr>
<td>distance</td>
<td>查询范围的半径, 传参时需要指定距离 单位，不传默认为 1km，支持距离单位 m 和 km，如果想查询 500m 范围内的数 据，可以传 500m 或 0.5km</td>
<td>String</td>
<td>否</td>
</tr>
<tr>
<td>addressType</td>
<td>地址类型：0 房屋，1 楼栋，不传查询 全部地址类型</td>
<td>String</td>
<td>否</td>
</tr>
<tr>
<td>page</td>
<td>分页页码, 默认为 1</td>
<td>Integer</td>
<td>否</td>
</tr>
<tr>
<td>size</td>
<td>每页大小, 默认为 1</td>
<td>Integer</td>
<td>否</td>
</tr>
</tbody>
</table>
<h5 id="2-2-5-请求示例"><a href="#2-2-5-请求示例" class="headerlink" title="2.2.5 请求示例"></a>2.2.5 请求示例</h5><p><a href="http://172.18.34.198:8000/geocoding-web/geocode/getLocationByPoint?lon=120&amp;lat=30" target="_blank" rel="noopener">http://172.18.34.198:8000/geocoding-web/geocode/getLocationByPoint?lon=120&amp;lat=30</a></p>
<h5 id="2-2-6-返回示例"><a href="#2-2-6-返回示例" class="headerlink" title="2.2.6 返回示例"></a>2.2.6 返回示例</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"code"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"message"</span>: <span class="string">"操作成功"</span>,</span><br><span class="line">    <span class="string">"data"</span>: &#123;</span><br><span class="line">        <span class="string">"code"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"msg"</span>: <span class="string">"成功"</span>,</span><br><span class="line">        <span class="string">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"data"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"near_addr"</span>: <span class="string">"杭州市富阳区大源镇亭山村蝴蝶阁东门"</span>,</span><br><span class="line">                <span class="string">"is_overlap"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"rel_near_addr_position"</span>: <span class="string">"西南"</span>,</span><br><span class="line">                <span class="string">"addr_desc"</span>: &#123;</span><br><span class="line">                    <span class="string">"door"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"loc"</span>: &#123;</span><br><span class="line">                        <span class="string">"coordinates"</span>: [</span><br><span class="line">                            <span class="number">120.0001177</span>,</span><br><span class="line">                            <span class="number">30.00012726</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="string">"type"</span>: <span class="string">"Point"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"code"</span>: <span class="string">"330111117243002980038"</span>,</span><br><span class="line">                    <span class="string">"city"</span>: <span class="string">"杭州市"</span>,</span><br><span class="line">                    <span class="string">"county"</span>: <span class="string">"富阳区"</span>,</span><br><span class="line">                    <span class="string">"belong_building"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"check_type"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lon"</span>: <span class="number">120.0001177</span>,</span><br><span class="line">                    <span class="string">"lv"</span>: <span class="number">11</span>,</span><br><span class="line">                    <span class="string">"grid_code"</span>: <span class="string">"330111117243002"</span>,</span><br><span class="line">                    <span class="string">"addrReachCoordinatePosition"</span>: <span class="string">"西南"</span>,</span><br><span class="line">                    <span class="string">"building_num"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"building"</span>: <span class="string">"东门"</span>,</span><br><span class="line">                    <span class="string">"point"</span>: &#123;</span><br><span class="line">                        <span class="string">"lon"</span>: <span class="number">120.0001177</span>,</span><br><span class="line">                        <span class="string">"lat"</span>: <span class="number">30.00012726</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">"resregion"</span>: <span class="string">"蝴蝶阁"</span>,</span><br><span class="line">                    <span class="string">"szone"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"usage_type"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"street"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"addr"</span>: <span class="string">"杭州市富阳区大源镇亭山村蝴蝶阁东门"</span>,</span><br><span class="line">                    <span class="string">"village"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"lat"</span>: <span class="number">30.00012726</span>,</span><br><span class="line">                    <span class="string">"room_floor"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"town"</span>: <span class="string">"大源镇"</span>,</span><br><span class="line">                    <span class="string">"address_type"</span>: <span class="string">"98"</span>,</span><br><span class="line">                    <span class="string">"shape"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"community"</span>: <span class="string">"亭山村"</span>,</span><br><span class="line">                    <span class="string">"room"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"unit"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"squad"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="string">"datasource"</span>: <span class="string">"网格员采集"</span>,</span><br><span class="line">                    <span class="string">"is_multi"</span>: <span class="string">"0"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"rel_near_addr_distance"</span>: <span class="number">18</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"success"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-2-7-返回参数说明"><a href="#2-2-7-返回参数说明" class="headerlink" title="2.2.7 返回参数说明"></a>2.2.7 返回参数说明</h5><p><img src="https://z3.ax1x.com/2021/11/24/oPta40.png" alt></p>
<p><img src="https://z3.ax1x.com/2021/11/24/oPtNEn.png" alt></p>
<h3 id="3-路径规划"><a href="#3-路径规划" class="headerlink" title="3. 路径规划"></a>3. 路径规划</h3><p>路径规划方法 <strong>pathPlan</strong> 内部调用高德服务接口，参数需要传入高德地图服务 token</p>
<h4 id="3-1-请求参数说明"><a href="#3-1-请求参数说明" class="headerlink" title="3.1 请求参数说明"></a>3.1 请求参数说明</h4><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>token</td>
<td>高德地图服务 token</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>origin</td>
<td>起点火星坐标系经纬度字符串，用逗号拼接</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>destination</td>
<td>终点火星坐标系经纬度字符串，用逗号拼接</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>by</td>
<td>交通类型：walking/bicycling/electrobike/bus/driving  默认driving</td>
<td>String</td>
<td>否</td>
</tr>
<tr>
<td>toCRS</td>
<td>指定高德路径数据转换经纬度坐标系，gcj02/wgs84/bd09, 默认 gcj02，也就是不做转换</td>
<td>String</td>
<td>否</td>
</tr>
</tbody>
</table>
<h4 id="3-2-示例"><a href="#3-2-示例" class="headerlink" title="3.2 示例"></a>3.2 示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; LineLayer, CMap, GaodeMap, pathPlan, polylineString2coords &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; LineLayer &#125; from 'cci-layers'</span></span><br><span class="line"><span class="comment">// import &#123; pathPlan, polylineString2coords &#125; from 'cci-utils'</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    center: [<span class="number">120.19382669582967</span>, <span class="number">30.258134</span>],</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    zoom: <span class="number">8</span>,</span><br><span class="line">    viewMode: <span class="string">'3D'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="string">'9795c67f0efaf73a3276c40ccf55a428'</span></span><br><span class="line">  <span class="keyword">const</span> origin = <span class="string">'120,30'</span></span><br><span class="line">  <span class="keyword">const</span> destination = <span class="string">'121,30'</span></span><br><span class="line">  pathPlan(&#123;</span><br><span class="line">    token, origin, destination</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> multiLineString = []</span><br><span class="line">    res.route.paths[<span class="number">0</span>].steps.forEach(<span class="function"><span class="params">path</span> =&gt;</span> &#123;</span><br><span class="line">      multiLineString.push(polylineString2coords(path.polyline, <span class="string">';'</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> layer = <span class="keyword">new</span> LineLayer(&#123;&#125;)</span><br><span class="line">    .source(&#123;</span><br><span class="line">      type: <span class="string">'FeatureCollection'</span>,</span><br><span class="line">      name: <span class="string">'dl2'</span>,</span><br><span class="line">      crs: &#123;</span><br><span class="line">        type: <span class="string">'name'</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          name: <span class="string">'urn:ogc:def:crs:OGC:1.3:CRS84'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      features: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'Feature'</span>,</span><br><span class="line">          properties: &#123;&#125;,</span><br><span class="line">          geometry: &#123;</span><br><span class="line">            type: <span class="string">'MultiLineString'</span>,</span><br><span class="line">            coordinates: multiLineString</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">    .size(<span class="number">1</span>)</span><br><span class="line">    .shape(<span class="string">'line'</span>)</span><br><span class="line">    .color(<span class="string">'#25d8b7'</span>)</span><br><span class="line">    scene.addLayer(layer)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="4-路径纠偏"><a href="#4-路径纠偏" class="headerlink" title="4. 路径纠偏"></a>4. 路径纠偏</h3><p>路径纠偏 <strong>graspPath</strong> 内部调用高德服务接口，参数需要传入高德地图 token</p>
<ul>
<li><p>纠偏之前需要按照下面的数据规格准备原始轨迹点，<code>x、y、sp、ag、tm</code>分别代表经度、纬度、速度、角度、时间。</p>
</li>
<li><p>经纬度应该是高德坐标，而不是GPS直接采集的坐标</p>
</li>
<li><p>tm以秒为单位，第一个采集点的tm值从1970年0点开始，其他采集点为与第一个采集点时间的差值</p>
</li>
</ul>
<h4 id="4-1-请求参数说明"><a href="#4-1-请求参数说明" class="headerlink" title="4.1 请求参数说明"></a>4.1 请求参数说明</h4><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>token</td>
<td>高德地图服务 token</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>version</td>
<td>高德地图 api 版本，默认 2.0</td>
<td>String</td>
<td>否</td>
</tr>
<tr>
<td>path</td>
<td>火星坐标系经纬度数组</td>
<td>Array</td>
<td>是</td>
</tr>
<tr>
<td>toCRS</td>
<td>指定高德路径数据转换经纬度坐标系，gcj02/wgs84/bd09, 默认 gcj02，也就是不做转换</td>
<td>String</td>
<td>否</td>
</tr>
</tbody>
</table>
<h4 id="4-2-返回参数"><a href="#4-2-返回参数" class="headerlink" title="4.2 返回参数"></a>4.2 返回参数</h4><ul>
<li>distance 返回里程数</li>
<li>newPath 返回纠偏后对应坐标系经纬度数组</li>
</ul>
<h4 id="4-3-示例"><a href="#4-3-示例" class="headerlink" title="4.3 示例"></a>4.3 示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Scene, MapTalks, graspPath, lineLayer &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; Scene, MapTalks &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; graspPath &#125; from 'cci-utils'</span></span><br><span class="line"><span class="comment">// import &#123; lineLayer &#125; from 'cci-layers'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> Scene(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> MapTalks(&#123;</span><br><span class="line">    center: [<span class="number">116.478928</span>, <span class="number">39.997761</span>],</span><br><span class="line">    zoom: <span class="number">16</span>,</span><br><span class="line">    style: <span class="string">'light'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> path = [</span><br><span class="line">    &#123; <span class="string">"x"</span>: <span class="number">116.478928</span>, <span class="string">"y"</span>: <span class="number">39.997761</span>, <span class="string">"sp"</span>: <span class="number">19</span>, <span class="string">"ag"</span>: <span class="number">0</span>, <span class="string">"tm"</span>: <span class="number">1478031031</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"x"</span>: <span class="number">116.478907</span>, <span class="string">"y"</span>: <span class="number">39.998422</span>, <span class="string">"sp"</span>: <span class="number">10</span>, <span class="string">"ag"</span>: <span class="number">0</span>, <span class="string">"tm"</span>: <span class="number">2</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"x"</span>: <span class="number">116.479384</span>, <span class="string">"y"</span>: <span class="number">39.998546</span>, <span class="string">"sp"</span>: <span class="number">10</span>, <span class="string">"ag"</span>: <span class="number">110</span>, <span class="string">"tm"</span>: <span class="number">3</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"x"</span>: <span class="number">116.481053</span>, <span class="string">"y"</span>: <span class="number">39.998204</span>, <span class="string">"sp"</span>: <span class="number">10</span>, <span class="string">"ag"</span>: <span class="number">120</span>, <span class="string">"tm"</span>: <span class="number">4</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"x"</span>: <span class="number">116.481793</span>, <span class="string">"y"</span>: <span class="number">39.997868</span>, <span class="string">"sp"</span>: <span class="number">10</span>, <span class="string">"ag"</span>: <span class="number">120</span>, <span class="string">"tm"</span>: <span class="number">5</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"x"</span>: <span class="number">116.482898</span>, <span class="string">"y"</span>: <span class="number">39.998217</span>, <span class="string">"sp"</span>: <span class="number">10</span>, <span class="string">"ag"</span>: <span class="number">30</span>, <span class="string">"tm"</span>: <span class="number">6</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"x"</span>: <span class="number">116.483789</span>, <span class="string">"y"</span>: <span class="number">39.999063</span>, <span class="string">"sp"</span>: <span class="number">10</span>, <span class="string">"ag"</span>: <span class="number">30</span>, <span class="string">"tm"</span>: <span class="number">7</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"x"</span>: <span class="number">116.484674</span>, <span class="string">"y"</span>: <span class="number">39.999844</span>, <span class="string">"sp"</span>: <span class="number">10</span>, <span class="string">"ag"</span>: <span class="number">30</span>, <span class="string">"tm"</span>: <span class="number">8</span> &#125;</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> formatPath = path.map(<span class="function"><span class="params">p</span> =&gt;</span> [p.x, p.y])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> oldLine = <span class="keyword">new</span> LineLayer()</span><br><span class="line">  .source(&#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"FeatureCollection"</span>,</span><br><span class="line">    <span class="string">"features"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">        <span class="string">"geometry"</span>: &#123;</span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"LineString"</span>,</span><br><span class="line">          <span class="string">"coordinates"</span>: formatPath</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line">  .color(<span class="string">'red'</span>)</span><br><span class="line">  scene.addLayer(oldLine)</span><br><span class="line"></span><br><span class="line">  graspPath(&#123;</span><br><span class="line">    path,</span><br><span class="line">    toCRS: <span class="string">'wgs84'</span></span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">&#123; newPath &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    newPath = newPath.map(<span class="function"><span class="params">p</span> =&gt;</span> [p.x, p.y])</span><br><span class="line">    <span class="keyword">const</span> newLine = <span class="keyword">new</span> LineLayer()</span><br><span class="line">    .source(&#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"FeatureCollection"</span>,</span><br><span class="line">      <span class="string">"features"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">          <span class="string">"geometry"</span>: &#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"LineString"</span>,</span><br><span class="line">            <span class="string">"coordinates"</span>: newPath</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">    .color(<span class="string">'blue'</span>)</span><br><span class="line">    scene.addLayer(newLine)</span><br><span class="line">  &#125;) </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="5-行政区划查询"><a href="#5-行政区划查询" class="headerlink" title="5. 行政区划查询"></a>5. 行政区划查询</h3><p>行政区划查询 <strong>districtQuery</strong> 内部调用高德服务接口，参数需要传入高德地图服务 token</p>
<h4 id="5-1-请求参数说明"><a href="#5-1-请求参数说明" class="headerlink" title="5.1 请求参数说明"></a>5.1 请求参数说明</h4><table>
<thead>
<tr>
<th style="text-align:left">参数名</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">规则说明</th>
<th style="text-align:left">是否必须</th>
<th style="text-align:left">缺省值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">token</td>
<td style="text-align:left">请求服务权限标识</td>
<td style="text-align:left">高德地图服务 token</td>
<td style="text-align:left">必填</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">keywords</td>
<td style="text-align:left">查询关键字</td>
<td style="text-align:left">规则：只支持单个关键词语搜索关键词支持：行政区名称、citycode、adcode例如，在subdistrict=2，搜索省份（例如山东），能够显示市（例如济南），区（例如历下区）adcode信息可参考<a href="https://lbs.amap.com/api/webservice/download" target="_blank" rel="noopener">城市编码表</a>获取</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">subdistrict</td>
<td style="text-align:left">子级行政区</td>
<td style="text-align:left">规则：设置显示下级行政区级数（行政区级别包括：国家、省/直辖市、市、区/县、乡镇/街道多级数据）可选值：0、1、2、3等数字，并以此类推0：不返回下级行政区；1：返回下一级行政区；2：返回下两级行政区；3：返回下三级行政区； 需要在此特殊说明，目前部分城市和省直辖县因为没有区县的概念，故在市级下方直接显示街道。例如：广东-东莞、海南-文昌市</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">page</td>
<td style="text-align:left">需要第几页数据</td>
<td style="text-align:left">最外层的districts最多会返回20个数据，若超过限制，请用page请求下一页数据。例如page=2；page=3。默认page=1</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">offset</td>
<td style="text-align:left">最外层返回数据个数</td>
<td style="text-align:left"></td>
<td style="text-align:left">可选</td>
<td style="text-align:left">20</td>
</tr>
<tr>
<td style="text-align:left">extensions</td>
<td style="text-align:left">返回结果控制</td>
<td style="text-align:left">此项控制行政区信息中返回行政区边界坐标点； 可选值：base、all;base:不返回行政区边界坐标点；all:只返回当前查询district的边界值，不返回子节点的边界值；目前<strong>不能</strong>返回乡镇/街道级别的边界值</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">base</td>
</tr>
<tr>
<td style="text-align:left">filter</td>
<td style="text-align:left">根据区划过滤</td>
<td style="text-align:left">按照指定行政区划进行过滤，填入后则只返回该省/直辖市信息需填入adcode，为了保证数据的正确，强烈建议填入此参数</td>
<td style="text-align:left">可选</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">callback</td>
<td style="text-align:left">回调函数</td>
<td style="text-align:left">callback值是用户定义的函数名称，此参数只在output=JSON时有效</td>
<td style="text-align:left">可选</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">output</td>
<td style="text-align:left">返回数据格式类型</td>
<td style="text-align:left">可选值：JSON，XML</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">JSON</td>
</tr>
<tr>
<td style="text-align:left">toCRS</td>
<td style="text-align:left">返回数据坐标系</td>
<td style="text-align:left">指定高德行政区划查询数据转换经纬度坐标系，gcj02/wgs84/bd09, 默认 gcj02，也就是不做转换</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">gcj02</td>
</tr>
</tbody>
</table>
<h4 id="5-2-返回参数"><a href="#5-2-返回参数" class="headerlink" title="5.2 返回参数"></a>5.2 返回参数</h4><table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th>含义</th>
<th>规则说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">status</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>返回结果状态值</td>
<td>值为0或1，0表示失败；1表示成功</td>
</tr>
<tr>
<td style="text-align:left">info</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>返回状态说明</td>
<td>返回状态说明，status为0时，info返回错误原因，否则返回“OK”。</td>
</tr>
<tr>
<td style="text-align:left">infocode</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>状态码</td>
<td>返回状态说明，10000代表正确，详情参阅info状态表</td>
</tr>
<tr>
<td style="text-align:left">suggestion</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>建议结果列表</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">keywords</td>
<td style="text-align:left"></td>
<td>建议关键字列表</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">cites</td>
<td style="text-align:left"></td>
<td>建议城市列表</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">districts</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>行政区列表</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">district</td>
<td style="text-align:left"></td>
<td>行政区信息</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">citycode</td>
<td>城市编码</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">adcode</td>
<td>区域编码</td>
<td>街道没有独有的adcode，均继承父类（区县）的adcode</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">name</td>
<td>行政区名称</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">polyline</td>
<td>行政区边界坐标点</td>
<td>当一个行政区范围，由完全分隔两块或者多块的地块组成，每块地的 polyline 坐标串以 \</td>
<td>分隔 。如北京 的 朝阳区</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">center</td>
<td>区域中心点</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">level</td>
<td>行政区划级别</td>
<td>country:国家province:省份（直辖市会在province和city显示）city:市（直辖市会在province和city显示）district:区县street:街道</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">districts</td>
<td>下级行政区列表，包含district元素</td>
</tr>
</tbody>
</table>
<h4 id="5-3-示例-1"><a href="#5-3-示例-1" class="headerlink" title="5.3 示例"></a>5.3 示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap, districtQuery &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; districtQuery &#125; from 'cci-utils'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    center: [<span class="number">120.19382669582967</span>, <span class="number">30.258134</span>],</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    zoom: <span class="number">8</span>,</span><br><span class="line">    viewMode: <span class="string">'3D'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="string">'9795c67f0efaf73a3276c40ccf55a428'</span></span><br><span class="line">  districtQuery(&#123;</span><br><span class="line">    token,</span><br><span class="line">    <span class="comment">// toCRS: 'wgs84',</span></span><br><span class="line">    keywords: <span class="string">'山东'</span>,</span><br><span class="line">    subdistrict: <span class="number">3</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res, <span class="string">'res:::::::::::::'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="6-天气查询"><a href="#6-天气查询" class="headerlink" title="6. 天气查询"></a>6. 天气查询</h3><p>天气查询 <strong>weatherQuery</strong> 内部调用高德服务接口，参数需要传入高德地图服务 token</p>
<h4 id="6-1-请求参数说明"><a href="#6-1-请求参数说明" class="headerlink" title="6.1 请求参数说明"></a>6.1 请求参数说明</h4><table>
<thead>
<tr>
<th style="text-align:left">参数名</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">规则说明</th>
<th style="text-align:left">是否必须</th>
<th style="text-align:left">缺省值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">token</td>
<td style="text-align:left">请求服务权限标识</td>
<td style="text-align:left">高德地图服务 token</td>
<td style="text-align:left">必填</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">city</td>
<td style="text-align:left">城市编码</td>
<td style="text-align:left">输入城市的adcode，adcode信息可参考<a href="https://lbs.amap.com/api/webservice/download" target="_blank" rel="noopener">城市编码表</a></td>
<td style="text-align:left">必填</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">extensions</td>
<td style="text-align:left">气象类型</td>
<td style="text-align:left">可选值：base/allbase:返回实况天气 all:返回预报天气</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">output</td>
<td style="text-align:left">返回格式</td>
<td style="text-align:left">可选值：JSON,XML</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">JSON</td>
</tr>
</tbody>
</table>
<h4 id="6-2-返回参数说明"><a href="#6-2-返回参数说明" class="headerlink" title="6.2 返回参数说明"></a>6.2 返回参数说明</h4><p>实况天气每小时更新多次，预报天气每天更新3次，分别在8、11、18点左右更新。由于天气数据的特殊性以及数据更新的持续性，无法确定精确的更新时间，请以接口返回数据的reporttime字段为准。<a href="https://lbs.amap.com/api/webservice/guide/tools/weather-code/" target="_blank" rel="noopener">天气结果对照表&gt;&gt;</a></p>
<table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th>含义</th>
<th>规则说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">status</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>返回状态</td>
<td>值为0或11：成功；0：失败</td>
</tr>
<tr>
<td style="text-align:left">count</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>返回结果总数目</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">info</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>返回的状态信息</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">infocode</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>返回状态说明,10000代表正确</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">lives</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>实况天气数据信息</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">province</td>
<td style="text-align:left"></td>
<td>省份名</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">city</td>
<td style="text-align:left"></td>
<td>城市名</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">adcode</td>
<td style="text-align:left"></td>
<td>区域编码</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">weather</td>
<td style="text-align:left"></td>
<td>天气现象（汉字描述）</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">temperature</td>
<td style="text-align:left"></td>
<td>实时气温，单位：摄氏度</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">winddirection</td>
<td style="text-align:left"></td>
<td>风向描述</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">windpower</td>
<td style="text-align:left"></td>
<td>风力级别，单位：级</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">humidity</td>
<td style="text-align:left"></td>
<td>空气湿度</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">reporttime</td>
<td style="text-align:left"></td>
<td>数据发布的时间</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">forecast</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>预报天气信息数据</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">city</td>
<td style="text-align:left"></td>
<td>城市名称</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">adcode</td>
<td style="text-align:left"></td>
<td>城市编码</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">province</td>
<td style="text-align:left"></td>
<td>省份名称</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">reporttime</td>
<td style="text-align:left"></td>
<td>预报发布时间</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">casts</td>
<td style="text-align:left"></td>
<td>预报数据list结构，元素cast,按顺序为当天、第二天、第三天的预报数据</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">date</td>
<td>日期</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">week</td>
<td>星期几</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">dayweather</td>
<td>白天天气现象</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">nightweather</td>
<td>晚上天气现象</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">daytemp</td>
<td>白天温度</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">nighttemp</td>
<td>晚上温度</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">daywind</td>
<td>白天风向</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">nightwind</td>
<td>晚上风向</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">daypower</td>
<td>白天风力</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">nightpower</td>
<td>晚上风力</td>
</tr>
</tbody>
</table>
<h4 id="6-3-示例-1"><a href="#6-3-示例-1" class="headerlink" title="6.3 示例"></a>6.3 示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap, weatherQuery &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; weatherQuery &#125; from 'cci-utils'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    center: [<span class="number">120.19382669582967</span>, <span class="number">30.258134</span>],</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    zoom: <span class="number">8</span>,</span><br><span class="line">    viewMode: <span class="string">'3D'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="string">'9795c67f0efaf73a3276c40ccf55a428'</span></span><br><span class="line">  weatherQuery(&#123;</span><br><span class="line">    token,</span><br><span class="line">    city: <span class="string">'110101'</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res, <span class="string">'res:::::::::::::'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="7-ip-查询"><a href="#7-ip-查询" class="headerlink" title="7. ip 查询"></a>7. ip 查询</h3><p>ip查询  <strong>ipQuery</strong> 内部调用高德服务接口，参数需要传入高德地图服务 token</p>
<h4 id="7-1-请求参数说明"><a href="#7-1-请求参数说明" class="headerlink" title="7.1 请求参数说明"></a>7.1 请求参数说明</h4><table>
<thead>
<tr>
<th style="text-align:left">参数名</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">规则</th>
<th style="text-align:left">是否必填</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">token</td>
<td style="text-align:left">请求服务权限标识</td>
<td style="text-align:left">高德地图服务 token</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">type</td>
<td style="text-align:left">IP类型</td>
<td style="text-align:left">值为 4 或 6，4 表示 IPv4，6 表示 IPv6</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">ip</td>
<td style="text-align:left">要查询的ip地址</td>
<td style="text-align:left">如：221.206.131.10</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">sig</td>
<td style="text-align:left">数字签名</td>
<td style="text-align:left">数字签名认证用户必填</td>
<td style="text-align:left">否</td>
</tr>
<tr>
<td style="text-align:left">toCRS</td>
<td style="text-align:left">返回数据坐标系</td>
<td style="text-align:left">指定IP查询数据转换经纬度坐标系，gcj02/wgs84/bd09, 默认 gcj02，也就是不做转换</td>
<td style="text-align:left">否</td>
</tr>
</tbody>
</table>
<h4 id="7-2-返回参数说明"><a href="#7-2-返回参数说明" class="headerlink" title="7.2 返回参数说明"></a>7.2 返回参数说明</h4><table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">规则</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">status</td>
<td style="text-align:left">状态码</td>
<td style="text-align:left">返回结果状态值，值为0或1,0表示失败；1表示成功</td>
</tr>
<tr>
<td style="text-align:left">info</td>
<td style="text-align:left">返回状态说明</td>
<td style="text-align:left">status为0时，info返回错误原因；否则返回“OK”。详情参阅<a href="https://lbs.amap.com/api/webservice/info/" target="_blank" rel="noopener">info状态</a></td>
</tr>
<tr>
<td style="text-align:left">infocode</td>
<td style="text-align:left">状态码</td>
<td style="text-align:left">返回状态说明,10000代表正确,详情参阅info状态表</td>
</tr>
<tr>
<td style="text-align:left">country</td>
<td style="text-align:left">国家</td>
<td style="text-align:left">国家（或地区），中文</td>
</tr>
<tr>
<td style="text-align:left">province</td>
<td style="text-align:left">省份</td>
<td style="text-align:left">省（二级），中文</td>
</tr>
<tr>
<td style="text-align:left">city</td>
<td style="text-align:left">城市</td>
<td style="text-align:left">市（三级），中文</td>
</tr>
<tr>
<td style="text-align:left">district</td>
<td style="text-align:left">区县</td>
<td style="text-align:left">区（四级），中文</td>
</tr>
<tr>
<td style="text-align:left">isp</td>
<td style="text-align:left">运营商</td>
<td style="text-align:left">如电信、联通、移动</td>
</tr>
<tr>
<td style="text-align:left">location</td>
<td style="text-align:left">经纬度</td>
<td style="text-align:left">如 116.480881,39.989410</td>
</tr>
<tr>
<td style="text-align:left">Ip</td>
<td style="text-align:left">IP地址</td>
<td style="text-align:left">提交的 Ipv4/Ipv6 地址</td>
</tr>
</tbody>
</table>
<h4 id="7-3-示例"><a href="#7-3-示例" class="headerlink" title="7.3 示例"></a>7.3 示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap, ipQuery &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; ipQuery &#125; from 'cci-utils'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    center: [<span class="number">120.19382669582967</span>, <span class="number">30.258134</span>],</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    zoom: <span class="number">8</span>,</span><br><span class="line">    viewMode: <span class="string">'3D'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="string">'9795c67f0efaf73a3276c40ccf55a428'</span></span><br><span class="line">  ipQuery(&#123;</span><br><span class="line">    token,</span><br><span class="line">    <span class="comment">//toCRS: 'wgs84',</span></span><br><span class="line">    type: <span class="number">4</span>,</span><br><span class="line">    ip: <span class="string">'114.247.50.2'</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res, <span class="string">'res:::::::::::::'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="8-地理-逆地理编码"><a href="#8-地理-逆地理编码" class="headerlink" title="8 地理/逆地理编码"></a>8 地理/逆地理编码</h3><p>地理编码/逆地理编码 API 是通过 HTTP/HTTPS 协议访问远程服务的接口，提供结构化地址与经纬度之间的相互转化的能力</p>
<h4 id="8-1-地理编码"><a href="#8-1-地理编码" class="headerlink" title="8.1 地理编码"></a>8.1 地理编码</h4><p>地理编码 <strong>geocodeQuery</strong> 内部封装高德服务接口，需要提供高德地图服务 token</p>
<h5 id="8-1-1-请求参数说明"><a href="#8-1-1-请求参数说明" class="headerlink" title="8.1.1 请求参数说明"></a>8.1.1 请求参数说明</h5><table>
<thead>
<tr>
<th style="text-align:left">参数名</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">规则说明</th>
<th style="text-align:left">是否必须</th>
<th style="text-align:left">缺省值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">token</td>
<td style="text-align:left">请求权限服务标志</td>
<td style="text-align:left">高德地图服务 token</td>
<td style="text-align:left">必填</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">address</td>
<td style="text-align:left">结构化地址信息</td>
<td style="text-align:left">规则遵循：国家、省份、城市、区县、城镇、乡村、街道、门牌号码、屋邨、大厦，如：北京市朝阳区阜通东大街6号。如果需要解析多个地址的话，请用”\</td>
<td style="text-align:left">“进行间隔，并且将 batch 参数设置为 true，最多支持 10 个地址进进行”\</td>
<td style="text-align:left">“分割形式的请求。</td>
<td>必填</td>
<td>无</td>
</tr>
<tr>
<td style="text-align:left">city</td>
<td style="text-align:left">指定查询的城市</td>
<td style="text-align:left">可选输入内容包括：指定城市的中文（如北京）、指定城市的中文全拼（beijing）、citycode（010）、adcode（110000），不支持县级市。当指定城市查询内容为空时，会进行全国范围内的地址转换检索。adcode信息可参考<a href="https://lbs.amap.com/api/webservice/download" target="_blank" rel="noopener">城市编码表</a>获取</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">无，会进行全国范围内搜索</td>
</tr>
<tr>
<td style="text-align:left">batch</td>
<td style="text-align:left">批量查询控制</td>
<td style="text-align:left">batch 参数设置为 true 时进行批量查询操作，最多支持 10 个地址进行批量查询。batch 参数设置为 false 时进行单点查询，此时即使传入多个地址也只返回第一个地址的解析查询结果。</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">sig</td>
<td style="text-align:left">数字签名</td>
<td style="text-align:left">请参考<a href="https://lbs.amap.com/faq/account/key/72" target="_blank" rel="noopener">数字签名获取和使用方法</a></td>
<td style="text-align:left">可选</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">output</td>
<td style="text-align:left">返回数据格式类型</td>
<td style="text-align:left">可选输入内容包括：JSON，XML。设置 JSON 返回结果数据将会以JSON结构构成；如果设置 XML 返回结果数据将以 XML 结构构成。</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">JSON</td>
</tr>
<tr>
<td style="text-align:left">callback</td>
<td style="text-align:left">回调函数</td>
<td style="text-align:left">callback 值是用户定义的函数名称，此参数只在 output 参数设置为 JSON 时有效。</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">toCRS</td>
<td style="text-align:left">返回数据坐标系</td>
<td style="text-align:left">指定地理编码数据转换经纬度坐标系，gcj02/wgs84/bd09</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">gcj02</td>
</tr>
</tbody>
</table>
<h5 id="8-1-2-返回参数说明"><a href="#8-1-2-返回参数说明" class="headerlink" title="8.1.2 返回参数说明"></a>8.1.2 返回参数说明</h5><table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left"></th>
<th style="text-align:left">含义</th>
<th>规则说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">status</td>
<td style="text-align:left"></td>
<td style="text-align:left">返回结果状态值</td>
<td>返回值为 0 或 1，0 表示请求失败；1 表示请求成功。</td>
</tr>
<tr>
<td style="text-align:left">count</td>
<td style="text-align:left"></td>
<td style="text-align:left">返回结果数目</td>
<td>返回结果的个数。</td>
</tr>
<tr>
<td style="text-align:left">info</td>
<td style="text-align:left"></td>
<td style="text-align:left">返回状态说明</td>
<td>当 status 为 0 时，info 会返回具体错误原因，否则返回“OK”。详情可以参阅<a href="https://lbs.amap.com/api/webservice/guide/tools/info" target="_blank" rel="noopener">info状态表</a></td>
</tr>
<tr>
<td style="text-align:left">geocodes</td>
<td style="text-align:left"></td>
<td style="text-align:left">地理编码信息列表</td>
<td>结果对象列表，包括下述字段：</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">formatted_address</td>
<td style="text-align:left">结构化地址信息</td>
<td>省份＋城市＋区县＋城镇＋乡村＋街道＋门牌号码</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">country</td>
<td style="text-align:left">国家</td>
<td>国内地址默认返回中国</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">province</td>
<td style="text-align:left">地址所在的省份名</td>
<td>例如：北京市。此处需要注意的是，中国的四大直辖市也算作省级单位。</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">city</td>
<td style="text-align:left">地址所在的城市名</td>
<td>例如：北京市</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">citycode</td>
<td style="text-align:left">城市编码</td>
<td>例如：010</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">district</td>
<td style="text-align:left">地址所在的区</td>
<td>例如：朝阳区</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">street</td>
<td style="text-align:left">街道</td>
<td>例如：阜通东大街</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">number</td>
<td style="text-align:left">门牌</td>
<td>例如：6号</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">adcode</td>
<td style="text-align:left">区域编码</td>
<td>例如：110101</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">location</td>
<td style="text-align:left">坐标点</td>
<td>经度，纬度</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">level</td>
<td style="text-align:left">匹配级别</td>
<td>参见下方的地理编码匹配级别列表</td>
</tr>
</tbody>
</table>
<h5 id="8-1-3-示例"><a href="#8-1-3-示例" class="headerlink" title="8.1.3 示例"></a>8.1.3 示例</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap, geocodeQuery &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; geocodeQuery &#125; from 'cci-utils'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    center: [<span class="number">120.19382669582967</span>, <span class="number">30.258134</span>],</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    zoom: <span class="number">8</span>,</span><br><span class="line">    viewMode: <span class="string">'3D'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="string">'9795c67f0efaf73a3276c40ccf55a428'</span></span><br><span class="line">  geocodeQuery(&#123;</span><br><span class="line">    token,</span><br><span class="line">    toCRS: <span class="string">'wgs84'</span>,</span><br><span class="line">    address: <span class="string">'北京市朝阳区阜通东大街6号'</span>,</span><br><span class="line">    city: <span class="string">'北京'</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res, <span class="string">'res:::::::::::::'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="8-2-逆地理编码"><a href="#8-2-逆地理编码" class="headerlink" title="8.2 逆地理编码"></a>8.2 逆地理编码</h4><p>地理编码 <strong>regeocodeQuery</strong> 内部封装高德服务接口，需要提供高德地图服务 token</p>
<h5 id="8-2-1-请求参数说明"><a href="#8-2-1-请求参数说明" class="headerlink" title="8.2.1 请求参数说明"></a>8.2.1 请求参数说明</h5><table>
<thead>
<tr>
<th style="text-align:left">参数名</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">规则说明</th>
<th style="text-align:left">是否必须</th>
<th style="text-align:left">缺省值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">key</td>
<td style="text-align:left">请求服务权限标志</td>
<td style="text-align:left">高德地图服务 token</td>
<td style="text-align:left">必填</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">location</td>
<td style="text-align:left">经纬度坐标</td>
<td style="text-align:left">传入内容规则：经度在前，纬度在后，经纬度间以“,”分割，经纬度小数点后不要超过 6 位。如果需要解析多个经纬度的话，请用”\</td>
<td style="text-align:left">“进行间隔，并且将 batch 参数设置为 true，最多支持传入 20 对坐标点。每对点坐标之间用”\</td>
<td style="text-align:left">“分割。默认是高德坐标系坐标</td>
<td>必填</td>
<td>无</td>
</tr>
<tr>
<td style="text-align:left">poitype</td>
<td style="text-align:left">返回附近POI类型</td>
<td style="text-align:left">以下内容需要 extensions 参数为 all 时才生效。逆地理编码在进行坐标解析之后不仅可以返回地址描述，也可以返回经纬度附近符合限定要求的POI内容（在 extensions 字段值为 all 时才会返回POI内容）。设置 POI 类型参数相当于为上述操作限定要求。参数仅支持传入POI TYPECODE，可以传入多个POI TYPECODE，相互之间用“\</td>
<td style="text-align:left">”分隔。该参数在 batch 取值为 true 时不生效。获取 POI TYPECODE 可以参考<a href="https://a.amap.com/lbs/static/amap_3dmap_lite/amap_poicode.zip" target="_blank" rel="noopener">POI分类码表</a></td>
<td style="text-align:left">可选</td>
<td>无</td>
</tr>
<tr>
<td style="text-align:left">radius</td>
<td style="text-align:left">搜索半径</td>
<td style="text-align:left">radius取值范围在0~3000，默认是1000。单位：米</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">1000</td>
</tr>
<tr>
<td style="text-align:left">extensions</td>
<td style="text-align:left">返回结果控制</td>
<td style="text-align:left">extensions 参数默认取值是 base，也就是返回基本地址信息；extensions 参数取值为 all 时会返回基本地址信息、附近 POI 内容、道路信息以及道路交叉口信息。</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">base</td>
</tr>
<tr>
<td style="text-align:left">batch</td>
<td style="text-align:left">批量查询控制</td>
<td style="text-align:left">batch 参数设置为 true 时进行批量查询操作，最多支持 20 个经纬度点进行批量地址查询操作。batch 参数设置为 false 时进行单点查询，此时即使传入多个经纬度也只返回第一个经纬度的地址解析查询结果。</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">roadlevel</td>
<td style="text-align:left">道路等级</td>
<td style="text-align:left">以下内容需要 extensions 参数为 all 时才生效。可选值：0，1 当roadlevel=0时，显示所有道路 当roadlevel=1时，过滤非主干道路，仅输出主干道路数据</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">sig</td>
<td style="text-align:left">数字签名</td>
<td style="text-align:left">请参考<a href="https://lbs.amap.com/faq/account/key/72" target="_blank" rel="noopener">数字签名获取和使用方法</a></td>
<td style="text-align:left">可选</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">output</td>
<td style="text-align:left">返回数据格式类型</td>
<td style="text-align:left">可选输入内容包括：JSON，XML。设置 JSON 返回结果数据将会以JSON结构构成；如果设置 XML 返回结果数据将以 XML 结构构成。</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">JSON</td>
</tr>
<tr>
<td style="text-align:left">callback</td>
<td style="text-align:left">回调函数</td>
<td style="text-align:left">callback 值是用户定义的函数名称，此参数只在 output 参数设置为 JSON 时有效。</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">homeorcorp</td>
<td style="text-align:left">是否优化POI返回顺序</td>
<td style="text-align:left">以下内容需要 extensions 参数为 all 时才生效。homeorcorp 参数的设置可以影响召回 POI 内容的排序策略，目前提供三个可选参数：0：不对召回的排序策略进行干扰。1：综合大数据分析将居家相关的 POI 内容优先返回，即优化返回结果中 pois 字段的poi顺序。2：综合大数据分析将公司相关的 POI 内容优先返回，即优化返回结果中 pois 字段的poi顺序。</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">fromCRS</td>
<td style="text-align:left">请求数据坐标系</td>
<td style="text-align:left">指定逆地理编码请求数据经纬度坐标系，gcj02/wgs84/bd09</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">gcj02</td>
</tr>
<tr>
<td style="text-align:left">toCRS</td>
<td style="text-align:left">返回数据坐标系统</td>
<td style="text-align:left">指定逆地理编码返回数据经纬度坐标系，gcj02/wgs84/bd09</td>
<td style="text-align:left">可选</td>
<td style="text-align:left">gcj0</td>
</tr>
</tbody>
</table>
<h5 id="8-2-2-返回参数说明"><a href="#8-2-2-返回参数说明" class="headerlink" title="8.2.2 返回参数说明"></a>8.2.2 返回参数说明</h5><table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th></th>
<th>含义</th>
<th>规则说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">status</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td></td>
<td>返回结果状态值</td>
<td>返回值为 0 或 1，0 表示请求失败；1 表示请求成功。</td>
</tr>
<tr>
<td style="text-align:left">info</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td></td>
<td>返回状态说明</td>
<td>当 status 为 0 时，info 会返回具体错误原因，否则返回“OK”。详情可以参考<a href="https://lbs.amap.com/api/webservice/guide/tools/info" target="_blank" rel="noopener">info状态表</a></td>
</tr>
<tr>
<td style="text-align:left">regeocode</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td></td>
<td>逆地理编码列表</td>
<td>batch 字段设置为 true 时为批量请求，此时 regeocodes 标签返回，标签下为 regeocode 对象列表；batch 为false 时为单个请求，会返回 regeocode 对象；regeocode 对象包含的数据如下：</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">formatted_address</td>
<td style="text-align:left"></td>
<td></td>
<td>结构化地址信息</td>
<td>结构化地址信息包括：省份＋城市＋区县＋城镇＋乡村＋街道＋门牌号码如果坐标点处于海域范围内，则结构化地址信息为：省份＋城市＋区县＋海域信息</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">addressComponent</td>
<td style="text-align:left"></td>
<td></td>
<td>地址元素列表</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">province</td>
<td></td>
<td>坐标点所在省名称</td>
<td>例如：北京市</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">city</td>
<td></td>
<td>坐标点所在城市名称</td>
<td>请注意：当城市是省直辖县时返回为空，以及城市为北京、上海、天津、重庆四个直辖市时，该字段返回为空；<a href="https://lbs.amap.com/faq/webservice/webservice-api/geocoding/43267" target="_blank" rel="noopener">省直辖县列表</a>地址元素列表</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">citycode</td>
<td></td>
<td>城市编码</td>
<td>例如：010</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">district</td>
<td></td>
<td>坐标点所在区</td>
<td>例如：海淀区</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">adcode</td>
<td></td>
<td>行政区编码</td>
<td>例如：110108</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">township</td>
<td></td>
<td>坐标点所在乡镇/街道（此街道为社区街道，不是道路信息）</td>
<td>例如：燕园街道</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">towncode</td>
<td></td>
<td>乡镇街道编码</td>
<td>例如：110101001000</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">neighborhood</td>
<td></td>
<td>社区信息列表</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>name</td>
<td>社区名称</td>
<td>例如：北京大学</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>type</td>
<td>POI类型</td>
<td>例如：科教文化服务;学校;高等院校</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">building</td>
<td></td>
<td>楼信息列表</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>name</td>
<td>建筑名称</td>
<td>例如：万达广场</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>type</td>
<td>类型</td>
<td>例如：科教文化服务;学校;高等院校</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">streetNumber</td>
<td></td>
<td>门牌信息列表</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>street</td>
<td>街道名称</td>
<td>例如：中关村北二条</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>number</td>
<td>门牌号</td>
<td>例如：3号</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>location</td>
<td>坐标点</td>
<td>经纬度坐标点：经度，纬度</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>direction</td>
<td>方向</td>
<td>坐标点所处街道方位</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>distance</td>
<td>门牌地址到请求坐标的距离</td>
<td>单位：米</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">seaArea</td>
<td></td>
<td>所属海域信息</td>
<td>例如：渤海</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">businessAreas</td>
<td></td>
<td>经纬度所属商圈列表</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>businessArea</td>
<td>商圈信息</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>location</td>
<td>商圈中心点经纬度</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>name</td>
<td>商圈名称</td>
<td>例如：颐和园</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>id</td>
<td>商圈所在区域的adcode</td>
<td>例如：朝阳区/海淀区</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">roads</td>
<td style="text-align:left"></td>
<td></td>
<td>道路信息列表</td>
<td>请求参数 extensions 为 all 时返回如下内容</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">road</td>
<td></td>
<td>道路信息</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>id</td>
<td>道路id</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>name</td>
<td>道路名称</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>distance</td>
<td>道路到请求坐标的距离</td>
<td>单位：米</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>direction</td>
<td>方位</td>
<td>输入点和此路的相对方位</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>location</td>
<td>坐标点</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">roadinters</td>
<td style="text-align:left"></td>
<td></td>
<td>道路交叉口列表</td>
<td>请求参数 extensions 为 all 时返回如下内容</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">roadinter</td>
<td></td>
<td>道路交叉口</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>distance</td>
<td>交叉路口到请求坐标的距离</td>
<td>单位：米</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>direction</td>
<td>方位</td>
<td>输入点相对路口的方位</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>location</td>
<td>路口经纬度</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>first_id</td>
<td>第一条道路id</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>first_name</td>
<td>第一条道路名称</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>second_id</td>
<td>第二条道路id</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>second_name</td>
<td>第二条道路名称</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">pois</td>
<td style="text-align:left"></td>
<td></td>
<td>poi信息列表</td>
<td>请求参数 extensions 为 all 时返回如下内容</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">poi</td>
<td></td>
<td>poi信息</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>id</td>
<td>poi的id</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>name</td>
<td>poi点名称</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>type</td>
<td>poi类型</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>tel</td>
<td>电话</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>distance</td>
<td>该POI的中心点到请求坐标的距离</td>
<td>单位：米</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>direction</td>
<td>方向</td>
<td>为输入点相对建筑物的方位</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>address</td>
<td>poi地址信息</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>location</td>
<td>坐标点</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>businessarea</td>
<td>poi所在商圈名称</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">aois</td>
<td style="text-align:left"></td>
<td></td>
<td>aoi信息列表</td>
<td>请求参数 extensions 为 all 时返回如下内容</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">aoi</td>
<td></td>
<td>aoi信息</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>id</td>
<td>所属 aoi的id</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>name</td>
<td>所属 aoi 名称</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>adcode</td>
<td>所属 aoi 所在区域编码</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>location</td>
<td>所属 aoi 中心点坐标</td>
<td></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>area</td>
<td>所属aoi点面积</td>
<td>单位：平方米</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td>distance</td>
<td>输入经纬度是否在aoi面之中</td>
<td>0，代表在aoi内其余整数代表距离AOI的距离</td>
</tr>
</tbody>
</table>
<h5 id="8-2-3-示例"><a href="#8-2-3-示例" class="headerlink" title="8.2.3 示例"></a>8.2.3 示例</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CMap, GaodeMap, regeocodeQuery &#125; <span class="keyword">from</span> <span class="string">'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; CMap, GaodeMap &#125; from 'cci-map'</span></span><br><span class="line"><span class="comment">// import &#123; regeocodeQuery &#125; from 'cci-utils'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">  id: <span class="string">'map'</span>,</span><br><span class="line">  map: <span class="keyword">new</span> GaodeMap(&#123;</span><br><span class="line">    center: [<span class="number">120.19382669582967</span>, <span class="number">30.258134</span>],</span><br><span class="line">    pitch: <span class="number">0</span>,</span><br><span class="line">    zoom: <span class="number">8</span>,</span><br><span class="line">    viewMode: <span class="string">'3D'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">scene.on(<span class="string">'loaded'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="string">'9795c67f0efaf73a3276c40ccf55a428'</span></span><br><span class="line">  regeocodeQuery(&#123;</span><br><span class="line">    token,</span><br><span class="line">    fromCRS: <span class="string">'wgs84'</span>,</span><br><span class="line">    toCRS: <span class="string">'wgs84'</span>,</span><br><span class="line">    location: <span class="string">'116.481488,39.990464|115,39.990464'</span>,</span><br><span class="line">    poitype: <span class="string">'商务写字楼'</span>,</span><br><span class="line">    roadlevel: <span class="number">0</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res, <span class="string">'res:::::::::::::'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="九、小程序"><a href="#九、小程序" class="headerlink" title="九、小程序"></a>九、小程序</h2><h3 id="1-教程"><a href="#1-教程" class="headerlink" title="1. 教程"></a>1. 教程</h3><h4 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h4><p>通过引入 Mini 模块，能让用户在小程序环境中使用 地图可视化的能力，增强原生地图组件的可视化能力。</p>
<p>✨ 目前 Mini 兼容支付宝小程序，尚不支持微信小程序。<br>✨ 目前 Mini 只支持无底图模式，即只展示可视化层。<br>✨ Mini 模块的使用，除了画布获取和和事件注册因为小程序环境的原因需要用户额外处理，其余部分和普通 cci-map 使用保持一致。</p>
<p>下面将介绍如何在支付宝小程序中使用 Mini 模块。</p>
<h4 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2 安装"></a>1.2 安装</h4><p>目前在小程序开发中使用的能力全部来自 Mini 模块，用户只需要执行一次安装即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install cci-mini --save</span><br></pre></td></tr></table></figure>
<h4 id="1-3-地图引用"><a href="#1-3-地图引用" class="headerlink" title="1.3 地图引用"></a>1.3 地图引用</h4><p>在小程序环境中，用户无法引用高德地图和 Mapbox 地图， 只能引用小程序版本的地图类型。<br>在 .ts/.js 页面脚本文件中引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="built_in">Map</span>, <span class="comment">// 其他地图类型不兼容小程序环境</span></span><br><span class="line">  Scene,</span><br><span class="line">  PointLayer,</span><br><span class="line">  dispatchTouchStart,</span><br><span class="line">  dispatchTouchMove,</span><br><span class="line">  dispatchTouchEnd,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'cci-mini'</span></span><br></pre></td></tr></table></figure>
<p>地图小程序环境的使用和普通 H5 环境的使用保持一致。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> miniMap = <span class="keyword">new</span> <span class="built_in">Map</span>(&#123;</span><br><span class="line">  center: [<span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">  zoom: <span class="number">-0.5</span>,</span><br><span class="line">  pitch: <span class="number">0</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="1-4-节点注册"><a href="#1-4-节点注册" class="headerlink" title="1.4 节点注册"></a>1.4 节点注册</h4><p>由于小程序限制无法动态创建新的节点，因此需要事先在 .axml 文件中创建 canvas 画布节点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas onReady=<span class="string">"onCanvasReady"</span> type=<span class="string">"webgl"</span> id=<span class="string">"canvas"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>注册完的节点会在脚本文件中获取使用。</p>
<p>✨ 需要完成 onCanvasReady 事件的注册，以便明确获取节点的时机。</p>
<h4 id="1-5-事件注册"><a href="#1-5-事件注册" class="headerlink" title="1.5 事件注册"></a>1.5 事件注册</h4><p>由于小程序环境的限制无法动态注册事件，所以需要用户自己完成事件代理，下面将会说明如何完成事件的代理。</p>
<p>✨ 如果不进行事件的注册和转发，用户将无法对地图进行操作。</p>
<ul>
<li>在 .axml 文件中绑定基础事件</li>
</ul>
<p>✨ 事件需要绑定在 canvas 节点上或是 canvas 的父节点上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;view id=&quot;box&quot; class=&quot;wrap&quot;</span><br><span class="line">  onTouchStart=&quot;onTouchStart&quot;  // 绑定基础事件</span><br><span class="line">  onTouchMove=&quot;onTouchMove&quot;</span><br><span class="line">  onTouchEnd=&quot;onTouchEnd&quot;</span><br><span class="line">  &gt;</span><br><span class="line">  &lt;canvas onReady=&quot;onCanvasReady&quot; type=&quot;webgl&quot; id=&quot;canvas&quot; /&gt;</span><br><span class="line">  &lt;view class=&quot;populationWrap&quot;&gt;</span><br><span class="line">    &lt;view class=&quot;populationIcons&quot;&gt;</span><br><span class="line">      人口/千万:</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">    &lt;view class=&quot;populationIcons&quot; a:for=&quot;&#123;&#123;population&#125;&#125;&quot;&gt;</span><br><span class="line">      &lt;view&gt; &#123;&#123;item.count&#125;&#125;  &lt;/view&gt;</span><br><span class="line">      &lt;view class=&quot;colorLine&quot; style=&quot;background:&#123;&#123;item.color&#125;&#125;&quot;&gt;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>.ts/.js 文件中完成事件的代理转发</li>
</ul>
<p>引入代理方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="built_in">Map</span>,</span><br><span class="line">  Scene,</span><br><span class="line">  PointLayer,</span><br><span class="line">  dispatchTouchStart, <span class="comment">// Mini 封装的代理方法</span></span><br><span class="line">  dispatchTouchMove,</span><br><span class="line">  dispatchTouchEnd,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'cci-mini'</span></span><br></pre></td></tr></table></figure>
<p>在 page 对象中注册方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">page(&#123;</span><br><span class="line">  ...</span><br><span class="line">  onTouchStart(e) &#123;</span><br><span class="line">    dispatchTouchStart(e);</span><br><span class="line">  &#125;,</span><br><span class="line">  onTouchMove(e) &#123;</span><br><span class="line">    dispatchTouchMove(e);</span><br><span class="line">  &#125;,</span><br><span class="line">  onTouchEnd(e) &#123;</span><br><span class="line">    dispatchTouchEnd(e);</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>只需要完成基础方法的注册（touchstart/touchmove/touchend），Mini 会完成复合方法、手势的判断。</p>
<h4 id="1-6-画布的获取与使用"><a href="#1-6-画布的获取与使用" class="headerlink" title="1.6 画布的获取与使用"></a>1.6 画布的获取与使用</h4><p>在小程序中，需要使用小程序提供的方法来获取页面节点。</p>
<p>通过在 .axml 在 canvas 画布组件上注册的 onCanvasReady 方法来判断获取画布的时机。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">page(&#123;</span><br><span class="line">  ...</span><br><span class="line">  onCanvasReady() &#123;</span><br><span class="line">    handleCanvas(my, canvas =&gt; &#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="comment">// 正常开发 代码</span></span><br><span class="line">      ...</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>下面提供了获取画布节点通用方法，同时对画布进行一些处理方便后续使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleCanvas</span>(<span class="params">my, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> selector = my.createSelectorQuery();</span><br><span class="line">  <span class="keyword">const</span> domSelector = selector.select(<span class="string">'#canvas'</span>);</span><br><span class="line">  domSelector</span><br><span class="line">    .fields(</span><br><span class="line">      &#123;</span><br><span class="line">        node: <span class="literal">true</span>,</span><br><span class="line">        context: <span class="literal">false</span>,</span><br><span class="line">        rect: <span class="literal">true</span>,</span><br><span class="line">        computedStyle: [<span class="string">'height'</span>, <span class="string">'width'</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 内部计算使用 （必须设置）</span></span><br><span class="line">        res.node.left = res.left;</span><br><span class="line">        res.node.top = res.top;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置画布的 DPR （必须设置）</span></span><br><span class="line">        <span class="keyword">const</span> DPR = my.getSystemInfoSync().pixelRatio;</span><br><span class="line">        res.node.width *= DPR;</span><br><span class="line">        res.node.height *= DPR;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回 canvas 画布节点</span></span><br><span class="line">        callback(res.node);</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">    .exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在获取到画布对象后需要传递给 scene 使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> miniScene = <span class="keyword">new</span> Scene(&#123;</span><br><span class="line">  id: <span class="string">'canvas'</span>,</span><br><span class="line">  canvas, <span class="comment">// canvas 是我们从小程序页面上获取到的实际节点</span></span><br><span class="line">  map: miniMap,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="1-7-销毁"><a href="#1-7-销毁" class="headerlink" title="1.7 销毁"></a>1.7 销毁</h4><p>为了保证小程序的良好体验，在页面关闭时记得及时将地图内容进行销毁。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">page(&#123;</span><br><span class="line">  ...</span><br><span class="line">  onHide() &#123;</span><br><span class="line">    miniScene.destroy();</span><br><span class="line">  &#125;,</span><br><span class="line">  onUnload() &#123;</span><br><span class="line">    miniScene.destroy();</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="1-8-限制"><a href="#1-8-限制" class="headerlink" title="1.8 限制"></a>1.8 限制</h4><p>目前 Mini 尚不支持 marker/popup 等需要动态创建页面节点的能力，用户若是需要可以自己单独创建。</p>
<h3 id="2-3D-柱状实例"><a href="#2-3D-柱状实例" class="headerlink" title="2. 3D 柱状实例"></a>2. 3D 柱状实例</h3><ul>
<li>index.axml 页面结构代码</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"isLoading"</span> <span class="attr">style</span>=<span class="string">"height: 100vh"</span> <span class="attr">a:if</span>=<span class="string">"&#123;&#123;isLoading&#125;&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"loadItem"</span> <span class="attr">a:for</span>=<span class="string">"&#123;&#123;10&#125;&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">id</span>=<span class="string">"box"</span> <span class="attr">class</span>=<span class="string">"wrap"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">onTouchStart</span>=<span class="string">"onTouchStart"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">onTouchMove</span>=<span class="string">"onTouchMove"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">onTouchEnd</span>=<span class="string">"onTouchEnd"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">onReady</span>=<span class="string">"onCanvasReady"</span> <span class="attr">type</span>=<span class="string">"webgl"</span> <span class="attr">id</span>=<span class="string">"canvas"</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>index.less 样式代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.wrap &#123;</span><br><span class="line">  height: <span class="number">100</span>vh;</span><br><span class="line">  #canvas &#123;</span><br><span class="line">    height: <span class="number">100</span>%;</span><br><span class="line">    width: <span class="number">100</span>%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>index.js 脚本代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="built_in">Map</span>,</span><br><span class="line">  CMap,</span><br><span class="line">  PointLayer,</span><br><span class="line">  dispatchTouchStart,</span><br><span class="line">  dispatchTouchMove,</span><br><span class="line">  dispatchTouchEnd</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'cci-mini'</span></span><br><span class="line"><span class="keyword">import</span> &#123; getJSON, handleCanvas, LayerCounter &#125; <span class="keyword">from</span> <span class="string">'../../utils'</span>;</span><br><span class="line"><span class="keyword">const</span> hexagonData = <span class="string">'https://gw.alipayobjects.com/os/basement_prod/893d1d5f-11d9-45f3-8322-ee9140d288ae.json'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> miniScene;</span><br><span class="line"><span class="keyword">let</span> counter;</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    isLoading: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onLoad() &#123;</span><br><span class="line">    counter = <span class="keyword">new</span> LayerCounter(<span class="number">1</span>, my, <span class="keyword">this</span>);</span><br><span class="line">    my.showLoading();</span><br><span class="line">  &#125;,</span><br><span class="line">  onTouchStart(e) &#123;</span><br><span class="line">    dispatchTouchStart(e);</span><br><span class="line">  &#125;,</span><br><span class="line">  onTouchMove(e) &#123;</span><br><span class="line">    dispatchTouchMove(e);</span><br><span class="line">  &#125;,</span><br><span class="line">  onTouchEnd(e) &#123;</span><br><span class="line">    dispatchTouchEnd(e);</span><br><span class="line">  &#125;,</span><br><span class="line">  onCanvasReady() &#123;</span><br><span class="line">    handleCanvas(<span class="keyword">this</span>, my, (canvas) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> miniMap = <span class="keyword">new</span> <span class="built_in">Map</span>(&#123;</span><br><span class="line">        pitch: <span class="number">60</span>,</span><br><span class="line">        style: <span class="string">'light'</span>,</span><br><span class="line">        center: [ <span class="number">121.412224</span>, <span class="number">31.26192438</span> ],</span><br><span class="line">        zoom: <span class="number">13.13438</span>,</span><br><span class="line">        rotation: <span class="number">35.97133</span></span><br><span class="line">      &#125;);</span><br><span class="line">      miniScene = <span class="keyword">new</span> CMap(&#123;</span><br><span class="line">        id: <span class="string">'canvas'</span>,</span><br><span class="line">        canvas,</span><br><span class="line">        map: miniMap,</span><br><span class="line">        hasBaseMap: <span class="literal">false</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      miniScene.setBgColor(<span class="string">'rgb(240, 243, 246)'</span>)</span><br><span class="line"></span><br><span class="line">      getJSON(hexagonData, <span class="function"><span class="keyword">function</span> (<span class="params">result, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">          <span class="keyword">const</span> layer = <span class="keyword">new</span> PointLayer(&#123;&#125;)</span><br><span class="line">          .source(data, &#123;</span><br><span class="line">            parser: &#123;</span><br><span class="line">              type: <span class="string">'json'</span>,</span><br><span class="line">              x: <span class="string">'longitude'</span>,</span><br><span class="line">              y: <span class="string">'latitude'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .shape(<span class="string">'name'</span>, [</span><br><span class="line">            <span class="string">'cylinder'</span>,</span><br><span class="line">            <span class="string">'triangleColumn'</span>,</span><br><span class="line">            <span class="string">'hexagonColumn'</span>,</span><br><span class="line">            <span class="string">'squareColumn'</span></span><br><span class="line">          ])</span><br><span class="line">          .animate(<span class="literal">true</span>)</span><br><span class="line">          .active(<span class="literal">true</span>)</span><br><span class="line">          .size(<span class="string">'unit_price'</span>, h =&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> [ <span class="number">6</span>, <span class="number">6</span>, h / <span class="number">500</span> ];</span><br><span class="line">          &#125;)</span><br><span class="line">          .color(<span class="string">'name'</span>, [ <span class="string">'#5B8FF9'</span>, <span class="string">'#70E3B5'</span>, <span class="string">'#FFD458'</span>, <span class="string">'#FF7C6A'</span> ])</span><br><span class="line">          .style(&#123;</span><br><span class="line">            opacity: <span class="number">1.0</span></span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          miniScene.addLayer(layer);</span><br><span class="line">          counter.loadLayer()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      miniScene.on(<span class="string">'loaded'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        counter.loadLayer();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  onUnload() &#123;</span><br><span class="line">    <span class="comment">// 页面被关闭</span></span><br><span class="line">    miniScene.destroy();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>方法代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getJSON</span>(<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">  my.request(&#123;</span><br><span class="line">    url,</span><br><span class="line">    method: <span class="string">'GET'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      <span class="keyword">from</span>: <span class="string">'支付宝'</span>,</span><br><span class="line">      production: <span class="string">'AlipayJSAPI'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">'content-type'</span>: <span class="string">'application/json'</span>, <span class="comment">// 默认值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    dataType: <span class="string">'json'</span>,</span><br><span class="line">    fail() &#123;</span><br><span class="line">      callback(<span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    complete(res) &#123;</span><br><span class="line">      callback(<span class="literal">true</span>, res.data);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">handleCanvas</span>(<span class="params">_that, my, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> selector = my.createSelectorQuery();</span><br><span class="line">  <span class="keyword">const</span> domSelector = selector.select(<span class="string">'#canvas'</span>);</span><br><span class="line">  domSelector</span><br><span class="line">    .fields(</span><br><span class="line">      &#123;</span><br><span class="line">        node: <span class="literal">true</span>,</span><br><span class="line">        context: <span class="literal">false</span>,</span><br><span class="line">        rect: <span class="literal">true</span>,</span><br><span class="line">        computedStyle: [<span class="string">'height'</span>, <span class="string">'width'</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        res.node.left = res.left;</span><br><span class="line">        res.node.top = res.top;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> DPR = my.getSystemInfoSync().pixelRatio;</span><br><span class="line">        res.node.width *= DPR;</span><br><span class="line">        res.node.height *= DPR;</span><br><span class="line"></span><br><span class="line">        callback(res.node);</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">    .exec();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">LayerCounter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(totalLayers, my, context) &#123;</span><br><span class="line">    <span class="keyword">this</span>.loadedLayer = <span class="number">0</span></span><br><span class="line">    <span class="keyword">this</span>.totalLayers = totalLayers;</span><br><span class="line">    <span class="keyword">this</span>.my = my;</span><br><span class="line">    <span class="keyword">this</span>.context = context;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  loadLayer() &#123;</span><br><span class="line">    <span class="keyword">this</span>.loadedLayer++;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.loadedLayer &gt;= <span class="keyword">this</span>.totalLayers) &#123;</span><br><span class="line">      <span class="keyword">this</span>.my.hideLoading(&#123;</span><br><span class="line">        page: that, <span class="comment">// 防止执行时已经切换到其它页面，page 指向不准确</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">this</span>.context.setData(&#123;</span><br><span class="line">        isLoading: <span class="literal">false</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2021/12/10/npm publish 发布自己的模块/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2021/12/10/npm publish 发布自己的模块/" itemprop="url">npm publish 发布自己的模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-12-10T16:07:29+08:00">
                2021-12-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>在 npm 官网上发布自己的模块首先需要在 <a href="https://www.npmjs.com" target="_blank" rel="noopener">https://www.npmjs.com</a> 注册账号</p>
<h2 id="1-编写模块"><a href="#1-编写模块" class="headerlink" title="1 编写模块"></a>1 编写模块</h2><p>一般遵循 umd / amd / commonJS 风格编写模块</p>
<h2 id="2-初始化包描述文件-package-json"><a href="#2-初始化包描述文件-package-json" class="headerlink" title="2 初始化包描述文件 package.json"></a>2 初始化包描述文件 package.json</h2><p>使用 npm init 命令初始化包描述文件，要注意两点：</p>
<ul>
<li><strong>包名不能包含大写字母</strong></li>
<li><strong>最好先在 npm 官网搜索一下包名是否已被占用，被占用的包名模块是无法发布的</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/blog/2021/12/10/npm publish 发布自己的模块/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2021/12/10/koa2 源码解读/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2021/12/10/koa2 源码解读/" itemprop="url">koa2 源码解读</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-12-10T16:07:29+08:00">
                2021-12-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>koa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架。 使用 koa 编写 web 应用，通过组合<strong>不同的 generator(koa2 用 async/await)</strong>，可以免除重复繁琐的回调函数嵌套， 并极大地提升错误处理的效率。<strong>koa 不在内核方法中绑定任何中间件</strong>， 它仅仅提供了一个轻量优雅的函数库，使得编写 Web 应用变得得心应手</p>
</blockquote>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// res.writeHead(statusCode, [reason], [headers])</span></span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html;charset=UTF-8'</span>&#125;)</span><br><span class="line">  <span class="comment">// res.statusCode = 200</span></span><br><span class="line">  <span class="comment">// res.setHead('Content-Type', 'text/html;charset=UTF-8')</span></span><br><span class="line">  res.end(<span class="string">'hi'</span>)</span><br><span class="line">&#125;).listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'listen at port 3000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>使用 Node.js 原生创建一个 http 服务器的代码, 实际上是调用 http.createServer(requestListener), 创建一个 http.Server 的实例，http.Server 继承于 EventEmitter 类。传入的 requestListener 是一个函数，会自动添加到 ‘request’ 事件，最后将 http.Server 的实例绑定到 3000 端口，开始监听来自 3000 端口的请求</p>
<p>requestListener 函数接受两个参数 req 和 res，req 是一个可读流，res 是一个可写流。通过 req 获取该 http 请求的所有信息，同时将数据写入 res 来对请求做出响应</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node.js 源码 http.js</span></span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'_http_server'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; Server &#125; = server;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createServer</span>(<span class="params">requestListener</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Server(requestListener);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Node.js 源码 _http_server.js</span></span><br><span class="line"><span class="comment">// Server 构造函数 传入 requestListener，如果 requestListener 存在会被添加到 'request' 事件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Server</span>(<span class="params">requestListener</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Server)) <span class="keyword">return</span> <span class="keyword">new</span> Server(requestListener);</span><br><span class="line">  net.Server.call(<span class="keyword">this</span>, &#123; <span class="attr">allowHalfOpen</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (requestListener) &#123;</span><br><span class="line">    <span class="keyword">this</span>.on(<span class="string">'request'</span>, requestListener);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="常见中间件操作"><a href="#常见中间件操作" class="headerlink" title="常见中间件操作"></a>常见中间件操作</h3><ul>
<li><p>静态服务</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="built_in">require</span>(<span class="string">'koa-static'</span>)(__dirname + <span class="string">'/'</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)()</span><br><span class="line">router.get(<span class="string">'/string'</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'koa2 string'</span></span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">'/json'</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    title: <span class="string">'koa2 json'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.use(router.routes())</span><br></pre></td></tr></table></figure>
</li>
<li><p>日志</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="keyword">async</span> (ctx,next) =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime()</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`start: <span class="subst">$&#123;ctx.url&#125;</span>`</span>);</span><br><span class="line">	<span class="keyword">await</span> next();</span><br><span class="line">	<span class="keyword">const</span> end = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() <span class="built_in">console</span>.log(<span class="string">`请求<span class="subst">$&#123;ctx.url&#125;</span>, 耗时<span class="subst">$&#123;<span class="built_in">parseInt</span>(end-start)&#125;</span>ms`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><h3 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- lib/</span><br><span class="line">-- application.js <span class="comment">// 入口文件</span></span><br><span class="line">-- context.js</span><br><span class="line">-- request.js</span><br><span class="line">-- response.js</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/blog/2021/12/10/koa2 源码解读/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2020/02/28/dll/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2020/02/28/dll/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-28T09:40:28+08:00">
                2020-02-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>dll</p>
<ol>
<li>dllPlugin 生成 require 或 inport 依赖 生成对应 id 映射 json</li>
<li><p>dllReference 根据 json 生成 js</p>
</li>
<li><p>1  dllEntryPlugin 处理 vendor 依赖数组 LibManifestPlugin 生成 json</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2019/12/30/轮播图组件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2019/12/30/轮播图组件/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-30T18:06:40+08:00">
                2019-12-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: 轮播图组件<br>tag: </p>
<pre><code>- 轮播图
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2019/12/22/使用verdaccio 搭建npm私服/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2019/12/22/使用verdaccio 搭建npm私服/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-22T14:45:55+08:00">
                2019-12-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="搭建-npm-私服原因"><a href="#搭建-npm-私服原因" class="headerlink" title="搭建 npm 私服原因"></a>搭建 npm 私服原因</h2><ul>
<li>统一管理（公司内部开发的私有包，方便统一管理、开发和使用）</li>
<li>安全性（由于公司内部开发的模块等并不希望公开, 但又希望内部能方便使用）</li>
<li>加速（自建服务器自带常用 package 的缓存，会缓存下载过的包，节省时间）</li>
</ul>
<h2 id="使用verdaccio"><a href="#使用verdaccio" class="headerlink" title="使用verdaccio"></a>使用verdaccio</h2><p>verdaccio 是 sinopia 开源框架的一个fork，由于sinopia 已不再维护，因此采用 verdaccio</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i –g verdaccio</span><br></pre></td></tr></table></figure>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">verdaccio</span><br><span class="line"></span><br><span class="line"> warn --- config file  - /home/admin/.config/verdaccio/config.yaml <span class="comment"># 默认的配置文件</span></span><br><span class="line"> warn --- Verdaccio started</span><br><span class="line"> warn --- Plugin successfully loaded: verdaccio-htpasswd</span><br><span class="line"> warn --- Plugin successfully loaded: verdaccio-audit</span><br><span class="line"> warn --- http address - http://localhost:4873/ - verdaccio/4.4.0 <span class="comment"># 默认端口</span></span><br></pre></td></tr></table></figure>
<p>可以使用 pm2 来管理进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i -g pm2</span><br><span class="line">pm2 start verdaccio</span><br><span class="line"><span class="comment"># pm2 ls 查看进程情况</span></span><br></pre></td></tr></table></figure>
<h3 id="腾讯云服务器配置-nginx"><a href="#腾讯云服务器配置-nginx" class="headerlink" title="腾讯云服务器配置 nginx"></a>腾讯云服务器配置 nginx</h3><p>verdaccio 默认是启动在 4873 端口，腾讯云服务器需要配置 nginx 反向代理到该端口，nginx 配置需要在 <code>/etc/nginx/conf.d/</code> 下新建文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name registry.npm.your.server;</span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass              http://127.0.0.1:4873/;</span><br><span class="line">    proxy_set_header        Host <span class="variable">$host</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重启 nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -s reload</span><br></pre></td></tr></table></figure>
<h3 id="verdaccio-配置-（-home-admin-config-verdaccio-config-yaml）"><a href="#verdaccio-配置-（-home-admin-config-verdaccio-config-yaml）" class="headerlink" title="verdaccio 配置 （/home/admin/.config/verdaccio/config.yaml）"></a>verdaccio 配置 （/home/admin/.config/verdaccio/config.yaml）</h3><ul>
<li>verdaccio 默认使用的是 npm官方的源，可改成淘宝的源</li>
<li>私有npm 里面不包含的包, 例如要安装一个vue  包, 找不到的话, 会被代理到默认 npm 源仓库去下载, 并且会缓存在 ./storage 文件夹</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/verdaccio/verdaccio/tree/master/conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># path to a directory with all packages</span></span><br><span class="line"><span class="comment"># 所有包缓存目录</span></span><br><span class="line">storage: ./storage</span><br><span class="line"><span class="comment"># path to a directory with plugins to include</span></span><br><span class="line"><span class="comment"># 插件目录</span></span><br><span class="line">plugins: ./plugins</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 web 服务,能够通过 web 访问</span></span><br><span class="line">web:</span><br><span class="line">  title: Verdaccio</span><br><span class="line">  <span class="comment"># comment out to disable gravatar support</span></span><br><span class="line">  <span class="comment"># gravatar: false</span></span><br><span class="line">  <span class="comment"># by default packages are ordercer ascendant (asc|desc)</span></span><br><span class="line">  <span class="comment"># sort_packages: asc</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证信息</span></span><br><span class="line">auth:</span><br><span class="line">  htpasswd:</span><br><span class="line">    file: ./htpasswd</span><br><span class="line">    <span class="comment"># Maximum amount of users allowed to register, defaults to "+inf".</span></span><br><span class="line">    <span class="comment"># You can set this to -1 to disable registration.</span></span><br><span class="line">    <span class="comment"># max_users: 1000</span></span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  api:</span><br><span class="line">    jwt:</span><br><span class="line">      sign:</span><br><span class="line">        expiresIn: 60d</span><br><span class="line">        notBefore: 1</span><br><span class="line">  web:</span><br><span class="line">    sign:</span><br><span class="line">      expiresIn: 7d</span><br><span class="line">      notBefore: 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># a list of other known repositories we can talk to</span></span><br><span class="line"><span class="comment"># 公有仓库配置</span></span><br><span class="line">uplinks:</span><br><span class="line">  npmjs:</span><br><span class="line">  	<span class="comment"># url: https://registry.npmjs.org/</span></span><br><span class="line">    url: https://registry.taobao.org/</span><br><span class="line"></span><br><span class="line">packages:</span><br><span class="line">  <span class="string">'@*/*'</span>:</span><br><span class="line">    <span class="comment"># scoped packages</span></span><br><span class="line">    <span class="comment"># 代理 表示没有的仓库会去 npmjs 里面去找 </span></span><br><span class="line">    access: <span class="variable">$all</span></span><br><span class="line">    publish: <span class="variable">$authenticated</span></span><br><span class="line">    unpublish: <span class="variable">$authenticated</span></span><br><span class="line">    proxy: npmjs</span><br><span class="line"></span><br><span class="line">  <span class="string">'**'</span>:</span><br><span class="line">    <span class="comment"># allow all users (including non-authenticated users) to read and</span></span><br><span class="line">    <span class="comment"># publish all packages</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># you can specify usernames/groupnames (depending on your auth plugin)</span></span><br><span class="line">    <span class="comment"># and three keywords: "$all", "$anonymous", "$authenticated"</span></span><br><span class="line">    access: <span class="variable">$all</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># allow all known users to publish/publish packages</span></span><br><span class="line">    <span class="comment"># (anyone can register by default, remember?)</span></span><br><span class="line">    publish: <span class="variable">$authenticated</span></span><br><span class="line">    unpublish: <span class="variable">$authenticated</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if package is not available locally, proxy requests to 'npmjs' registry</span></span><br><span class="line">    proxy: npmjs</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can specify HTTP/1.1 server keep alive timeout in seconds for incomming connections.</span></span><br><span class="line"><span class="comment"># A value of 0 makes the http server behave similarly to Node.js versions prior to 8.0.0, which did not have a keep-alive timeout.</span></span><br><span class="line"><span class="comment"># WORKAROUND: Through given configuration you can workaround following issue https://github.com/verdaccio/verdaccio/issues/301. Set to 0 in case 60 is not enought.</span></span><br><span class="line">server:</span><br><span class="line">  keepAliveTimeout: 60</span><br><span class="line"></span><br><span class="line">middlewares:</span><br><span class="line">  audit:</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># log settings</span></span><br><span class="line">logs:</span><br><span class="line">  - &#123; <span class="built_in">type</span>: stdout, format: pretty, level: http &#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ul>
<li>切换源</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 使用 nrm 切换源</span><br><span class="line">npm i -g nrm</span><br><span class="line">nrm add jhgrrewq http:<span class="comment">//registry.npm.jhgrrewq.com/</span></span><br><span class="line">nrm use jhgrrewq</span><br></pre></td></tr></table></figure>
<ul>
<li>注册用户（或登录）</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm adduser / npm login</span><br><span class="line"># 输入用户名密码</span><br></pre></td></tr></table></figure>
<ul>
<li>发布</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># npm publish 标准编写包并发布</span><br><span class="line">npm publish</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2019/12/11/react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2019/12/11/react/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-11T09:33:59+08:00">
                2019-12-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="起步项目"><a href="#起步项目" class="headerlink" title="起步项目"></a>起步项目</h2><ul>
<li>安装官方脚手架 <code>npm install -g create-react-app</code></li>
<li>创建项目 <code>create-react-app react-study</code></li>
<li>启动项目 <code>npm start</code></li>
</ul>
<h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">├── README.md              文档</span><br><span class="line">├── public							   静态资源</span><br><span class="line">│   ├── favicon.ico</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   └── manifest.json</span><br><span class="line">└── src									   源码</span><br><span class="line">    ├── App.css</span><br><span class="line">    ├── App.js             根组件</span><br><span class="line">    ├── App.test.js</span><br><span class="line">    ├── index.css          全局样式</span><br><span class="line">    ├── index.js           入口文件</span><br><span class="line">    ├── logo.svg</span><br><span class="line">    └── serviceWorker.js   pwa支持</span><br><span class="line">├── package.json           npm 依赖</span><br></pre></td></tr></table></figure>
<h2 id="CRA-（create-react-app）项目真容"><a href="#CRA-（create-react-app）项目真容" class="headerlink" title="CRA （create-react-app）项目真容"></a>CRA （create-react-app）项目真容</h2><p>使用 <code>npm run eject</code> 弹出项目真容，会多出两个目录</p>
<p>该操作不可逆</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├── config</span><br><span class="line">	├── env.js                     处理.env环境变量配置文件</span><br><span class="line">	├── paths.js                   提供各种路径</span><br><span class="line">	├── webpack.config.js          webpack配置文件</span><br><span class="line">	└── webpackDevServer.config.js 测试服务器配置文件</span><br><span class="line">└── scripts                      启动、打包和测试脚本 </span><br><span class="line">	├── build.js                   打包脚本</span><br><span class="line">	├── start.js                   启动脚本</span><br><span class="line">	└── test.js                    测试脚本</span><br></pre></td></tr></table></figure>
<h3 id="env-js"><a href="#env-js" class="headerlink" title="env.js"></a>env.js</h3><p>用来处理 env 文件中配置的变量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node 运行环境：development production test 等</span></span><br><span class="line"><span class="keyword">const</span> NODE_ENV = process.env.NODE_ENV</span><br><span class="line"></span><br><span class="line"><span class="comment">// 待扫描的文件名数组</span></span><br><span class="line"><span class="keyword">const</span> dotenvFiles = [</span><br><span class="line">  <span class="string">`<span class="subst">$&#123;paths.dotenv&#125;</span>.<span class="subst">$&#123;NODE_ENV&#125;</span>.local`</span>, <span class="comment">// .env.development.local</span></span><br><span class="line">  <span class="string">`<span class="subst">$&#123;paths.dotenv&#125;</span>.<span class="subst">$&#123;NODE_ENV&#125;</span>`</span>,	     <span class="comment">// .env.development</span></span><br><span class="line">  NODE_ENV !== <span class="string">'test'</span> &amp;&amp; <span class="string">`<span class="subst">$&#123;paths.dotenv&#125;</span>.local`</span>, <span class="comment">// .env.local</span></span><br><span class="line">  paths.dotenv, <span class="comment">// .env</span></span><br><span class="line">].filter(<span class="built_in">Boolean</span>); <span class="comment">// 判断文件存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从 .env* 文件中加载文件变量</span></span><br><span class="line">dotenvFiles.forEach(<span class="function"><span class="params">dotenvFile</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (fs.existsSync(dotenvFile)) &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'dotenv-expand'</span>)(</span><br><span class="line">      <span class="built_in">require</span>(<span class="string">'dotenv'</span>).config(&#123;</span><br><span class="line">        path: dotenvFile,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><ul>
<li>支持 ts</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check if TypeScript is setup 启用 ts</span></span><br><span class="line"><span class="keyword">const</span> useTypeScript = fs.existsSync(paths.appTsConfig); <span class="comment">// 配置 tsconfig.json</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TypeScript type checking ts 相关插件启用</span></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  useTypeScript &amp;&amp;</span><br><span class="line">    <span class="keyword">new</span> ForkTsCheckerWebpackPlugin(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>支持 sass 和 css 模块化</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// style files regexes</span></span><br><span class="line"><span class="keyword">const</span> cssRegex = <span class="regexp">/\.css$/</span>;</span><br><span class="line"><span class="keyword">const</span> cssModuleRegex = <span class="regexp">/\.module\.css$/</span>; <span class="comment">// css 模块化</span></span><br><span class="line"><span class="keyword">const</span> sassRegex = <span class="regexp">/\.(scss|sass)$/</span>;</span><br><span class="line"><span class="keyword">const</span> sassModuleRegex = <span class="regexp">/\.module\.(scss|sass)$/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// "oneOf" will traverse all following loaders until one will</span></span><br><span class="line">      <span class="comment">// match the requirements. When no loader matches it will fall</span></span><br><span class="line">      <span class="comment">// back to the "file" loader at the end of the loader list.</span></span><br><span class="line">      <span class="comment">// 这里由上至下进行匹配，只有一个匹配后面就不匹配</span></span><br><span class="line">      oneOf: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: cssRegex,</span><br><span class="line">          exclude: cssModuleRegex, <span class="comment">// 优先处理 css ，排除模块化 css 文件</span></span><br><span class="line">          use: getStyleLoaders(&#123;</span><br><span class="line">            importLoaders: <span class="number">1</span>,</span><br><span class="line">            sourceMap: isEnvProduction &amp;&amp; shouldUseSourceMap,</span><br><span class="line">          &#125;),</span><br><span class="line">          sideEffects: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: cssModuleRegex,</span><br><span class="line">          use: getStyleLoaders(&#123;</span><br><span class="line">            importLoaders: <span class="number">1</span>,</span><br><span class="line">            sourceMap: isEnvProduction &amp;&amp; shouldUseSourceMap,</span><br><span class="line">            modules: &#123;</span><br><span class="line">              getLocalIdent: getCSSModuleLocalIdent,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>入口</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">entry: [</span><br><span class="line">      <span class="comment">// Include an alternative client for WebpackDevServer. A client's job is to</span></span><br><span class="line">      <span class="comment">// connect to WebpackDevServer by a socket and get notified about changes.</span></span><br><span class="line">      <span class="comment">// When you save a file, the client will either apply hot updates (in case</span></span><br><span class="line">      <span class="comment">// of CSS changes), or refresh the page (in case of JS changes). When you</span></span><br><span class="line">      <span class="comment">// make a syntax error, this client will display a syntax error overlay.</span></span><br><span class="line">      <span class="comment">// Note: instead of the default WebpackDevServer client, we use a custom one</span></span><br><span class="line">      <span class="comment">// to bring better experience for Create React App users. You can replace</span></span><br><span class="line">      <span class="comment">// the line below with these two lines if you prefer the stock client:</span></span><br><span class="line">      <span class="comment">// require.resolve('webpack-dev-server/client') + '?/',</span></span><br><span class="line">      <span class="comment">// require.resolve('webpack/hot/dev-server'),</span></span><br><span class="line">      isEnvDevelopment &amp;&amp;</span><br><span class="line">        <span class="built_in">require</span>.resolve(<span class="string">'react-dev-utils/webpackHotDevClient'</span>), <span class="comment">// 开发环境 热更新文件</span></span><br><span class="line">     	paths.appIndexJs <span class="comment">// src/index 入口文件</span></span><br><span class="line">    ].filter(<span class="built_in">Boolean</span>),</span><br></pre></td></tr></table></figure>
<h2 id="React-和-ReactDom"><a href="#React-和-ReactDom" class="headerlink" title="React 和 ReactDom"></a>React 和 ReactDom</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// babel-loader 可转换 jsx -&gt; vdom, 需要使用 React.createElement() 等</span></span><br><span class="line"><span class="comment">// &lt;h1&gt;test&lt;/h1&gt; -&gt; React.createElement('h1', 'test') </span></span><br><span class="line"><span class="keyword">const</span> jsx = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>test<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">ReactDOM.render(jsx, <span class="built_in">document</span>.querySelector(<span class="string">'#root'</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>React 负责逻辑控制， 数据 -&gt; vdom</li>
<li>ReactDom 渲染实际 dom，vdom -&gt; dom，如果是移动端，要用别的库渲染</li>
<li>React 可用 jsx 来描述 UI</li>
</ul>
<h2 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h2><p>jsx 是一种 js 语法扩展，能很好描述 UI</p>
<ul>
<li>使用 表达式 <code>{}</code></li>
<li>表达式可以是 <code>变量</code> 、<code>常量</code> 、<code>函数</code> 、jsx </li>
<li>条件可以通过三元表达式等实现</li>
<li>数组元素可通过 map 等函数实现</li>
<li>class for 等属于保留字，class 用 className 替代， for 用 htmlFor 替代</li>
<li>style 或 class 可以使用 css 模块化</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'./index.module.css'</span></span><br><span class="line">&lt;h1 className=&#123; style.img &#125;&gt;test&lt;<span class="regexp">/h1&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h2><h3 id="dotenv-从文件加载环境变量"><a href="#dotenv-从文件加载环境变量" class="headerlink" title="dotenv 从文件加载环境变量"></a>dotenv 从文件加载环境变量</h3><p><code>require(&#39;dotenv&#39;).config()</code> 会默认读取项目根目录下的 .env 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 可传入路径和编码方式</span><br><span class="line">config(&#123;</span><br><span class="line">  path: <span class="string">''</span>,</span><br><span class="line">  Encoding: <span class="string">''</span> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2019/11/28/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2019/11/28/docker/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-28T13:52:00+08:00">
                2019-11-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="环境配置难度"><a href="#环境配置难度" class="headerlink" title="环境配置难度"></a>环境配置难度</h2><p>虚拟机是带环境安装的一种解决方案，可以在一种操作系统里运行另一种才做系统，但仍有一些缺点：</p>
<ul>
<li>资源占用多</li>
<li>冗余步骤多</li>
<li>启动慢</li>
</ul>
<h2 id="linux-容器"><a href="#linux-容器" class="headerlink" title="linux 容器"></a>linux 容器</h2><p>由于虚拟机的这些缺点，linux 发展了另一种虚拟化技术：linux 容器</p>
<p><strong>linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离</strong>。或者说对容器内进程来说，他接触的资源都是虚拟的，从而实现和底层系统的隔离</p>
<ul>
<li>启动快</li>
</ul>
<p>容器内的应用直接就是底层系统的一个进程，而不是虚拟机内部的进程。启动容器相当于启动本机的一个进程，而不是启动一个操作系统</p>
<ul>
<li>资源占用少</li>
</ul>
<p>容器只占用需要的资源，多个容器可共享资源；虚拟机因为是完整的操作系统，不可避免需要占用所有资源并独享资源</p>
<ul>
<li>体积小</li>
</ul>
<p>容器只要包含用的组件即可；虚拟接则是整个操作系统的打包</p>
<ul>
<li>一致运行环境</li>
<li>持续交付和部署</li>
<li>更轻松的迁移</li>
</ul>
<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><p><strong>docker 属于 linux 容器的一种封装，提供简单易用的容器接口，是目前最流行的 linux 容器解决方案</strong></p>
<p> docker 将应用程序和该程序的依赖打包在一个文件。运行该文件会生成一个虚拟容器。程序在该虚拟容器里运行，无需担心环境问题</p>
<p>docker 接口相当简单，可以方便创建和使用容器。容器还可以进行版本管理、复制、分享、修改等</p>
<h2 id="docker-使用流程"><a href="#docker-使用流程" class="headerlink" title="docker 使用流程"></a>docker 使用流程</h2><ul>
<li>通常会写一个或多个 Dockerfile 文件，一个文件对应一个容器。根据 Dockerfile 的文件配置可以烧录一个镜像（可理解为类似制作一个 USB启动盘）。当制作完成镜像，可以运行这个镜像，运行成功就变成了容器</li>
<li>对于启动和关联多个容器，可编写 docker-compose.yml</li>
<li>对容器进行编排做更多配置，可使用 Kubernetes 在不间断服务情况下更新容器</li>
</ul>
<h2 id="docker-安装"><a href="#docker-安装" class="headerlink" title="docker 安装"></a>docker 安装</h2><p>docker 有两个版本： 社区版（Community Editon， 缩写CE）和企业版（Enterprise Edition，缩写EE), 一般使用社区版</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 升级 apt</span><br><span class="line">sudo apt-<span class="keyword">get</span> update</span><br><span class="line"># 添加相关软件包</span><br><span class="line">sudo apt-<span class="keyword">get</span> install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"># 下载软件包的合法性，需要添加软件源的 GPG 密钥</span><br><span class="line">curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"># source.list 中添加 Docker 软件源</span><br><span class="line">sudo add-apt-repository "deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu  $(lsb_release -cs)  stable"</span><br><span class="line"># 安装 docker CE</span><br><span class="line">sudo apt-<span class="keyword">get</span> update</span><br><span class="line">sudo apt-<span class="keyword">get</span> install docker-ce</span><br><span class="line"># 启动 docker CE</span><br><span class="line">sudo groupadd docker</span><br><span class="line">sudo usermod -aG docker $USER</span><br><span class="line">newgrp docker // 更新用户组</span><br><span class="line"># 测试</span><br><span class="line">docker run hello-world</span><br><span class="line"># 使用 -ti 标志可以接管 docker 启动的 shell</span><br><span class="line">docker run -ti ubuntu bash</span><br></pre></td></tr></table></figure>
<h3 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速"></a>镜像加速</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> # /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [</span><br><span class="line">    <span class="string">"https://dockerhub.azk8s.cn"</span>,</span><br><span class="line">    <span class="string">"https://reg-mirror.qiniu.com"</span></span><br><span class="line">] &#125;</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<h3 id="手动构建镜像"><a href="#手动构建镜像" class="headerlink" title="手动构建镜像"></a>手动构建镜像</h3><ul>
<li><code>docker image</code> 查看本地已有镜像</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">ubuntu              latest              <span class="number">775349758637</span>        <span class="number">6</span> weeks ago         <span class="number">64.2</span>MB</span><br><span class="line">hello-world         latest              fce289e99eb9        <span class="number">11</span> months ago       <span class="number">1.84</span>kB</span><br></pre></td></tr></table></figure>
<ul>
<li><code>docker pull</code>  下载镜像 (所有镜像可在 hub.docker.com 中找到)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull centos</span><br><span class="line">Using <span class="keyword">default</span> tag: latest</span><br><span class="line">latest: Pulling <span class="keyword">from</span> library/centos</span><br><span class="line"><span class="number">729</span>ec3a6ada3: Pull complete </span><br><span class="line">Digest: sha256:f94c1d992c193b3dc09e297ffd54d8a4f1dc946c37cbeceb26d35ce1647f88d9</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br><span class="line">docker.io/library/centos:latest</span><br></pre></td></tr></table></figure>
<ul>
<li><code>docker rmi</code>  删除镜像 (后面可跟名称或者 imageId)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker rmi centos</span><br><span class="line">Untagged: centos:latest</span><br><span class="line">Untagged: centos@sha256:f94c1d992c193b3dc09e297ffd54d8a4f1dc946c37cbeceb26d35ce1647f88d9</span><br><span class="line">Deleted: sha256:<span class="number">0</span>f3e07c0138fbe05abcb7a9cc7d63d9bd4c980c3f61fea5efa32e7c4217ef4da</span><br><span class="line">Deleted: sha256:<span class="number">9e607</span>bb861a7d58bece26dd2c02874beedd6a097c1b6eca5255d5eb0d2236983</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>docker run</code>  运行一个镜像，产生一个容器</p>
</li>
<li><p><code>docker ps -a</code>  查看所有容器，不加 a 参数会隐藏停止的容器</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">admin@VM<span class="number">-0</span><span class="number">-9</span>-ubuntu:~$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS                          PORTS               NAMES</span><br><span class="line"><span class="number">0</span>ba76322c986        ubuntu              <span class="string">"/bin/bash"</span>         About a minute ago   Exited (<span class="number">0</span>) About a minute ago                       laughing_shirley</span><br><span class="line"><span class="number">287</span>fe66ab63c        hello-world         <span class="string">"/hello"</span>            <span class="number">19</span> minutes ago       Exited (<span class="number">0</span>) <span class="number">19</span> minutes ago                           affectionate_wu</span><br></pre></td></tr></table></figure>
<ul>
<li><code>docker rm</code>  删除一个停止容器</li>
<li><code>docker stop</code>  停止运行一个容器</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 移除一个运行的容器会发生错误 </span><br><span class="line">docker rmi fce289e99eb9</span><br><span class="line"><span class="built_in">Error</span> response <span class="keyword">from</span> daemon: conflict: unable to <span class="keyword">delete</span> fce289e99eb9 (must be forced) - image is being used by stopped container <span class="number">76650e1</span>cb919</span><br></pre></td></tr></table></figure>
<h3 id="编写-Dockerfile-文件"><a href="#编写-Dockerfile-文件" class="headerlink" title="编写 Dockerfile 文件"></a>编写 Dockerfile 文件</h3><p>Dockerfile 所有指令可以在 Docker Documentation 中找到</p>
<h4 id="通过-Dockerfile-构建镜像"><a href="#通过-Dockerfile-构建镜像" class="headerlink" title="通过 Dockerfile 构建镜像"></a>通过 Dockerfile 构建镜像</h4><ul>
<li><code>docker build</code> 在当前目录下找到 Dockerfile 文件构建</li>
</ul>
<h4 id="FROM-指令"><a href="#FROM-指令" class="headerlink" title="FROM 指令"></a>FROM 指令</h4><p>自定义镜像基本是基于官方的基础镜像进行更改，使用 From 指令表示以何种镜像为基础</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM Ubuntu</span><br></pre></td></tr></table></figure>
<h4 id="RUN-命令"><a href="#RUN-命令" class="headerlink" title="RUN 命令"></a>RUN 命令</h4><p>run 命令用来执行一些 shell 命令，如安装依赖等，通常建议把命令尽量写到一行，因为一个指令就是一个镜像层，安装的命令何在一个层是一种最佳实践</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN apt-get install -y vim</span><br></pre></td></tr></table></figure>
<h4 id="VOLUME-指令"><a href="#VOLUME-指令" class="headerlink" title="VOLUME 指令"></a>VOLUME 指令</h4><p>将当前目录下所有文件同步到镜像中，默认 docker 容器中数据都是只读，如果要让他可写，并且可以共享给其他容器必须创建 volume</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">VOLUME [<span class="string">'/code'</span>]</span><br><span class="line">WORKDIR /code</span><br><span class="line">RUN node index.js</span><br><span class="line">docker run -v <span class="variable">$PWD</span>/app:/code</span><br></pre></td></tr></table></figure>
<h4 id="COPY-和-ADD"><a href="#COPY-和-ADD" class="headerlink" title="COPY 和 ADD"></a>COPY 和 ADD</h4><p>这两个命令是把文件复制到容器中，相较而言，ADD 读取远程网络文件更加优秀，一般使用 COPY 即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPY . /code</span><br></pre></td></tr></table></figure>
<h4 id="EXPORT"><a href="#EXPORT" class="headerlink" title="EXPORT"></a>EXPORT</h4><p>将本机端口映射到容器内部端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将本机 80 端口映射到容器内部 8080 端口</span></span><br><span class="line">EXPORT 80 8080</span><br></pre></td></tr></table></figure>
<h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>用于切换目录，类似 cd 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /code</span><br></pre></td></tr></table></figure>
<h4 id="运行一个-server-实例"><a href="#运行一个-server-实例" class="headerlink" title="运行一个 server 实例"></a>运行一个 server 实例</h4><ul>
<li>创建 Dockerfile (命令可使用小写)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 node 镜像的 slim 版本构建， slim 版本是 node 应用最精简容器</span></span><br><span class="line">from node:slim</span><br><span class="line"><span class="comment"># 将当前目录复制到容器 /code 目录下</span></span><br><span class="line">copy . /code</span><br><span class="line"><span class="comment"># 进入 /code 目录</span></span><br><span class="line">workdir /code</span><br><span class="line"><span class="comment"># 暴露容器 80 端口</span></span><br><span class="line">expose 80</span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">run npm install</span><br><span class="line"><span class="comment"># 运行 index.js 文件</span></span><br><span class="line">cmd node index.js</span><br></pre></td></tr></table></figure>
<ul>
<li>创建 index.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'server'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="keyword">get</span> &#125; = server.router</span><br><span class="line">server(&#123; port: <span class="number">8080</span> &#125;, [</span><br><span class="line">  <span class="keyword">get</span>('/', ctx =&gt; 'hello docker')</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<ul>
<li>安装依赖</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i server -D</span><br></pre></td></tr></table></figure>
<ul>
<li>忽略 node_modules</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 创建 .dockerignore</span><br><span class="line">node_modules</span><br></pre></td></tr></table></figure>
<ul>
<li>构建镜像,   t 参数可指定名字</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build . -t my_server</span><br></pre></td></tr></table></figure>
<ul>
<li>运行镜像，生成容器</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:8080 my_server</span><br></pre></td></tr></table></figure>
<h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker compose"></a>docker compose</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-compose</span><br></pre></td></tr></table></figure>
<h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><ul>
<li>build </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dicker-compose.yml 藐视了多个容器的属性，运行 build 命令会将自定义 Dockerfile build 成镜像再运行</span></span><br><span class="line"><span class="comment"># 若需要的镜像不存在，会通过 pull 从镜像仓库拉去</span></span><br><span class="line">docker-compose build</span><br></pre></td></tr></table></figure>
<ul>
<li>up</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># up 可启动 docker-compose.yml 中所有服务</span></span><br><span class="line"><span class="comment"># -d 可让服务在后台运行</span></span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<ul>
<li>logs</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># logs 查看后台启动的服务日志</span></span><br><span class="line">docker-compose logs</span><br></pre></td></tr></table></figure>
<ul>
<li>down</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将所有通过 up 命令创建的容器停止并销毁</span></span><br><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>
<ul>
<li>ps</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看通过 docker-compose 启动的容器的详细信息</span></span><br><span class="line">docker-compose ps</span><br></pre></td></tr></table></figure>
<ul>
<li>stop</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止通过 docker-compose up 启动容器</span></span><br><span class="line">docker-compose stop</span><br></pre></td></tr></table></figure>
<ul>
<li>start</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动被 stop 命令停止的容器</span></span><br><span class="line">docker-compose start</span><br></pre></td></tr></table></figure>
<ul>
<li>restart</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启容器</span></span><br><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure>
<ul>
<li>exec</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在某个容器中执行命令， 默认会接管一个 shell</span></span><br><span class="line">docker-compose <span class="built_in">exec</span> web sh</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2019/11/26/try-finally/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2019/11/26/try-finally/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-26T10:58:26+08:00">
                2019-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="comment">// 可能抛出异常</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">	<span class="comment">// 捕获异常</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="comment">// 不管有无异常都执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>finally 中的代码不管有无异常都会执行：</p>
<ul>
<li>如果没有异常发生，try 内代码执行结束后执行</li>
<li>如果异常发生并且被 catch 捕获，在 catch 代码执行结束后执行</li>
<li>如果有异常发生但没被捕获，在异常被抛给上层之前执行</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ret</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> ret = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    ret = <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ret() <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果 try 或 catch 语句内有 return 语句，则 <strong>return 语句在 finally 语句后才执行，但是 finally 不能改变返回值</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ret</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> ret = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ret() <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>finally 中有 return 语句，实际会返回 finally 中的返回值，try 和 catch 中的返回值会被覆盖</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ret</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>/<span class="number">0</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ret() <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ret</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>/<span class="number">0</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'test'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ret() <span class="comment">// Uncaught Error: test</span></span><br></pre></td></tr></table></figure>
<ul>
<li>finally 不仅 return 语句会覆盖异常，如果 finally 抛出异常，则原异常也会覆盖</li>
</ul>
<p>综上，应该<strong>避免在 finally 中使用 return 语句和排除异常</strong>， 如果调用其他代码可能抛出异常，应先捕获异常并进行处理</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/blog/2019/11/19/vue3 composition api 简易实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2019/11/19/vue3 composition api 简易实现/" itemprop="url">vue3 composition api 简易实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-19T09:10:56+08:00">
                2019-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>vue3 已经推出<a href="https://github.com/jhgrrewq/vue-next" target="_blank" rel="noopener">Pre-Alpha 版本</a>, 除了 SSR、keep-alive、transition 和v-on/v-model/v-text/v-pre/v-once/v-html/v-show 等指令外，已完成大部分功能。现在我们对 <a href="https://vue-composition-api-rfc.netlify.com/" target="_blank" rel="noopener">vue composition-api</a> 尝鲜，并对其响应式做基本实现</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/blog/2019/11/19/vue3 composition api 简易实现/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/12/">12</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4" alt="jhgrrewq">
            
              <p class="site-author-name" itemprop="name">jhgrrewq</p>
              <p class="site-description motion-element" itemprop="description">爱好电影，更爱女神阿佳妮；爱网球，更爱罗杰费德勒。网易云音乐深度用户</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/blog/archives/">
              
                  <span class="site-state-item-count">118</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/blog/tags/index.html">
                  <span class="site-state-item-count">80</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/jhgrrewq" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jhgrrewq</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




<div>备案号 <a class="theme-link" target="_blank" href="http://www.beian.miit.gov.cn">浙ICP备18011306号-1</a></div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  




  
  
  
  <link rel="stylesheet" href="/blog/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/blog/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/blog/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  


</body>
</html>
