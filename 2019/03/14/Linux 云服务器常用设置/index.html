<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Linux," />










<meta name="description" content="参考: linux云服务器常用设置  重装系统后重新登录12345678910111213@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux 云服务器常用设置">
<meta property="og:url" content="http://jhgrrewq.github.io/2019/03/14/Linux 云服务器常用设置/index.html">
<meta property="og:site_name" content="jhgrrewq 前端小站">
<meta property="og:description" content="参考: linux云服务器常用设置  重装系统后重新登录12345678910111213@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ony85apla.bkt.clouddn.com/18-8-15/17396776.jpg">
<meta property="og:image" content="http://ony85apla.bkt.clouddn.com/18-8-15/37334854.jpg">
<meta property="og:image" content="http://ony85apla.bkt.clouddn.com/18-8-16/55830565.jpg">
<meta property="og:image" content="http://ony85apla.bkt.clouddn.com/18-8-15/9004089.jpg">
<meta property="og:image" content="http://ony85apla.bkt.clouddn.com/18-8-16/91258893.jpg">
<meta property="og:image" content="http://ony85apla.bkt.clouddn.com/18-8-16/6567381.jpg">
<meta property="og:image" content="http://ony85apla.bkt.clouddn.com/18-8-16/93374088.jpg">
<meta property="og:image" content="http://ony85apla.bkt.clouddn.com/18-8-16/46325545.jpg">
<meta property="og:updated_time" content="2019-12-25T07:52:08.506Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux 云服务器常用设置">
<meta name="twitter:description" content="参考: linux云服务器常用设置  重装系统后重新登录12345678910111213@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@">
<meta name="twitter:image" content="http://ony85apla.bkt.clouddn.com/18-8-15/17396776.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'O0AP0FGXSX',
      apiKey: 'ab7c2224e88a925feeea82c8902add9d',
      indexName: 'jhgrrewq',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jhgrrewq.github.io/2019/03/14/Linux 云服务器常用设置/"/>





  <title>Linux 云服务器常用设置 | jhgrrewq 前端小站</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jhgrrewq 前端小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">置我于死地者 必将赐我以后生</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jhgrrewq.github.io/2019/03/14/Linux 云服务器常用设置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jhgrrewq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jhgrrewq 前端小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Linux 云服务器常用设置</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-14T16:01:10+08:00">
                2019-03-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <!-- markdownlint-disable MD010 -->
<blockquote>
<p>参考: <a href="http://www.cnblogs.com/xiaohuochai/p/7749727.html" target="_blank" rel="noopener">linux云服务器常用设置</a></p>
</blockquote>
<h2 id="重装系统后重新登录"><a href="#重装系统后重新登录" class="headerlink" title="重装系统后重新登录"></a>重装系统后重新登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span><br><span class="line">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span><br><span class="line">It is also possible that a host key has just been changed.</span><br><span class="line">The fingerprint <span class="keyword">for</span> the ECDSA key sent by the remote host is</span><br><span class="line">SHA256:fpZat/wEOrHUkMv81FrwdoGEBI6Xs+OlEHNElmyUu90.</span><br><span class="line">Please contact your system administrator.</span><br><span class="line">Add correct host key <span class="keyword">in</span> /Users/jackzhang/.ssh/known_hosts to get rid of this message.</span><br><span class="line">Offending ECDSA key <span class="keyword">in</span> /Users/jackzhang/.ssh/known_hosts:41</span><br><span class="line">ECDSA host key <span class="keyword">for</span> 118.24.149.79 has changed and you have requested strict checking.</span><br><span class="line">Host key verification failed.</span><br></pre></td></tr></table></figure>
<p>服务器重装后连接远程服务器，本地和远程服务器 ssh 连接不上导致错误，因此需要删除本地 ssh 缓存信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -R &lt;host&gt;</span><br></pre></td></tr></table></figure>
<h2 id="登录-登出"><a href="#登录-登出" class="headerlink" title="登录 登出"></a>登录 登出</h2><ul>
<li>ssh 用户名密码登录</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;username&gt;@&lt;host&gt;</span><br></pre></td></tr></table></figure>
<p>回车输入密码</p>
<ul>
<li>通过特定端口 登录</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p &lt;port&gt; &lt;username&gt;@&lt;host&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>登出</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用快捷键 ctrl + d</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="更改-shell"><a href="#更改-shell" class="headerlink" title="更改 shell"></a>更改 shell</h2><p>Ubuntu 系统默认使用的 shell 是 <code>dash</code>, 可通过下面命令切换成更常用的 <code>bash</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg-reconfigure dash</span><br></pre></td></tr></table></figure>
<p>然后选择 <no></no></p>
<p><img src="http://ony85apla.bkt.clouddn.com/18-8-15/17396776.jpg" alt=""></p>
<p>执行 <code>ls -l /bin/sh</code>，查看 shell 类型已经修改为 bash</p>
<p><img src="http://ony85apla.bkt.clouddn.com/18-8-15/37334854.jpg" alt=""></p>
<h2 id="账号权限"><a href="#账号权限" class="headerlink" title="账号权限"></a>账号权限</h2><p>为保证服务器安全性，需要设置一个高权限的账号来替代操作</p>
<ul>
<li>新建一个新用户</li>
</ul>
<p>ubuntu 系统默认不创建目录，如果需要添加 <code>-m</code> 参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd <span class="built_in">test</span> -m</span><br></pre></td></tr></table></figure>
<ul>
<li>设置用户密码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<ul>
<li>将用户添加到 sudo 组中，操作命令前添加 sudo，可实现 root 权限</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gpasswd -a <span class="built_in">test</span> sudo</span><br></pre></td></tr></table></figure>
<ul>
<li>配置 visudo (相当于编辑 vim /etc/sudoers 文件)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo visudo</span><br></pre></td></tr></table></figure>
<p><code>ALL=(ALL:ALL) ALL</code> 四个 all 分别指：任意用户、任意用户身份、任意用户组、任意命令；也就是<strong>让该用户可以以 root 权限执行的命令</strong></p>
<p><img src="http://ony85apla.bkt.clouddn.com/18-8-16/55830565.jpg" alt=""></p>
<ul>
<li>切换到 test 账号下</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><ul>
<li>强制删除用户</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -r 用于彻底删除，/home 下的目录会被移除，在其他位置的也将找出并删除</span></span><br><span class="line">sudo userdel -r xxx</span><br></pre></td></tr></table></figure>
<p>当前删除用户可能正被进程使用，因此需要先将使用的进程杀死</p>
<ul>
<li>查看使用进程</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">...</span><br><span class="line">ubuntu   28817 28816  0 09:18 pts/0    00:00:00 -bash</span><br><span class="line">root     29478     2  0 09:24 ?        00:00:00 [kworker/0:1]</span><br><span class="line">root     29491  1318  0 09:24 ?        00:00:00 sshd: <span class="built_in">test</span> [priv]</span><br><span class="line"><span class="built_in">test</span>    29543 29491  0 09:24 ?        00:00:00 sshd: <span class="built_in">test</span></span><br><span class="line">root     29660  1318  0 09:26 ?        00:00:00 sshd: root [priv]</span><br><span class="line">sshd     29661 29660  0 09:26 ?        00:00:00 sshd: root [net]</span><br><span class="line">ubuntu   29664 28817  0 09:26 pts/0    00:00:00 ps -ef</span><br><span class="line"><span class="built_in">test</span>    32694     1  0 Aug15 ?        00:00:00 /lib/systemd/systemd --user</span><br><span class="line"><span class="built_in">test</span>    32695 32694  0 Aug15 ?        00:00:00 (sd-pam)</span><br></pre></td></tr></table></figure>
<ul>
<li>利用管道符查找进程</li>
</ul>
<p>将 <code>ps</code> 的查询结果通过管道给 <code>grep</code> 查找包含特定字符串的进程</p>
<p>管道符 <code>|</code> 用于隔开两个命令，管道符左边命令的输出会作为右边命令的输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<ul>
<li>杀死进程</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">kill</span> -s 9 29543</span><br></pre></td></tr></table></figure>
<p><code>-s 9</code> <strong>指定传递给进程的信号是９，即强制、尽快终止进程</strong>。29543 则是上面 <code>ps</code> 查到 test 的 PID</p>
<h2 id="无密码登录"><a href="#无密码登录" class="headerlink" title="无密码登录"></a>无密码登录</h2><p>ssh 是网络上两台机器互联的一套协议，<strong>默认使用 22 端口</strong></p>
<p>使用 <code>ssh test@xxx</code> 可以 test 用户名来登录服务器</p>
<p>可以通过添加 <code>ssh key</code> 实现无密码登录(<strong>原理就是通过匹配公钥和私钥</strong>)</p>
<ul>
<li>本地机器上生成 <code>ssh key</code> (<code>id_rsa</code> 私钥文件，<code>id_rsa.pub</code> 为公钥文件)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>ssh-copy-id</code> 命令将公钥文件传输到远程 <code>/home/test/.ssh/authorized_keys</code> 文件中</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub <span class="built_in">test</span>@118.24.149.79</span><br></pre></td></tr></table></figure>
<p><img src="http://ony85apla.bkt.clouddn.com/18-8-15/9004089.jpg" alt=""></p>
<p>之后就可免密码登录 <code>ssh test@118.24.149.79</code></p>
<p>注意遇到 <code>ssh-copy-id -i command not found</code></p>
<ul>
<li>本地终端执行以下命令</li>
</ul>
<p><code>curl -L https://raw.githubusercontent.com/beautifulcode/ssh-copy-id-for-OSX/master/install.sh | sh</code></p>
<p>输入本地软件安装密码，看到 <code>Installed ssh-copy-id into /usr/local/bin</code>，说明 ssh-copy-id 安装成功</p>
<h2 id="常见-linux-操作"><a href="#常见-linux-操作" class="headerlink" title="常见 linux 操作"></a>常见 linux 操作</h2><ul>
<li>查看系统盘</li>
</ul>
<p><code>/dev/vda1</code> 挂载系统盘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l</span><br></pre></td></tr></table></figure>
<p><img src="http://ony85apla.bkt.clouddn.com/18-8-16/91258893.jpg" alt=""></p>
<ul>
<li>查看硬盘使用情况</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -h</span><br></pre></td></tr></table></figure>
<p><img src="http://ony85apla.bkt.clouddn.com/18-8-16/6567381.jpg" alt=""></p>
<h2 id="增强服务器安全性"><a href="#增强服务器安全性" class="headerlink" title="增强服务器安全性"></a>增强服务器安全性</h2><h3 id="修改-ssh-端口"><a href="#修改-ssh-端口" class="headerlink" title="修改 ssh 端口"></a>修改 ssh 端口</h3><p>ssh 默认端口是 22。为提高服务器安全性，缩小被扫描和猜测几率，可将其修改为其他端口</p>
<ul>
<li>修改 <code>/etc/ssh/sshd_conf</code> 文件端口为 1024 - 65536 之间端口(0-1024 端口一般系统占用)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<p><img src="http://ony85apla.bkt.clouddn.com/18-8-16/93374088.jpg" alt=""></p>
<p><code>/etc/ssh/sshd_conf</code> 文件末尾添加 <code>AllowUsers test</code></p>
<p><img src="http://ony85apla.bkt.clouddn.com/18-8-16/46325545.jpg" alt=""></p>
<ul>
<li>然后重启 ssh 服务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh restart</span><br></pre></td></tr></table></figure>
<h3 id="取消密码登录"><a href="#取消密码登录" class="headerlink" title="取消密码登录"></a>取消密码登录</h3><p>使用 ssh key 免密登录后，可以设置取消密码登录，同样是修改 <code>/etc/ssh/sshd_config</code>，将 <code>PasswordAuthentication yes</code> 改为 <code>PasswordAuthentication no</code>, 在重启 ssh 服务</p>
<h2 id="linux-包依赖安装"><a href="#linux-包依赖安装" class="headerlink" title="linux 包依赖安装"></a>linux 包依赖安装</h2><ul>
<li>更新包列表</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<ul>
<li>卸载包但不删除配置</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove &lt;package&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>卸载包并且删除配置</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get purge &lt;package&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>安装常用依赖</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install vim openssl build-essential libssl-dev wget curl git</span><br></pre></td></tr></table></figure>
<h2 id="安装-Node-js"><a href="#安装-Node-js" class="headerlink" title="安装 Node.js"></a>安装 Node.js</h2><p>linux 安装 Node.js 一般有三种方式：</p>
<ul>
<li>下载源码并手动编译二进制文件</li>
<li>直接下载二进制文件并解压</li>
<li>使用 <code>apt-get install nodejs</code> <code>sudo apt-get install npm</code>下载(不推荐)</li>
</ul>
<h3 id="直接下载二进制文件并解压"><a href="#直接下载二进制文件并解压" class="headerlink" title="直接下载二进制文件并解压"></a>直接下载二进制文件并解压</h3><ul>
<li>去官网下载和系统匹配的二进制文件</li>
</ul>
<p>通过命令 <code>uname -a</code> 查看系统位数为 64 位</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux VM-0-9-ubuntu 4.4.0-130-generic #156-Ubuntu SMP Thu Jun 14 08:53:28 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>
<ul>
<li>下载的 tar 包文件上传到服务器并且解压，然后通过建立软连接变为全局</li>
</ul>
<p>1）上传服务器可是任意路径，笔者这里为 <code>/home/test/software/</code><br>2) 上传解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传远程服务器</span></span><br><span class="line">scp -P &lt;port&gt; -r node-v10.15.3-linux-x64.tar.xz <span class="built_in">test</span>@&lt;host&gt;:/home/<span class="built_in">test</span>/software</span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -xvf node-v10.15.3-linux-x64.tar.xz</span><br><span class="line"><span class="comment"># 重命名</span></span><br><span class="line">mv node-v10.15.3-linux-x64.tar.xz nodejs-v10.15.3</span><br></pre></td></tr></table></figure>
<p>3) 解压目录 <code>nodejs-v10.15.3</code> 下 <code>bin</code> 目录下有 node npm npx 三个执行文件。 <strong>因为 <code>/home/test/software/node-v10.15.3-linux-x64/bin</code> 不在环境变量中，因此只能在当前目录下才能执行 node 的程序，如果在其他目录下想要执行 node 命令，必须通过绝对路径。如果想要在任意目录访问，需要将 node 所在目录添加到环境变量；或者通过软连接的形式将 node 和 npm 链接到系统默认的 path 目录下</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /home/<span class="built_in">test</span>/software/nodejs-v10.15.3/bin/node /usr/<span class="built_in">local</span>/bin/node</span><br><span class="line">sudo ln -s /home/<span class="built_in">test</span>/software/nodejs-v10.15.3/bin/npm /usr/<span class="built_in">local</span>/bin/npm</span><br></pre></td></tr></table></figure>
<ul>
<li>删除软链接</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如删除上述软连接</span></span><br><span class="line">rm -rf /usr/<span class="built_in">local</span>/bin/node</span><br></pre></td></tr></table></figure>
<h3 id="执行-npm-i-g-lt-package-gt-报错没有找到命令"><a href="#执行-npm-i-g-lt-package-gt-报错没有找到命令" class="headerlink" title="执行 npm i -g &lt;package&gt; 报错没有找到命令"></a>执行 <code>npm i -g &lt;package&gt;</code> 报错没有找到命令</h3><p>npm 全局安装找不到命令，<strong>本质还是环境变量问题</strong></p>
<p>linux 环境变量有三种：</p>
<ul>
<li>当前用户当前 shell 有效（临时环境变量关闭则失效）</li>
<li>当前用户有效</li>
<li>所有用户都有效</li>
</ul>
<h4 id="当前用户当前-shell-有效"><a href="#当前用户当前-shell-有效" class="headerlink" title="当前用户当前 shell 有效"></a>当前用户当前 shell 有效</h4><p>在 shell 中执行以下命令，<code>$PATH:</code> 后跟想要加入环境变量的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/home/<span class="built_in">test</span>/software/nodejs-v10.15.3/bin</span><br></pre></td></tr></table></figure>
<h4 id="当前用户有效"><a href="#当前用户有效" class="headerlink" title="当前用户有效"></a>当前用户有效</h4><p>修改当前用户目录下 <code>./bashrc</code> 文件, 执行 <code>source ~/.bashrc</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/home/<span class="built_in">test</span>/software/nodejs-v10.15.3/bin</span><br></pre></td></tr></table></figure>
<h4 id="所有用户"><a href="#所有用户" class="headerlink" title="所有用户"></a>所有用户</h4><p>修改     <code>/etc/profile</code> 文件, 执行 <code>source /etc/profile</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/home/<span class="built_in">test</span>/software/nodejs-v10.15.3/bin</span><br></pre></td></tr></table></figure>
<h2 id="安装-Node-js-常用依赖"><a href="#安装-Node-js-常用依赖" class="headerlink" title="安装 Node.js 常用依赖"></a>安装 Node.js 常用依赖</h2><ul>
<li>安装 n 模块管理 node 版本</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常用指令</span></span><br><span class="line"><span class="comment"># 列出当前安装的 node 版本</span></span><br><span class="line">n</span><br><span class="line"><span class="comment"># 列出 node 全部现有版本</span></span><br><span class="line">n ls</span><br><span class="line"><span class="comment"># 列出 node 发行的最新版本</span></span><br><span class="line">n --latest</span><br><span class="line"><span class="comment"># 列出 node 长期支持的最新版本</span></span><br><span class="line">n --lts</span><br><span class="line"><span class="comment"># 安装最新发行的 node 版本</span></span><br><span class="line">n latest</span><br><span class="line"><span class="comment"># 安装最新的长期支持版本</span></span><br><span class="line">n lts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装特定版本 node</span></span><br><span class="line">n &lt;version&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用特定版本 node</span></span><br><span class="line">n use &lt;version&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除特定 node(可删除多个)</span></span><br><span class="line">n rm &lt;version ...&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除除了当前版本的所有版本</span></span><br><span class="line">n prune</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 nrm 管理 registry</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装</span></span><br><span class="line">npm i nrm -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有 registry</span></span><br><span class="line">nrm ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用特定 registry</span></span><br><span class="line">nrm use npm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加特定 registry</span></span><br><span class="line">nrm add &lt;registry-name&gt; &lt;registry&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除特定 registry</span></span><br><span class="line">nrm del &lt;registry-name&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>安装常用 Node.js 模块</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pm2 webpack gulp grunt-cli -g</span><br></pre></td></tr></table></figure>
<h2 id="pm2-管理-node-进程"><a href="#pm2-管理-node-进程" class="headerlink" title="pm2 管理 node 进程"></a>pm2 管理 node 进程</h2><p>pm2 是一个带有负载均衡功能的 Node 应用的进程管理器, 括守护进程，监控，日志的一整套完整的功能</p>
<ul>
<li>进程守护，系统崩溃自动重启</li>
<li>启动多进程，充分利用 CPU 和内存</li>
<li>自带日志记录功能</li>
</ul>
<h3 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">pm2 start app.js</span><br><span class="line">pm2 start app.js --name my-api   <span class="comment"># 启动进程并命名为 my-api</span></span><br><span class="line">pm2 start app.js -i 4           <span class="comment"># 根据 CPU 核数启动进程个数, 这个 4 个应用会自动负载均衡</span></span><br><span class="line">pm2 start app.js --watch   <span class="comment"># 实时监控 app.js 的方式启动，当app.js文件有变动时，pm2 会自动 reload；更复杂的监听最好通过配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">pm2 stop all  <span class="comment"># 停止 PM2 列表中所有的进程</span></span><br><span class="line">pm2 stop 0    <span class="comment"># 停止 PM2 列表中进程为 0 的进程</span></span><br><span class="line">pm2 stop app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 PM2 进程</span></span><br><span class="line">pm2 delete 0     <span class="comment">#删除 PM2 列表中进程为 0 的进程</span></span><br><span class="line">pm2 delete all   <span class="comment">#删除 PM2 列表中所有的进程</span></span><br><span class="line">pm2 delete app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">pm2 restart all     <span class="comment"># 重启 PM2 列表中所有的进程</span></span><br><span class="line">pm2 restart 0      <span class="comment"># 重启 PM2 列表中进程为 0 的进程</span></span><br><span class="line">pm2 restart app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重载</span></span><br><span class="line">pm2 reload all    <span class="comment"># 重载 PM2 列表中所有的进程</span></span><br><span class="line">pm2 reload 0     <span class="comment"># 重载 PM2 列表中进程为 0 的进程</span></span><br><span class="line">pm2 reload app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看进程</span></span><br><span class="line">pm2 list</span><br><span class="line">pm2 show 0 <span class="comment"># pm2 info 0  #查看进程详细信息，0 为 PM2 进程 id</span></span><br><span class="line">pm2 show app  <span class="comment">#查看进程详细信息，app 为 PM2 进程 name, 下同</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程信息</span></span><br><span class="line">pm2 info app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监控</span></span><br><span class="line">pm2 monit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志操作</span></span><br><span class="line">pm2 <span class="built_in">log</span> app</span><br><span class="line">pm2 logs [--raw]   <span class="comment"># Display all processes logs in streaming</span></span><br><span class="line">pm2 flush          <span class="comment"># Empty all log file</span></span><br><span class="line">pm2 reloadLogs    <span class="comment"># Reload all logs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级 PM2</span></span><br><span class="line">npm install pm2@lastest -g   <span class="comment"># 安装最新的 PM2 版本</span></span><br><span class="line">pm2 updatePM2                <span class="comment"># 升级pm2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更多命令参数请查看帮助</span></span><br><span class="line">pm2 --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># 执行pm2 start pm2.config.js</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="string">"apps"</span>: &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"wuwu"</span>,                             <span class="comment">// 进程名          </span></span><br><span class="line">        <span class="string">"script"</span>: <span class="string">"./bin/www"</span>,                      <span class="comment">// 执行文件，如果是 node 项目就是入口文件</span></span><br><span class="line">        <span class="string">"cwd"</span>: <span class="string">"./"</span>,                                <span class="comment">// 根目录</span></span><br><span class="line">        <span class="string">"args"</span>: <span class="string">""</span>,                                 <span class="comment">// 传递给脚本的参数，可以数组</span></span><br><span class="line">        <span class="string">"watch"</span>: <span class="literal">true</span>,                              <span class="comment">// 是否监听文件变动然后重启</span></span><br><span class="line">        <span class="string">"ignore_watch"</span>: [                           <span class="comment">// 不用监听的文件</span></span><br><span class="line">            <span class="string">"node_modules"</span>,</span><br><span class="line">            <span class="string">"logs"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"exec_mode"</span>: <span class="string">"cluster_mode"</span>,                <span class="comment">// 应用启动模式，支持fork和cluster模式</span></span><br><span class="line">        <span class="string">"instances"</span>: <span class="number">4</span>,                             <span class="comment">// 应用启动实例个数，仅在cluster模式有效 默认为fork；或者 max</span></span><br><span class="line">        <span class="string">"max_memory_restart"</span>: <span class="number">8</span>,                    <span class="comment">// 最大内存限制数，超出自动重启</span></span><br><span class="line">        <span class="string">"error_file"</span>: <span class="string">"./logs/app-err.log"</span>,         <span class="comment">// 错误日志文件</span></span><br><span class="line">        <span class="string">"out_file"</span>: <span class="string">"./logs/app-out.log"</span>,           <span class="comment">// 正常日志文件</span></span><br><span class="line">        <span class="string">"merge_logs"</span>: <span class="literal">true</span>,                         <span class="comment">// 设置追加日志而不是新建日志</span></span><br><span class="line">        <span class="string">"log_date_format"</span>: <span class="string">"YYYY-MM-DD HH:mm:ss"</span>,   <span class="comment">// 指定日志文件的时间格式</span></span><br><span class="line">        <span class="string">"min_uptime"</span>: <span class="string">"60s"</span>,                        <span class="comment">// 应用运行少于时间被认为是异常启动</span></span><br><span class="line">        <span class="string">"max_restarts"</span>: <span class="number">30</span>,                         <span class="comment">// 最大异常重启次数，即小于min_uptime运行时间重启次数；</span></span><br><span class="line">        <span class="string">"restart_delay"</span>: <span class="string">"60s"</span>                      <span class="comment">// 异常重启情况下，延时重启时间</span></span><br><span class="line">        <span class="string">"env"</span>: &#123;</span><br><span class="line">           <span class="string">"NODE_ENV"</span>: <span class="string">"development"</span>,                <span class="comment">// 环境参数，当前指定为开发环境 process.env.NODEPORT</span></span><br><span class="line">           <span class="string">"PORT"</span>: <span class="number">9091</span>                              <span class="comment">// process.env.PORT</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"env_development"</span>: &#123;</span><br><span class="line">            <span class="string">"NODE_ENV"</span>: <span class="string">"development"</span>,              <span class="comment">// 环境参数，当前指定为开发环境 pm2 start app.js --env development</span></span><br><span class="line">            <span class="string">"PORT"</span>: <span class="number">9091</span>                             </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"env_test"</span>: &#123;                               <span class="comment">// 环境参数，当前指定为测试环境 pm2 start app.js --env test</span></span><br><span class="line">            <span class="string">"NODE_ENV"</span>: <span class="string">"test"</span>,</span><br><span class="line">            <span class="string">"PORT"</span>: <span class="number">9091</span>                              </span><br><span class="line">        &#125;,</span><br><span class="line">  			<span class="string">"env_production"</span>: &#123;                         <span class="comment">// 环境参数，当前指定为生产环境 pm2 start app.js --env production</span></span><br><span class="line">            <span class="string">"NODE_ENV"</span>: <span class="string">"production"</span>,</span><br><span class="line">            <span class="string">"PORT"</span>: <span class="number">9091</span>                              </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置-nginx"><a href="#配置-nginx" class="headerlink" title="配置 nginx"></a>配置 nginx</h2><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul>
<li>更新包列表</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 nginx</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nginx</span><br></pre></td></tr></table></figure>
<ul>
<li>停掉 nginx</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 快速停止 nginx</span></span><br><span class="line">nginx -s stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 完整有序停止 nginx</span></span><br><span class="line">nginx -s quit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前 nginx 进程 pid, 强制杀死进程</span></span><br><span class="line">ps -ef | grep nginx</span><br><span class="line">pkill -9 nginx</span><br></pre></td></tr></table></figure>
<ul>
<li>启动 nginx</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx 安装目录 -c nginx 配置文件</span></span><br><span class="line">sudo nginx -c /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<ul>
<li>重启 nginx (热启动，修改配置重启不影响线上)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入 nginx 安装目录</span></span><br><span class="line">sudo nginx -s reload</span><br></pre></td></tr></table></figure>
<ul>
<li>测试 nginx 配置</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入 nginx 安装目录</span></span><br><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure>
<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>笔者将域名代理到 coding pages 博客</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name blog.jhgrrewq.com;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass https://qwerrghj.coding.me/;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="配置-ssl-证书"><a href="#配置-ssl-证书" class="headerlink" title="配置 ssl 证书"></a>配置 ssl 证书</h3><ul>
<li><p>生成 ssl 证书</p>
</li>
<li><p>基本 https 配置</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本配置</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 443;</span><br><span class="line">	server_name jhgrrewq.com;</span><br><span class="line">	ssl on;</span><br><span class="line">	ssl_certificate /etc/nginx/certs/1_jhgrrewq.com_bundle.crt;</span><br><span class="line">	ssl_certificate_key /etc/nginx/certs/2_jhgrrewq.com.key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 负载</span></span><br><span class="line">upstream jack &#123;</span><br><span class="line">  server 127.0.0.1:&lt;port&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 443;</span><br><span class="line">	server_name jhgrrewq.com;</span><br><span class="line">	ssl on;</span><br><span class="line">	ssl_certificate /etc/nginx/certs/1_jhgrrewq.com_bundle.crt;</span><br><span class="line">	ssl_certificate_key /etc/nginx/certs/2_jhgrrewq.com.key;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://jack;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag"># Linux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/13/ssh + scp 登录 linux 服务器和传输文件/" rel="next" title="ssh + scp 登录 linux 服务器和传输文件">
                <i class="fa fa-chevron-left"></i> ssh + scp 登录 linux 服务器和传输文件
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/04/vue cli/" rel="prev" title="">
                 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars0.githubusercontent.com/u/8380737?s=460&v=4"
                alt="jhgrrewq" />
            
              <p class="site-author-name" itemprop="name">jhgrrewq</p>
              <p class="site-description motion-element" itemprop="description">爱好电影，更爱女神阿佳妮；爱网球，更爱罗杰费德勒。网易云音乐深度用户</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">117</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">81</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/jhgrrewq" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#重装系统后重新登录"><span class="nav-number">1.</span> <span class="nav-text">重装系统后重新登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#登录-登出"><span class="nav-number">2.</span> <span class="nav-text">登录 登出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更改-shell"><span class="nav-number">3.</span> <span class="nav-text">更改 shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#账号权限"><span class="nav-number">4.</span> <span class="nav-text">账号权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#删除用户"><span class="nav-number">4.1.</span> <span class="nav-text">删除用户</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无密码登录"><span class="nav-number">5.</span> <span class="nav-text">无密码登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常见-linux-操作"><span class="nav-number">6.</span> <span class="nav-text">常见 linux 操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增强服务器安全性"><span class="nav-number">7.</span> <span class="nav-text">增强服务器安全性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#修改-ssh-端口"><span class="nav-number">7.1.</span> <span class="nav-text">修改 ssh 端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#取消密码登录"><span class="nav-number">7.2.</span> <span class="nav-text">取消密码登录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#linux-包依赖安装"><span class="nav-number">8.</span> <span class="nav-text">linux 包依赖安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-Node-js"><span class="nav-number">9.</span> <span class="nav-text">安装 Node.js</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#直接下载二进制文件并解压"><span class="nav-number">9.1.</span> <span class="nav-text">直接下载二进制文件并解压</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行-npm-i-g-lt-package-gt-报错没有找到命令"><span class="nav-number">9.2.</span> <span class="nav-text">执行 npm i -g &lt;package&gt; 报错没有找到命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#当前用户当前-shell-有效"><span class="nav-number">9.2.1.</span> <span class="nav-text">当前用户当前 shell 有效</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#当前用户有效"><span class="nav-number">9.2.2.</span> <span class="nav-text">当前用户有效</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#所有用户"><span class="nav-number">9.2.3.</span> <span class="nav-text">所有用户</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-Node-js-常用依赖"><span class="nav-number">10.</span> <span class="nav-text">安装 Node.js 常用依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pm2-管理-node-进程"><span class="nav-number">11.</span> <span class="nav-text">pm2 管理 node 进程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#命令行"><span class="nav-number">11.1.</span> <span class="nav-text">命令行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置文件"><span class="nav-number">11.2.</span> <span class="nav-text">配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置-nginx"><span class="nav-number">12.</span> <span class="nav-text">配置 nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用命令"><span class="nav-number">12.1.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反向代理"><span class="nav-number">12.2.</span> <span class="nav-text">反向代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-ssl-证书"><span class="nav-number">12.3.</span> <span class="nav-text">配置 ssl 证书</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jhgrrewq</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




<div>备案号 <a class="theme-link" target="_blank" href="http://www.beian.miit.gov.cn">浙ICP备18011306号-1</a></div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  


</body>
</html>
